(()=>{"use strict";var e,t,n,o={633:(e,t,n)=>{var o=n(7774),i=n(917),r=n(403);function s(e,t,n,o,i,r,s){return{type:"s/LIST_TEMPLATE",imageId:e,title:t,canvasId:n,x:o,y:i,width:r,height:s}}function a(e){return{type:"s/REM_TEMPLATE",title:e}}function l(e,t){return{type:"s/CHG_TEMPLATE",title:e,props:t}}var c=n(940),d=n(669);const u=["g","h","x","m","t","r","l","+","-"];var h=n(906),p=n(4890),f=n(3894),v=n(6734);const m={showGrid:!1,showPixelNotify:!1,showMvmCtrls:!1,autoZoomIn:!1,isPotato:!1,isLightGrid:!1,compactPalette:!1,paletteOpen:!0,mute:!1,chatNotify:!0,menuOpen:!1,onlineCanvas:!1,style:"default",holdPaint:c.EQ.OFF,easterEgg:!1,moveU:0,moveV:0,moveW:0},g={lastFetch:0,totalPixels:0,dailyTotalPixels:0,ranking:1488,dailyRanking:1488,online:{total:0},totalRanking:[],totalDailyRanking:[],dailyCRanking:[],prevTop:[],onlineStats:[],cHistStats:[],histStats:{users:[],stats:[]},pDailyStats:[],pHourlyStats:[]},w=15e3,y={mute:[],readTs:{},unread:{}},b={id:null,name:null,wait:null,coolDown:null,lastCoolDownEnd:null,messages:[],mailreg:!1,blockDm:!1,priv:!1,isOnMobile:!1,notification:null,userlvl:0},S=class{length;rgb;colors;abgr;fl;constructor(e){this.length=e.length,this.rgb=new Uint8Array(3*this.length),this.colors=new Array(this.length),this.abgr=new Uint32Array(this.length),this.fl=new Array(this.length);let t=0;for(let n=0;n<e.length;n++){const o=e[n][0],i=e[n][1],r=e[n][2];this.rgb[t++]=o,this.rgb[t++]=i,this.rgb[t++]=r,this.colors[n]=`rgb(${o}, ${i}, ${r})`,this.abgr[n]=4278190080|r<<16|i<<8|o,this.fl[n]=[o/256,i/256,r/256]}}isDark(e){return e*=3,.2126*this.rgb[e++]+.7152*this.rgb[e++]+.0722*this.rgb[e]<128}getIndexOfColor(e,t,n){const{rgb:o}=this;let i=o.length/3;for(;i>0;){i-=1;const r=3*i;if(o[r]===e&&o[r+1]===t&&o[r+2]===n)return i}return null}getClosestIndexOfColor(e,t,n){const{rgb:o}=this;let i=o.length/3,r=0,s=null;for(;i>0;){i-=1;const a=3*i;let l=(o[a]-e)**2;l+=(o[a+1]-t)**2,l+=(o[a+2]-n)**2,(null===s||s>l)&&(r=i,s=l)}return r}};var E=n(259);function C(e){const{canvasEndDate:t,isHistoricalView:n,is3D:o}=e;if(o&&n?e.isHistoricalView=!1:t&&!n&&(e.isHistoricalView=!0,e.historicalDate||(e.historicalDate=(0,E.UW)(t),e.historicalTime="0000")),e.isHistoricalView){const{historicalDate:t,canvasId:n,canvasSize:o,canvases:i}=e;e.historicalCanvasSize=(0,E.Ss)(t,o,i[n]?.historicalSizes)}return e}function T(e,t){const n=e.cli||0,{size:o,sd:i=null,ed:r=null,ident:s,colors:a}=e,l=!!e.v;let d=[0,0,c.A$],u=n;return t&&(d=t.view,u=t.selectedColor),{clrIgnore:n,canvasSize:o,canvasStartDate:i,canvasEndDate:r,canvasIdent:s,is3D:l,view:d,selectedColor:u,palette:new S(a,0)}}function k(e){const{hash:t}=window.location,n=decodeURIComponent(t).substring(1).split(",");let o=n[0],i=(0,E.s3)(e,o);if(!i&&window.ssv.dc&&(i=window.ssv.dc),!i||!window.ssv?.backupurl&&e[i].ed){i=c.V4;const t=e[c.V4];if(!t)return null;o=t.ident}const r=!!e[i].v,s=parseInt(n[1],10)||0,a=parseInt(n[2],10)||0;let l=parseInt(n[3],10);return Number.isNaN(l)?l=r?0:c.A$:r||(l=2**(l/10)),{canvasId:i,canvasIdent:o,view:[s,a,l]}}const I={canvasId:null,canvasIdent:"xx",canvases:{},canvasSize:65536,historicalCanvasSize:65536,is3D:null,canvasStartDate:null,canvasEndDate:null,canvasMaxTiledZoom:(0,E.W4)(65536),palette:new S([[0,0,0]]),clrIgnore:0,selectedColor:0,view:[0,0,c.A$],isHistoricalView:!1,historicalDate:null,historicalTime:null,hover:null,prevCanvasState:{}},x={ovEnabled:!1,mEnabled:!1,oOpacity:40,oSmallPxls:!0,oRightShift:!1,list:[]},N={channels:{},blocked:[],messages:{}};let _=0;const A={fetchingChunks:0,fetchingChat:!1,fetchingPixel:!1,fetchingApi:!1},L=(e,t)=>e&&e._persist&&e._persist.version===t?(console.log(`Store version: ${t}`),Promise.resolve(e)):(console.log("Newer version run, resetting store."),Promise.resolve({})),O={gui:(0,o.OJ)({key:"gui",storage:v.Z,version:17,migrate:L},(function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:m,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"s/TGL_GRID":return{...e,showGrid:!e.showGrid};case"s/TGL_PXL_NOTIFY":return{...e,showPixelNotify:!e.showPixelNotify};case"s/TGL_MVM_CTRLS":return{...e,showMvmCtrls:!e.showMvmCtrls};case"s/TGL_AUTO_ZOOM_IN":return{...e,autoZoomIn:!e.autoZoomIn};case"s/TGL_ONLINE_CANVAS":return{...e,onlineCanvas:!e.onlineCanvas};case"s/TGL_POTATO_MODE":return{...e,isPotato:!e.isPotato};case"s/TGL_LIGHT_GRID":return{...e,isLightGrid:!e.isLightGrid};case"s/TGL_COMPACT_PALETTE":return{...e,compactPalette:!e.compactPalette};case"s/TGL_OPEN_PALETTE":return{...e,paletteOpen:!e.paletteOpen};case"s/TGL_OPEN_MENU":return{...e,menuOpen:!e.menuOpen};case"s/TGL_MUTE":return{...e,mute:!e.mute};case"s/TGL_CHAT_NOTIFY":return{...e,chatNotify:!e.chatNotify};case"s/TGL_EASTER_EGG":return{...e,easterEgg:!e.easterEgg};case"s/SELECT_HOLD_PAINT":return{...e,holdPaint:t.value};case"s/SELECT_STYLE":{const{style:n}=t;return{...e,style:n}}case"SELECT_COLOR":{const{compactPalette:t}=e;let{paletteOpen:n}=e;return(t||window.innerWidth<300)&&(n=!1),{...e,paletteOpen:n}}case"s/SET_MOVE_U":{const{value:n}=t,o=n;return{...e,moveU:o}}case"s/SET_MOVE_V":{const{value:n}=t,o=n;return{...e,moveV:o}}case"s/SET_MOVE_W":{const{value:n}=t,o=n;return{...e,moveW:o}}case"s/CANCEL_MOVE":return{...e,moveU:0,moveV:0,moveW:0};case"persist/REHYDRATE":return{...e,easterEgg:!1,holdPaint:c.EQ.OFF,moveU:0,moveV:0,moveW:0};default:return e}})),ranks:(0,o.OJ)({key:"ranks",storage:v.Z,version:17,migrate:L},(function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:g,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"REC_SET_PXLS":{const{rankedPxlCnt:n}=t;if(!n)return e;let{totalPixels:o,dailyTotalPixels:i}=e;return o+=n,i+=n,{...e,totalPixels:o,dailyTotalPixels:i}}case"REC_ONLINE":{const{online:n}=t;return{...e,online:n}}case"s/REC_ME":case"s/LOGIN":{if(!t.totalPixels)return e;const{totalPixels:n,dailyTotalPixels:o,ranking:i,dailyRanking:r}=t;return{...e,totalPixels:n,dailyTotalPixels:o,ranking:i,dailyRanking:r}}case"REC_STATS":{const{totalRanking:n,totalDailyRanking:o,dailyCRanking:i,prevTop:r,onlineStats:s,cHistStats:a,histStats:l,pDailyStats:c,pHourlyStats:d}=t,u={totalRanking:n,totalDailyRanking:o,dailyCRanking:i,prevTop:r,onlineStats:s,cHistStats:a,histStats:l,pDailyStats:c,pHourlyStats:d},h=Date.now();return{...e,lastFetch:h,...u}}default:return e}})),chatRead:(0,o.OJ)({key:"cr",storage:v.Z,version:17,migrate:L},(function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:y,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"s/REC_ME":case"s/LOGIN":{const{channels:n}=t,o=Object.keys(n),i={},r={};for(let t=0;t<o.length;t+=1){const s=o[t];e.readTs[s]?i[s]=e.readTs[s]:i[s]=0,r[s]=n[s][2]>i[s]}return{...e,readTs:i,unread:r}}case"s/ADD_CHAT_CHANNEL":{const[n]=Object.keys(t.channel);return{...e,readTs:{...e.readTs,[n]:e.readTs[n]||0},unread:{...e.unread,[n]:!0}}}case"s/REMOVE_CHAT_CHANNEL":{const{cid:n}=t;if(!e.readTs[n])return e;const o={...e.readTs};delete o[n];const i={...e.unread};return delete i[n],{...e,readTs:o,unread:i}}case"s/REC_CHAT_MESSAGE":{const{channel:n,isRead:o}=t,i=o?{...e.readTs,[n]:Date.now()+w}:e.readTs,r=o?e.unread:{...e.unread,[n]:!0};return{...e,readTs:i,unread:r}}case"OPEN_WIN":{const{windowType:n}=t;if("CHAT"!==n)return e;const o=t.args&&t.args.chatChannel||1;return{...e,readTs:{...e.readTs,[o]:Date.now()+w},unread:{...e.unread,[o]:!1}}}case"MARK_CHANNEL_AS_READ":{const{cid:n}=t;return{...e,readTs:{...e.readTs,[n]:Date.now()+w},unread:{...e.unread,[n]:!1}}}case"s/MUTE_CHAT_CHANNEL":{const{cid:n}=t;return{...e,mute:[...e.mute,n]}}case"s/UNMUTE_CHAT_CHANNEL":{const{cid:n}=t,o=e.mute.filter((e=>e!==n));return{...e,mute:o}}default:return e}})),templates:(0,o.OJ)({key:"tem",storage:v.Z,version:17,migrate:L},(function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:x,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"s/LIST_TEMPLATE":{const{imageId:n,title:o,canvasId:i,x:r,y:s,width:a,height:l}=t;return{...e,list:[...e.list,{enabled:!0,title:o,canvasId:i,x:r,y:s,imageId:n,width:a,height:l}]}}case"s/CHG_TEMPLATE":{const{title:n,props:o}=t,{list:i}=e,r=i.findIndex((e=>e.title===n));return-1===r?e:{...e,list:[...i.slice(0,r),{...i[r],...o},...i.slice(r+1)]}}case"s/REM_TEMPLATE":return{...e,list:e.list.filter((e=>e.title!==t.title))};case"s/UPD_TEMPLATE_IMG":{const{imageId:n,width:o,height:i}=t,{list:r}=e,s=r.findIndex((e=>e.imageId===n));return-1===s?e:{...e,list:[...r.slice(0,s),{...r[s],imageId:n,width:o,height:i},...r.slice(s+1)]}}case"s/TGL_OVENABLED":return{...e,ovEnabled:!e.ovEnabled};case"s/TGL_SMALLPXLS":return{...e,oSmallPxls:!e.oSmallPxls};case"s/TGL_RIGHTSHIFT":return{...e,oRightShift:!e.oRightShift};case"s/SET_O_OPACITY":return{...e,oOpacity:t.opacity};case"TEMPLATES_READY":return{...e,available:!0};case"persist/REHYDRATE":return{...e,available:!1};default:return e}})),user:function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:b,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"COOLDOWN_SET":{const{coolDown:n}=t;return{...e,coolDown:n||null}}case"COOLDOWN_END":return{...e,coolDown:null,lastCoolDownEnd:Date.now(),wait:null};case"REC_SET_PXLS":{const{wait:n}=t;return{...e,wait:n?Date.now()+n:e.wait}}case"REC_COOLDOWN":{const{wait:n}=t,o=n?Date.now()+n:null;return{...e,wait:o,coolDown:null}}case"SET_MOBILE":{const{mobile:n}=t;return{...e,isOnMobile:n}}case"s/REC_ME":case"s/LOGIN":{const{id:n,name:o,mailreg:i,blockDm:r,priv:s,userlvl:a}=t,l=t.messages?t.messages:[];return{...e,id:n,name:o,messages:l,mailreg:i,blockDm:r,priv:s,userlvl:a}}case"s/LOGOUT":return{...e,id:null,name:null,messages:[],mailreg:!1,blockDm:!1,priv:!1,userlvl:0};case"s/SET_NAME":{const{name:n}=t;return{...e,name:n}}case"s/SET_BLOCKING_DM":{const{blockDm:n}=t;return{...e,blockDm:n}}case"s/SET_PRIVATE":{const{priv:n}=t;return{...e,priv:n}}case"SET_NOTIFICATION":return{...e,notification:t.notification};case"UNSET_NOTIFICATION":return{...e,notification:null};case"s/REM_FROM_MESSAGES":{const{message:n}=t,o=[...e.messages],i=o.indexOf(n);return i>-1&&o.splice(i),{...e,messages:o}}case"s/SET_MAILREG":{const{mailreg:n}=t;return{...e,mailreg:n}}default:return e}},canvas:function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:I,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"SET_HISTORICAL_TIME":{const{date:n,time:o}=t;return C({...e,historicalDate:n,historicalTime:o})}case"s/TGL_HISTORICAL_VIEW":return e.is3D||e.canvasEndDate?e:C({...e,isHistoricalView:!e.isHistoricalView});case"UPDATE_VIEW":{const{view:n}=t;return{...e,view:[...n]}}case"RELOAD_URL":{const{canvases:t}=e,n=k(t);if(!n)return e;if(n.canvasId!==e.canvasId){const{canvasId:o}=n,i=T(t[o],e.prevCanvasState[o]);return{...e,...i,...n}}return{...e,...n}}case"SELECT_COLOR":return{...e,selectedColor:t.color};case"SET_HOVER":{const{hover:n}=t;return{...e,hover:n}}case"UNSET_HOVER":return{...e,hover:null};case"s/SELECT_CANVAS":{let{canvasId:n}=t;const{canvases:o,prevCanvasState:i,canvasId:r}=e;let s=o[n];s||(n=c.V4,s=o[c.V4]);const a=T(s,i[n]);return C({...e,...a,canvasId:n,isHistoricalView:!e.canvasEndDate&&e.isHistoricalView,prevCanvasState:{...e.prevCanvasState,[r]:{view:e.view,selectedColor:e.selectedColor}}})}case"s/REC_ME":{const{canvases:n}=t;let{canvasId:o,view:i}=e;null===o&&({canvasId:o,view:i}=k(n));const r=T(n[o],e.prevCanvasState[o]);return C({...e,...r,canvasId:o,canvases:n,view:i})}default:return e}},chat:function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:N,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"s/REC_ME":case"s/LOGIN":{const n={},o=t.channels,i=Object.keys(o);for(let e=0;e<i.length;e+=1){const t=i[e];n[Number(t)]=o[t]}return{...e,channels:n,blocked:t.blocked}}case"s/LOGOUT":{const t={...e.channels},n={...e.messages},o=Object.keys(t);for(let e=0;e<o.length;e+=1){const i=o[e];0!==t[i][1]&&(delete n[i],delete t[i])}return{...e,channels:t,blocked:[],messages:n}}case"s/BLOCK_USER":{const{userId:n,userName:o}=t,i=[...e.blocked,[n,o]],r={...e.channels},s=Object.keys(r);for(let t=0;t<s.length;t+=1){const o=s[t];if(1===r[o][1]&&r[o][3]===n)return delete r[o],{...e,channels:r,blocked:i}}return{...e,blocked:i}}case"s/UNBLOCK_USER":{const{userId:n}=t,o=e.blocked.filter((e=>e[0]!==n));return{...e,blocked:o}}case"s/ADD_CHAT_CHANNEL":{const{channel:n}=t,o=Number(Object.keys(n)[0]);return e.channels[o]?e:{...e,channels:{...e.channels,...n}}}case"s/REMOVE_CHAT_CHANNEL":{const{cid:n}=t;if(!e.channels[n])return e;const o={...e.channels},i={...e.messages};return delete i[n],delete o[n],{...e,channels:o,messages:i}}case"s/REC_CHAT_MESSAGE":{const{name:n,text:o,country:i,channel:r,user:s}=t;if(!e.messages[r]||!e.channels[r])return e;const a=Math.round(Date.now()/1e3);_+=1;const l={...e.messages,[r]:[...e.messages[r],[n,o,i,s,a,_]]};l[r].length>c.Kb&&l[r].splice(0,2);const d=[...e.channels[r]];return d[2]=Date.now(),{...e,channels:{...e.channels,[r]:d},messages:l}}case"s/REC_CHAT_HISTORY":{const{cid:n,history:o}=t;for(let e=0;e<o.length;e+=1)_+=1,o[e].push(_);return{...e,messages:{...e.messages,[n]:o}}}default:return e}},fetching:function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:A,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"s/SET_CHAT_FETCHING":{const{fetching:n}=t;return{...e,fetchingChat:n}}case"SET_API_FETCHING":{const{fetching:n}=t;return{...e,fetchingApi:n}}case"REQ_BIG_CHUNK":{const{fetchingChunks:t}=e;return{...e,fetchingChunks:t+1}}case"REC_BIG_CHUNK":case"REC_BIG_CHUNK_FAILURE":{const{fetchingChunks:t}=e;return{...e,fetchingChunks:t-1}}case"SET_PXLS_FETCHING":{const{fetching:n}=t;return{...e,fetchingPixel:n}}default:return e}}};function P(e){let t=Math.floor(99999*Math.random())+1;for(;e.args[t];)t+=1;return t}function R(e,t){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],o=window.innerWidth,i=window.innerHeight;n&&(o=Math.floor(.7*o),i=Math.floor(Math.min(.8*i,900)));const r=e||o,s=t||i;return[(0,E.uZ)(r,70,o),(0,E.uZ)(s,50,i)]}function $(e,t,n,o){const i=e||0===e?e:Math.floor((window.innerWidth-n)/2),r=t||0===t?t:Math.floor((window.innerHeight-o)/2);return[(0,E.uZ)(i,70-n,window.innerWidth-70),(0,E.uZ)(r,0,window.innerHeight-30)]}function D(e){const{innerWidth:t,innerHeight:n}=window,{windows:o,positions:i}=e,r=t-70,s=n-30;let a=!1;const l={};for(let e=0;e<o.length;e+=1){const c=o[e].windowId,{xPos:d,yPos:u,width:h,height:p}=i[c],f=70-h;d>r||u>s||d<f||u<0||t>h||n>p?(a=!0,l[c]={xPos:(0,E.uZ)(d,f,r),yPos:(0,E.uZ)(u,0,s),width:Math.min(h,t-30),height:Math.min(p,n-30),z:i[c].z}):l[c]=i[c]}return a?{...e,positions:l}:e}function M(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(e.zMax>=50||t){const t={...e.positions},n=Object.keys(t),o=n.map((e=>t[e].z)).sort(((e,t)=>!t||e&&e>=t));for(let e=0;e<n.length;e+=1){const i=n[e];t[i]={...t[i],z:o.indexOf(t[i].z)}}e.zMax=o.length-1,e.positions=t}return e}const H={showWindows:window.innerWidth>604,zMax:0,windows:[],positions:{},args:{}},W={open:!1,alertType:null,title:null,message:null,btn:null},U=window.AudioContext||window.webkitAudioContext,V=U&&new U;function z(e){const t=new ArrayBuffer(2),n=new DataView(t);return n.setInt8(0,160),n.setInt8(1,Number(e)),t}var G=n(395),F=n(631);const q=new class{store=null;pixelTransferController=null;ws=null;getRenderer;constructor(){console.log("Creating WebSocketClient"),this.channelId=0,this.readyState=WebSocket.CLOSED,this.msgQueue=[],this.reqQueue=[],this.checkHealth=this.checkHealth.bind(this),setInterval(this.checkHealth,2e3)}initialize(e,t,n){return this.store=e,t&&(this.pixelTransferController=t),n&&(this.getRenderer=n),this.connect()}connect(){this.readyState=WebSocket.CONNECTING,this.ws&&console.log("WebSocket already open, not starting"),this.timeLastConnecting=Date.now();const e=`${"https:"===window.location.protocol?"wss:":"ws:"}//${F.uY||window.location.host}/ws`;this.ws=new WebSocket(e),this.ws.binaryType="arraybuffer",this.ws.onopen=this.onOpen.bind(this),this.ws.onmessage=this.onMessage.bind(this),this.ws.onclose=this.onClose.bind(this),this.ws.onerror=e=>{console.error("Socket encountered error, closing socket",e)}}checkHealth(){if(this.readyState===WebSocket.OPEN){const e=Date.now();e-3e4>this.timeLastPing&&(console.log("Server is silent, killing websocket"),this.readyState=WebSocket.CLOSING,this.ws.close()),e-23e3>this.timeLastSent&&(this.send(new Uint8Array([176]).buffer),this.timeLastSent=e)}}sendWhenReady(e){this.timeLastSent=Date.now(),this.readyState===WebSocket.OPEN?this.ws.send(e):(console.log("Tried sending message when websocket was closed!"),this.msgQueue.push(e))}send(e){this.readyState===WebSocket.OPEN&&this.ws.send(e)}processMsgQueue(){for(;this.msgQueue.length>0;)this.sendWhenReady(this.msgQueue.shift())}onOpen(){const e=Date.now();this.timeLastPing=e,this.timeLastSent=e,this.store.dispatch((0,G.$s)()),this.readyState=WebSocket.OPEN,this.send(z(this.store.getState().canvas.canvasId));const t=this.getRenderer?.().recChunkIds;t?.length&&(console.log(`Register ${t.length} chunks`),this.send(function(e){const t=new ArrayBuffer(2+2*e.length),n=new Uint16Array(t);n[0]=163;for(let t=0;t<e.length;t+=1)n[t+1]=e[t];return t}(t))),this.processMsgQueue()}setCanvas(e){null!==e&&(console.log(`Notify websocket server that we changed canvas to ${e}`),this.send(z(e)))}registerChunk(e){const t=function(e){const t=new ArrayBuffer(3),n=new DataView(t);return n.setInt8(0,161),n.setInt16(1,e),t}(e);this.readyState===WebSocket.OPEN&&this.send(t)}deRegisterChunks(e){const t=function(e){const t=new ArrayBuffer(2+2*e.length),n=new Uint16Array(t);n[0]=164;for(let t=0;t<e.length;t+=1)n[t+1]=e[t];return t}(e);this.readyState===WebSocket.OPEN&&this.send(t)}sendCaptchaSolution(e,t){return new Promise(((n,o)=>{let i;const r=["cs",e=>{n(e),clearTimeout(i)}];this.reqQueue.push(r),i=setTimeout((()=>{const e=this.reqQueue.indexOf(r);~e&&this.reqQueue.splice(e,1),o(new Error("Timeout"))}),2e4),this.sendWhenReady(`cs,${JSON.stringify([e,t])}`)}))}sendPixelUpdate(e,t,n){return new Promise(((o,i)=>{let r;const s=["pu",e=>{o(e),clearTimeout(r)}];this.reqQueue.push(s),r=setTimeout((()=>{const e=this.reqQueue.indexOf(s);~e&&this.reqQueue.splice(e,1),i(new Error("Timeout"))}),2e4),this.sendWhenReady(function(e,t,n){const o=new ArrayBuffer(3+4*n.length),i=new DataView(o);i.setUint8(0,193),i.setUint8(1,e),i.setUint8(2,t);let r=2,s=n.length;for(;s;){s-=1;const[e,t]=n[s];i.setUint8(r+=1,e>>>16),i.setUint16(r+=1,65535&e),i.setUint8(r+=2,t)}return o}(e,t,n))}))}sendChatMessage(e,t){this.sendWhenReady(`cm,${JSON.stringify([e,t])}`)}onMessage(e){let{data:t}=e;try{"string"==typeof t?this.onTextMessage(t):this.onBinaryMessage(t)}catch(e){console.log(`An error occurred while parsing websocket message ${t}`,e)}}onTextMessage(e){const t=e.indexOf(",");if(-1===t)return;const n=e.slice(0,t),o=JSON.parse(e.slice(t+1));switch(n){case"cm":this.store.dispatch((0,G.pl)(...o));break;case"ac":this.store.dispatch((0,G.dm)(o));break;case"rc":this.store.dispatch((0,G.jg)(o))}}onBinaryMessage(e){if(0===e.byteLength)return;const t=new DataView(e),n=t.getUint8(0);switch(this.timeLastPing=Date.now(),n){case 193:this.pixelTransferController&&this.pixelTransferController.receivePixelUpdate(function(e){const t=e.getUint8(1),n=e.getUint8(2),o=[];let i=e.byteLength;for(;i>3;){const t=e.getUint8(i-=1),n=e.getUint16(i-=2),r=e.getUint8(i-=1)<<16;o.push([r|n,t])}return{i:t,j:n,pixels:o}}(t));break;case 195:{const e=this.reqQueue.findIndex((e=>"pu"===e[0]));~e&&this.reqQueue.splice(e,1)[0][1](function(e){return{retCode:e.getUint8(1),wait:e.getUint32(2),coolDownSeconds:e.getInt16(6),pxlCnt:e.getUint8(8),rankedPxlCnt:e.getUint8(9)}}(t));break}case 167:this.store.dispatch((0,G.Wm)(function(e){const t={};t.total=e.getUint16(1);let n=e.byteLength;for(;n>3;){const o=e.getUint16(n-=2);t[e.getUint8(n-=1)]=o}return t}(t)));break;case 194:this.store.dispatch((0,G.At)(function(e){return e.getUint32(1)}(t)));break;case 166:console.log("Websocket requested api/me reload"),this.store.dispatch((0,d.aM)()),this.reconnect();break;case 198:{const e=this.reqQueue.findIndex((e=>"cs"===e[0]));~e&&this.reqQueue.splice(e,1)[0][1](function(e){return e.getUint8(1)}(t));break}default:console.error(`Unknown op_code ${n} received`)}}onClose(e){this.store.dispatch((0,G.WV)()),this.ws=null,this.readyState=WebSocket.CONNECTING;const t=this.timeLastConnecting<Date.now()-7e3?1e3:5e3;console.warn(`Socket is closed. Reconnect will be attempted in ${t} ms.`,e.reason),setTimeout((()=>this.connect()),t)}reconnect(){this.readyState===WebSocket.OPEN&&(this.readyState=WebSocket.CLOSING,console.log("Restarting WebSocket"),this.ws.onclose=null,this.ws.onmessage=null,this.ws.close(),this.ws=null,this.connect())}};var B=n(785);class j{type;static db;constructor(e){this.type=e}async initialize(){return await j.openDB(),this}static openDB(){return j.db?j.db:new Promise(((e,t)=>{const n=window.indexedDB.open("ppfun_files",1);n.onsuccess=t=>{const n=t.target.result;n.onerror=e=>{console.error("indexedDB error:",e.target.error)},j.db=n,e(n)},n.onupgradeneeded=e=>{const t=e.target.result.createObjectStore("files",{autoIncrement:!0});t.createIndex("type","type",{unique:!1}),t.createIndex("mimetype","mimetype",{unique:!1})},n.onerror=()=>{console.error("Error on opening indexedDB:",n.error),t(n.error)}}))}async saveFile(e){const{db:t}=j;if(!t)return null;const n=Array.isArray(e)?e:[e],o=await Promise.all(n.map((e=>e.arrayBuffer())));return new Promise(((i,r)=>{const s=[],a=t.transaction("files","readwrite");a.oncomplete=()=>{i(Array.isArray(e)?s:s[0])},a.onabort=e=>{e.stopPropagation(),r(e.target.error)};const l=a.objectStore("files");n.forEach(((e,t)=>{s.push(null),l.add({type:this.type,mimetype:e.type,buffer:o[t]}).onsuccess=e=>{s[t]=e.target.result}}))}))}async updateFile(e,t){const{db:n}=j;if(!n)return null;const o=await t.arrayBuffer();return new Promise(((i,r)=>{const s=n.transaction("files","readwrite");s.onabort=e=>{e.stopPropagation(),r(e.target.error)},s.objectStore("files").put({type:this.type,mimetpe:t.type,buffer:o},e).onsuccess=e=>i(e.target.result)}))}loadFile(e){const{db:t}=j;if(!t)return null;const n=Array.isArray(e)?e:[e];return new Promise(((o,i)=>{const r=[],s=t.transaction("files","readonly");s.oncomplete=()=>{o(Array.isArray(e)?r:r[0])},s.onabort=e=>{e.stopPropagation(),i(e.target.error)};const a=s.objectStore("files");n.forEach(((e,t)=>{r.push(null),a.get(e).onsuccess=e=>{r[t]=e.target.result}}))}))}deleteFile(e){const{db:t}=j;if(!t)return null;const n=Array.isArray(e)?e:[e];return new Promise(((e,o)=>{const i=t.transaction("files","readwrite");i.oncomplete=()=>{e()},i.onabort=e=>{e.stopPropagation(),o(e.target.error)};const r=i.objectStore("files");n.forEach((e=>{r.delete(e)}))}))}getAllKeys(){const{db:e}=j;return e?new Promise(((t,n)=>{const o=e.transaction("files","readonly");o.objectStore("files").index("type").getAllKeys(this.type).onsuccess=e=>{t(e.target.result)},o.onabort=e=>{e.stopPropagation(),n(e.target.error)}})):null}async sync(e){const t=await this.getAllKeys(),n=t.filter((t=>!e.includes(t)));n.length&&(console.log("Templaes: Keys in db but not in store",n),await this.deleteFile(n));const o=e.filter((e=>!t.includes(e)));return o.length&&console.log("Templates: Keys in store but not in db",o),o}}const Z=j;var K=n(875);const Y=class{image;id;width;height;ready=!1;#e;constructor(e){this.id=e}get imageSmall(){if(!this.#e){const e=this.image.getContext("2d").getImageData(0,0,this.width,this.height),t=document.createElement("canvas");t.width=3*this.width,t.height=3*this.height;const n=t.getContext("2d"),o=n.getImageData(0,0,t.width,t.height);let i=0,r=4*o.width+4;for(;i<e.data.length;){for(let t=0;t<e.width;t+=1)o.data[r]=e.data[i],o.data[++r]=e.data[++i],o.data[++r]=e.data[++i],o.data[++r]=e.data[++i],r+=9,i+=1;r+=4*o.width*2}n.putImageData(o,0,0),this.#e=t}return this.#e}async arrayBuffer(){return(0,K.nE)(this.image)}setDimensionFromCanvas(){const{width:e,height:t}=this.image;return this.width=e,this.height=t,this.read=!0,[e,t]}fromImage(e){return this.image=(0,K.zE)(e),this.setDimensionFromCanvas()}async fromFile(e){return this.image=await(0,K.NE)(e),this.setDimensionFromCanvas()}async fromBuffer(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"image/png";return this.image=await(0,K.NF)(e,t),this.setDimensionFromCanvas()}},Q=new class{#t;#n=new Z("templates");#o=new Map;ready=!1;async initialize(e){try{this.#t=e,await this.#n.initialize(),this.ready=!0,this.#t.dispatch({type:"TEMPLATES_READY"}),await this.syncDB()}catch(e){console.warn(`Couldn't initialize Templates: ${e.message}`)}}async getTemplate(e){if(!this.ready)return null;let t=this.#o.get(e);return t?t.image:(t=await this.loadExistingTemplate(e),t?t.image:null)}getTemplateSync(e){if(!this.ready)return null;const t=this.#o.get(e);return t?t.image:(this.loadExistingTemplate(e),null)}getSmallTemplateSync(e){if(!this.ready)return null;const t=this.#o.get(e);return t?t.imageSmall:(this.loadExistingTemplate(e),null)}getColorOfPixel(e,t,n){const o=this.#t.getState().templates.list.filter((o=>o.enabled&&o.canvasId===e&&o.x<=t&&o.y<=n&&o.x+o.width>t&&o.y+o.height>n));for(const e of o){const o=this.getTemplateSync(e.imageId);if(!o)continue;const i=o.getContext("2d").getImageData(t-e.x,n-e.y,1,1).data;if(i[3]>200)return[i[0],i[1],i[2]]}return null}getTemplatesInView(e,t,n,o,i){const r=t-o,s=n-i,a=t+o,l=n+i;return this.#t.getState().templates.list.filter((t=>t.enabled&&t.canvasId===e&&t.x<=a&&t.y<=l&&t.x+t.width>r&&t.y+t.height>s))}async syncDB(){try{const{list:e}=this.#t.getState().templates,t=e.map((e=>e.imageId)),n=await this.#n.sync(t);e.filter((e=>n.includes(e.imageId))).forEach((e=>{this.#t.dispatch(a(e.title))}))}catch(e){console.error(`Error on syncing templates store and indexedDB: ${e.message}`)}}async loadAllMissing(){const{templates:e}=this.#t.getState(),t=e.list.map((e=>e.imageId)).filter((e=>!this.#o.has(e)));for(const e of t)await this.loadExistingTemplate(e)}async loadExistingTemplate(e){try{const t=await this.#n.loadFile(e);if(!t)throw new Error("File does not exist in indexedDB");const{mimetype:n,buffer:o}=t,i=new Y(e);return await i.fromBuffer(o,n),this.#o.set(e,i),this.#t.dispatch({type:"REC_TEMPLATE"}),i}catch(t){return console.error(`Error loading template ${e}: ${t.message}`),null}}async addFile(e,t,n,o,i){try{const r=await this.#n.saveFile(e),a=new Y(r),l=await a.fromFile(e);this.#o.set(r,a),this.#t.dispatch(s(r,t,n,o,i,...l))}catch(e){console.error(`Error saving template ${t}: ${e.message}`)}}async updateFile(e,t){try{await this.#n.updateFile(e,t);const n=new Y(e),o=await n.fromFile(t);this.#o.set(e,n),this.#t.dispatch(function(e,t,n){return{type:"s/UPD_TEMPLATE_IMG",imageId:e,width:t,height:n}}(e,...o))}catch(t){console.error(`Error updating file ${e}: ${t.message}`)}}changeTemplate(e,t){this.#t.dispatch(l(e,t))}deleteTemplate(e){const{list:t}=this.#t.getState().templates,n=t.find((t=>t.title===e));if(!n)return;const{imageId:o}=n;this.#t.dispatch(a(e)),this.#n.deleteFile(o),this.#o.delete(o)}async exportEnabledTemplates(){const{list:e}=this.#t.getState().templates,t=e.filter((e=>e.enabled));if(!t.length||t.length>20)return this.#t.dispatch((0,r.UI)("Error :(","¡No se pueden exportar más de 20 o ninguna plantilla!","error")),null;const n=await this.#n.loadFile(t.map((e=>e.imageId))),o=[];for(let e=0;e<t.length;e+=1){const{buffer:i,mimetype:r}=n[e];o.push({...t[e],buffer:await(0,E.h$)(i),mimetype:r})}return o}async importTemplates(e){const t=JSON.parse(await e.text());if(!t.length||t.length>20)return void this.#t.dispatch((0,r.UI)("Error :(","No se pueden importar más de 20 o ninguna plantilla!","error"));const n=await Promise.all(t.map((e=>(0,E._V)(e.buffer)))),o=[];for(let e=0;e<t.length;e+=1){const{mimetype:i}=t[e];o.push(new Blob([n[e]],{type:i}))}const{list:i}=this.#t.getState().templates,a=await this.#n.saveFile(o),l=[];for(let e=0;e<t.length;e+=1){const{x:n,y:o,width:r,height:c,canvasId:d,title:u}=t[e],h=a[e],p=i.find((e=>e.title===u));p?(l.push(p.imageId),this.changeTemplate(u,{imageId:h,title:u,canvasId:d,x:n,y:o,width:r,height:c})):this.#t.dispatch(s(h,u,d,n,o,r,c))}l.length&&this.#n.deleteFile(l)}};window.templateLoader=Q;const X=Q,J=1.2;function ee(e,t,n,o,i){const{width:r,height:s}=t,a=t.getContext("2d");if(!a)return;a.globalAlpha=.5,a.fillStyle=i?"#DDDDDD":"#222222";let[l,c]=(0,E.nK)(n,o,t,[0,0]),[d,u]=(0,E.Cr)(n,o,t,[l,c]);for(;d<r;d+=o){const e=l++%10==0?2:1;a.fillRect(d,0,e,s)}for(;u<s;u+=o){const e=c++%10==0?2:1;a.fillRect(0,u,r,e)}a.globalAlpha=1}class te{store;renderer;viewport;clickTapStartView=[0,0];clickTapStartTime=0;tapStartDist=50;clickTapStartCoords=[0,0];speedScalar=0;isClicking=!1;isMultiTap=!1;wasEverMultiTap=!1;isTapPainting=!1;tapTimeout=null;prevTime=Date.now();coolDownDelta=!1;constructor(e,t,n){this.store=n,this.renderer=e,this.viewport=t,this.onMouseDown=this.onMouseDown.bind(this),this.onAuxClick=this.onAuxClick.bind(this),this.onMouseOut=this.onMouseOut.bind(this),this.onMouseMove=this.onMouseMove.bind(this),this.onWheel=this.onWheel.bind(this),this.onMouseUp=this.onMouseUp.bind(this),this.onTouchStart=this.onTouchStart.bind(this),this.onTouchEnd=this.onTouchEnd.bind(this),this.onTouchMove=this.onTouchMove.bind(this),t.addEventListener("auxclick",this.onAuxClick,!1),t.addEventListener("mousedown",this.onMouseDown,!1),t.addEventListener("mousemove",this.onMouseMove,!1),t.addEventListener("mouseup",this.onMouseUp,!1),t.addEventListener("wheel",this.onWheel,!1),t.addEventListener("touchstart",this.onTouchStart,!1),t.addEventListener("touchend",this.onTouchEnd,!1),t.addEventListener("touchmove",this.onTouchMove,!1),t.addEventListener("mouseout",this.onMouseOut,!1),t.addEventListener("touchcancel",this.onMouseOut,!1)}dispose(){}gotCoolDownDelta(e){this.coolDownDelta=!0,setTimeout((()=>{this.coolDownDelta=!1}),1e3*e)}onMouseDown(e){if(e.preventDefault(),document.activeElement.blur(),0===e.button){this.renderer.cancelStoreViewInState(),this.isClicking=!0;const{clientX:t,clientY:n}=e;this.clickTapStartTime=Date.now(),this.clickTapStartCoords=[t,n],this.clickTapStartView=this.renderer.view;const{viewport:o}=this;setTimeout((()=>{this.isClicking&&(o.style.cursor="move")}),300)}}onMouseUp(e){e.preventDefault();const{store:t,renderer:n}=this;if(0===e.button){this.isClicking=!1;const{clientX:o,clientY:i}=e,{clickTapStartCoords:r,clickTapStartTime:s}=this,a=[r[0]-o,r[1]-i].map(Math.abs);s>Date.now()-250&&a[0]<6&&a[1]<6&&te.placePixel(t,n,this.screenToWorld([o,i])),this.viewport.style.cursor="auto"}n.storeViewInState()}static getTouchCenter(e){let t=0,n=0;for(const{pageX:o,pageY:i}of e.touches)t+=o,n+=i;const{length:o}=e.touches;return[t/o,n/o]}static placePixel(e,t,n){let o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;const i=e.getState();if(i.canvas.isHistoricalView)return;const r=o??te.getWantedColor(i,t,n);if(null===r)return;const{viewscale:s}=t;if(i.gui.autoZoomIn&&s<8)return void t.updateView([n[0],n[1],12]);if(s<3)return;const a=t.getColorIndexOfPixel(...n);if(r===a)return;if(r<i.canvas.clrIgnore){const{palette:e}=i.canvas,{rgb:t}=e;let n=3*r;const o=t[n++],s=t[n++],l=t[n];if(e.getIndexOfColor(o,s,l)===a)return}const{canvasSize:l}=i.canvas,[c,d]=n;if(c>5275&&d>-8713&&c<5398&&d<-8614&&"0"===i.canvas.canvasId)return void(window.location.href="https://files.catbox.moe/gh2wtr.mp4");const u=l/2;if(c<-u||c>=u||d<-u||d>=u)return;const[p,f]=(0,E.sG)(l,c,d),v=(0,E.NK)(l,c,d);h.Z.tryPlacePixel(p,f,v,r,a)}static getMultiTouchDistance(e){if(e.touches.length<2)return 1;const t=e.touches[0],n=e.touches[1];return Math.sqrt((n.pageX-t.pageX)**2+(n.pageY-t.pageY)**2)}onTouchStart(e){e.preventDefault(),document.activeElement.blur(),this.renderer.cancelStoreViewInState(),this.clearTabTimeout(),this.isTapPainting=!1,this.clickTapStartTime=Date.now(),this.clickTapStartCoords=(0,E.bt)(e),this.clickTapStartView=this.renderer.view,e.touches.length>1?(this.tapStartDist=te.getMultiTouchDistance(e),this.isMultiTap=!0,this.wasEverMultiTap=!0):(this.isMultiTap=!1,this.wasEverMultiTap=!1,this.store.getState().gui.holdPaint?this.tapTimeout=setTimeout((()=>{this.isTapPainting=!0,te.placePixel(this.store,this.renderer,this.screenToWorld(this.clickTapStartCoords))}),200):this.tapTimeout=setTimeout((()=>{this.selectColorFromScreen(this.clickTapStartCoords)}),600))}onTouchEnd(e){if(e.preventDefault(),e.touches.length)return;const{store:t,renderer:n}=this;if(!this.wasEverMultiTap){const[n,o]=(0,E.bt)(e),{clickTapStartCoords:i,clickTapStartTime:s}=this,a=[i[0]-n,i[1]-o].map(Math.abs);s>Date.now()-580&&a[0]<6&&a[1]<6&&(te.placePixel(t,this.renderer,this.screenToWorld([n,o])),setTimeout((()=>{t.dispatch((0,r.BH)())}),500))}n.storeViewInState(),this.clearTabTimeout()}onTouchMove(e){e.preventDefault(),e.stopPropagation();const t=e.touches.length>1,n=this.store.getState(),[o,i]=(0,E.bt)(e);if(this.isMultiTap!==t)return this.wasEverMultiTap=!0,this.isMultiTap=t,this.clickTapStartCoords=[o,i],this.clickTapStartView=this.renderer.view,void(this.tapStartDist=te.getMultiTouchDistance(e));const{clickTapStartView:r,clickTapStartCoords:s}=this;if(t){this.clearTabTimeout();const t=e.touches[0],n=e.touches[1],o=Math.sqrt((n.pageX-t.pageX)**2+(n.pageY-t.pageY)**2)/this.tapStartDist,[i,s]=this.renderer.view;this.renderer.updateView([i,s,r[2]*o])}if(!n.gui.holdPaint||t){const[e,t]=r,n=o-s[0],a=i-s[1];(n>5||a>5)&&this.clearTabTimeout();const{viewscale:l}=this.renderer;this.renderer.updateView([e-n/l,t-a/l])}else this.wasEverMultiTap||this.coolDownDelta||(this.isTapPainting?te.placePixel(this.store,this.renderer,this.screenToWorld([o,i])):(this.clickTapStartCoords=[o,i],this.clickTapStartView=this.renderer.view,this.tapStartDist=te.getMultiTouchDistance(e)))}clearTabTimeout(){this.tapTimeout&&(clearTimeout(this.tapTimeout),this.tapTimeout=null)}zoom(e,t){const[n,o,i]=this.renderer.view,r=i>=1?1.1:1.04,s=e>0?i*r:i/r;this.renderer.updateView([n,o,s],t),this.renderer.storeViewInState()}step(e){const[t,n,o]=this.renderer.view,[i,r]=e.map((e=>100*e/o));this.renderer.updateView([t+i,n+r]),this.renderer.storeViewInState()}holdPaintStarted(e){if(!e)return;const{hover:t}=this.store.getState().canvas;t&&te.placePixel(this.store,this.renderer,t)}onWheel(e){e.preventDefault(),e.stopPropagation(),document.activeElement.blur();const{deltaY:t}=e,{store:n}=this,{hover:o}=n.getState().canvas,i=o||null;t<0&&this.zoom(1,i),t>0&&this.zoom(-1,i)}static getWantedColor(e,t,n){if(e.gui.holdPaint===c.EQ.HISTORY)return t.getColorIndexOfPixel(...n,!0);if(e.gui.holdPaint===c.EQ.OVERLAY){const{canvasId:t}=e.canvas,o=X.getColorOfPixel(t,...n);return o?e.canvas.palette.getClosestIndexOfColor(...o):null}return e.canvas.selectedColor}screenToWorld(e){return(0,E.nK)(this.renderer.view,this.renderer.viewscale,this.viewport,e)}setHoverFromScrrenCoor(e){const{store:t}=this,n=t.getState(),{hover:o}=n.canvas,i=this.screenToWorld(e),[s,a]=i,{canvasSize:l}=n.canvas,c=l/2;return s<-c||s>=c||a<-c||a>=c?(o&&t.dispatch((0,r.BH)()),null):o&&o[0]===s&&o[1]===a?null:(t.dispatch((0,r.GZ)(i)),i)}onMouseMove(e){e.preventDefault();const{clientX:t,clientY:n}=e,{renderer:o,isClicking:i}=this,{viewscale:r}=o;if(i){if(Date.now()<this.clickTapStartTime+100)return;const{clickTapStartView:e,clickTapStartCoords:o}=this,[i,s]=e,a=t-o[0],l=n-o[1];this.renderer.updateView([i-a/r,s-l/r])}else{const e=this.setHoverFromScrrenCoor([t,n]);if(!e)return;const o=this.store.getState();!this.coolDownDelta&&o.gui.holdPaint&&te.placePixel(this.store,this.renderer,e)}}onMouseOut(){const{store:e,viewport:t}=this;t.style.cursor="auto",e.dispatch((0,r.BH)()),this.isClicking=!1,this.clearTabTimeout()}selectColorFromScreen(e){const{renderer:t,store:n}=this;if(this.renderer.viewscale<3)return;const o=this.screenToWorld(e),i=t.getColorIndexOfPixel(...o);null!==i&&n.dispatch((0,r.Oh)(i))}onAuxClick(e){const{which:t,clientX:n,clientY:o}=e;2===t&&(e.preventDefault(),this.selectColorFromScreen([n,o]))}update(){let e=Date.now();const{moveU:t,moveV:n,moveW:o}=this.store.getState().gui;if(!(t||n||o))return this.prevTime=e,this.speedScalar=0,!1;e-=this.prevTime,this.prevTime+=e,this.speedScalar=Math.min(1,this.speedScalar+.025);const[i,r,s]=this.renderer.view,a=.4*e/s*this.speedScalar;let l=s>=1?1.0005:1.0003;return l**=o*this.speedScalar,this.renderer.updateView([i+a*t,r+a*n,s*l**e]),!0}}const ne=te;var oe=n(686),ie=n(802);class re extends ie.Z{image;ready;isEmpty;palette;constructor(e){super(arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,arguments.length>3&&void 0!==arguments[3]?arguments[3]:0),this.palette=e,this.image=document.createElement("canvas"),this.image.getContext("2d"),this.image.width=c.I_,this.image.height=c.I_,this.ready=!1,this.isEmpty=!1}fromBuffer(e){this.recUpdates=!0;const t=new ImageData(c.I_,c.I_),n=new Uint32Array(t.data.buffer),{abgr:o}=this.palette;let i=e.byteLength;for(let t=0;t<i;t+=1)n[t]=o[63&e[t]];const r=c.I_**2,s=this.palette.abgr[0];for(;i<r;)n[i]=s,i+=1;this.image.getContext("2d").putImageData(t,0,0),this.ready=!0}preLoad(e,t,n,o){if(this.ready)return;this.ready=!0;const i=this.image.getContext("2d");i.save(),i.msImageSmoothingEnabled=!1,i.webkitImageSmoothingEnabled=!1,i.imageSmoothingEnabled=!1,i.scale(t,t);const r=c.I_/t;i.drawImage(e,n,o,r,r,0,0,r,r),i.restore()}fromImage(e){this.ready=!0,this.image.getContext("2d").drawImage(e,0,0)}empty(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this.ready=!0,this.isEmpty=!0,!e){const{image:e,palette:t}=this,n=e.getContext("2d");n.fillStyle=t.colors[0],n.fillRect(0,0,c.I_,c.I_)}}static getIndexFromCell(e){let[t,n]=e;return t+c.I_*n}getColorIndex(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];const[n,o]=e,i=this.image.getContext("2d").getImageData(n,o,1,1).data;return t||0!==i[3]?t?this.palette.getClosestIndexOfColor(i[0],i[1],i[2]):this.palette.getIndexOfColor(i[0],i[1],i[2]):null}hasColorIn(e,t){const n=re.getIndexFromCell(e),o=this.image.getContext("2d").getImageData(0,0,c.I_,c.I_);return new Uint32Array(o.data.buffer)[n]===this.palette.abgr[t]}setColor(e,t){const[n,o]=e,i=this.image.getContext("2d");return i.fillStyle=this.palette.colors[t],i.fillRect(n,o,1,1),!0}}const se=re,ae=/^([\w]+:)?\/\//;function le(e){return new Promise(((t,n)=>{const o=new Image;o.addEventListener("load",(()=>t(o))),o.addEventListener("error",(()=>{n(new Error(`Failed to load image's URL: ${e}`))})),function(e){return ae&&e.replace(ae,"").indexOf(window.location.host)}(e)&&(o.crossOrigin="anonymous"),o.src=e}))}const ce=new class{tiles;constructor(){this.tiles={},this.loadLoadingTile(0)}getTile(e){return void 0===this.tiles[e]&&this.loadLoadingTile(e),this.tiles[e]||this.tiles[0]||null}async loadLoadingTile(e){null!==this.tiles[e]&&(this.tiles[e]=null,this.tiles[e]=await le(`./loading${e}.png`))}};class de extends oe.Z{canvasMaxTiledZoom;historicalMaxTiledZooms;palette;canvasSize;constructor(e,t,n,o,i){super(e,t),this.palette=n,this.canvasSize=o,this.canvasMaxTiledZoom=(0,E.W4)(o),this.historicalMaxTiledZooms=i?i.map((e=>{const[t,n]=e;return[t,(0,E.W4)(n)]})):[]}getPixelUpdate(e,t,n,o){const i=this.cget(`${this.canvasMaxTiledZoom}:${e}:${t}`);if(i){const e=n%c.I_,t=Math.floor(n/c.I_);i.setColor([e,t],o)}}getColorIndexOfPixel(e,t){const{canvasSize:n}=this,[o,i]=(0,E.sG)(n,e,t),r=`${this.canvasMaxTiledZoom}:${o}:${i}`,s=this.cget(r);return s?s.getColorIndex((0,E.D0)(n,[e,t])):null}getHistoricalIndexOfPixel(e,t,n,o,i){if(!n)return null;const[r,s]=(0,E.sG)(i,e,t),a=(0,E.D0)(i,[e,t]),l=Date.now();if(o&&o&&"0000"!==o){const e=`${n}${o}:${r}:${s}`,t=this.cget(e);if(t){const e=t.getColorIndex(a,!1);if(t.timestamp=l,null!==e)return e}}const c=`${n}:${r}:${s}`,d=this.cget(c);return d?(d.timestamp=l,d.getColorIndex(a)):null}preLoadChunk(e,t,n,o){if(e<=0)return null;try{let i=e-1,r=c.p7,[s,a]=[t,n].map((e=>Math.floor(e/r))),l=this.getChunk(i,s,a,!1,!1,!0);if(l||(i>0&&(i-=1),r=c.p7**(e-i),[s,a]=[t,n].map((e=>Math.floor(e/r))),l=this.getChunk(i,s,a,!0,!1,!0)),l){const e=t%r*c.I_/r,i=n%r*c.I_/r;return o.preLoad(l,r,e,i),o.image}}catch(o){return console.warn(`Error occurred while preloading for ${e}:${t}:${n}`,o),null}return null}getChunk(e,t,n){let o=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],i=!(arguments.length>4&&void 0!==arguments[4])||arguments[4],r=!(arguments.length>5&&void 0!==arguments[5])||arguments[5];const s=`${e}:${t}:${n}`;let a=this.cget(s);if(a){if(a.ready)return a.image}else o&&(a=new se(this.palette,e,t,n),this.cset(s,a),this.canvasMaxTiledZoom===e?this.fetchBaseChunk(t,n,a):this.fetchTile(e,t,n,a));if(r&&a){const o=this.preLoadChunk(e,t,n,a);if(o)return o}return i?ce.getTile(this.canvasId):null}getHistoricalChunk(e,t,n,o){let i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,r=i?`${o}${i}`:o;r+=`:${e}:${t}`;const s=this.cget(r),{canvasId:a}=this;if(s)return s.ready?s.image:i?null:ce.getTile(a);if(n){const n=(0,E.Ss)(o,this.canvasMaxTiledZoom,this.historicalMaxTiledZooms),s=new se(this.palette,n,e,t);this.cset(r,s),this.fetchHistoricalChunk(e,t,o,i,s)}return i?null:ce.getTile(a)}async fetchHistoricalChunk(e,t,n,o,i){const{canvasId:r}=this;let s=`${window.ssv.backupurl}/${n.slice(0,4)}/${n.slice(4,6)}/${n.slice(6)}/`;s+=o?`${r}/${o}/${e}/${t}.png`:`${r}/tiles/${e}/${t}.png`,this.bcReqChunk(i);try{const e=await le(s);i.fromImage(e),this.bcRecChunk(i)}catch(e){this.bcReqChunkFail(i,e),o?i.empty(!0):i.empty()}}async fetchBaseChunk(e,t,n){this.bcReqChunk(n);try{const o=`${F.Fx}/chunks/${this.canvasId}/${e}/${t}.bmp`,i=await fetch(o);if(!i.ok)throw new Error("Network response was not ok.");{const e=await i.arrayBuffer();if(!e.byteLength)throw new Error("Chunk response was invalid");{const t=new Uint8Array(e);n.fromBuffer(t)}this.bcRecChunk(n)}}catch(e){n.empty(),n.recUpdates=!0,this.bcReqChunkFail(n,e)}}async fetchTile(e,t,n,o){this.bcReqChunk(o);try{const i=`/tiles/${this.canvasId}/${e}/${t}/${n}.webp`,r=await le(i);o.fromImage(r),this.bcRecChunk(o)}catch(e){o.empty(),this.bcReqChunkFail(o,e)}}}const ue=de;class he{static NOTIFICATION_TIME=1100;scale;notifcircle;notificationRadius;pixelList;constructor(){this.pixelList=[],this.notificationRadius=150,this.notifcircle=document.createElement("canvas"),this.notifcircle.width=200,this.notifcircle.height=200;const e=this.notifcircle.getContext("2d");e&&(e.fillStyle="#FF000055",e.beginPath(),e.arc(100,100,100,0,2*Math.PI),e.closePath(),e.fill())}addPixel(e,t){this.pixelList.length<300&&this.pixelList.unshift([Date.now(),e,t])}doRender(){return 0!==this.pixelList.length}updateScale(e){this.scale=e,this.notificationRadius=(0,E.uZ)(10*this.scale,20,400)}render(e,t,n,o){const i=t.getContext("2d");if(!i)return;const r=Date.now();let s=this.pixelList.length;for(;s>0;){s--;const[e,a,l]=this.pixelList[s],c=r-e;if(c>he.NOTIFICATION_TIME){this.pixelList.pop();continue}const[d,u]=(0,E.Cr)(n,o,t,[a,l]).map((e=>e+this.scale/2)),h=c/he.NOTIFICATION_TIME*this.notificationRadius/100;i.save(),i.scale(h,h),i.drawImage(this.notifcircle,d/h-100,u/h-100),i.restore()}}}const pe=new he;class fe extends B.Z{canvasId=null;viewscale=0;centerChunk=[null,null];tiledScale=0;tiledZoom=4;hover=!1;viewport=null;lastFetch=0;canvas;oldHistoricalTime=null;constructor(e){super(e),this.is3D=!1,this.canvasMaxTiledZoom=0,this.historicalCanvasMaxTiledZoom=0,this.scaleThreshold=1;const t=document.createElement("canvas");t.className="viewport";const n=t.getContext("2d",{alpha:!1});this.viewport=t;const o=document.createElement("canvas"),i=o.getContext("2d",{alpha:!1});this.canvas=o,this.onWindowResize(),i.fillStyle="#C4C4C4",i.fillRect(0,0,this.canvas.width,this.canvas.height),n.fillStyle="#C4C4C4",n.fillRect(0,0,this.viewport.width,this.viewport.height),document.body.appendChild(this.viewport),this.onWindowResize=this.onWindowResize.bind(this),window.addEventListener("resize",this.onWindowResize),this.updateCanvasData(e.getState()),this.controls=new ne(this,this.viewport,e)}destructor(){this.controls.dispose(),window.removeEventListener("resize",this.onWindowResize),this.viewport.remove(),super.destructor()}getViewport(){return this.viewport}onWindowResize(){this.viewport.width=window.innerWidth,this.viewport.height=window.innerHeight;const e=2*Math.ceil(window.screen.width/2)+c.p7*c.I_,t=2*Math.ceil(window.screen.height/2)+c.p7*c.I_;this.canvas.width===e&&this.canvas.height===t||(console.log(`Noticed screen: ${e} / ${t}`),this.canvas.width=e,this.canvas.height=t,this.scaleThreshold=Math.min(e/c.I_/3,t/c.I_/3)),this.forceNextRender=!0}updateCanvasData(e){const{canvasId:t}=e.canvas;if(t!==this.canvasId){if(this.canvasId=t,null!==t){const{palette:n,canvasSize:o,canvases:i}=e.canvas;this.canvasMaxTiledZoom=(0,E.W4)(o),this.historicalCanvasMaxTiledZoom=this.canvasMaxTiledZoom,this.chunkLoader=new ue(this.store,t,n,o,i[t].historicalSizes)}this._view[2]=0,this.updateView(e.canvas.view),this.forceNextRender=!0}}updateOldHistoricalTime(e,t){this.oldHistoricalTime="0000"===t?null:t}updateHistoricalTime(e,t,n){this.historicalCanvasMaxTiledZoom=(0,E.W4)(n),this.forceNextRender=!0,this.updateView(this.store.getState().canvas.view)}getColorIndexOfPixel(e,t){if(arguments.length>2&&void 0!==arguments[2]&&arguments[2]){const n=this.store.getState(),{historicalDate:o,historicalTime:i,historicalCanvasSize:r}=n.canvas;return this.chunkLoader.getHistoricalIndexOfPixel(e,t,o,i,r)}return this.chunkLoader.getColorIndexOfPixel(e,t)}getPointedColor(){const{hover:e}=this.store.getState().canvas;return e?this.getColorIndexOfPixel(...e):null}updateView(e,t){let[n,o,i]=e;const r=this.store.getState(),{isHistoricalView:s}=r.canvas,a=s?r.canvas.historicalCanvasSize:r.canvas.canvasSize;if(i){const r=s?.7:c.I_/a;if(i=(0,E.uZ)(e[2],r,c.Fv),t){let e=this.viewscale;this.viewscale=i>.85&&i<1.2?1:i,e/=this.viewscale;const[r,s]=t;n=r+(n-r)*e,o=s+(o-s)*e}else this.viewscale=i}else[,,i]=this._view;const l=-a/2,d=a/2-1;n=(0,E.uZ)(n,l,d),o=(0,E.uZ)(o,l,d);const u=this.view[2];if(super.updateView([n,o,i]),u!==i){const{viewscale:e}=this;pe.updateScale(e);let t=e>.5?0:Math.round(2*Math.log2(e)/c.p7);t=c.p7**t;const n=(s?this.historicalCanvasMaxTiledZoom:this.canvasMaxTiledZoom)+2*Math.log2(t)/c.p7,o=e/t;this.tiledScale=t,this.tiledZoom=n,this.relScale=o,e<this.scaleThreshold||u<this.scaleThreshold||r.templates.ovEnabled&&(u<=c.vB&&i>c.vB||u>c.vB&&i<=c.vB)?this.forceNextRender=!0:this.forceNextSubrender=!0}const h=this.centerChunk,p=(0,E.HD)(this.tiledScale,[n,o],a);h&&h[0]===p[0]&&h[1]===p[1]?this.forceNextSubrender=!0:(this.centerChunk=p,this.forceNextRender=!0)}renderPixel(e,t,n,o,i){const r=this.store.getState(),{canvasSize:s,palette:a,isHistoricalView:l}=r.canvas,d=this.viewscale;if(this.chunkLoader.getPixelUpdate(e,t,n,o),d<.8||l)return;const u=d>this.scaleThreshold?1:d,h=this.canvas.getContext("2d");if(!h)return;const[p,f]=(0,E._O)(e,t,n,s),[v,m]=this.centerChunk.map((e=>(e+.5)*c.I_-s/2)),{width:g,height:w}=this.canvas,y=(p-v)*u+g/2,b=(f-m)*u+w/2;y<0||y>=g||b<0||b>=w||(h.fillStyle=a.colors[o],h.fillRect(y,b,u,u),i&&pe.addPixel(p,f),this.forceNextSubrender=!0)}isChunkInView(e,t,n){const{tiledZoom:o}=this;if(e>o+1)return!1;let[i,r]=this.centerChunk,{relScale:s}=this;if(e!==o){const t=c.p7**(e-o);i=Math.floor(i*t),r=Math.floor(r*t),s*=t}const{width:a,height:l}=this.viewport,d=Math.ceil(a/c.I_/2/s),u=Math.ceil(l/c.I_/2/s);return Math.abs(t-i)<=d&&Math.abs(n-r)<=u}renderChunks(e){const t=this.canvas.getContext("2d");if(!t)return;const{centerChunk:n,tiledScale:o,tiledZoom:i,viewport:r,viewscale:s}=this,{canvasSize:a}=e.canvas;let{relScale:l}=this;s>=1?(t.msImageSmoothingEnabled=!1,t.webkitImageSmoothingEnabled=!1,t.imageSmoothingEnabled=!1):(t.msImageSmoothingEnabled=!0,t.webkitImageSmoothingEnabled=!0,t.imageSmoothingEnabled=!0);const{width:d,height:u}=r,h=Math.ceil(d/c.I_/2/l),p=Math.ceil(u/c.I_/2/l);s>this.scaleThreshold&&(l=1),t.save(),t.fillStyle="#C4C4C4",t.scale(l,l);const f=Date.now();let v=!1;f>this.lastFetch+150&&(this.lastFetch=f,v=!0);const m=this.canvas.width/2/l-c.I_/2,g=this.canvas.height/2/l-c.I_/2,[w,y]=n;let b;for(let e=-h;e<=h;e+=1)for(let n=-p;n<=p;n+=1){const r=w+e,s=y+n,l=m+e*c.I_,d=g+n*c.I_,u=a/c.I_;r<0||r>=u*o||s<0||s>=u*o?t.fillRect(l,d,c.I_,c.I_):(b=this.chunkLoader.getChunk(i,r,s),b?(t.drawImage(b,l,d),v&&(b.timestamp=f)):t.fillRect(l,d,c.I_,c.I_))}t.restore(),e.templates.ovEnabled&&(s<c.vB||!e.templates.oSmallPxls)&&function(e,t,n,o,i,r){if(!X.ready||o<.035)return;const{canvasSize:s,canvasId:a}=e.canvas,[l,d]=n.map((e=>e*c.I_/i+c.I_/2/i-s/2)),u=o>r?1:o,{width:h,height:p}=t,f=h/2/u,v=p/2/u,m=X.getTemplatesInView(a,l,d,f,v);if(!m.length)return;const g=t.getContext("2d");if(g){g.imageSmoothingEnabled=!1,g.save(),g.scale(u,u),g.globalAlpha=e.templates.oOpacity/100;for(const e of m){if(e.width*u<1||e.height*u<1)continue;const t=X.getTemplateSync(e.imageId);t&&g.drawImage(t,e.x-l+h/2/u,e.y-d+p/2/u)}g.restore()}}(e,this.canvas,n,s,this.tiledScale,this.scaleThreshold)}render(){if(!this.chunkLoader)return;super.render();const e=this.store.getState();e.canvas.isHistoricalView?this.renderHistorical(e):this.renderMain(e)}renderMain(e){const{_view:t,viewport:n,viewscale:o}=this,{showGrid:i,showPixelNotify:r,isPotato:s,isLightGrid:a}=e.gui,{fetchingPixel:l}=e.fetching,{canvasSize:d,hover:u}=e.canvas,[h,p]=t,[f,v]=this.centerChunk,m=o>=.5&&r&&pe.doRender(),g=o>=3&&!l&&(u||this.hover)&&!s,w=o>=3&&!l&&(u!==this.hover||this.forceNextRender||this.forceNextSubrender||m)&&s;if(!(this.forceNextRender||g||w||m||this.forceNextSubrender))return;this.hover=u,this.forceNextRender&&this.renderChunks(e),this.forceNextRender=!1,this.forceNextSubrender=!1;const{width:y,height:b}=n,S=n.getContext("2d");if(!S)return;S.msImageSmoothingEnabled=!1,S.webkitImageSmoothingEnabled=!1,S.imageSmoothingEnabled=!1;const C=d/2;o>this.scaleThreshold?(S.save(),S.scale(o,o),S.drawImage(this.canvas,y/2/o-this.canvas.width/2+((f+.5)*c.I_-C-h),b/2/o-this.canvas.height/2+((v+.5)*c.I_-C-p)),S.restore()):S.drawImage(this.canvas,Math.floor(y/2-this.canvas.width/2+((f+.5)*c.I_/this.tiledScale-C-h)*o),Math.floor(b/2-this.canvas.height/2+((v+.5)*c.I_/this.tiledScale-C-p)*o)),e.templates.ovEnabled&&e.templates.oSmallPxls&&o>=c.vB&&function(e,t,n,o){if(!X.ready)return;const{canvasId:i}=e.canvas,[r,s]=n,{width:a,height:l}=t,c=a/2/o,d=l/2/o,u=X.getTemplatesInView(i,r,s,c,d);if(!u.length)return;const h=t.getContext("2d");if(!h)return;const p=o/3;h.imageSmoothingEnabled=!1,h.save(),h.scale(p,p);for(const e of u){const t=X.getSmallTemplateSync(e.imageId);t&&h.drawImage(t,3*(e.x-r)+a/2/p,3*(e.y-s)+l/2/p)}h.restore()}(e,n,t,o),i&&o>=8&&ee(0,n,t,o,a),m&&pe.render(e,n,t,o),u&&g&&function(e,t,n,o){const i=t.getContext("2d"),{hover:r,palette:s,selectedColor:a}=e.canvas,[l,c]=(0,E.Cr)(n,o,t,r);i.save(),i.translate(l+o/2,c+o/2);const d=Math.sin(Date.now()/250)/4;i.rotate(d),i.fillStyle="#000",i.fillRect(-.6*o-1,-.6*o-1,o*J+2,o*J+2),i.fillStyle=s.colors[a],i.fillRect(.6*-o,.6*-o,o*J,o*J),i.restore()}(e,n,t,o),u&&w&&function(e,t,n,o){const i=t.getContext("2d"),{palette:r,selectedColor:s,hover:a}=e.canvas,[l,c]=(0,E.Cr)(n,o,t,a);i.save(),i.fillStyle="#000",i.fillRect(l-1,c-1,4,o+2),i.fillRect(l-1,c-1,o+2,4),i.fillRect(l+o-2,c-1,4,o+2),i.fillRect(l-1,c+o-2,o+1,4),i.fillStyle=r.colors[s],i.fillRect(l,c,2,o),i.fillRect(l,c,o,2),i.fillRect(l+o-1,c,2,o),i.fillRect(l,c+o-1,o,2),i.restore()}(e,n,t,o)}renderHistoricalChunks(e){const t=this.canvas.getContext("2d");if(!t)return;const{centerChunk:n,viewport:o,viewscale:i,oldHistoricalTime:r}=this,{historicalDate:s,historicalTime:a,historicalCanvasSize:l}=e.canvas;i>=1?(t.msImageSmoothingEnabled=!1,t.webkitImageSmoothingEnabled=!1,t.imageSmoothingEnabled=!1):(t.msImageSmoothingEnabled=!0,t.webkitImageSmoothingEnabled=!0,t.imageSmoothingEnabled=!0);const d=i>this.scaleThreshold?1:i,{width:u,height:h}=o,p=Math.ceil(u/c.I_/2/d),f=Math.ceil(h/c.I_/2/d);if(t.save(),t.fillStyle="#C4C4C4",!s||!a)return t.fillRect(0,0,this.canvas.width,this.canvas.height),void t.restore();t.scale(d,d);const v=Date.now();let m=!1;v>this.lastFetch+150&&(this.lastFetch=v,m=!0);const g=this.canvas.width/2/d-c.I_/2,w=this.canvas.height/2/d-c.I_/2,[y,b]=n;let S;for(let e=-p;e<=p;e+=1)for(let n=-f;n<=f;n+=1){const o=y+e,i=b+n,d=g+e*c.I_,u=w+n*c.I_,h=l/c.I_;if(o<0||o>=h||i<0||i>=h)t.fillRect(d,u,c.I_,c.I_);else{if(S=this.chunkLoader.getHistoricalChunk(o,i,!0,s),S?(t.drawImage(S,d,u),m&&(S.timestamp=v)):t.fillRect(d,u,c.I_,c.I_),"0000"===a)continue;S=this.chunkLoader.getHistoricalChunk(o,i,!0,s,a),S?S.isEmpty||(t.drawImage(S,d,u),m&&(S.timestamp=v)):r&&(S=this.chunkLoader.getHistoricalChunk(o,i,!1,s,r),S&&!S.isEmpty&&(t.drawImage(S,d,u),m&&(S.timestamp=v)))}}t.restore()}renderHistorical(e){const{viewport:t,viewscale:n}=this,{showGrid:o,isLightGrid:i}=e.gui,{historicalCanvasSize:r}=e.canvas,[s,a]=this._view,[l,d]=this.centerChunk;if(!this.forceNextRender&&!this.forceNextSubrender)return;this.forceNextRender&&this.renderHistoricalChunks(e),this.forceNextRender=!1,this.forceNextSubrender=!1;const{width:u,height:h}=t,p=t.getContext("2d");if(!p)return;p.msImageSmoothingEnabled=!1,p.webkitImageSmoothingEnabled=!1,p.imageSmoothingEnabled=!1;const f=r/2;n>this.scaleThreshold?(p.save(),p.scale(n,n),p.drawImage(this.canvas,u/2/n-this.canvas.width/2+((l+.5)*c.I_-f-s),h/2/n-this.canvas.height/2+((d+.5)*c.I_-f-a)),p.restore()):p.drawImage(this.canvas,Math.floor(u/2-this.canvas.width/2+((l+.5)*c.I_-f-s)*n),Math.floor(h/2-this.canvas.height/2+((d+.5)*c.I_-f-a)*n)),o&&n>=8&&ee(0,t,this._view,n,i)}}const ve=fe,me=new B.Z;let ge=me;async function we(e,t){switch(ge.destructor(),t){case!0:if((0,E.b3)()){const t=(await Promise.all([n.e(841),n.e(882)]).then(n.bind(n,156))).default;ge=new t(e)}else e.dispatch((0,r.UI)("Error de lienzo","No se puede renderizar el lienzo 3D. ¿Tienes WebGL2 deshabilitado?","error","OK")),ge=me;break;case!1:ge=new ve(e);break;default:ge=me}return ge}function ye(){return ge}!function e(){ge.render(),window.requestAnimationFrame(e)}();const be="PixelPlanet.fun";let Se=null;const Ee=new class{constructor(){this.wins=[],this.origin=window.location.origin,window.addEventListener("beforeunload",(()=>{this.dispatch((0,r.Rz)())}))}add(e){-1===this.wins.indexOf(e)&&this.wins.push(e)}remove(e){const t=this.wins.indexOf(e);~t&&this.wins.splice(t,1)}dispatch(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const{wins:n}=this;try{for(let o=0;o<n.length;o+=1){const i=n[o];i.closed?(n.splice(o,1),o-=1):i!==t&&i.postMessage(e,this.origin)}}catch{return!1}return!0}closeAll(){for(;this.wins.length;)this.wins.pop().close()}};var Ce=n(7187);let Te=!1;const ke=new(n.n(Ce)());function Ie(e){!Te||e.is3D||e.origUpdateView||(console.log("Extension hooked into Renderer"),e.origUpdateView=e.updateView,e.updateView=function(){const[e,t,n]=this._view;this.origUpdateView(...arguments);const[o,i,r]=this._view;if(o===e&&i===t||ke.emit("setviewcoordinates",[o,i]),r!==n){const e=(arguments.length<=1?void 0:arguments[1])&&r>.85&&r<1.2?1:r;ke.emit("setscale",e)}})}!function(){function e(){console.log("Extension active"),ke.once=ke.origOnce,ke.addListener=ke.origAdd,ke.on=ke.addListener,delete ke.origOnce,delete ke.origAdd,Te=!0,Ie(ye())}ke.origOnce=ke.once,ke.origAdd=ke.addListener,ke.once=function(){ke.origOnce(...arguments),e()},ke.addListener=function(){ke.origAdd(...arguments),e()},ke.on=ke.addListener}(),window.pixelPlanetEvents=ke;const xe=(0,o.OJ)({key:"wind",storage:v.Z,version:17,migrate:L},(function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:H,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"OPEN_WIN":{const{windowType:n,title:o,cloneable:i,args:r,xPos:s,yPos:a,width:l,height:c}=t,[d,u]=R(l,c,!0),[h,p]=$(s,a,d,u),f=!e.showWindows||t.fullscreen;if(e.windows.length>=100)return e;const v=P(e),m=e.zMax+1;return M({...e,zMax:m,windows:[...e.windows,{windowId:v,windowType:n,open:!0,hidden:!1,fullscreen:f,title:o,cloneable:i}],args:{...e.args,[v]:{...r}},positions:{...e.positions,[v]:{width:d,height:u,xPos:h,yPos:p,z:m}}})}case"REMOVE_WIN":{const{windowId:n}=t,o={...e.args},i={...e.positions};return delete o[n],delete i[n],{...e,windows:e.windows.filter((e=>e.windowId!==n)),args:o,positions:i}}case"CLOSE_WIN":{const{windowId:n}=t,o=e.windows.map((e=>e.windowId!==n?e:{...e,open:!1}));return{...e,windows:o}}case"CLOSE_ALL_WIN_TYPE":{const{windowType:n}=t,o=e.windows.map((e=>e.windowType!==n?e:{...e,open:!1}));return{...e,windows:o}}case"HIDE_ALL_WIN_TYPE":{const{windowType:n,hide:o}=t,i=e.windows.map((e=>e.windowType!==n?e:{...e,hidden:o}));return{...e,windows:i}}case"CLONE_WIN":{const{windowId:n}=t,o=e.windows.find((e=>e.windowId===n)),i=e.positions[n],r=P(e),s=e.zMax+1,{innerWidth:a,innerHeight:l}=window;return M({...e,zMax:s,windows:[...e.windows,{...o,windowId:r}],args:{...e.args,[r]:{...e.args[n]}},positions:{...e.positions,[r]:{...i,xPos:Math.min(i.xPos+15,a-70),yPos:Math.min(i.yPos+15,l-30),z:s}}})}case"CHANGE_WIN_TYPE":{const{windowId:n,windowType:o,title:i}=t,r={...e.args,[n]:{...t.args}},s=e.windows.map((e=>e.windowId!==n?e:{...e,windowType:o,title:i}));return{...e,args:r,windows:s}}case"FOCUS_WIN":{const{windowId:n}=t,{zMax:o}=e,{z:i}=e.positions[n];return i===o?e:M({...e,zMax:o+1,positions:{...e.positions,[n]:{...e.positions[n],z:o+1}}})}case"TGL_MAXIMIZE_WIN":{const{windowId:n}=t,o=e.windows.map((e=>e.windowId!==n?e:{...e,fullscreen:!e.fullscreen,open:!0,hidden:!1}));return{...e,windows:o}}case"CLOSE_FULLSCREEN_WINS":{const t=e.windows.map((e=>e.fullscreen?{...e,open:!1}:e));return{...e,windows:t}}case"MOVE_WIN":{const{windowId:n,xDiff:o,yDiff:i}=t;let{xPos:r,yPos:s}=e.positions[n];const{width:a,height:l}=e.positions[n];return[r,s]=$(r+o,s+i,a,l),{...e,positions:{...e.positions,[n]:{...e.positions[n],xPos:r,yPos:s}}}}case"RESIZE_WIN":{const{windowId:n,xDiff:o,yDiff:i}=t;let{width:r,height:s}=e.positions[n];return[r,s]=R(r+o,s+i,!1),{...e,positions:{...e.positions,[n]:{...e.positions[n],width:r,height:s}}}}case"persist/REHYDRATE":{const{showWindows:n}=e;if(!n||"wind"!==t.key)return e;const o={...e,...t.payload},i={...o.args},r={...o.positions},s=o.windows.filter((e=>!(!e.open||!e.fullscreen&&!n)||(console.log(`Cleaning up window from previous session: ${e.windowId}`),delete i[e.windowId],delete r[e.windowId],!1)));return M(D({...o,windows:s,args:i,positions:r}))}case"WIN_RESIZE":{const t=window.innerWidth>604;return t?D(t===e.showWindows?e:{...e,showWindows:t}):{...e,showWindows:t}}case"SET_WIN_TITLE":{const{windowId:n,title:o}=t,i=e.windows.map((e=>e.windowId!==n?e:{...e,title:o}));return{...e,windows:i}}case"SET_WIN_ARGS":{const{windowId:n,args:o}=t;return{...e,args:{...e.args,[n]:{...e.args[n],...o}}}}default:return e}})),Ne=(0,p.UY)({...O,windows:xe,alert:function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:W,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"ALERT":{const{title:n,message:o,alertType:i,btn:r}=t;return{...e,open:!0,title:n,message:o,alertType:i,btn:r}}case"CLOSE_ALERT":return{...e,open:!1};default:return e}}}),_e=(0,p.MT)(Ne,(0,p.md)(f.Z,(()=>e=>t=>Array.isArray(t)?t.map(e):e(t)),(e=>t=>n=>{if(n instanceof MessageEvent){if(n.origin!==window.location.origin||!n.data.type)return null;if("t/UNLOAD"===n.data.type)console.log("popup closed"),Ee.remove(n.source);else if("t/LOAD"===n.data.type){const t=e.getState();n.source.postMessage((0,r.GY)(t),window.location.origin),Ee.add(n.source),console.log("popup added")}else n.data.type.startsWith("s/")&&Ee.dispatch(n.data,n.source);return t(n.data)}return Ee.wins.length&&n.type&&n.type.startsWith("s/")&&Ee.dispatch(n),t(n)}),(e=>t=>n=>{const o=e.getState(),{mute:i,chatNotify:r}=o.gui;if(!i&&V)switch(n.type){case"SELECT_COLOR":{const e=V.createOscillator(),t=V.createGain(),{currentTime:n}=V;e.type="sine",e.detune.value=-600,e.frequency.setValueAtTime(600,n),e.frequency.setValueAtTime(700,n+.1),t.gain.setValueAtTime(.3,n),t.gain.exponentialRampToValueAtTime(.2,n+.1),e.connect(t),t.connect(V.destination),e.start(),e.stop(n+.2);break}case"SET_NOTIFICATION":{const{notification:e}=n;if("string"!=typeof e)break;const t=V.createOscillator(),o=V.createGain(),{currentTime:i}=V;t.type="sine",t.detune.value=-1200,t.frequency.setValueAtTime(500,i),t.frequency.setValueAtTime(600,i+.1),o.gain.setValueAtTime(.3,i),o.gain.exponentialRampToValueAtTime(.2,i+.1),t.connect(o),o.connect(V.destination),t.start(),t.stop(i+.2);break}case"ALERT":{const e=V.createOscillator(),t=V.createGain(),{currentTime:o}=V;if("captcha"===n.alertType)e.type="sine",e.detune.value=-600,e.start(o),e.frequency.setValueAtTime(1479.98,o),e.frequency.exponentialRampToValueAtTime(493.88,o+.01),e.stop(o+.1),t.gain.setValueAtTime(.5,o),t.gain.setTargetAtTime(0,o,.1),e.connect(t),t.connect(V.destination);else{e.type="sine",e.detune.value=-900,e.start(o),e.frequency.setValueAtTime(600,o),e.frequency.setValueAtTime(1400,o+.025),e.frequency.setValueAtTime(1200,o+.05),e.frequency.setValueAtTime(900,o+.075),e.stop(o+.3);const n=V.createOscillator();n.type="sine",n.start(o),n.frequency.setValueAtTime(2,o),n.stop(o+.3),n.connect(t),t.gain.setValueAtTime(1,o),t.gain.setTargetAtTime(0,o,3),e.connect(t),t.connect(V.destination)}break}case"REC_SET_PXLS":switch(n.retCode){case 0:{const{palette:e,selectedColor:t}=o.canvas,n=e.colors.length,i=100+300*Math.log(t/n+1),r=V.createOscillator(),s=V.createGain(),{currentTime:a}=V;r.type="sine",r.start(a),r.frequency.setValueAtTime(i,a),r.frequency.exponentialRampToValueAtTime(1400,a+.2),r.stop(a+.1),s.gain.setValueAtTime(.5,a),s.gain.setTargetAtTime(0,a,.1),r.connect(s),s.connect(V.destination);break}case 9:{const e=V.createOscillator(),t=V.createGain(),{currentTime:n}=V;e.type="sine",e.start(n),e.frequency.setValueAtTime(1479.98,n),e.frequency.exponentialRampToValueAtTime(493.88,n+.01),e.stop(n+.1),t.gain.setValueAtTime(.5,n),t.gain.setTargetAtTime(0,n,.1),e.connect(t),t.connect(V.destination);break}}break;case"COOLDOWN_END":{const{lastCoolDownEnd:e}=o.user;if(e&&e+5e3>Date.now())break;const t=V.createOscillator(),n=V.createGain(),{currentTime:i}=V;t.type="sine",t.frequency.setValueAtTime(349.23,i),t.frequency.setValueAtTime(523.25,i+.1),t.frequency.setValueAtTime(698.46,i+.2),n.gain.setValueAtTime(.5,i),n.gain.exponentialRampToValueAtTime(.2,i+.15),t.connect(n),n.connect(V.destination),t.start(),t.stop(i+.3);break}case"s/REC_CHAT_MESSAGE":{if(r)break;const{isPing:e,channel:t}=n,{mute:i,chatChannel:s}=o.chatRead;if(i.includes(t)||i.includes(`${t}`))break;const{channels:a}=o.chat,l=V.createOscillator(),c=V.createGain(),{currentTime:d}=V;l.type="sine",l.frequency.setValueAtTime(310,d);const u=e||a[t]&&1===a[t][1]&&t!=s?540:355;l.frequency.exponentialRampToValueAtTime(u,d+.025),c.gain.setValueAtTime(.1,d),c.gain.exponentialRampToValueAtTime(.1,d+.1),l.connect(c),c.connect(V.destination),l.start(),l.stop(d+.075);break}}return t(n)}),(e=>t=>n=>{try{if(!document.hasFocus())switch(n.type){case"s/REC_ME":window.Notification&&"granted"!==Notification.permission&&"denied"!==Notification.permission&&Notification.requestPermission();break;case"COOLDOWN_END":{const t=e.getState(),{lastCoolDownEnd:n}=t.user;if(n&&n+15e3>Date.now())break;window.Notification&&"granted"===Notification.permission&&new Notification("Tus próximos píxeles están listos",{icon:"/tile.png",silent:!1,vibrate:[200,100],body:"Ahora puedes colocar más en pixelplanet.fun :)"});break}case"s/REC_CHAT_MESSAGE":{const t=e.getState(),{chatNotify:o}=t.gui;if(!o)break;const{isPing:i}=n;if(!i)break;const{name:r}=n;window.Notification&&"granted"===Notification.permission&&new Notification(`${r} te mencionó`,{icon:"/tile.png",silent:!1,vibrate:[200,100],body:"Tienes nuevos mensajes en el chat"});break}}}catch(e){console.error(e)}return t(n)}),(e=>t=>n=>{const o=t(n);switch(n.type){case"COOLDOWN_SET":{const{coolDown:t}=e.getState().user,n=`${(0,E.VL)(t,!0)} | ${be}`;if(Se===n)break;Se=n,document.title=n;break}case"COOLDOWN_END":document.title=be;break;case"s/SELECT_CANVAS":case"s/REC_ME":case"RELOAD_URL":case"UPDATE_VIEW":{const t=e.getState(),{view:o,canvasIdent:i,is3D:r}=t.canvas;if("UPDATE_VIEW"!==n.type){const[e,n,o]=t.canvas.palette.rgb;!function(e,t,n){const o=document.querySelector("meta[name=theme-color]");o&&o.setAttribute("content",`rgb(${e}, ${t}, ${n})`)}(e,n,o)}const s=`#${i},${o.map(((e,t)=>(2!==t||r||(e=10*Math.log2(e)),Math.round(e)))).join(",")}`;window.history.replaceState(void 0,void 0,s);break}}return o}),(e=>t=>n=>{switch(n.type){case"REC_BIG_CHUNK":case"REC_BIG_CHUNK_FAILURE":{const{chunk:e}=n;e.recUpdates&&q.registerChunk(n.chunk.id);break}case"REMOVE_CHUNKS":{const{chunks:e}=n,t=e.filter((e=>e.recUpdates)).map((e=>e.id));t.length&&q.deRegisterChunks(t);break}case"s/SET_NAME":case"s/LOGIN":case"s/LOGOUT":q.reconnect();break;case"s/REQ_CHAT_MESSAGE":{const{text:e,channel:t}=n;q.sendChatMessage(e,t);break}case"RELOAD_URL":case"s/SELECT_CANVAS":case"s/REC_ME":{const o=e.getState(),i=t(n),r=e.getState(),{canvasId:s}=r.canvas;return o.canvas.canvasId!==s&&q.setCanvas(s),i}}return t(n)}),(()=>e=>t=>{const{type:n}=t;switch(n){case"s/SELECT_CANVAS":ke.emit("selectcanvas",t.canvasId);break;case"SET_HOVER":ke.emit("sethover",t.hover);break;case"REC_BIG_CHUNK":ke.emit("receivechunk",t.chunk)}const o=e(t);switch(n){case"RELOAD_URL":case"s/SELECT_CANVAS":case"s/TGL_EASTER_EGG":case"s/REC_ME":Te&&Ie(ye())}return o}),(e=>t=>n=>{const{type:o}=n;switch(o){case"SET_HISTORICAL_TIME":{const t=e.getState(),n=ye(),{historicalDate:o,historicalTime:i}=t.canvas;n.updateOldHistoricalTime(o,i);break}case"SELECT_HOVER_COLOR":{const t=ye().getPointedColor();null!==t&&e.dispatch((0,r.Oh)(t));break}}const i=t(n),s=e.getState();switch(o){case"RELOAD_URL":case"s/SELECT_CANVAS":case"s/REC_ME":{const t=ye(),{is3D:n}=s.canvas;if(n===t.is3D?(t.updateCanvasData(s),"RELOAD_URL"===o&&t.updateView(s.canvas.view)):we(e,n),s.canvas.isHistoricalView){const{historicalDate:e,historicalTime:n,historicalCanvasSize:o}=s.canvas;t.updateHistoricalTime(e,n,o)}break}case"s/TGL_EASTER_EGG":{const t=ye(),{is3D:n}=s.canvas;n&&we(e,!t.is3D);break}case"SET_HISTORICAL_TIME":{const{historicalDate:e,historicalTime:t,historicalCanvasSize:n}=s.canvas;ye().updateHistoricalTime(e,t,n);break}case"s/CHG_TEMPLATE":case"s/TGL_OVENABLED":case"s/TGL_SMALLPXLS":case"s/REM_TEMPLATE":case"s/UPD_TEMPLATE_IMG":case"s/SET_O_OPACITY":case"REQ_BIG_CHUNK":case"PRE_LOADED_BIG_CHUNK":case"REC_BIG_CHUNK":case"REC_BIG_CHUNK_FAILURE":ye().forceNextRender=!0;break;case"s/TGL_GRID":case"ALLOW_SETTING_PXL":ye().forceNextSubrender=!0;break;case"s/TGL_HISTORICAL_VIEW":{const e=ye();e.updateView(e.view,e.view),e.forceNextRender=!0;break}case"s/SELECT_HOLD_PAINT":if(n.value){const e=ye();e.controls.holdPaintStarted?.(n.immediate)}break;case"s/SET_MOVE_U":case"s/SET_MOVE_V":case"s/SET_MOVE_W":case"s/CANCEL_MOVE":n.value||ye().storeViewInState();break;case"SET_VIEW_COORDINATES":{const e=ye();e.updateView(n.view),e.storeViewInState();break}case"SET_SCALE":{const e=ye(),[t,o]=e.view;e.updateView([t,o,n.scale],n.zoompoint),e.storeViewInState();break}case"REC_SET_PXLS":{const e=ye();e.forceNextSubrender=!0;const{coolDownSeconds:t}=n;t<0&&e&&e.controls&&e.controls.gotCoolDownDelta&&e.controls.gotCoolDownDelta(-1*t);break}}return i}))),Ae=_e;var Le,Oe=n(7294),Pe=n(743),Re=n(745),$e=n(7479);function De(e,t,n,o){Le||(Le="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var i=e&&e.defaultProps,r=arguments.length-3;if(t||0===r||(t={children:void 0}),1===r)t.children=o;else if(r>1){for(var s=new Array(r),a=0;a<r;a++)s[a]=arguments[a+3];t.children=s}if(t&&i)for(var l in i)void 0===t[l]&&(t[l]=i[l]);else t||(t=i||{});return{$$typeof:Le,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}function Me(){let e=(0,Pe.v9)((e=>e.gui.style));if(!window.ssv.availableStyles)return null;const t=new Date,n=t.getMonth()+1,o=t.getDate();(31===o&&10===n||1===o&&11===n)&&(e="dark-spooky");const i=window.ssv.availableStyles[e];return"default"!==e&&i?De("link",{rel:"stylesheet",type:"text/css",href:i}):null}const He=Oe.memo(Me);var We;function Ue(e,t,n,o){We||(We="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var i=e&&e.defaultProps,r=arguments.length-3;if(t||0===r||(t={children:void 0}),1===r)t.children=o;else if(r>1){for(var s=new Array(r),a=0;a<r;a++)s[a]=arguments[a+3];t.children=s}if(t&&i)for(var l in i)void 0===t[l]&&(t[l]=i[l]);else t||(t=i||{});return{$$typeof:We,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}const Ve=()=>{const[e,t,n]=(0,Pe.v9)((e=>[e.canvas.view,e.canvas.hover,e.canvas.is3D]),Pe.wU),o=(0,Pe.I0)();let r;if(t)r=t;else{const[t,o,i]=e;r=(n?[t,o,i]:[t,o]).map(Math.round)}return Ue("div",{className:"coorbox",onClick:()=>{(0,i.Z)(window.location.hash),o((0,d.h4)("Copiado"))},role:"button",title:"Copia al Portapapeles",tabIndex:"0"},void 0,`(${r.join(", ")})`)},ze=Oe.memo(Ve);var Ge=n(9583);const Fe={USERAREA:["activeTab"],CHAT:["chatChannel"]},qe=["HELP","SETTINGS","USERAREA","CHAT","CANVAS_SELECTION","ARCHIVE","REGISTER","FORGOT_PASSWORD"];function Be(){const e=window.location.pathname.split("/")[1];return e&&qe.includes(e.toUpperCase())}function je(e,t){const n={...t};let o=`/${e.toLowerCase()}`;const i=Fe[e];if(i)for(let e=0;e<i.length;e+=1){const t=i[e];n[t]&&(o+=`/${encodeURIComponent(n[t])}`,delete n[t])}let r=new URLSearchParams;const s=Object.keys(n);for(let e=0;e<s.length;e+=1){const t=s[e];r.append(t,n[t])}return r=r.toString(),r&&(o+=`?${r}`),o}const Ze=qe;function Ke(e){return{type:"OPEN_WIN",windowType:e,title:arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",args:arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,fullscreen:arguments.length>3&&void 0!==arguments[3]&&arguments[3],cloneable:!(arguments.length>4&&void 0!==arguments[4])||arguments[4],xPos:arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,yPos:arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,width:arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,height:arguments.length>8&&void 0!==arguments[8]?arguments[8]:null}}function Ye(e,t){return{type:"HIDE_ALL_WIN_TYPE",windowType:e,hide:t}}const Qe=(0,Oe.createContext)();function Xe(e,t,n,o,i,r){!function(e,t,n,o,i){let r,s;try{if(window.innerWidth<=604?(o=window.innerWidth,i=window.innerHeight,r=window.top.screenX,s=window.top.screenY):(r=Math.round(window.top.screenX+t),s=Math.round(window.top.screenY+n)),Number.isNaN(r)||Number.isNaN(s))throw new Error("NaN")}catch{r=0,s=0}try{return window.open(e,e,`popup=yes,width=${o},height=${i},left=${r},top=${s},toolbar=no,status=no,directories=no,menubar=no`)}catch{return null}}(je(e,t),n,o,i,r)}const Je=function(){const e=(0,Pe.I0)(),t=(0,Oe.useContext)(Qe);return(0,Oe.useCallback)((function(n){let o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const{xPos:i=null,yPos:r=null,width:s=null,height:a=null,args:l=null}=o;if("popup"===o.target)return void Xe(n,l,i,r,s,a);const{title:c=""}=o,d=!Be();if("blank"===o.target&&d){const{cloneable:t=!0}=o;e(Ke(n.toUpperCase(),c,l,!1,t,i,r,s,a))}else if("fullscreen"===o.target&&d){const{cloneable:t=!0}=o;e(Ke(n.toUpperCase(),c,l,!0,t,i,r,s,a))}else t?t.changeType(n,c,l):window.location.href=je(n,l)}),[t,e])};var et,tt;function nt(e,t,n,o){tt||(tt="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var i=e&&e.defaultProps,r=arguments.length-3;if(t||0===r||(t={children:void 0}),1===r)t.children=o;else if(r>1){for(var s=new Array(r),a=0;a<r;a++)s[a]=arguments[a+3];t.children=s}if(t&&i)for(var l in i)void 0===t[l]&&(t[l]=i[l]);else t||(t=i||{});return{$$typeof:tt,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}const ot=()=>{const e=Je();return nt("div",{id:"canvasbutton",className:"actionbuttons",onClick:()=>e("CANVAS_SELECTION",{target:"fullscreen"}),role:"button",title:"Selección de Lienzo",tabIndex:-1},void 0,et||(et=nt(Ge.n6C,{})))},it=Oe.memo(ot);var rt,st,at,lt,ct;function dt(e,t,n,o){ct||(ct="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var i=e&&e.defaultProps,r=arguments.length-3;if(t||0===r||(t={children:void 0}),1===r)t.children=o;else if(r>1){for(var s=new Array(r),a=0;a<r;a++)s[a]=arguments[a+3];t.children=s}if(t&&i)for(var l in i)void 0===t[l]&&(t[l]=i[l]);else t||(t=i||{});return{$$typeof:ct,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}const ut=()=>{const[e,t,n,o,i]=(0,Pe.v9)((e=>[e.ranks.online,e.ranks.totalPixels,e.user.name,e.gui.onlineCanvas,e.canvas.canvasId]),Pe.wU),s=(0,Pe.I0)();return dt("div",{className:"onlinebox",role:"button",tabIndex:"0",onClick:()=>s((0,r._)())},void 0,o?dt("span",{title:"Usuarios en línea en Canvas"},void 0,e[i]||0,rt||(rt=dt(Ge.Xws,{})),st||(st=dt(Ge.n6C,{}))):dt("span",{title:"Total de usuarios en línea"},void 0,e.total,at||(at=dt(Ge.Xws,{})))," ",null!=n&&dt("span",{title:"Pixels placed"},void 0,(0,E.D$)(t)," ",lt||(lt=dt(Ge._TT,{}))))},ht=Oe.memo(ut);var pt,ft,vt=n(5434);function mt(e,t,n,o){ft||(ft="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var i=e&&e.defaultProps,r=arguments.length-3;if(t||0===r||(t={children:void 0}),1===r)t.children=o;else if(r>1){for(var s=new Array(r),a=0;a<r;a++)s[a]=arguments[a+3];t.children=s}if(t&&i)for(var l in i)void 0===t[l]&&(t[l]=i[l]);else t||(t=i||{});return{$$typeof:ft,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}const gt=e=>[e.windows.windows.some((t=>"CHAT"===t.windowType&&!1===t.hidden&&(e.windows.showWindows||t.fullscreen))),e.windows.windows.some((e=>"CHAT"===e.windowType&&!0===e.hidden))&&e.windows.showWindows],wt=()=>{const[e,t]=(0,Oe.useState)(!1),n=(0,Pe.I0)(),[o,i]=(0,Pe.v9)(gt,Pe.wU),r=(0,Pe.v9)((e=>e.gui.chatNotify)),s=(0,Pe.v9)((e=>e.chat.channels)),[a,l]=(0,Pe.v9)((e=>[e.chatRead.unread,e.chatRead.mute]),Pe.wU);return(0,Oe.useEffect)((()=>{if(!r||o)return void t(!1);const e=Object.keys(s);let n=0;for(;n<e.length;){const o=e[n];if(0!==s[o][1]&&a[o]&&!l.includes(o)){t(!0);break}n+=1}n===e.length&&t(!1)}),[r,o,s,a,l]),mt("div",{id:"chatbutton",className:"actionbuttons",onClick:()=>{n(o?Ye("CHAT",!0):i?Ye("CHAT",!1):Ke("CHAT","",null,!1,!0,window.innerWidth-350-62,window.innerHeight-350-64,350,350))},role:"button",title:o?"Cerrar Chat":"Abrir Chat",tabIndex:0},void 0,e&&mt("div",{style:{position:"fixed",bottom:27,right:62,top:"unset"},className:"chnunread"},void 0,"⦿"),pt||(pt=mt(vt.Rlc,{})))},yt=Oe.memo(wt);var bt,St;function Et(e,t,n,o){St||(St="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var i=e&&e.defaultProps,r=arguments.length-3;if(t||0===r||(t={children:void 0}),1===r)t.children=o;else if(r>1){for(var s=new Array(r),a=0;a<r;a++)s[a]=arguments[a+3];t.children=s}if(t&&i)for(var l in i)void 0===t[l]&&(t[l]=i[l]);else t||(t=i||{});return{$$typeof:St,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}const Ct=()=>{const e=Je();return Et("div",{id:"helpbutton",className:"actionbuttons",onClick:()=>e("HELP",{target:"fullscreen"}),role:"button",title:"Ayuda",tabIndex:-1},void 0,bt||(bt=Et(Ge.g_g,{})))},Tt=Oe.memo(Ct);var kt,It;function xt(e,t,n,o){It||(It="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var i=e&&e.defaultProps,r=arguments.length-3;if(t||0===r||(t={children:void 0}),1===r)t.children=o;else if(r>1){for(var s=new Array(r),a=0;a<r;a++)s[a]=arguments[a+3];t.children=s}if(t&&i)for(var l in i)void 0===t[l]&&(t[l]=i[l]);else t||(t=i||{});return{$$typeof:It,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}const Nt=()=>{const e=Je();return xt("div",{id:"settingsbutton",className:"actionbuttons",onClick:()=>e("SETTINGS",{target:"fullscreen"}),role:"button",title:"Configuración",tabIndex:-1},void 0,kt||(kt=xt(Ge.p4t,{})))},_t=Oe.memo(Nt);var At,Lt;function Ot(e,t,n,o){Lt||(Lt="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var i=e&&e.defaultProps,r=arguments.length-3;if(t||0===r||(t={children:void 0}),1===r)t.children=o;else if(r>1){for(var s=new Array(r),a=0;a<r;a++)s[a]=arguments[a+3];t.children=s}if(t&&i)for(var l in i)void 0===t[l]&&(t[l]=i[l]);else t||(t=i||{});return{$$typeof:Lt,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}const Pt=()=>{const e=Je();return Ot("div",{id:"loginbutton",className:"actionbuttons",onClick:()=>e("USERAREA",{target:"fullscreen"}),role:"button",title:"Área del Usuario",tabIndex:-1},void 0,At||(At=Ot(vt.Vyx,{})))},Rt=Oe.memo(Pt);var $t,Dt,Mt=n(5823),Ht=n.n(Mt);function Wt(e,t,n,o){Dt||(Dt="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var i=e&&e.defaultProps,r=arguments.length-3;if(t||0===r||(t={children:void 0}),1===r)t.children=o;else if(r>1){for(var s=new Array(r),a=0;a<r;a++)s[a]=arguments[a+3];t.children=s}if(t&&i)for(var l in i)void 0===t[l]&&(t[l]=i[l]);else t||(t=i||{});return{$$typeof:Dt,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}const Ut=()=>{const e=(0,Pe.v9)((e=>e.canvas.view));return Wt("div",{id:"downloadbutton",className:"actionbuttons",role:"button",title:"Tomar Captura de Pantalla",tabIndex:0,onClick:()=>function(e){const t=ye().getViewport();if(!t)return;const[n,o]=e.map(Math.round),i=`pixelplanet-${n}-${o}.png`;t.toBlob((e=>Ht()(e,i)))}(e)},void 0,$t||($t=Wt(vt.tEr,{})))},Vt=Oe.memo(Ut);var zt,Gt,Ft,qt,Bt;function jt(e,t,n,o){Bt||(Bt="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var i=e&&e.defaultProps,r=arguments.length-3;if(t||0===r||(t={children:void 0}),1===r)t.children=o;else if(r>1){for(var s=new Array(r),a=0;a<r;a++)s[a]=arguments[a+3];t.children=s}if(t&&i)for(var l in i)void 0===t[l]&&(t[l]=i[l]);else t||(t=i||{});return{$$typeof:Bt,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}const Zt=()=>{const[e,t]=(0,Oe.useState)(!1),n=(0,Pe.v9)((e=>e.gui.menuOpen));return(0,Oe.useEffect)((()=>{n&&setTimeout((()=>t(!0)),10)}),[n]),(e||n)&&jt("div",{className:n&&e?"menu show":"menu",onTransitionEnd:()=>{n||t(!1)}},void 0,zt||(zt=jt(_t,{})),Gt||(Gt=jt(Rt,{})),Ft||(Ft=jt(Vt,{})),qt||(qt=jt(Tt,{})))},Kt=Oe.memo(Zt);var Yt;function Qt(e,t,n,o){Yt||(Yt="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var i=e&&e.defaultProps,r=arguments.length-3;if(t||0===r||(t={children:void 0}),1===r)t.children=o;else if(r>1){for(var s=new Array(r),a=0;a<r;a++)s[a]=arguments[a+3];t.children=s}if(t&&i)for(var l in i)void 0===t[l]&&(t[l]=i[l]);else t||(t=i||{});return{$$typeof:Yt,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}const Xt=()=>{const e=(0,Pe.v9)((e=>e.user.coolDown));return Qt("div",{className:e&&e>=300?"cooldownbox show":"cooldownbox"},void 0,e&&(0,E.VL)(e,!0))},Jt=Oe.memo(Xt);var en;function tn(e,t,n,o){en||(en="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var i=e&&e.defaultProps,r=arguments.length-3;if(t||0===r||(t={children:void 0}),1===r)t.children=o;else if(r>1){for(var s=new Array(r),a=0;a<r;a++)s[a]=arguments[a+3];t.children=s}if(t&&i)for(var l in i)void 0===t[l]&&(t[l]=i[l]);else t||(t=i||{});return{$$typeof:en,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}const nn=()=>{const[e,t]=(0,Oe.useState)("notifybox"),n=(0,Pe.v9)((e=>e.user.notification));return(0,Oe.useEffect)((()=>{if(n){let o="notifybox";n&&"string"!=typeof n&&(o+=n>0?" green":" red"),o!==e&&t(o)}}),[n,e]),tn("div",{className:n?`${e} show`:e},void 0,n)},on=Oe.memo(nn);var rn,sn;function an(e,t,n,o){sn||(sn="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var i=e&&e.defaultProps,r=arguments.length-3;if(t||0===r||(t={children:void 0}),1===r)t.children=o;else if(r>1){for(var s=new Array(r),a=0;a<r;a++)s[a]=arguments[a+3];t.children=s}if(t&&i)for(var l in i)void 0===t[l]&&(t[l]=i[l]);else t||(t=i||{});return{$$typeof:sn,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}const ln=()=>{const[e,t,n,o]=(0,Pe.v9)((e=>[e.canvas.canvasId,e.canvas.canvasIdent,e.canvas.canvasSize,e.canvas.view]),Pe.wU);return an("div",{role:"button",tabIndex:-1,id:"globebutton",title:"Vista de Globo",className:"actionbuttons",onClick:()=>function(e,t,n,o){const[i,r]=o.map(Math.round);window.location.href=`globe#${t},${e},${n},${i},${r}`}(e,t,n,o)},void 0,rn||(rn=an(vt.gb5,{})))},cn=Oe.memo(ln);var dn,un;function hn(e,t,n,o){un||(un="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var i=e&&e.defaultProps,r=arguments.length-3;if(t||0===r||(t={children:void 0}),1===r)t.children=o;else if(r>1){for(var s=new Array(r),a=0;a<r;a++)s[a]=arguments[a+3];t.children=s}if(t&&i)for(var l in i)void 0===t[l]&&(t[l]=i[l]);else t||(t=i||{});return{$$typeof:un,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}const pn=()=>{const e=(0,Pe.v9)((e=>e.gui.paletteOpen)),[t,n]=(0,Pe.v9)((e=>[e.canvas.palette,e.canvas.selectedColor]),Pe.wU),o=(0,Pe.I0)();return hn("div",{id:"palselbutton",className:"actionbuttons"+(e?" pressed":""),style:{color:t.isDark(n)?"white":"black",backgroundColor:t.colors[n]},role:"button",title:e?"Cerrar Paleta":"Abrir Paleta",tabIndex:0,onClick:()=>o((0,r.KB)())},void 0,dn||(dn=hn(vt.Zox,{})))},fn=Oe.memo(pn);var vn=n(106);const mn=function(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:600;const[o,i]=(0,Oe.useState)(null),r=(0,Oe.useRef)(),s=(0,Oe.useCallback)((e=>{e.preventDefault(),i(setTimeout((()=>{t(e),i(null)}),n))}),[t,n]),a=(0,Oe.useCallback)((t=>{t.preventDefault(),o&&(clearTimeout(o),e&&e(t),i(null))}),[o,e]),l=(0,Oe.useCallback)((e=>{e.preventDefault(),clearTimeout(o),i(null)}),[o]);return(0,Oe.useCallback)((e=>{if(e)r.current=e,e.addEventListener("mousedown",s,{passive:!1}),e.addEventListener("mouseup",a,{passive:!1}),e.addEventListener("touchstart",s,{passive:!1}),e.addEventListener("touchend",a,{passive:!1}),e.addEventListener("mouseleave",l,{passive:!1}),e.addEventListener("touchcancel",l,{passive:!1});else if(r.current){const e=r.current;e.removeEventListener("mousedown",s,{passive:!1}),e.removeEventListener("mouseup",a,{passive:!1}),e.removeEventListener("touchstart",s,{passive:!1}),e.removeEventListener("touchend",a,{passive:!1}),e.removeEventListener("mouseleave",l,{passive:!1}),e.removeEventListener("touchcancel",l,{passive:!1})}}),[l,s,a])};var gn,wn,yn;function bn(e,t,n,o){yn||(yn="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var i=e&&e.defaultProps,r=arguments.length-3;if(t||0===r||(t={children:void 0}),1===r)t.children=o;else if(r>1){for(var s=new Array(r),a=0;a<r;a++)s[a]=arguments[a+3];t.children=s}if(t&&i)for(var l in i)void 0===t[l]&&(t[l]=i[l]);else t||(t=i||{});return{$$typeof:yn,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}const Sn=()=>{const[e,t]=(0,Pe.v9)((e=>[e.gui.holdPaint,e.gui.showMvmCtrls]),Pe.wU),n=(0,Pe.I0)(),o=(0,Oe.useCallback)((()=>{let t;switch(e){case c.EQ.OFF:case c.EQ.PENCIL:if(window.ssv?.backupurl){t=c.EQ.HISTORY,n((0,d.h4)("History Pencil ON"));break}case c.EQ.HISTORY:t=c.EQ.OVERLAY,n((0,d.h4)("Overlay Pencil ON"));break;default:t=e?c.EQ.OFF:c.EQ.PENCIL}n((0,r.UW)(t))}),[e,n]),i=(0,Oe.useCallback)((()=>{let t;t=e?c.EQ.OFF:c.EQ.PENCIL,n((0,r.UW)(t))}),[e,n]),s=mn(i,o);let a="actionbuttons",l="Lápiz activado";switch(e){case c.EQ.PENCIL:a+=" ppencil pressed",l="Lápiz desactivado";break;case c.EQ.HISTORY:a+=" phistory pressed",l="Lápiz historico desactivado";break;case c.EQ.OVERLAY:a+=" poverlay pressed",l="Lápiz overlay desactivado"}return Oe.createElement("div",{id:"pencilbutton",className:a,style:{bottom:e||t?180:98},role:"button",title:l,tabIndex:-1,ref:s},e?gn||(gn=bn(vn.nxI,{})):wn||(wn=bn(vn.Lik,{})))},En=Oe.memo(Sn);var Cn,Tn,kn,In,xn,Nn,_n,An,Ln,On=n(225),Pn=n(130);function Rn(e,t,n,o){Ln||(Ln="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var i=e&&e.defaultProps,r=arguments.length-3;if(t||0===r||(t={children:void 0}),1===r)t.children=o;else if(r>1){for(var s=new Array(r),a=0;a<r;a++)s[a]=arguments[a+3];t.children=s}if(t&&i)for(var l in i)void 0===t[l]&&(t[l]=i[l]);else t||(t=i||{});return{$$typeof:Ln,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}const $n=()=>{const[e,t]=(0,Oe.useState)(!1),[n,o]=(0,Pe.v9)(Pn.x,Pe.wU),i=(0,Pe.I0)();(0,Oe.useEffect)((()=>{o&&window.setTimeout((()=>t(!0)),10)}),[o]);const s=(0,Oe.useCallback)((e=>{if(!e)return;const t=e=>{switch(e.preventDefault(),e.currentTarget.id){case"forwardbtn":i((0,r.mx)(-1));break;case"backwardbtn":i((0,r.mx)(1));break;case"leftbtn":i((0,r.mW)(-1));break;case"rightbtn":i((0,r.mW)(1));break;case"upbtn":i((0,r.WW)(-1));break;case"downbtn":i((0,r.WW)(1))}},n=e=>{switch(e.preventDefault(),e.currentTarget.id){case"forwardbtn":case"backwardbtn":i((0,r.mx)(0));break;case"leftbtn":case"rightbtn":i((0,r.mW)(0));break;case"upbtn":case"downbtn":i((0,r.WW)(0))}},o=e=>{e.preventDefault(),i((0,r.OJ)())};e.addEventListener("touchstart",t,{passive:!1}),e.addEventListener("mousedown",t,{passive:!1}),e.addEventListener("touchend",n,{passive:!1}),e.addEventListener("mouseup",n,{passive:!1}),e.addEventListener("mouseleave",o,{passive:!1}),e.addEventListener("touchcancel",o,{passive:!1})}),[i]);return(e||o)&&Rn("div",{id:"mvmctrls",className:e&&o?"show":"",onTransitionEnd:()=>!o&&t(!1)},void 0,Oe.createElement("div",{className:"actionbuttons",id:"forwardbtn",role:"button",key:"forward",tabIndex:0,style:{left:57,bottom:139},ref:s},Cn||(Cn=Rn(On.x8Z,{}))),Oe.createElement("div",{className:"actionbuttons",id:"backwardbtn",role:"button",key:"backward",tabIndex:0,style:{left:57,bottom:98},ref:s},Tn||(Tn=Rn(On._tY,{}))),Oe.createElement("div",{className:"actionbuttons",id:"leftbtn",role:"button",key:"left",tabIndex:0,style:{left:16,bottom:98},ref:s},kn||(kn=Rn(On.uMh,{}))),Oe.createElement("div",{className:"actionbuttons",id:"rightbtn",role:"button",key:"right",tabIndex:0,style:{left:98,bottom:98},ref:s},In||(In=Rn(On.aiH,{}))),Oe.createElement("div",{className:"actionbuttons",id:"upbtn",role:"button",key:"up",tabIndex:0,style:{left:16,bottom:139},ref:s},n?xn||(xn=Rn(On.V6o,{})):Nn||(Nn=Rn(On.owN,{}))),Oe.createElement("div",{className:"actionbuttons",id:"downbtn",role:"button",key:"down",tabIndex:0,style:{left:98,bottom:139},ref:s},n?_n||(_n=Rn(On.Hgk,{})):An||(An=Rn(On.svp,{}))))};var Dn;function Mn(e,t,n,o){Dn||(Dn="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var i=e&&e.defaultProps,r=arguments.length-3;if(t||0===r||(t={children:void 0}),1===r)t.children=o;else if(r>1){for(var s=new Array(r),a=0;a<r;a++)s[a]=arguments[a+3];t.children=s}if(t&&i)for(var l in i)void 0===t[l]&&(t[l]=i[l]);else t||(t=i||{});return{$$typeof:Dn,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}const Hn=()=>{const[e,t]=(0,Oe.useState)(!1),[n,o,i,s,a,l]=(0,Pe.v9)((e=>[e.gui.paletteOpen,e.gui.compactPalette,e.canvas.palette.colors,e.canvas.clrIgnore,e.canvas.selectedColor,e.user.userlvl]),Pe.wU),c=(0,Pe.I0)();(0,Oe.useEffect)((()=>{window.setTimeout((()=>{n&&t(!0)}),10)}),[n]);const d=0===l?s:0,[u,h]=function(e,t,n,o,i){const{width:r,height:s}=t,a=n.length-o;let l,c,d;r<=300||s<=432?(c=24,d=5,l="row"):a>30||i?(c=28,d=5,l="row"):(c=24,d=s<801?2:1,l="column");const u=Math.ceil(a/d)*c,h=c*d;return e?[{display:"flex",flexWrap:"wrap",textAlign:"center",lineHeight:0,height:u,width:h,flexDirection:l,visibility:"visible"},{display:"block",width:c,height:c,margin:0,padding:0,cursor:"pointer",visibility:"visible"}]:[{display:"flex",flexWrap:"wrap",textAlign:"center",lineHeight:0,height:0,width:h,flexDirection:l,visibility:"hidden"},{display:"block",height:0,width:c,margin:0,padding:0,visibility:"hidden"}]}(e&&n,function(){const[e,t]=(0,Oe.useState)({width:window.innerWidth,height:window.innerHeight});return(0,Oe.useEffect)((()=>{function e(){t({width:window.innerWidth,height:window.innerHeight})}return window.addEventListener("resize",e),()=>window.removeEventListener("resize",e)}),[]),e}(),i,d,o);return(e||n)&&Mn("div",{id:"palettebox",style:u,onTransitionEnd:()=>{n||t(!1)}},void 0,i.slice(d).map(((e,t)=>Mn("span",{style:{backgroundColor:e,...h},role:"button",tabIndex:0,"aria-label":`color ${t+d}`,className:a===t+d?"selected":"unselected",color:e,onClick:()=>c((0,r.Oh)(t+d))},`${e}-${t+d}`))))},Wn=Oe.memo(Hn);var Un,Vn,zn=n(155);function Gn(e,t,n,o){Vn||(Vn="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var i=e&&e.defaultProps,r=arguments.length-3;if(t||0===r||(t={children:void 0}),1===r)t.children=o;else if(r>1){for(var s=new Array(r),a=0;a<r;a++)s[a]=arguments[a+3];t.children=s}if(t&&i)for(var l in i)void 0===t[l]&&(t[l]=i[l]);else t||(t=i||{});return{$$typeof:Vn,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}const Fn={width:"100%",position:"absolute",top:"50%",left:"50%",transform:"translate(-50%,-50%)"},qn=e=>{let{autoload:t,width:n,setLegit:o}=e;const[i,r]=(0,Oe.useState)({}),[s,a]=(0,Oe.useState)([]),[l,c]=(0,Oe.useState)(!1),d=async()=>{l&&c(!1);const e=await async function(){const e=`${F.Fx}/captcha.svg`,t=await fetch(e,{cache:"no-cache"});if(t.ok){const e=t.headers.get("captcha-id"),n=await t.blob();return[URL.createObjectURL(n),e]}return null}();if(!e)return void a(["No se pudo cargar el captcha"]);const[t,n]=e;r({url:t,id:n})};(0,Oe.useEffect)((()=>{t&&d()}),[]);const u=n||100;return Oe.createElement(Oe.Fragment,null,Gn("p",{},void 0,"Escribe los caracteres de la siguiente imagen:"," ",Gn("span",{style:{fontSize:11}},void 0,"(","Consejo: No es sensible a las mayúsculas, I y l son lo mismo",")")),s.map((e=>Gn("p",{className:"errormessage"},e,Gn("span",{},void 0,"Error"),": ",e))),Gn("div",{style:{width:`${u}%`,paddingTop:`${Math.floor(.6*u)}%`,position:"relative",display:"inline-block",backgroundColor:"#e0e0e0"}},void 0,i.url?Gn("img",{style:{...Fn,opacity:l?1:0,transition:"100ms"},src:i.url,alt:"CAPTCHA",onLoad:()=>{a([]),c(!0)},onError:()=>{a(["No se pudo cargar el captcha"])}}):Gn("span",{style:Fn,role:"button",tabIndex:0,title:"Cargar Captcha",className:"modallink",onClick:d,onKeyPress:d},void 0,"Haga clic para cargar el captcha")),Gn("p",{},void 0,"¿No puedes leer? Recargar::"," ",Gn("span",{role:"button",tabIndex:-1,title:"Recargar",className:"modallink",style:{fontSize:28},onClick:d},void 0,Un||(Un=Gn(zn.q9I,{})))),Gn("input",{name:"captcha",placeholder:"Introducir Caracteres",type:"text",autoComplete:"off",autoCorrect:"off",autoCapitalize:"off",spellCheck:"false",onChange:()=>o&&o(!0),autoFocus:t,style:{width:"6em",fontSize:21,margin:5}}),Gn("input",{type:"hidden",name:"captchaid",value:i.id||"0"}))},Bn=Oe.memo(qn);var jn;function Zn(e,t,n,o){jn||(jn="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var i=e&&e.defaultProps,r=arguments.length-3;if(t||0===r||(t={children:void 0}),1===r)t.children=o;else if(r>1){for(var s=new Array(r),a=0;a<r;a++)s[a]=arguments[a+3];t.children=s}if(t&&i)for(var l in i)void 0===t[l]&&(t[l]=i[l]);else t||(t=i||{});return{$$typeof:jn,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}const Kn=e=>{let{close:t}=e;const[n,o]=(0,Oe.useState)(null),[i,r]=(0,Oe.useState)(!1),[s,a]=(0,Oe.useState)(!1),[l,c]=(0,Oe.useState)(Date.now());return Zn("form",{onSubmit:async e=>{e.preventDefault();const n=e.target.captcha.value.slice(0,6);if(i||!n)return;s||await(0,F.jK)(2);const a=e.target.captchaid.value;let l;try{switch(r(!0),await q.sendCaptchaSolution(n,a)){case 0:return void t();case 1:l="Tardaste demasiado, inténtalo de nuevo.";break;case 2:l="Fallaste el captcha";break;case 3:l="Texto captcha inexistente o no válido";break;case 4:l="No se proporciona ninguna id de captcha";break;default:l="Error de captcha desconocido"}}catch(e){l=`${e.message}`}r(!1),c(Date.now()),o(l)}},void 0,n&&Zn("p",{className:"errormessage"},n,Zn("span",{},void 0,"Error"),": ",n),Zn(Bn,{autoload:!0,setLegit:a},l),Zn("p",{},void 0,Zn("button",{type:"button",onClick:t},void 0,"Cancelar")," ",Zn("button",{type:"submit"},void 0,i?"...":"Enviar")))},Yn=Oe.memo(Kn);var Qn,Xn=n(389);function Jn(e,t,n,o){Qn||(Qn="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var i=e&&e.defaultProps,r=arguments.length-3;if(t||0===r||(t={children:void 0}),1===r)t.children=o;else if(r>1){for(var s=new Array(r),a=0;a<r;a++)s[a]=arguments[a+3];t.children=s}if(t&&i)for(var l in i)void 0===t[l]&&(t[l]=i[l]);else t||(t=i||{});return{$$typeof:Qn,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}const eo=e=>{let{close:t}=e;const[n,o]=(0,Oe.useState)([]),[i,r]=(0,Oe.useState)(null),[s,a]=(0,Oe.useState)(null),[l,c]=(0,Oe.useState)(0),[d,u]=(0,Oe.useState)(null),[h,p]=(0,Oe.useState)(!1),f=Je(),v=async()=>{if(h)return;p(!0),o([]);const e=await(0,F.Es)();if(p(!1),e.errors)return void o(e.errors);const{sleft:t,mod:n,reason:i}=e;if(t){const e=new Date(Date.now()+1e3*t);c(t),u(e.toLocaleString())}a(n),r(i)};return(0,Xn.Z)((()=>{l>0&&(c(l-1),1===l&&v())}),1e3),Jn("div",{style:{userSelect:"text"}},void 0,Jn("p",{},void 0,"Estás baneado. Piensas que está injustificado? Revisa el ",Jn("span",{role:"button",tabIndex:0,className:"modallink",onClick:()=>{f("HELP",{target:"fullscreen"}),t()}},void 0,"Ayuda")," sobre como apelar."),n.map((e=>Jn("p",{className:"errormessage"},e,Jn("span",{},void 0,"Error"),": ",e))),i&&Jn(Oe.Fragment,{},"rea",Jn("h3",{},void 0,"Motivo",":"),Jn("p",{},void 0,i)),s&&Jn(Oe.Fragment,{},"mod",Jn("h3",{},void 0,"Por mod",":"),Jn("p",{},void 0,s)),l>0&&Jn(Oe.Fragment,{},"exp",Jn("h3",{},void 0,"Duración",":"),Jn("p",{},void 0,"Tu baneo expira en ",Jn("span",{style:{fontWeight:"bold"}},void 0,d)," que es en ",Jn("span",{style:{fontWeight:"bold"}},void 0,(0,E.gx)(l)))),l<0&&Jn(Oe.Fragment,{},"nb",Jn("h3",{},void 0,"Desbaneado",":"),Jn("p",{},void 0,"Ahora que has visto este mensaje, ya no estás baneado.")),Jn("p",{},void 0,!i&&Jn(Oe.Fragment,{},"btnr",Jn("button",{type:"button",style:{fontWeight:"bold",animation:"glowing 1300ms infinite"},onClick:v},void 0,h?"...":"¿Por qué?")," "),Jn("button",{type:"submit",onClick:t},void 0,"OK")))},to=Oe.memo(eo);var no;function oo(e,t,n,o){no||(no="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var i=e&&e.defaultProps,r=arguments.length-3;if(t||0===r||(t={children:void 0}),1===r)t.children=o;else if(r>1){for(var s=new Array(r),a=0;a<r;a++)s[a]=arguments[a+3];t.children=s}if(t&&i)for(var l in i)void 0===t[l]&&(t[l]=i[l]);else t||(t=i||{});return{$$typeof:no,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}const io=e=>{let{show:t,onClick:n,z:o}=e;const[i,r]=(0,Oe.useState)(!1);return(0,Oe.useEffect)((()=>{t&&window.setTimeout((()=>{r(!0)}),10)}),[t]),i||t?oo("div",{className:t&&i?"overlay show":"overlay",style:o?{zIndex:o}:{},onTransitionEnd:()=>{t||r(!1)},tabIndex:-1,onClick:n}):null},ro=Oe.memo(io);var so;function ao(e,t,n,o){so||(so="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var i=e&&e.defaultProps,r=arguments.length-3;if(t||0===r||(t={children:void 0}),1===r)t.children=o;else if(r>1){for(var s=new Array(r),a=0;a<r;a++)s[a]=arguments[a+3];t.children=s}if(t&&i)for(var l in i)void 0===t[l]&&(t[l]=i[l]);else t||(t=i||{});return{$$typeof:so,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}const lo=()=>{const[e,t]=(0,Oe.useState)(!1),{open:n,alertType:o,title:i,message:s,btn:a}=(0,Pe.v9)((e=>e.alert)),l=(0,Pe.I0)(),c=(0,Oe.useCallback)((()=>{l((0,r.M6)())}),[l]);(0,Oe.useEffect)((()=>{n&&window.setTimeout((()=>{t(!0)}),10)}),[n]);let d=null;switch(o){case"captcha":d=Yn;break;case"ban":d=to}if(!e&&!n)return null;const u=n&&e;return Oe.createElement(Oe.Fragment,null,ao(ro,{z:6,show:u,onClick:c}),ao("div",{className:u?"Alert show":"Alert",onTransitionEnd:()=>{n||t(!1)}},void 0,ao("h2",{},void 0,i),s&&ao("p",{},void 0,s),d?ao(d,{close:c}):ao("button",{type:"button",onClick:c},void 0,a)),")")},co=Oe.memo(lo);var uo;function ho(e,t,n,o){uo||(uo="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var i=e&&e.defaultProps,r=arguments.length-3;if(t||0===r||(t={children:void 0}),1===r)t.children=o;else if(r>1){for(var s=new Array(r),a=0;a<r;a++)s[a]=arguments[a+3];t.children=s}if(t&&i)for(var l in i)void 0===t[l]&&(t[l]=i[l]);else t||(t=i||{});return{$$typeof:uo,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}function po(e){return e?`${e.substring(0,2)}:${e.substring(2)}`:""}const fo=()=>{const e=(0,Oe.useRef)(null),[t,n]=(0,Oe.useState)(!1),[o,i]=(0,Oe.useState)([]),[s]=(0,Oe.useState)((0,E.x2)()),[a,l,c,d,u]=(0,Pe.v9)((e=>[e.canvas.canvasId,e.canvas.canvasStartDate,e.canvas.canvasEndDate,e.canvas.historicalDate,e.canvas.historicalTime]),Pe.wU),h=(0,Pe.I0)(),p=(0,Oe.useCallback)(((e,t)=>{const n=t.substring(0,2)+t.substring(3,5),o=(0,E.UW)(e);h((0,r.on)(o,n))}),[h]),f=(0,Oe.useCallback)((async e=>{if(t)return;n(!0);const o=e.target.value,r=await(0,F.No)(o,a);r&&r.length&&(i(r),p(o,r[0])),n(!1)}),[t,a,p]),v=(0,Oe.useCallback)((async t=>{if(!(o.length&&e&&e.current&&e.current.value))return;let r=o,s=o.indexOf(po(u))+t,l=e.current.value;if(s>=o.length||s<0){if(n(!0),s<0?e.current.stepDown(1):e.current.stepUp(1),l=e.current.value,r=await(0,F.No)(l,a),n(!1),!r||!r.length)return;s=s<0?r.length-1:0}i(r),p(l,r[s])}),[u,o,a,p]),m=(g=d)?`${g.substring(0,4)}-${g.substring(4,6)}-${g.substring(6)}`:"";var g;const w=po(u);return ho("div",{id:"historyselect"},void 0,Oe.createElement("input",{type:"date",pattern:"\\d{4}-\\d{2}-\\d{2}",key:"dateinput",value:m,min:l,max:c||s,ref:e,onChange:f}),ho("div",{},"timeselcon",!!o.length&&u&&!t&&ho("div",{},"timesel",ho("button",{type:"button",className:"hsar",onClick:()=>v(-1)},void 0,"←"),ho("select",{value:w,onChange:e=>p(m,e.target.value)},void 0,o.map((e=>ho("option",{value:e},e,e)))),ho("button",{type:"button",className:"hsar",onClick:()=>v(1)},void 0,"→")),t&&ho("p",{},void 0,"Cargando..."),!o.length&&!t&&ho("p",{},void 0,"Selecciona la fecha")))},vo=Oe.memo(fo);var mo,go,wo,yo,bo,So,Eo,Co,To,ko;function Io(e,t,n,o){ko||(ko="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var i=e&&e.defaultProps,r=arguments.length-3;if(t||0===r||(t={children:void 0}),1===r)t.children=o;else if(r>1){for(var s=new Array(r),a=0;a<r;a++)s[a]=arguments[a+3];t.children=s}if(t&&i)for(var l in i)void 0===t[l]&&(t[l]=i[l]);else t||(t=i||{});return{$$typeof:ko,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}const xo=()=>{const[e,t,n]=(0,Pe.v9)((e=>[e.canvas.isHistoricalView,e.canvas.is3D,e.user.isOnMobile]),Pe.wU);return Oe.createElement(Oe.Fragment,null,mo||(mo=Io(co,{})),go||(go=Io($n,{})),e?wo||(wo=Io(vo,{})):Oe.createElement(Oe.Fragment,null,yo||(yo=Io(fn,{})),bo||(bo=Io(Wn,{})),!t&&(So||(So=Io(cn,{}))),!t&&n&&(Eo||(Eo=Io(En,{}))),Co||(Co=Io(Jt,{}))),To||(To=Io(on,{})))},No=Oe.memo(xo);var _o,Ao,Lo;function Oo(e,t,n,o){Lo||(Lo="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var i=e&&e.defaultProps,r=arguments.length-3;if(t||0===r||(t={children:void 0}),1===r)t.children=o;else if(r>1){for(var s=new Array(r),a=0;a<r;a++)s[a]=arguments[a+3];t.children=s}if(t&&i)for(var l in i)void 0===t[l]&&(t[l]=i[l]);else t||(t=i||{});return{$$typeof:Lo,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}const Po=()=>{const e=(0,Pe.v9)((e=>e.gui.menuOpen)),t=(0,Pe.I0)();return Oo("div",{id:"menubutton",className:"actionbuttons"+(e?" pressed":""),role:"button",title:e?"Cerrar Menú":"Abrir Menú",tabIndex:-1,onClick:()=>t((0,r.vN)())},void 0,e?_o||(_o=Oo(vt.Faw,{})):Ao||(Ao=Oo(vt.Yc6,{})))},Ro=Oe.memo(Po);var $o=n(7516),Do=n(573);const Mo=e=>e.windows.windows,Ho=e=>e.windows.showWindows,Wo=(0,Do.P1)(Mo,Ho,((e,t)=>[e.some((e=>e.fullscreen&&!e.hidden))||t,e.some((e=>e.fullscreen&&e.open&&!e.hidden))])),Uo=(0,Do.P1)(Mo,Ho,((e,t)=>(t||(e=e.filter((e=>e.fullscreen))),e.map((e=>e.windowId))))),Vo=function(e,t,n){const o=(0,Oe.useCallback)((e=>{e.preventDefault(),e.stopPropagation(),t&&t();let{clientX:o,clientY:i}=e.touches?e.touches[0]:e;const r=e=>{e.preventDefault(),e.stopPropagation();const{clientX:t,clientY:r}=e.touches?e.touches[0]:e;n(t-o,r-i),o=t,i=r};document.addEventListener("mousemove",r),document.addEventListener("touchmove",r);const s=e=>{e.preventDefault(),e.stopPropagation(),document.removeEventListener("mousemove",r),document.removeEventListener("touchmove",r),document.removeEventListener("mouseup",s),document.removeEventListener("touchcancel",s),document.removeEventListener("touchend",s)};document.addEventListener("mouseup",s),document.addEventListener("touchcancel",s),document.addEventListener("touchend",s)}),[t,n]);(0,Oe.useEffect)((()=>{const t=e.current;if(t)return t.addEventListener("mousedown",o,{passive:!1}),t.addEventListener("touchstart",o,{passive:!1}),()=>{t.removeEventListener("mousedown",o),t.removeEventListener("touchstart",o)}}),[e,o])};var zo,Go=n(2585);function Fo(e,t,n,o){zo||(zo="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var i=e&&e.defaultProps,r=arguments.length-3;if(t||0===r||(t={children:void 0}),1===r)t.children=o;else if(r>1){for(var s=new Array(r),a=0;a<r;a++)s[a]=arguments[a+3];t.children=s}if(t&&i)for(var l in i)void 0===t[l]&&(t[l]=i[l]);else t||(t=i||{});return{$$typeof:zo,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}const qo=()=>{const[e,t]=(0,Oe.useState)(""),[n,o]=(0,Oe.useState)(!1),r=(0,Pe.I0)();return Fo("p",{},void 0,Fo("input",{style:{display:"inline-block",width:"100%",maxWidth:"18em"},readOnly:!0,value:e}),e?Fo("button",{type:"button",onClick:()=>{(0,i.Z)(e),r((0,d.h4)("Copiado"))}},"cobtn","Copiar"):Fo("button",{type:"button",onClick:async()=>{o(!0);const e=await(0,F.JL)();e.iid&&t(e.iid),o(!1)}},"subtn",n?"...":"Obtener IID"))},Bo=Oe.memo(qo);var jo,Zo,Ko,Yo,Qo,Xo,Jo,ei,ti,ni,oi,ii,ri,si,ai,li,ci,di,ui,hi,pi,fi,vi,mi,gi,wi,yi,bi,Si,Ei,Ci,Ti,ki,Ii,xi,Ni,_i,Ai,Li,Oi,Pi,Ri;function $i(e,t,n,o){Ri||(Ri="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var i=e&&e.defaultProps,r=arguments.length-3;if(t||0===r||(t={children:void 0}),1===r)t.children=o;else if(r>1){for(var s=new Array(r),a=0;a<r;a++)s[a]=arguments[a+3];t.children=s}if(t&&i)for(var l in i)void 0===t[l]&&(t[l]=i[l]);else t||(t=i||{});return{$$typeof:Ri,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}var Di,Mi,Hi=n(888);function Wi(e,t,n,o){Mi||(Mi="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var i=e&&e.defaultProps,r=arguments.length-3;if(t||0===r||(t={children:void 0}),1===r)t.children=o;else if(r>1){for(var s=new Array(r),a=0;a<r;a++)s[a]=arguments[a+3];t.children=s}if(t&&i)for(var l in i)void 0===t[l]&&(t[l]=i[l]);else t||(t=i||{});return{$$typeof:Mi,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}const Ui=Oe.memo((e=>{let{title:t,keyBind:n,value:o,onToggle:i,children:r,deactivated:s}=e;return Wi("div",{className:"setitem"},void 0,Wi("div",{className:"setrow"},void 0,Wi("h3",{className:"settitle"},void 0,t," ",n&&Wi("kbd",{},void 0,n)),Wi(Hi.Z,{checked:o,onChange:i,disabled:s})),Wi("div",{className:"modaldesc"},void 0,r),Di||(Di=Wi("div",{className:"modaldivider"})))}),((e,t)=>e.value===t.value));var Vi;function zi(e,t,n,o){Vi||(Vi="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var i=e&&e.defaultProps,r=arguments.length-3;if(t||0===r||(t={children:void 0}),1===r)t.children=o;else if(r>1){for(var s=new Array(r),a=0;a<r;a++)s[a]=arguments[a+3];t.children=s}if(t&&i)for(var l in i)void 0===t[l]&&(t[l]=i[l]);else t||(t=i||{});return{$$typeof:Vi,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}const Gi=function(){const[e,t]=(0,Oe.useState)(window.ssv.lang),[n,o]=(0,Oe.useState)("xx");return(0,Oe.useEffect)((()=>{const{langs:t}=window.ssv;for(let n=0;n<t.length;n+=1){const[i,r]=t[n];if(i===e)return void o(r)}}),[e]),navigator.cookieEnabled?zi("div",{style:{textAlign:"right"}},void 0,zi("span",{},void 0,zi("select",{value:e,onChange:e=>{const n=e.target;t(n.options[n.selectedIndex].value)}},void 0,window.ssv.langs.map((e=>{let[t]=e;return zi("option",{value:t},t,t.toUpperCase())})))),"  ",zi("span",{},void 0,zi("img",{style:{height:"1em",imageRendering:"crisp-edges"},alt:"",src:`/cf/${n}.gif`})),zi("button",{type:"submit",style:{display:"block",margin:5},onClick:()=>{const t=new Date;t.setTime(t.getTime()+24*c.vc);let{hostname:n}=window.location;n=n.lastIndexOf(".")!==n.indexOf(".")?n.slice(n.indexOf(".")):`.${n}`,document.cookie=`plang=${e};expires=${t.toUTCString()};path=/;domain=${n}`,window.location.reload()}},void 0,"Guardar")):null};var Fi;function qi(e,t,n,o){Fi||(Fi="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var i=e&&e.defaultProps,r=arguments.length-3;if(t||0===r||(t={children:void 0}),1===r)t.children=o;else if(r>1){for(var s=new Array(r),a=0;a<r;a++)s[a]=arguments[a+3];t.children=s}if(t&&i)for(var l in i)void 0===t[l]&&(t[l]=i[l]);else t||(t=i||{});return{$$typeof:Fi,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}const Bi=e=>{let{enabled:t,title:n,canvasId:o,x:i,y:s,width:a,height:c,imageId:d,startEditing:u}=e;const h=(0,Oe.useRef)(),p=(0,Pe.v9)((e=>e.canvas.canvases)),f=(0,Pe.I0)();return(0,Oe.useEffect)((()=>{(async()=>{if(!d||!h.current)return;const e=await X.getTemplate(d);if(!e)return;const t=await createImageBitmap(e);h.current.getContext("bitmaprenderer").transferFromImageBitmap(t),t.close()})()}),[d]),qi("div",{className:t?"tmpitm":"tmpitm disabled",style:{cursor:"pointer"},onClick:()=>f(l(n,{enabled:!t}))},void 0,qi("div",{className:"tmpitm-preview"},void 0,Oe.createElement("canvas",{className:"tmpitm-img",ref:h,key:"showimg",width:a,height:c})),qi("div",{className:"tmpitm-desc"},void 0,qi("h4",{},void 0,n),qi("p",{},void 0,"Lienzo",": ",qi("span",{},void 0,p[o]?.title)),qi("p",{},void 0,"Coordenadas",": ",qi("span",{},void 0,`${i},${s}`)),qi("p",{},void 0,"Dimensiones",": ",qi("span",{},void 0,`${a} x ${c}`))),qi("div",{className:"tmpitm-actions"},void 0,qi("button",{onClick:e=>{e.stopPropagation(),u(n)},type:"button"},void 0,"Editar"),qi("button",{onClick:e=>{e.stopPropagation(),f((0,r.SC)(o)),f((0,r.w5)([i+a/2,s+c/2]))},type:"button"},void 0,"Ir")))},ji=Oe.memo(Bi);var Zi;function Ki(e,t,n,o){Zi||(Zi="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var i=e&&e.defaultProps,r=arguments.length-3;if(t||0===r||(t={children:void 0}),1===r)t.children=o;else if(r>1){for(var s=new Array(r),a=0;a<r;a++)s[a]=arguments[a+3];t.children=s}if(t&&i)for(var l in i)void 0===t[l]&&(t[l]=i[l]);else t||(t=i||{});return{$$typeof:Zi,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}const Yi=e=>{let{title:t,canvasId:n,x:o,y:i,imageId:r,stopEditing:s}=e;const[a]=(0,Oe.useMemo)((()=>[Number.isNaN(parseInt(o,10))||Number.isNaN(parseInt(i,10))?null:[o,i]]),[o,i]),[l,c]=(0,Oe.useState)(a),[d,u]=(0,Oe.useState)(null),[h,p]=(0,Oe.useState)(t||""),[f,v]=(0,Oe.useState)(null),[m,g]=(0,Oe.useState)(!0),w=(0,Oe.useRef)(),y=(0,Oe.useRef)(),[b,S,C]=(0,Pe.v9)((e=>[e.canvas.canvasId,e.canvas.canvases,e.templates.list]),Pe.wU),[T,k]=(0,Oe.useState)(n??b);(0,Oe.useEffect)((()=>{(async()=>{if(!r||!w.current)return;const e=await X.getTemplate(r);if(!e)return;const t=await createImageBitmap(e),n=w.current,{width:o,height:i}=t;n.width=o,n.height=i,n.getContext("bitmaprenderer").transferFromImageBitmap(t),u([o,i]),t.close()})()}),[r]),(0,Oe.useEffect)((()=>{f&&w.current&&(async()=>{const e=await createImageBitmap(f),t=w.current,{width:n,height:o}=e;t.width=n,t.height=o,t.getContext("bitmaprenderer").transferFromImageBitmap(e),u([n,o]),e.close()})()}),[f]);const I=w.current&&(f||r)&&m&&l&&h&&d;return Ki("div",{className:"tmpitm"},void 0,Ki("div",{className:"tmpitm-preview"},void 0,Ki("div",{style:{width:"100%",height:"100%"}},void 0,Oe.createElement("canvas",{className:"tmpitm-img",ref:w,key:"editimg",style:{opacity:.4}})),Ki("div",{className:"centered-on-img modallink",onClick:()=>y.current?.click()},void 0,"Seleccionar Archivo"),Oe.createElement("input",{type:"file",key:"hinpt",accept:"image/*",ref:y,style:{display:"none"},onChange:e=>{u(null),v(e.target.files?.[0])}})),Ki("div",{className:"tmpitm-desc"},void 0,Ki("h4",{},void 0,Ki("input",{value:h,style:{width:"10em"},type:"text",onChange:e=>{const t=e.target.value;g(!C.some((e=>e.title===t))),p(e.target.value)},placeholder:"Nombre de la plantilla"})),Ki("p",{},void 0,"Lienzo",": ",Ki("span",{},void 0,Ki("select",{value:T,onChange:e=>{const t=e.target;k(t.options[t.selectedIndex].value)}},void 0,Object.keys(S).filter((e=>!S[e].v&&!S[e].ed)).map((e=>Ki("option",{value:e},e,S[e].title)))))),Ki("p",{},void 0,"Coordenadas",": ",Ki("span",{},void 0,Ki("input",{type:"text",defaultValue:l&&l.join("_"),style:{display:"inline-block",maxWidth:"8em"},placeholder:"X_Y or URL",onChange:e=>{const t=(0,E._I)(e.target.value.trim());t&&(e.target.value=t.join("_")),c(t)}}))),Ki("p",{},void 0,"Dimensiones",": ",Ki("span",{},void 0,d?d.join(" x "):"N/A"))),Ki("div",{className:"tmpitm-actions"},void 0,t&&Ki("button",{onClick:()=>{s(t),X.deleteTemplate(t)},type:"button"},void 0,"Eliminar"),Ki("button",{onClick:()=>s(h),type:"button"},void 0,"Cancelar"),Ki("button",{disabled:!I,onClick:async()=>{if(!I)return;const[e,a]=l;t?(f&&r&&await X.updateFile(r,f),!t||t===h&&o===e&&i===a&&n===T||X.changeTemplate(t,{title:h,canvasId:T,x:e,y:a})):await X.addFile(f,h,T,e,a),s(t)},type:"button"},void 0,"Guardar")))},Qi=Oe.memo(Yi);var Xi,Ji;function er(e,t,n,o){Ji||(Ji="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var i=e&&e.defaultProps,r=arguments.length-3;if(t||0===r||(t={children:void 0}),1===r)t.children=o;else if(r>1){for(var s=new Array(r),a=0;a<r;a++)s[a]=arguments[a+3];t.children=s}if(t&&i)for(var l in i)void 0===t[l]&&(t[l]=i[l]);else t||(t=i||{});return{$$typeof:Ji,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}const tr=()=>{const[e,t]=(0,Oe.useState)(!1),[n,o,i,r,s,a]=(0,Pe.v9)((e=>[e.templates.list,e.templates.ovEnabled,e.templates.oSmallPxls,e.templates.oOpacity,e.templates.oRightShift,e.user.isOnMobile]),Pe.wU),[l,c]=(0,Oe.useState)([]),d=(0,Oe.useCallback)((()=>t(!1)),[]),u=(0,Oe.useRef)(),h=(0,Pe.I0)(),p=(0,Oe.useCallback)((e=>{const t=n.findIndex((t=>t.title===e)),o=l.indexOf(t);c(-1===o?[...l,t]:l.toSpliced(o,1))}),[n,l]);return Oe.createElement(Oe.Fragment,null,er("h2",{},void 0,"Plantillas"),er("p",{},void 0,"¿Cansado de spamear siempre un sólo color? ¿En lugar de eso quieres crear arte, pero tienes que contar píxeles de otra imagen? ¡Las plantillas pueden ayudarte con eso! Las plantillas se muestran como superposiciones y puedes dibujar sobre ellas. Un pixel en la plantilla debe representar un pixel en el lienzo."),er(Ui,{title:"Activar Overlay",keyBind:"T",value:o,onToggle:()=>h({type:"s/TGL_OVENABLED"})},void 0,"Muestra plantillas como superposiciones dentro del juego."),er(Ui,{title:"Pixeles pequeños cuando haces zoom",value:i,onToggle:()=>h({type:"s/TGL_SMALLPXLS"})},void 0,"Muestra la superposición como pequeños píxeles individuales en niveles de zoom altos."),er("div",{className:"setitem"},void 0,er("div",{className:"setrow"},void 0,er("h3",{className:"settitle"},void 0,"Opacidad del overlay"),er("div",{style:{textAlign:"right"}},void 0,er("input",{type:"number",value:r,style:{maxWidth:"6em"},step:"1",min:"10",max:"100",onChange:e=>h({type:"s/SET_O_OPACITY",opacity:e.target.value})}))),er("div",{className:"modaldesc"},void 0,"Opacidad del overlay en porcentaje."),Xi||(Xi=er("div",{className:"modaldivider"}))),!a&&er(Ui,{title:"Right-Shift Auto-Color",value:s,onToggle:()=>h({type:"s/TGL_RIGHTSHIFT"})},void 0,"Place pixels from overlay on right-shift, instead of history."),n.map(((e,t)=>{let{enabled:n,imageId:o,canvasId:i,title:r,x:s,y:a,width:c,height:d}=e;return l.includes(t)?er(Qi,{enabled:n,title:r,imageId:o,canvasId:i,x:s,y:a,stopEditing:p},t):er(ji,{enabled:n,title:r,imageId:o,canvasId:i,x:s,y:a,width:c,height:d,startEditing:p},t)})),e&&er(Qi,{stopEditing:d}),e?er("span",{role:"button",tabIndex:-1,className:"modallink",onClick:()=>d()},void 0," ","Cancelar agregar plantilla"):er("span",{role:"button",tabIndex:-1,className:"modallink",onClick:()=>t(!0)},void 0," ","Añadir plantilla"),n.some((e=>e.enabled))&&er(Oe.Fragment,{},"exps"," | ",er("span",{role:"button",tabIndex:-1,className:"modallink",onClick:async()=>{const e=await X.exportEnabledTemplates();e&&Ht()(JSON.stringify(e),"PixelplanetTemplates.json")}},void 0,"Exportar plantillas activadas"))," | ",er("span",{role:"button",tabIndex:-1,className:"modallink",onClick:async()=>u.current?.click()},void 0,"Importar plantillas"),Oe.createElement("input",{type:"file",key:"impin",ref:u,style:{display:"none"},onChange:e=>{X.importTemplates(e.target.files?.[0])}}))};var nr,or,ir,rr,sr;function ar(e,t,n,o){sr||(sr="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var i=e&&e.defaultProps,r=arguments.length-3;if(t||0===r||(t={children:void 0}),1===r)t.children=o;else if(r>1){for(var s=new Array(r),a=0;a<r;a++)s[a]=arguments[a+3];t.children=s}if(t&&i)for(var l in i)void 0===t[l]&&(t[l]=i[l]);else t||(t=i||{});return{$$typeof:sr,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}const lr=e=>{let{title:t,values:n,selected:o,onSelect:i,icon:r,children:s}=e;return ar("div",{className:"setitem"},void 0,ar("div",{className:"setrow"},void 0,ar("h3",{className:"settitle"},void 0,t),r&&ar("img",{alt:"",src:r}),ar("select",{value:o,onChange:e=>{const t=e.target;i(t.options[t.selectedIndex].value)}},void 0,n.map((e=>ar("option",{value:e},e,e))))),ar("div",{className:"modaldesc"},void 0,s),nr||(nr=ar("div",{className:"modaldivider"})))},cr=()=>{const[e,t,n,o,i,s,a,l,c,d,u,h]=(0,Pe.v9)((e=>[e.gui.showGrid,e.gui.showPixelNotify,e.gui.showMvmCtrls,e.gui.autoZoomIn,e.gui.compactPalette,e.gui.isPotato,e.gui.isLightGrid,e.gui.style,e.gui.mute,e.gui.chatNotify,e.canvas.isHistoricalView,e.templates.available]),Pe.wU),p=(0,Pe.I0)(),f=window.AudioContext||window.webkitAudioContext;return ar("div",{className:"content"},void 0,ar(Ui,{title:"Mostrar Cuadrícula",keyBind:"G",value:e,onToggle:()=>p((0,r.xK)())},void 0,"Enciende la cuadrícula para mostrar los bordes de los píxeles."),ar(Ui,{title:"Mostrar Actividad de Píxeles",keyBind:"X",value:t,onToggle:()=>p((0,r.Xb)())},void 0,"Muestra círculos donde se han colocado píxeles."),ar(Ui,{title:"Mostrar siempre los Controles de Movimiento",keyBind:"N",value:n,onToggle:()=>p((0,r.qP)())},void 0,"Mostrar siempre los botones de control de movimiento"),ar(Ui,{title:"Desactivar los Sonidos del Juego",keyBind:"M",deactivated:!f,value:!f||c,onToggle:()=>p((0,r.$t)())},void 0,["Se desactivarán todos los efectos de sonido.",!f&&ar("p",{className:"warn"},void 0,"Su navegador no nos permite usar AudioContext para reproducir sonidos. ¿Tiene alguna función de privacidad que nos bloquee?")]),ar(Ui,{title:"Activar las notificaciones del chat",value:d,onToggle:()=>p((0,r.c7)())},void 0,"Reproducir un sonido al llegar mensajes nuevos"),ar(Ui,{title:"Zoom automático",value:o,onToggle:()=>p((0,r.o7)())},void 0,"Si el zoom está alejado, este se acercará en lugar de colocar un píxel al hacer clic en el lienzo."),ar(Ui,{title:"Paleta de colores compacta",value:i,onToggle:()=>p((0,r.Cd)())},void 0,"Muestra la Paleta de Colores en una forma compacta para ahorrar espacio en la pantalla."),ar(Ui,{title:"Modo Patata",value:s,onToggle:()=>p((0,r.RL)())},void 0,"Para cuando juegas en una patata."),ar(Ui,{title:"Cuadrícula Clara",value:a,onToggle:()=>p((0,r.ts)())},void 0,"Muestra la Cuadrícula en blanco en vez de negro."),window.ssv&&window.ssv.backupurl&&ar(Ui,{title:"Vista Histórica",value:u,keyBind:"H",onToggle:()=>p((0,r.FI)())},void 0,"Revisa versiones antiguas del lienzo."),window.ssv&&window.ssv.availableStyles&&ar(lr,{title:"Temas",values:Object.keys(window.ssv.availableStyles),selected:l,onSelect:e=>p((0,r.MM)(e))},void 0,"Cómo debería verse pixelplanet."),window.ssv&&navigator.cookieEnabled&&window.ssv.langs&&ar("div",{className:"setitem"},void 0,ar("div",{className:"setrow"},void 0,ar("h3",{className:"settitle"},void 0,"Seleccionar Lenguaje"),or||(or=ar(Gi,{})))),ir||(ir=ar("div",{className:"modaldivider"})),h&&(rr||(rr=ar(tr,{}))))},dr=Oe.memo(cr),ur=/^[-!#$%&'*+\/0-9=?A-Z^_a-z{|}~](\.?[-!#$%&'*+\/0-9=?A-Z^_a-z`{|}~])*@[a-zA-Z0-9](-*\.?[a-zA-Z0-9])*\.[a-zA-Z](-?[a-zA-Z0-9])+$/;function hr(e){return e?e.length<5?"El correo debe tener al menos 5 caracteres de largo.":e.length>40?"El correo no puede tener más de 40 caracteres.":-1===e.indexOf(".")?"El correo debe contener al menos un punto":1!==e.split("").filter((e=>"@"===e)).length?"El correo debe contener una @":!ur.test(e)&&"Your Email looks shady":"El campo de correo no puede estar vacío."}function pr(e){return e?e.length<2?"El nombre debe tener al menos 2 caracteres de largo":e.length>26?"El correo debe tener menos de 26 caracteres":(-1!==e.indexOf("@")||-1!==e.indexOf("/")||-1!==e.indexOf("\\")||-1!==e.indexOf(">")||-1!==e.indexOf("<")||-1!==e.indexOf("#"))&&"El nombre contiene caracteres inválidos como @, /, \\ o #":"El campo de nombre no puede estar vacío."}function fr(e){return e?e.length<6?"La contraseña debe tener al menos 6 caracteres de largo.":e.length>60&&"La contraseña debe tener menos de 60 caracteres.":"No se ingresó una contraseña."}var vr,mr;function gr(e,t,n,o){mr||(mr="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var i=e&&e.defaultProps,r=arguments.length-3;if(t||0===r||(t={children:void 0}),1===r)t.children=o;else if(r>1){for(var s=new Array(r),a=0;a<r;a++)s[a]=arguments[a+3];t.children=s}if(t&&i)for(var l in i)void 0===t[l]&&(t[l]=i[l]);else t||(t=i||{});return{$$typeof:mr,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}const wr={display:"inline-block",width:"75%",maxWidth:"35em"},yr=()=>{const[e,t]=(0,Oe.useState)(""),[n,o]=(0,Oe.useState)(""),[i,s]=(0,Oe.useState)(!1),[a,l]=(0,Oe.useState)([]),c=(0,Pe.I0)();return gr("form",{onSubmit:async t=>{if(t.preventDefault(),i)return;const o=function(e,t){const n=[],o=-1!==e.indexOf("@")?hr(e):pr(e);o&&n.push(o);const i=fr(t);return i&&n.push(i),n}(e,n);if(o.length>0)return void l(o);s(!0);const{errors:a,me:d}=await(0,F.Pw)(e,n);s(!1),a?l(a):c((0,r.pH)(d))}},void 0,a.map((e=>gr("p",{},e,gr("span",{},void 0,"Error"),": ",e))),gr("input",{value:e,style:wr,onChange:e=>t(e.target.value),type:"text",placeholder:"Nombre o Email"}),vr||(vr=gr("br",{})),gr("input",{value:n,style:wr,onChange:e=>o(e.target.value),type:"password",placeholder:"Contraseña"}),gr("p",{},void 0,gr("button",{type:"submit"},void 0,i?"...":"Iniciar Sesión")))},br=Oe.memo(yr);var Sr,Er,Cr,Tr,kr,Ir,xr,Nr;function _r(e,t,n,o){Nr||(Nr="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var i=e&&e.defaultProps,r=arguments.length-3;if(t||0===r||(t={children:void 0}),1===r)t.children=o;else if(r>1){for(var s=new Array(r),a=0;a<r;a++)s[a]=arguments[a+3];t.children=s}if(t&&i)for(var l in i)void 0===t[l]&&(t[l]=i[l]);else t||(t=i||{});return{$$typeof:Nr,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}const Ar={marginRight:5},Lr=()=>{const e=Je();return _r("div",{style:{textAlign:"center"}},void 0,_r("p",{},void 0,"Inicia sesión para acceder a más características y estadísticas."),Sr||(Sr=_r("br",{})),_r("h2",{},void 0,"Iniciar sesión con Nombre o Correo:"),Er||(Er=_r(br,{})),_r("p",{className:"modallink",onClick:()=>e("FORGOT_PASSWORD"),role:"presentation"},void 0,"Olvidé mi Contraseña."),_r("h2",{},void 0,"o inicia sesión con:"),Cr||(Cr=_r("a",{href:"/api/auth/discord"},void 0,_r("img",{style:Ar,width:32,src:"/discordlogo.svg",alt:"Discord"}))),Tr||(Tr=_r("a",{href:"/api/auth/google"},void 0,_r("img",{style:Ar,width:32,src:"/googlelogo.svg",alt:"Google"}))),kr||(kr=_r("a",{href:"/api/auth/facebook"},void 0,_r("img",{style:Ar,width:32,src:"/facebooklogo.svg",alt:"Facebook"}))),Ir||(Ir=_r("a",{href:"/api/auth/vk"},void 0,_r("img",{style:Ar,width:32,src:"/vklogo.svg",alt:"VK"}))),xr||(xr=_r("a",{href:"/api/auth/reddit"},void 0,_r("img",{style:Ar,width:32,src:"/redditlogo.svg",alt:"Reddit"}))),_r("h2",{},void 0,"o regístrate aquí:"),_r("button",{type:"button",onClick:()=>e("REGISTER")},void 0,"Registrar"))},Or=Oe.memo(Lr);var Pr;function Rr(e,t,n,o){Pr||(Pr="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var i=e&&e.defaultProps,r=arguments.length-3;if(t||0===r||(t={children:void 0}),1===r)t.children=o;else if(r>1){for(var s=new Array(r),a=0;a<r;a++)s[a]=arguments[a+3];t.children=s}if(t&&i)for(var l in i)void 0===t[l]&&(t[l]=i[l]);else t||(t=i||{});return{$$typeof:Pr,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}const $r=e=>{let{onClick:t,active:n,label:o}=e,i="tab-list-item";return n&&(i+=" active"),Rr("li",{role:"presentation",className:i,onClick:()=>t(o)},void 0,o)};var Dr;function Mr(e,t,n,o){Dr||(Dr="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var i=e&&e.defaultProps,r=arguments.length-3;if(t||0===r||(t={children:void 0}),1===r)t.children=o;else if(r>1){for(var s=new Array(r),a=0;a<r;a++)s[a]=arguments[a+3];t.children=s}if(t&&i)for(var l in i)void 0===t[l]&&(t[l]=i[l]);else t||(t=i||{});return{$$typeof:Dr,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}const Hr=e=>{let{children:t,activeTab:n,setActiveTab:o}=e;return Mr("div",{className:"tabs"},void 0,Mr("ol",{className:"tab-list"},void 0,t.map((e=>{if(!e.props)return;const{label:t}=e.props;return Mr($r,{active:n===t,label:t,onClick:e=>o(e)},t)}))),Mr("div",{className:"tab-content"},void 0,t.map((e=>{if(e.props&&e.props.label===n)return e.props.children}))))};var Wr;function Ur(e,t,n,o){Wr||(Wr="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var i=e&&e.defaultProps,r=arguments.length-3;if(t||0===r||(t={children:void 0}),1===r)t.children=o;else if(r>1){for(var s=new Array(r),a=0;a<r;a++)s[a]=arguments[a+3];t.children=s}if(t&&i)for(var l in i)void 0===t[l]&&(t[l]=i[l]);else t||(t=i||{});return{$$typeof:Wr,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}const Vr=()=>{const[e,t]=(0,Oe.useState)(!1),[n,o]=(0,Oe.useState)(null),i=(0,Pe.v9)((e=>e.user.messages));return i?Ur("div",{style:{paddingLeft:"5%",paddingRight:"5%"}},void 0,i.includes("not_verified")&&Ur("p",{className:"usermessages"},void 0,"Por favor verifica tu dirección de correo\no Tu cuenta podría ser eliminada en unos pocos días.",n?Ur("span",{className:"modallink"},void 0,n):Ur("span",{role:"button",tabIndex:-1,className:"modallink",onClick:async()=>{if(e)return;t(!0);const{errors:n}=await(0,F.ft)(),i=n?n[0]:"Un nuevo correo de verificación está siendo enviado.";o(i)}},void 0,"Haz clic aquí para solicitar un nuevo correo de verificación.")),i.map((e=>"not_verified"===e?null:Ur("p",{className:"usermessages"},e,e)))):null},zr=Oe.memo(Vr);var Gr,Fr,qr,Br;function jr(e,t,n,o){Br||(Br="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var i=e&&e.defaultProps,r=arguments.length-3;if(t||0===r||(t={children:void 0}),1===r)t.children=o;else if(r>1){for(var s=new Array(r),a=0;a<r;a++)s[a]=arguments[a+3];t.children=s}if(t&&i)for(var l in i)void 0===t[l]&&(t[l]=i[l]);else t||(t=i||{});return{$$typeof:Br,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}const Zr=e=>{let{done:t}=e;const[n,o]=(0,Oe.useState)(""),[i,s]=(0,Oe.useState)(""),[a,l]=(0,Oe.useState)(""),[c,d]=(0,Oe.useState)(!1),[u,h]=(0,Oe.useState)(!1),[p,f]=(0,Oe.useState)([]),v=(0,Pe.v9)((e=>e.user.mailreg)),m=(0,Pe.I0)();return c?jr("div",{className:"inarea"},void 0,jr("p",{className:"modalmessage"},void 0,"Se cambió la contraseña exitosamente."),jr("button",{type:"button",onClick:t},void 0,"Close")):jr("div",{className:"inarea"},void 0,jr("form",{onSubmit:async e=>{if(e.preventDefault(),u)return;const t=function(e,t,n,o){const i=[];if(e){const e=fr(t);e&&i.push(e)}if(n!==o)return i.push("Las contraseñas no coinciden."),i;const r=fr(n);return r&&i.push(r),i}(v,n,i,a);if(f(t),t.length)return;h(!0);const{errors:o}=await(0,F.Oh)(i,n);if(o)return f(o),void h(!1);m((0,r.Y2)(!0)),d(!0)}},void 0,p.map((e=>jr("p",{className:"errormessage"},e,jr("span",{},void 0,"Error"),": ",e))),v&&jr("input",{value:n,onChange:e=>o(e.target.value),type:"password",placeholder:"Contraseña Anterior"}),Gr||(Gr=jr("br",{})),jr("input",{value:i,onChange:e=>s(e.target.value),type:"password",placeholder:"Contraseña Nueva"}),Fr||(Fr=jr("br",{})),jr("input",{value:a,onChange:e=>l(e.target.value),type:"password",placeholder:"Confirmar Contraseña Nueva"}),qr||(qr=jr("br",{})),jr("button",{type:"submit"},void 0,u?"...":"Guardar"),jr("button",{type:"button",onClick:t},void 0,"Cancelar")))},Kr=Oe.memo(Zr);var Yr,Qr;function Xr(e,t,n,o){Qr||(Qr="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var i=e&&e.defaultProps,r=arguments.length-3;if(t||0===r||(t={children:void 0}),1===r)t.children=o;else if(r>1){for(var s=new Array(r),a=0;a<r;a++)s[a]=arguments[a+3];t.children=s}if(t&&i)for(var l in i)void 0===t[l]&&(t[l]=i[l]);else t||(t=i||{});return{$$typeof:Qr,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}const Jr=e=>{let{done:t}=e;const[n,o]=(0,Oe.useState)(""),[i,s]=(0,Oe.useState)(!1),[a,l]=(0,Oe.useState)([]),c=(0,Pe.I0)();return Xr("div",{className:"inarea"},void 0,Xr("form",{onSubmit:async e=>{if(e.preventDefault(),i)return;const o=function(e){const t=[],n=pr(e);return n&&t.push(n),t}(n);if(o.length>0)return void l(o);s(!0);const{errors:a}=await(0,F.Wt)(n);s(!1),a?l(a):(c((0,r.qC)(n)),t())}},void 0,a.map((e=>Xr("p",{className:"errormessage"},e,Xr("span",{},void 0,"Error"),": ",e))),Xr("input",{value:n,onChange:e=>o(e.target.value),type:"text",placeholder:"Nombre de Usuario Nuevo"}),Yr||(Yr=Xr("br",{})),Xr("button",{type:"submit"},void 0,i?"...":"Guardar"),Xr("button",{type:"button",onClick:t},void 0,"Cancelar")))};var es,ts,ns;function os(e,t,n,o){ns||(ns="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var i=e&&e.defaultProps,r=arguments.length-3;if(t||0===r||(t={children:void 0}),1===r)t.children=o;else if(r>1){for(var s=new Array(r),a=0;a<r;a++)s[a]=arguments[a+3];t.children=s}if(t&&i)for(var l in i)void 0===t[l]&&(t[l]=i[l]);else t||(t=i||{});return{$$typeof:ns,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}const is=e=>{let{done:t}=e;const[n,o]=(0,Oe.useState)(""),[i,r]=(0,Oe.useState)(""),[s,a]=(0,Oe.useState)(!1),[l,c]=(0,Oe.useState)(!1),[d,u]=(0,Oe.useState)([]);return l?os("div",{className:"inarea"},void 0,os("p",{className:"modalmessage"},void 0,"El correo se ha cambiado exitosamente. Te hemos enviado un correo de notificación,               por favor verifica tu nueva dirección de correo."),os("button",{type:"button",onClick:t},void 0,"Close")):os("div",{className:"inarea"},void 0,os("form",{onSubmit:async e=>{if(e.preventDefault(),s)return;const t=function(e,t){const n=[],o=fr(t);o&&n.push(o);const i=hr(e);return i&&n.push(i),n}(i,n);if(t.length>0)return void u(t);a(!0);const{errors:o}=await(0,F.fF)(i,n);a(!1),o?u(o):c(!0)}},void 0,d.map((e=>os("p",{className:"errormessage"},e,os("span",{},void 0,"Error"),": ",e))),os("input",{value:n,onChange:e=>o(e.target.value),type:"password",placeholder:"Contraseña"}),es||(es=os("br",{})),os("input",{value:i,onChange:e=>r(e.target.value),type:"text",placeholder:"Correo Nuevo"}),ts||(ts=os("br",{})),os("button",{type:"submit"},void 0,s?"...":"Guardar"),os("button",{type:"button",onClick:t},void 0,"Cancelar")))};var rs,ss;function as(e,t,n,o){ss||(ss="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var i=e&&e.defaultProps,r=arguments.length-3;if(t||0===r||(t={children:void 0}),1===r)t.children=o;else if(r>1){for(var s=new Array(r),a=0;a<r;a++)s[a]=arguments[a+3];t.children=s}if(t&&i)for(var l in i)void 0===t[l]&&(t[l]=i[l]);else t||(t=i||{});return{$$typeof:ss,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}const ls=e=>{let{done:t}=e;const[n,o]=(0,Oe.useState)(""),[i,s]=(0,Oe.useState)(!1),[a,l]=(0,Oe.useState)([]),c=(0,Pe.I0)();return as("div",{className:"inarea",style:{backgroundColor:"#ff6666"}},void 0,as("form",{onSubmit:async e=>{if(e.preventDefault(),i)return;const t=function(e){const t=[],n=fr(e);return n&&t.push(n),t}(n);if(t.length>0)return void l(t);s(!0);const{errors:o}=await(0,F.s$)(n);s(!1),o?l(o):c((0,r.TX)())}},void 0,a.map((e=>as("p",{className:"errormessage"},e,as("span",{},void 0,"Error"),": ",e))),as("input",{value:n,onChange:e=>o(e.target.value),type:"password",placeholder:"Contraseña"}),rs||(rs=as("br",{})),as("button",{type:"submit"},void 0,i?"...":"¡Si, Elimina Mi Cuenta!"),as("button",{type:"button",onClick:t},void 0,"Cancelar")))};var cs,ds;function us(e,t,n,o){ds||(ds="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var i=e&&e.defaultProps,r=arguments.length-3;if(t||0===r||(t={children:void 0}),1===r)t.children=o;else if(r>1){for(var s=new Array(r),a=0;a<r;a++)s[a]=arguments[a+3];t.children=s}if(t&&i)for(var l in i)void 0===t[l]&&(t[l]=i[l]);else t||(t=i||{});return{$$typeof:ds,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}const hs=e=>[e.chat.blocked,e.user.blockDm,e.user.priv,e.fetching.fetchingApi],ps=e=>{let{done:t}=e;const[n,o,i,r]=(0,Pe.v9)(hs,Pe.wU),s=(0,Pe.I0)();return us("div",{className:"inarea"},void 0,us(Ui,{title:"Bloquear DMs",value:o,onToggle:()=>{r||s((0,d.R0)(!o))}},void 0,"Bloquear todos los Mensajes Privados"),us(Ui,{title:"Privado",value:i,onToggle:()=>{r||s((0,d.eg)(!i))}},void 0,"No mostrarme en las estadísticas globales"),us("h3",{style:{textAlign:"left",marginLeft:10}},void 0,"Desbloquear Usuarios"),n.length?us("span",{className:"unblocklist"},void 0,n.map((e=>us("div",{role:"button",tabIndex:0,onClick:()=>{r||s((0,d.Ox)(e[0],e[1],!1))}},e[0],`⦸ ${e[1]}`)))):us("p",{},void 0,"No tienes usuarios bloqueados"),cs||(cs=us("div",{className:"modaldivider"})),us("button",{type:"button",onClick:t,style:{margin:10}},void 0,"Done"))};var fs,vs,ms,gs,ws,ys,bs;function Ss(e,t,n,o){bs||(bs="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var i=e&&e.defaultProps,r=arguments.length-3;if(t||0===r||(t={children:void 0}),1===r)t.children=o;else if(r>1){for(var s=new Array(r),a=0;a<r;a++)s[a]=arguments[a+3];t.children=s}if(t&&i)for(var l in i)void 0===t[l]&&(t[l]=i[l]);else t||(t=i||{});return{$$typeof:bs,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}const Es={CHANGE_NAME:Oe.memo(Jr),CHANGE_MAIL:Oe.memo(is),CHANGE_PASSWORD:Kr,DELETE_ACCOUNT:Oe.memo(ls),SOCIAL_SETTINGS:Oe.memo(ps)},Cs=e=>{let{text:t,value:n,rank:o}=e;return Ss("p",{},void 0,Ss("span",{className:"stattext"},void 0,o?`${t}: #`:`${t}: `)," ",Ss("span",{className:"statvalue"},void 0,(0,E.D$)(n)))},Ts=()=>{const[e,t]=(0,Oe.useState)("NONE"),n=(0,Pe.I0)(),o=(0,Oe.useCallback)((async()=>{await(0,F.e9)()&&n((0,r.TX)())}),[n]),i=(0,Pe.v9)((e=>e.user.mailreg)),s=(0,Pe.v9)((e=>e.user.name)),a=(0,Pe.v9)((e=>({totalPixels:e.ranks.totalPixels,dailyTotalPixels:e.ranks.dailyTotalPixels,ranking:e.ranks.ranking,dailyRanking:e.ranks.dailyRanking})),Pe.wU),l=Es[e];return Ss("div",{className:"content"},void 0,fs||(fs=Ss(zr,{})),Ss(Cs,{text:"Píxeles Colocados Hoy",value:a.dailyTotalPixels}),Ss(Cs,{text:"Ranking Diario",value:a.dailyRanking,rank:!0}),Ss(Cs,{text:"Píxeles Colocados",value:a.totalPixels}),Ss(Cs,{text:"Ranking Total",value:a.ranking,rank:!0}),Ss("div",{},void 0,Ss("p",{},void 0,`Tu nombre es: ${s}`),"(",Ss("span",{role:"button",tabIndex:-1,className:"modallink",onClick:o},void 0," ","Cerrar sesión"),vs||(vs=Ss("span",{className:"hdivider"})),Ss("span",{role:"button",tabIndex:-1,className:"modallink",onClick:()=>t("CHANGE_NAME")},void 0," ","Cambiar Nombre de Usuario"),ms||(ms=Ss("span",{className:"hdivider"})),i&&Ss(Oe.Fragment,{},"mc",Ss("span",{role:"button",tabIndex:-1,className:"modallink",onClick:()=>t("CHANGE_MAIL")},void 0," ","Cambiar Correo"),gs||(gs=Ss("span",{className:"hdivider"}))),Ss("span",{role:"button",tabIndex:-1,className:"modallink",onClick:()=>t("CHANGE_PASSWORD")},void 0," ","Cambiar Contraseña"),ws||(ws=Ss("span",{className:"hdivider"})),Ss("span",{role:"button",tabIndex:-1,className:"modallink",onClick:()=>t("DELETE_ACCOUNT")},void 0," ","Eliminar Cuenta")," )",ys||(ys=Ss("br",{})),"(",Ss("span",{role:"button",tabIndex:-1,className:"modallink",onClick:()=>t("SOCIAL_SETTINGS")},void 0," ","Configuración Social")," )"),l&&Ss(l,{done:()=>t(null)}))},ks=Oe.memo(Ts);var Is,xs,Ns,_s,As,Ls,Os,Ps;function Rs(e,t,n,o){Ps||(Ps="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var i=e&&e.defaultProps,r=arguments.length-3;if(t||0===r||(t={children:void 0}),1===r)t.children=o;else if(r>1){for(var s=new Array(r),a=0;a<r;a++)s[a]=arguments[a+3];t.children=s}if(t&&i)for(var l in i)void 0===t[l]&&(t[l]=i[l]);else t||(t=i||{});return{$$typeof:Ps,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}const $s=Oe.lazy((()=>n.e(784).then(n.bind(n,563)))),Ds=Oe.lazy((()=>n.e(545).then(n.bind(n,865)))),Ms=Oe.lazy((()=>n.e(189).then(n.bind(n,89)))),Hs=()=>{const e=(0,Pe.v9)((e=>e.user.name)),t=(0,Pe.v9)((e=>e.user.userlvl)),n=(0,Pe.v9)((e=>e.ranks.lastFetch)),{args:o,setArgs:i,setTitle:r}=(0,Oe.useContext)(Qe),{activeTab:s="Perfil"}=o,a=(0,Pe.I0)(),l=(0,Oe.useCallback)((e=>{i({activeTab:e}),r(e)}),[i,r]);return(0,Xn.Z)((()=>{Date.now()-3e5>n&&a((0,d.mP)())}),3e5),Rs("div",{style:{textAlign:"center"}},void 0,Rs(Hr,{activeTab:s,setActiveTab:l},void 0,Rs("div",{label:"Perfil"},void 0,e?Is||(Is=Rs(ks,{})):xs||(xs=Rs(Or,{}))),Rs("div",{label:"Estadísticas"},void 0,Ns||(Ns=Rs(Oe.Suspense,{fallback:Rs("div",{},void 0,"Loading...")},void 0,Rs($s,{})))),Rs("div",{label:"Convertidor"},void 0,_s||(_s=Rs(Oe.Suspense,{fallback:Rs("div",{},void 0,"Loading...")},void 0,Rs(Ds,{})))),t&&Rs("div",{label:"Herramientas de Moderación"},void 0,Rs(Oe.Suspense,{fallback:Rs("div",{},void 0,"Cargando...")},void 0,As||(As=Rs(Ms,{}))))),Ls||(Ls=Rs("br",{})),"Considera unirte a nuestro Guilded:"," ",Rs("a",{href:"./guilded",target:"_blank"},void 0,"Invited to Chat"),Os||(Os=Rs("br",{})))},Ws=Oe.memo(Hs);var Us;function Vs(e,t,n,o){Us||(Us="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var i=e&&e.defaultProps,r=arguments.length-3;if(t||0===r||(t={children:void 0}),1===r)t.children=o;else if(r>1){for(var s=new Array(r),a=0;a<r;a++)s[a]=arguments[a+3];t.children=s}if(t&&i)for(var l in i)void 0===t[l]&&(t[l]=i[l]);else t||(t=i||{});return{$$typeof:Us,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}const zs=()=>{const[e,t]=(0,Oe.useState)(""),[n,o]=(0,Oe.useState)([]),[i,s]=(0,Oe.useState)(Date.now()),a=(0,Pe.I0)(),l=Je();return Vs("div",{className:"content"},void 0,Vs("form",{style:{paddingLeft:"5%",paddingRight:"5%"},onSubmit:async n=>{if(n.preventDefault(),e)return;const i=n.target.name.value,c=n.target.email.value,d=n.target.password.value,u=n.target.confirmpassword.value,h=n.target.captcha.value,p=n.target.captchaid.value,f=function(e,t,n,o){const i=[],r=hr(t);r&&i.push(r);const s=pr(e);s&&i.push(s);const a=fr(n);return a&&i.push(a),n!==o&&i.push("Passwords do not match"),i}(i,c,d,u);if(f.length>0)return void o(f);t(!0);const{errors:v,me:m}=await(0,F.yx)(i,c,d,h,p);if(t(!1),v)return s(Date.now()),void o(v);a((0,r.pH)(m)),l("USERAREA")}},void 0,Vs("p",{},void 0,"Registrar una cuenta nueva aquí"),n.map((e=>Vs("p",{className:"errormessage"},e,Vs("span",{},void 0,"Error"),": ",e))),Vs("h3",{},void 0,"Nombre",":"),Vs("input",{name:"name",className:"reginput",autoComplete:"username",type:"text",placeholder:"Nombre"}),Vs("h3",{},void 0,"Correo electrónico",":"),Vs("input",{name:"email",className:"reginput",autoComplete:"email",type:"text",placeholder:"Correo electrónico"}),Vs("h3",{},void 0,"Contraseña",":"),Vs("input",{name:"password",className:"reginput",autoComplete:"new-password",type:"password",placeholder:"Contraseña"}),Vs("h3",{},void 0,"Confirmar Contraseña",":"),Vs("input",{name:"confirmpassword",className:"reginput",autoComplete:"new-password",type:"password",placeholder:"Confirmar Contraseña"}),Vs("h3",{},void 0,"Captcha",":"),Vs(Bn,{autoload:!1,width:60},i),Vs("button",{type:"submit"},void 0,e?"...":"Confirmar"),Vs("button",{type:"button",onClick:()=>l("USERAREA")},void 0,"Cancelar")))},Gs=Oe.memo(zs);var Fs,qs,Bs,js,Zs,Ks,Ys,Qs,Xs,Js;function ea(e,t,n,o){Js||(Js="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var i=e&&e.defaultProps,r=arguments.length-3;if(t||0===r||(t={children:void 0}),1===r)t.children=o;else if(r>1){for(var s=new Array(r),a=0;a<r;a++)s[a]=arguments[a+3];t.children=s}if(t&&i)for(var l in i)void 0===t[l]&&(t[l]=i[l]);else t||(t=i||{});return{$$typeof:Js,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}const ta=e=>{let{canvasId:t,canvas:n,selCanvas:o,online:i}=e;return ea("div",{className:"cvbtn",onClick:()=>o(t),role:"button",tabIndex:0},void 0,ea("img",{className:"cvimg",alt:"preview",src:`/preview${t}.png`}),ea("div",{className:"modalcvtext"},void 0,ea("h4",{},void 0,n.title),i&&ea(Oe.Fragment,{},"online","Usuarios Online",": ",ea("span",{className:"modalinfo"},void 0,i),Fs||(Fs=ea("br",{}))),ea("span",{className:"modalinfo"},void 0,n.desc),qs||(qs=ea("br",{})),"Enfriamiento",": ",ea("span",{className:"modalinfo"},void 0,n.pcd&&n.bcd!==n.pcd?ea("span",{},"cdf"," ",n.bcd/1e3,"s / ",n.pcd/1e3,"s"):ea("span",{},"cd"," ",n.bcd/1e3,"s")),Bs||(Bs=ea("br",{})),"Apilamiento hasta",": ",ea("span",{className:"modalinfo"},void 0," ",n.cds/1e3,"s"),js||(js=ea("br",{})),"Incluido en Ranking",": ",ea("span",{className:"modalinfo"},void 0,n.ranked?"Sí":"No"),Zs||(Zs=ea("br",{})),void 0!==n.req&&ea(Oe.Fragment,{},"req",ea("span",{},void 0,"Requisitos",":",Ks||(Ks=ea("br",{})),ea("span",{className:"modalinfo"},void 0,"number"==typeof n.req?ea("span",{},void 0,"Cuenta de Usuario"," "):null,n.req>0?ea("span",{},void 0," ",`y ${n.req} Píxeles colocados`," "):null,"top"===n.req&&ea("span",{},void 0,"Ranking Diario Top 10"))),Ys||(Ys=ea("br",{}))),"Dimensiones",": ",ea("span",{className:"modalinfo"},void 0," ",n.size," x ",n.size,n.v?Qs||(Qs=ea("span",{},"voxsize"," x ",c.Tj," Voxels")):Xs||(Xs=ea("span",{},"pxlsize"," Pixels")))))},na=Oe.memo(ta);var oa;function ia(e,t,n,o){oa||(oa="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var i=e&&e.defaultProps,r=arguments.length-3;if(t||0===r||(t={children:void 0}),1===r)t.children=o;else if(r>1){for(var s=new Array(r),a=0;a<r;a++)s[a]=arguments[a+3];t.children=s}if(t&&i)for(var l in i)void 0===t[l]&&(t[l]=i[l]);else t||(t=i||{});return{$$typeof:oa,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}const ra=()=>{const[e,t,n]=(0,Pe.v9)((e=>[e.canvas.canvases,e.gui.easterEgg,e.ranks.online]),Pe.wU),o=(0,Pe.I0)(),i=(0,Oe.useCallback)((e=>o((0,r.SC)(e))),[o]),s=Je();return ia("div",{className:"content"},void 0,ia("p",{},void 0,"Selecciona el lienzo que deseas utilizar.\nCada lienzo es único y tiene distintas paletas, tiempos de enfriamiento y requisitos.\nPuedes acceder a un archivo de los lienzos cerrados aquí:"," ",ia("span",{role:"button",tabIndex:0,className:"modallink",onClick:()=>s("ARCHIVE")},void 0,"Archivo")),Object.keys(e).sort(((t,n)=>t===window.ssv.dc?-1:n===window.ssv.dc?1:(null!=e[t].linkcd&&(t=e[t].linkcd+.1),null!=e[n].linkcd&&(n=e[n].linkcd+.1),t-n))).map((o=>(!e[o].hid||t)&&!e[o].ed&&ia(na,{online:n[o],canvasId:o,canvas:e[o],selCanvas:i},o))),window.ssv?.backupurl&&Object.keys(e).some((t=>e[t].ed))&&Oe.createElement(Oe.Fragment,null,ia("h3",{},void 0,"Lienzos retirados (solo historial)"),Object.keys(e).map((t=>e[t].ed&&ia(na,{online:n[t],canvasId:t,canvas:e[t],selCanvas:i},t)))))},sa=Oe.memo(ra);var aa,la,ca,da;function ua(e,t,n,o){da||(da="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var i=e&&e.defaultProps,r=arguments.length-3;if(t||0===r||(t={children:void 0}),1===r)t.children=o;else if(r>1){for(var s=new Array(r),a=0;a<r;a++)s[a]=arguments[a+3];t.children=s}if(t&&i)for(var l in i)void 0===t[l]&&(t[l]=i[l]);else t||(t=i||{});return{$$typeof:da,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}var ha,pa=n(9210),fa=n(3935);function va(e,t,n,o){ha||(ha="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var i=e&&e.defaultProps,r=arguments.length-3;if(t||0===r||(t={children:void 0}),1===r)t.children=o;else if(r>1){for(var s=new Array(r),a=0;a<r;a++)s[a]=arguments[a+3];t.children=s}if(t&&i)for(var l in i)void 0===t[l]&&(t[l]=i[l]);else t||(t=i||{});return{$$typeof:ha,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}const ma=e=>{let{args:t,close:n}=e;const o=(0,Pe.v9)((e=>e.chat.channels)),i=(0,Pe.v9)((e=>e.fetching.fetchingApi)),r=(0,Pe.I0)(),{name:s,uid:a,setChannel:l,addToInput:c}=t;return Oe.createElement(Oe.Fragment,null,va("div",{role:"button",tabIndex:0,onClick:()=>{const e=`@[${(0,E.lg)(s)}](${a})`;c(e),n()},style:{borderTop:"none"}},"ping","Hacer Ping"),va("div",{role:"button",tabIndex:0,onClick:()=>{const e=Object.keys(o);for(let t=0;t<e.length;t+=1){const i=e[t];if(4===o[i].length&&o[i][3]===a)return l(i),void n()}i||r((0,d.YB)({userId:a},l)),n()}},"dm","Mensaje Directo"),va("div",{role:"button",tabIndex:-1,onClick:()=>{r((0,d.Ox)(a,s,!0)),n()}},"block","Bloquear"))};var ga;function wa(e,t,n,o){ga||(ga="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var i=e&&e.defaultProps,r=arguments.length-3;if(t||0===r||(t={children:void 0}),1===r)t.children=o;else if(r>1){for(var s=new Array(r),a=0;a<r;a++)s[a]=arguments[a+3];t.children=s}if(t&&i)for(var l in i)void 0===t[l]&&(t[l]=i[l]);else t||(t=i||{});return{$$typeof:ga,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}const ya=e=>{let{args:t,close:n}=e;const o=(0,Pe.v9)((e=>e.chat.channels)),i=(0,Pe.v9)((e=>e.chatRead.mute)),{cid:s}=t,a=(0,Pe.I0)(),l=i.includes(s);return Oe.createElement(Oe.Fragment,null,wa("div",{role:"button",onClick:()=>{a(l?(0,r.wC)(s):(0,r.nb)(s))},tabIndex:0,style:{borderTop:"none"}},"mute",(l?"✔":"✘")+" Silenciar"),0!==o[s][1]&&wa("div",{role:"button",onClick:()=>{a((0,d.K6)(s)),n()},tabIndex:0},"leave","Cerrar"))};var ba;function Sa(e,t,n,o){ba||(ba="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var i=e&&e.defaultProps,r=arguments.length-3;if(t||0===r||(t={children:void 0}),1===r)t.children=o;else if(r>1){for(var s=new Array(r),a=0;a<r;a++)s[a]=arguments[a+3];t.children=s}if(t&&i)for(var l in i)void 0===t[l]&&(t[l]=i[l]);else t||(t=i||{});return{$$typeof:ba,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}const Ea={USER:Oe.memo(ma),CHANNEL:Oe.memo(ya)},Ca=e=>{let{type:t,x:n,y:o,args:i,close:r,align:s}=e;const a=(0,Oe.useRef)(null);var l,c;if(l=[a],c=r,(0,Oe.useEffect)((()=>{const e=l.some((e=>e.current))?l.map((e=>e.current)):null;if(null===e)return;const t=t=>{e.every((e=>!e||!e.contains(t.target)))&&c()},n=()=>{c()};return document.addEventListener("mousedown",t,{capture:!0}),window.addEventListener("resize",n),()=>{document.removeEventListener("mousedown",t,{capture:!0}),window.removeEventListener("resize",n)}}),[l,c]),!t)return null;const d={};switch(s){case"tr":d.right=window.innerWidth-n,d.top=o;break;case"br":d.right=window.innerWidth-n,d.bottom=window.innerHeight-o;break;case"bl":d.left=n,d.bottom=window.innerHeight-o;break;default:d.left=n,d.top=o}const u=Ea[t];return fa.createPortal(Oe.createElement("div",{ref:a,className:`contextmenu ${t}`,style:d},Sa(u,{close:r,args:i})),document.getElementById("app"))},Ta=Oe.memo(Ca);var ka,Ia,xa=n(3854);function Na(e,t,n,o){Ia||(Ia="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var i=e&&e.defaultProps,r=arguments.length-3;if(t||0===r||(t={children:void 0}),1===r)t.children=o;else if(r>1){for(var s=new Array(r),a=0;a<r;a++)s[a]=arguments[a+3];t.children=s}if(t&&i)for(var l in i)void 0===t[l]&&(t[l]=i[l]);else t||(t=i||{});return{$$typeof:Ia,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}const _a=e=>{let{url:t}=e;const[n,o]=(0,Oe.useState)(null);return(0,Oe.useEffect)((()=>{!async function(){const e=`${window.location.protocol}//www.tiktok.com/oembed?url=${encodeURIComponent(t)}`,n=await fetch(e),i=await n.json();i.html&&o(i.html)}()}),[t]),n?Na("iframe",{style:{width:"100%",height:756},srcDoc:n,frameBorder:"0",referrerPolicy:"no-referrer",allow:"autoplay; picture-in-picture",scrolling:"no",sandbox:"allow-scripts allow-modals allow-forms allow-popups allow-same-origin allow-presentation",allowFullScreen:!0,title:"Embedded tiktok"}):ka||(ka=Na("div",{},void 0,"LOADING"))},Aa=[Oe.memo(_a),e=>e.includes("/video/"),e=>function(e){let t=e.indexOf("/@");if(-1===t)return e;t+=1;let n=e.indexOf("/",t);return-1===n&&(n=e.length),e.substring(t,n)}(e),"/embico/tiktok.png"];var La;function Oa(e,t,n,o){La||(La="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var i=e&&e.defaultProps,r=arguments.length-3;if(t||0===r||(t={children:void 0}),1===r)t.children=o;else if(r>1){for(var s=new Array(r),a=0;a<r;a++)s[a]=arguments[a+3];t.children=s}if(t&&i)for(var l in i)void 0===t[l]&&(t[l]=i[l]);else t||(t=i||{});return{$$typeof:La,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}function Pa(e){let t,n=-1;if(e.includes("youtube")&&(n=e.indexOf("v=")),e.includes("youtu.be")&&(n=e.indexOf("e/")),-1===n)return null;for(n+=2,t=n;t<e.length&&!["&","?","/"].includes(e[t]);t+=1);return e.substring(n,t)}const Ra=e=>{let{url:t}=e;const n=Pa(t);return n?Oa("div",{className:"vemb",style:{paddingBottom:"56.25%"}},void 0,Oa("iframe",{className:"vembc",src:`https://www.youtube.com/embed/${n}`,frameBorder:"0",referrerPolicy:"no-referrer",allow:"autoplay; picture-in-picture",sandbox:"allow-scripts allow-modals allow-forms allow-popups allow-same-origin allow-presentation",allowFullScreen:!0,title:"Embedded youtube"})):null},$a=[Oe.memo(Ra),Pa,e=>Pa(e),"/embico/youtube.png"];var Da;function Ma(e,t,n,o){Da||(Da="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var i=e&&e.defaultProps,r=arguments.length-3;if(t||0===r||(t={children:void 0}),1===r)t.children=o;else if(r>1){for(var s=new Array(r),a=0;a<r;a++)s[a]=arguments[a+3];t.children=s}if(t&&i)for(var l in i)void 0===t[l]&&(t[l]=i[l]);else t||(t=i||{});return{$$typeof:Da,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}const Ha=e=>{let{url:t}=e;const n=t.substring(0,t.indexOf("?type="));return t.includes("?type=video")?Ma("div",{className:"vemb"},void 0,Ma("video",{className:"vembc",controls:!0,autoPlay:!0,src:n})):Ma("img",{alt:`Matrix ${n}`,src:n,style:{maxWidth:"100%"}})},Wa=[Oe.memo(Ha),e=>e.includes("?type=video")||e.includes("?type=image"),null,"/embico/matrix.png"],Ua=function(e,t){const n=(0,Oe.useRef)();(0,Oe.useEffect)((()=>{n.current=t}),[t]),(0,Oe.useEffect)((()=>{function t(t){t.source===e.current.contentWindow&&n.current(t.data)}return window.addEventListener("message",t,!1),()=>window.removeEventListener("message",t)}),[e])},Va="t.me/",za=e=>{let{url:t}=e;const[n,o]=(0,Oe.useState)(200),i=(0,Oe.useRef)(null);Ua(i,(e=>{try{const t=JSON.parse(e);"resize"===t.event&&t.height&&o(t.height)}catch{console.error(`Could not read postMessage from frame: ${e}`)}}));let r=(0,E._N)(t);r=r.substring(r.indexOf(Va)+5);const s=r.indexOf("/",r.indexOf("/")+1);return-1!==s&&(r=r.substring(0,s)),Oe.createElement("iframe",{ref:i,style:{width:"100%",height:n},src:`https://t.me/${r}?embed=1`,frameBorder:"0",referrerPolicy:"no-referrer",allow:"autoplay; picture-in-picture",scrolling:"no",sandbox:"allow-scripts allow-modals allow-forms allow-popups allow-same-origin allow-presentation",allowFullScreen:!0,title:"Embedded telegram"})},Ga=[Oe.memo(za),e=>{let t=e.indexOf(Va);return!(-1===t||t+5+1>=e.length||(t=e.indexOf("/",t+5+1),-1===t||t+2>=e.length))},e=>{let t=e.substring(e.indexOf(Va)+5);return t=t.substring(0,t.indexOf("/")),t},"/embico/telegram.png"],Fa="/status/",qa=e=>{let{url:t}=e;const[n,o]=(0,Oe.useState)(200),i=(0,Oe.useRef)(null);Ua(i,(e=>{try{e["twttr.embed"]&&"twttr.private.resize"===e["twttr.embed"].method&&e["twttr.embed"].params.length&&e["twttr.embed"].params[0].height&&o(e["twttr.embed"].params[0].height)}catch{console.error(`Could not read postMessage from frame: ${e}`)}}));let r=(0,E._N)(t);return r=r.substring(r.indexOf(Fa)+8),-1!==r.indexOf("/")&&(r=r.substring(r.indexOf("/"))),Oe.createElement("iframe",{ref:i,style:{width:"100%",height:n},src:`https://platform.twitter.com/embed/Tweet.html?dnt=true&embedId=twitter-widget-&frame=false&hideCard=false&hideThread=true&id=${r}&theme=light&width=550px`,frameBorder:"0",referrerPolicy:"no-referrer",allow:"autoplay; picture-in-picture",scrolling:"no",allowFullScreen:!0,title:"Embedded twitter"})},Ba=[Oe.memo(qa),e=>{const t=e.indexOf(Fa);return!(-1===t||t+8+1>=e.length)},e=>{let t=e.substring(0,e.indexOf(Fa));return t=t.substring(t.lastIndexOf("/")+1),t},"/embico/twitter.png"];var ja;function Za(e,t,n,o){ja||(ja="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var i=e&&e.defaultProps,r=arguments.length-3;if(t||0===r||(t={children:void 0}),1===r)t.children=o;else if(r>1){for(var s=new Array(r),a=0;a<r;a++)s[a]=arguments[a+3];t.children=s}if(t&&i)for(var l in i)void 0===t[l]&&(t[l]=i[l]);else t||(t=i||{});return{$$typeof:ja,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}function Ka(e){const t=e.lastIndexOf(":");return-1!==t?e.substring(0,t):e}const Ya="/@",Qa=e=>{let t,{url:n}=e,o=n.indexOf(Ya);return-1!==o||(o=n.indexOf("//"),-1===o&&(o=0)),t=n.substring(n.indexOf("/",o+2)+1),t=Ka((0,E._N)(t)),Za("div",{className:"vemb",style:{paddingBottom:"56.25%"}},void 0,Za("iframe",{className:"vembc",src:`https://odysee.com/$/embed/${t}`,frameBorder:"0",referrerPolicy:"no-referrer",allow:"autoplay; picture-in-picture",scrolling:"no",sandbox:"allow-scripts allow-modals allow-forms allow-popups allow-same-origin allow-presentation",allowFullScreen:!0,title:"Embedded odysee"}))},Xa=[Oe.memo(Qa),e=>{const t=(0,E._N)(e);let n=t.indexOf(Ya);return-1!==n?!(-1===n||n+4>=t.length||(n=t.indexOf("/",n+2),-1===n||n+2>=t.length)):(n=t.indexOf("//"),-1===n&&(n=0),n=t.indexOf("/",n+2),!(-1===n||n+2>=t.length))},e=>{let t=(0,E._N)(e),n=t.indexOf(Ya);if(-1!==n){t=t.substring(n+2);let e=t.substring(0,t.indexOf("/"));return t=Ka(t.substring(e.length+1)),e=Ka(e),`${e} | ${t}`}return n=t.indexOf("//"),-1===n&&(n=0),t=t.substring(t.indexOf("/",n+2)+1),t=Ka((0,E._N)(t)),t},"/embico/odysee.png"];var Ja;function el(e,t,n,o){Ja||(Ja="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var i=e&&e.defaultProps,r=arguments.length-3;if(t||0===r||(t={children:void 0}),1===r)t.children=o;else if(r>1){for(var s=new Array(r),a=0;a<r;a++)s[a]=arguments[a+3];t.children=s}if(t&&i)for(var l in i)void 0===t[l]&&(t[l]=i[l]);else t||(t=i||{});return{$$typeof:Ja,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}const tl=["webm","mp4"],nl=["jpg","jpeg","png","webp","gif"],ol=e=>{let{url:t}=e;const n=(0,E.r6)(t);return tl.includes(n)?el("div",{className:"vemb"},void 0,el("video",{className:"vembc",controls:!0,autoPlay:!0,src:t,referrerPolicy:"no-referrer"})):el("img",{alt:`Matrix ${t}`,src:t,style:{maxWidth:"100%"},referrerPolicy:"no-referrer"})},il=[Oe.memo(ol),e=>{const t=(0,E.r6)(e);return tl.includes(t)||nl.includes(t)},null,"/embico/direct.png"],rl={tiktok:Aa,youtube:$a,"youtu.be":$a,"matrix.pixelplanet.fun":Wa,"i.4cdn.org":il,"i.imgur":il,"litter.catbox.moe":il,"files.catbox.moe":il,"i.redd.it":il,"media.discordapp.net":il,"media.consumeproduct.win":il,"cdn.discord.com":il,"t.me":Ga,twitter:Ba,"nitter.net":Ba,odysee:Xa};var sl,al,ll;function cl(e,t,n,o){ll||(ll="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var i=e&&e.defaultProps,r=arguments.length-3;if(t||0===r||(t={children:void 0}),1===r)t.children=o;else if(r>1){for(var s=new Array(r),a=0;a<r;a++)s[a]=arguments[a+3];t.children=s}if(t&&i)for(var l in i)void 0===t[l]&&(t[l]=i[l]);else t||(t=i||{});return{$$typeof:ll,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}const dl=["odysee","twitter","matrix.pixelplanet.fun","youtube","youtu.be","t.me"],ul=e=>{let{href:t,title:n,refEmbed:o}=e;const[i,r]=(0,Oe.useState)(!1),s=(0,E.IU)(t);if(s===window.location.hostname&&t.includes("/#")){const e=t.substring(t.indexOf("/#")+1);return Be()&&window.opener&&!window.opener.closed?cl("a",{href:`/${e}`,target:"main"},void 0,n||e):cl("a",{href:`/${e}`},void 0,n||e)}const a=rl[s],l=a&&a[1](t),c=a&&a[0];let d;return d=n&&dl.includes(s)?n:l&&a[2]?a[2](t):t,Oe.createElement(Oe.Fragment,null,cl("a",{href:t,target:"_blank",rel:"noopener noreferrer"},void 0,d),l&&Oe.createElement(Oe.Fragment,null," ",a[3]&&cl("img",{style:{width:"1em",height:"1em",verticalAlign:"middle"},src:a[3],alt:`${s}-icon`}),cl("span",{style:{cursor:"pointer"},onClick:()=>r(!i)},void 0,i?sl||(sl=cl(xa.TQH,{className:"ebcl"})):al||(al=cl(xa.uwt,{className:"ebex"})))),i&&l&&(o&&o.current?fa.createPortal(cl(c,{url:t}),o.current):cl(c,{url:t})))},hl=Oe.memo(ul);var pl;function fl(e,t,n,o){pl||(pl="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var i=e&&e.defaultProps,r=arguments.length-3;if(t||0===r||(t={children:void 0}),1===r)t.children=o;else if(r>1){for(var s=new Array(r),a=0;a<r;a++)s[a]=arguments[a+3];t.children=s}if(t&&i)for(var l in i)void 0===t[l]&&(t[l]=i[l]);else t||(t=i||{});return{$$typeof:pl,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}const vl=e=>{let{name:t,uid:n}=e;const o=n&&n.trim(),i=(0,Pe.v9)((e=>-1!==e.gui.style.indexOf("dark")));return fl("span",{className:o==(0,Pe.v9)((e=>e.user.id))?"ping":"mention",style:{color:(0,E.TP)((0,E.Z)(t),i)}},void 0,`@${t}`)},ml=Oe.memo(vl);var gl;function wl(e,t,n,o){gl||(gl="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var i=e&&e.defaultProps,r=arguments.length-3;if(t||0===r||(t={children:void 0}),1===r)t.children=o;else if(r>1){for(var s=new Array(r),a=0;a<r;a++)s[a]=arguments[a+3];t.children=s}if(t&&i)for(var l in i)void 0===t[l]&&(t[l]=i[l]);else t||(t=i||{});return{$$typeof:gl,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}const yl=Oe.memo((e=>{let{pArray:t,refEmbed:n}=e;return t.map((e=>{if(!Array.isArray(e))return e;const t=e[0];switch(t){case"c":return wl("code",{},void 0,e[1]);case"*":return wl("strong",{},void 0,wl(yl,{pArray:e[1]}));case"~":return wl("s",{},void 0,wl(yl,{pArray:e[1]}));case"+":return wl("em",{},void 0,wl(yl,{pArray:e[1]}));case"_":return wl("u",{},void 0,wl(yl,{pArray:e[1]}));case"img":case"l":return wl(hl,{refEmbed:n,href:e[2],title:e[1]});case"@":return wl(ml,{uid:e[2],name:e[1]});default:return t}}))}));class bl{constructor(e,t){this.txt=e,this.iter=t||0}done(){return this.iter>=this.txt.length}moveForward(){return this.iter+=1,this.iter<this.txt.length}setIter(e){this.iter=e}getChar(){return this.txt[this.iter]}slice(e,t){return this.txt.slice(e,t||this.iter)}has(e){return this.txt.startsWith(e,this.iter)}move(e){return this.iter+=e,this.iter<this.txt.length}skipSpaces(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];for(;this.iter<this.txt.length;this.iter+=1){const t=this.txt[this.iter];if(" "!==t&&"\t"!==t&&(!e||"\n"!==t))break}}countRepeatingCharacters(){const e=this.getChar();let t=this.iter+1;for(;t<this.txt.length&&this.txt[t]===e;t+=1);return t-this.iter}moveToNextLine(){const e=this.txt.indexOf("\n",this.iter);this.iter=-1===e?this.txt.length:e+1}getLine(){const e=this.iter;return this.moveToNextLine(),this.txt.slice(e,this.iter)}getIndent(e){let t=0;for(;this.iter<this.txt.length;){const n=this.getChar();if("\t"===n)t+=e;else{if(" "!==n)break;t+=1}this.iter+=1}return t}goToCharInLine(e){let{iter:t}=this;for(;t<this.txt.length&&"\n"!==this.txt[t]&&this.txt[t]!==e;t+=1);return this.txt[t]===e&&(this.iter=t,t)}static isWhiteSpace(e){return" "===e||"\t"===e||"\n"===e}checkIfEnclosure(e){let t=this.iter+1,n=t;const o=[];for(;"]"!==this.txt[n];){const e=this.txt[n];if("\\"!==e){if(n>=this.txt.length||"\n"===e)return null;n+=1}else o.push(n),n+=2}let i=n+1;if("("!==this.txt[i])return null;i+=1;let r=i,s=null;for(;")"!==this.txt[r];){const t=this.txt[r];if(r>=this.txt.length||"\n"===t||"["===t||"("===t)return null;if(e&&":"===t){const e=this.iter;if(this.iter=r,s=this.checkIfLink(!0),r=this.iter,this.iter=e,null===s)return null}else r+=1}if(r<i+1||!s&&e)return null;e||(s=this.txt.slice(i,r));let a="";for(let e=0;e<o.length;e+=1){const n=o[e];a+=this.txt.slice(t,n),t=n+1}return t<n&&(a+=this.txt.slice(t,n)),this.iter=r,[a,s]}checkIfLink(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=this.iter;if(!this.txt.startsWith("://",t)||t<3)return null;let n=t-1;for(;n>=0&&!bl.isWhiteSpace(this.txt[n])&&"("!==this.txt[n];n-=1);for(n+=1,t+=3;t<this.txt.length&&!bl.isWhiteSpace(this.txt[t])&&(!e||")"!==this.txt[t]);t+=1);if(t<this.iter+4)return null;let o=this.txt.slice(n,t);const i=o.indexOf("http");return-1!==i&&0!==i&&(n+=i,o=this.txt.slice(n,t)),this.iter=t,o}checkIfCoords(){let e=this.iter+1;for(;e<this.txt.length;){const t=this.txt[e];if(","===t)break;if(bl.isWhiteSpace(t)||!Number.isNaN(Number(t)))return null;e+=1}if(e>=this.txt.length||e-this.iter>12||e===this.iter)return null;e+=1;const t=this.txt[e];if("-"!==t&&Number.isNaN(t))return null;e+=1;let n=1;for(;e<this.txt.length&&!bl.isWhiteSpace(this.txt[e]);){const t=this.txt[e];if(","===t)n+=1;else if("-"!==t&&Number.isNaN(Number(t)))return null;e+=1}if(n<2||n>3||","===this.txt[e-1])return null;const o=this.txt.slice(this.iter,e);return this.iter=e,o}}let Sl=()=>{};const El=["*","~","+","_"];function Cl(e,t,n){const o=[];let i=e.iter,r=null;for(;!e.done()&&(r=e.getChar(),r!==n);){if("\n"===r){e.moveForward();break}if("\\"===r)i!==e.iter&&o.push(e.slice(i)),i=e.iter+1,e.moveForward();else if("#"===r){const t=e.iter,n=e.checkIfCoords();n&&(i!==t&&o.push(e.slice(i,t)),o.push(["l",null,`${window.location.origin}/${n}`]),i=e.iter)}else if(El.includes(r)){const n=e.iter;e.moveForward();const s=Cl(e,t,r);e.getChar()===r?(i!==n&&o.push(e.slice(i,n)),o.push([r,s]),i=e.iter+1):e.setIter(n)}else if("`"===r){const t=e.iter;e.moveForward(),e.goToCharInLine("`")&&(i!==t&&o.push(e.slice(i,t)),o.push(["c",e.slice(t+1)]),i=e.iter+1)}else if(":"===r){const t=e.checkIfLink();if(null!==t){const n=e.iter-t.length;i<n&&o.push(e.slice(i,n)),o.push(["l",null,t]),i=e.iter;continue}}else if("["===r){let t=e.iter,n=null;e.iter>0&&(e.move(-1),n=e.getChar(),e.setIter(t));let r="l",s=!0;"!"===n?(r="img",t-=1):"@"===n&&(s=!1,r="@",t-=1);const a=e.checkIfEnclosure(s);null!==a&&(i<t&&o.push(e.slice(i,t)),o.push([r,a[0],a[1]]),i=e.iter+1)}e.moveForward()}return i!==e.iter&&o.push(e.slice(i)),o}function Tl(e){e.skipSpaces(!1),"\n"===e.getChar()&&e.moveForward();const t=e.iter;for(;!e.done();){if(e.skipSpaces(!0),e.has("```")){const n=["cb",e.slice(t)];return e.move(3),n}e.moveToNextLine()}const n=e.slice(t);return e.move(3),["cb",n]}function kl(e,t){const n=e.getChar();let o="";for(;e.getChar()===n&&e.moveForward();)o+=e.getLine();const i=new bl(o);return[n,Sl(i,t,0)]}function Il(e,t,n,o){const i=[];let r=[],s=0;for(;!e.done();){const a=e.iter;s+=1;const l=e.getIndent(t.tabWidth);if(l<o&&s>1){e.setIter(a);break}const c=e.getChar();if(!o&&"#"===c)break;let d=!1,u=!1;if("-"===c&&(d=!0,e.moveForward()),!Number.isNaN(parseInt(c,10))){let t=e.iter+1;for(;!Number.isNaN(parseInt(e.txt[t],10));t+=1);const n=e.txt[t];"."!==n&&")"!==n||(u=!0,e.setIter(t+1))}let h=!1,p=null;if(d||u){let o;r.length&&(i.push(["p",r]),r=[]),o=Il(e,t,n,l+1),o=["-",o];const s=d?"ul":"ol";i.length&&i[i.length-1][0]===s?i[i.length-1][1].push(o):i.push([s,[o]])}else if(">"===c||"<"===c)h=!0,p=kl(e,t);else if(e.has("```"))h=!0,e.move(3),p=Tl(e);else{if(o||"\n"!==c){const n=Cl(e,t);n&&(r=r.concat(n));continue}if(e.moveForward(),e.skipSpaces(!1),"\n"===e.getChar()){if(n&&t.newlineBreaksArticles)break;e.moveForward()}h=!0}h&&r.length&&(i.push(["p",r]),r=[]),p&&i.push(p)}return r.length&&i.push(["p",r]),i}var xl;function Nl(e,t,n,o){xl||(xl="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var i=e&&e.defaultProps,r=arguments.length-3;if(t||0===r||(t={children:void 0}),1===r)t.children=o;else if(r>1){for(var s=new Array(r),a=0;a<r;a++)s[a]=arguments[a+3];t.children=s}if(t&&i)for(var l in i)void 0===t[l]&&(t[l]=i[l]);else t||(t=i||{});return{$$typeof:xl,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}function _l(e){let{name:t,uid:n,country:o,msg:i,ts:r,openCm:s}=e;const a=(0,Pe.v9)(Pn.s),l=(0,Oe.useRef)(),c="info"===t,d="event"===t;let u="msg";c?u+=" info":d?u+=" event":">"===i.charAt(0)?u+=" greentext":"<"===i.charAt(0)&&(u+=" redtext");const h=function(e,t){const n=function(e){const t={};return t.parseLinks=e&&e.parseLinks||!1,t.tabWidth=e&&e.tabWidth||4,t.newlineBreaksArticles=e&&e.newlineBreaksArticles||!0,t}(void 0);return Cl(new bl(e),n)}(i);return Oe.createElement("li",{className:"chatmsg",ref:l},Nl("div",{className:"msgcont"},void 0,Nl("span",{className:u},void 0,!c&&!d&&Nl(Oe.Fragment,{},"name",Nl("img",{className:"chatflag",alt:"",title:o,src:`/cf/${o}.gif`}),Nl("span",{className:"chatname",style:{color:(0,E.TP)((0,E.Z)(t),a),cursor:"pointer"},role:"button",title:t,tabIndex:-1,onClick:e=>{s(e.clientX,e.clientY,t,n)}},void 0,t),": "),Nl(yl,{refEmbed:l,pArray:h})),Nl("span",{className:"chatts"},void 0,(0,E.tF)(r))))}Sl=(e,t,n)=>{let o=[];for(;!e.done();){const i=Il(e,t,n,0);if(o=o.concat(i),"#"!==e.getChar())break;{let i=e.countRepeatingCharacters();if(i<=n||6===n)break;{e.move(i);const n=e.getLine();i=Math.min(i,6);const r=Sl(e,t,i);o.push(["a",i,n,r])}}}return o};const Al=Oe.memo(_l);var Ll,Ol,Pl,Rl,$l;function Dl(e,t,n,o){$l||($l="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var i=e&&e.defaultProps,r=arguments.length-3;if(t||0===r||(t={children:void 0}),1===r)t.children=o;else if(r>1){for(var s=new Array(r),a=0;a<r;a++)s[a]=arguments[a+3];t.children=s}if(t&&i)for(var l in i)void 0===t[l]&&(t[l]=i[l]);else t||(t=i||{});return{$$typeof:$l,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}const Ml=e=>{let{setChatChannel:t,chatChannel:n}=e;const[o,i]=(0,Oe.useState)(!1),[r,s]=(0,Oe.useState)([]),[a,l]=(0,Oe.useState)(0),[c,d]=(0,Oe.useState)(0),[u,h]=(0,Oe.useState)(!1),[p,f]=(0,Oe.useState)("..."),[v,m]=(0,Oe.useState)(!1),g=(0,Oe.useRef)(null),w=(0,Oe.useRef)(null),y=(0,Pe.v9)((e=>e.chatRead.unread)),b=(0,Pe.v9)((e=>e.chatRead.mute)),S=(0,Pe.v9)((e=>e.chat.channels)),E=(0,Pe.v9)((e=>e.gui.chatNotify));return(0,Oe.useEffect)((()=>{d(w.current.clientHeight)}),[w]),function(e,t,n){const o=(0,Oe.useCallback)((t=>{e.every((e=>!e.current||!e.current.contains(t.target)))&&n()}),[n,e]),i=(0,Oe.useCallback)((()=>{n()}),[n]);(0,Oe.useLayoutEffect)((()=>{t?(document.addEventListener("mousedown",o,{capture:!0}),window.addEventListener("resize",i)):(document.removeEventListener("mousedown",o,{capture:!0}),window.removeEventListener("resize",i))}),[t,o,i])}([g],o,(0,Oe.useCallback)((()=>i(!1)),[])),(0,Oe.useEffect)((()=>{if(o&&S[n]){const e=1===S[n][1]?1:0;l(e)}}),[o,S,n]),(0,Oe.useEffect)((()=>{const e=Object.keys(S),t=[];let n=0;for(;n<e.length;){const o=e[n],i=y[o]&&!b.includes(o);t.push([o,i,...S[o]]),!u&&0!==S[o][1]&&i&&h(!0),n+=1}t.sort(((e,t)=>0===e[3]||0===t[3]?0:e[4]>t[4]?-1:t[4]>e[4]?1:0)),t.sort(((e,t)=>0===e[3]||0===t[3]?0:e[1]&&!t[1]?-1:t[1]&&!e[1]?1:0)),s(t),n===e.length&&h(!1)}),[S,y,b,u]),(0,Oe.useEffect)((()=>{const e=Object.keys(S);for(let t=0;t<e.length;t+=1)if(1===S[e[t]][1])return void m(!0);m(!1)}),[S]),(0,Oe.useEffect)((()=>{S[n]&&f(S[n][0])}),[n,S]),Dl("div",{style:{position:"relative"}},void 0,Oe.createElement("div",{ref:w,key:"expbtn",role:"button",tabIndex:-1,onClick:()=>i(!0),className:"channelbtn"+(o?" selected":"")},u&&E&&!o&&Dl("div",{style:{top:-4},className:"chnunread"},void 0,"⦿"),p),o&&Oe.createElement("div",{ref:g,key:"dropdown",style:{position:"absolute",bottom:c,right:9},className:"channeldd"},Dl("div",{className:"chntop"},void 0,Dl("span",{style:{borderLeft:"none"},className:"chntype"+(0===a?" selected":""),onClick:()=>l(0),role:"button",tabIndex:-1},void 0,Ll||(Ll=Dl(vt.Fmx,{}))),v&&Dl("span",{className:"chntype"+(1===a?" selected":""),onClick:()=>l(1),role:"button",tabIndex:-1},void 0,u&&E&&1!==a&&(Ol||(Ol=Dl("div",{className:"chnunread"},void 0,"⦿"))),Pl||(Pl=Dl(Ge.wN,{})))),Dl("div",{className:"channeldds"},void 0,r.filter((e=>{const t=e[3];return 1===a&&1===t||0===a&&1!==t})).map((e=>{const[o,i,r]=e;return Dl("div",{onClick:()=>t(o),className:"chn"+(o===n?" selected":""),role:"button",tabIndex:-1},o,i&&E?Rl||(Rl=Dl("div",{className:"chnunread"},void 0,"⦿")):null,r)})))))},Hl=Oe.memo(Ml);var Wl;function Ul(e,t,n,o){Wl||(Wl="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var i=e&&e.defaultProps,r=arguments.length-3;if(t||0===r||(t={children:void 0}),1===r)t.children=o;else if(r>1){for(var s=new Array(r),a=0;a<r;a++)s[a]=arguments[a+3];t.children=s}if(t&&i)for(var l in i)void 0===t[l]&&(t[l]=i[l]);else t||(t=i||{});return{$$typeof:Wl,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}var Vl,zl,Gl;function Fl(e,t,n,o){Gl||(Gl="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var i=e&&e.defaultProps,r=arguments.length-3;if(t||0===r||(t={children:void 0}),1===r)t.children=o;else if(r>1){for(var s=new Array(r),a=0;a<r;a++)s[a]=arguments[a+3];t.children=s}if(t&&i)for(var l in i)void 0===t[l]&&(t[l]=i[l]);else t||(t=i||{});return{$$typeof:Gl,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}const ql={display:"inline-block",width:"100%",maxWidth:"35em"},Bl=()=>{const[e,t]=(0,Oe.useState)(""),[n,o]=(0,Oe.useState)(!1),[i,r]=(0,Oe.useState)(!1),[s,a]=(0,Oe.useState)([]),l=Je();return i?Fl("div",{},void 0,Fl("p",{className:"modalmessage"},void 0,"Te enviamos un correo con instrucciones para reiniciar tu contraseña."),Fl("button",{type:"button",onClick:()=>l("USERAREA")},void 0,"Back")):Fl("div",{className:"content"},void 0,Fl("p",{},void 0,"Ingresa tu dirección de correo y te enviaremos una contraseña nueva:"),Vl||(Vl=Fl("br",{})),Fl("form",{onSubmit:async t=>{if(t.preventDefault(),n)return;const i=function(e){const t=[],n=hr(e);return n&&t.push(n),t}(e);if(i.length>0)return void a(i);o(!0);const{errors:s}=await(0,F.hH)(e);o(!1),s?a(s):r(!0)}},void 0,s.map((e=>Fl("p",{},e,Fl("span",{},void 0,"Error"),": ",e))),Fl("input",{style:ql,value:e,onChange:e=>t(e.target.value),type:"text",placeholder:"Correo electrónico"}),zl||(zl=Fl("br",{})),Fl("button",{type:"submit"},void 0,n?"...":"Confirmar"),Fl("button",{type:"button",onClick:()=>l("USERAREA")},void 0,"Cancelar")))},jl={HELP:[()=>{const e=$i("kbd",{},void 0,"G"),t=$i("kbd",{},void 0,"X"),n=$i("kbd",{},void 0,"H"),o=$i("kbd",{},void 0,"R"),i=$i("kbd",{},void 0,"Q"),s=$i("kbd",{},void 0,"E"),a=$i("kbd",{},void 0,"W"),l=$i("kbd",{},void 0,"A"),c=$i("kbd",{},void 0,"S"),u=$i("kbd",{},void 0,"D"),h=jo||(jo=$i("kbd",{},void 0,"↑")),p=Zo||(Zo=$i("kbd",{},void 0,"←")),f=Ko||(Ko=$i("kbd",{},void 0,"↓")),v=Yo||(Yo=$i("kbd",{},void 0,"→")),m=Qo||(Qo=$i("kbd",{},void 0,$i(Go.nI7,{}))),g=Xo||(Xo=$i("kbd",{},void 0,$i(vt.EGB,{}))),w=$i("kbd",{},void 0,"⇧ ","Shift"),y=Jo||(Jo=$i("a",{href:"https://twitter.com/starhousedev"},void 0,"starhouse ")),b=ei||(ei=$i("a",{href:"https://twitter.com/Vinikdev"},void 0,"Vinikdev")),S=ti||(ti=$i("a",{href:"https://lospec.com/palette-list/lava-gb"},void 0,"Do-Nendo")),E=ni||(ni=$i("a",{href:"/guilded"},void 0,"guilded")),C=$i("a",{href:`mailto:${window.ssv.contactAddress}`},void 0,window.ssv.contactAddress),T=(0,Pe.I0)(),k=(0,Pe.v9)((e=>e.gui.easterEgg)),I=(0,Oe.useCallback)((()=>{T((0,r.u0)()),T((0,d.h4)(k?"Huevo de Pascua APAGADO":"Huevo de Pascua encendido"))}),[k,T]),x=mn(null,I,1e3);return $i("div",{className:"content"},void 0,Oe.createElement("img",{style:{padding:2,maxWidth:"20%",verticalAlign:"middle",display:"inline-block"},alt:"ppfun",src:"./logo.svg",ref:x}),$i("p",{},void 0,"¡Coloca pixeles de colores en un enorme lienzo con otros jugadores en línea!",oi||(oi=$i("br",{})),"Nuestro lienzo principal es un enorme mapa del mundo, puedes poner tus píxeles donde quieras, pero debes esperar un periodo de enfriamiento (cooldown) específico entre píxeles. Puedes revisar el tiempo de enfriamiento y los requisitos en el Menú de Selección de Lienzo (botón del globo en la parte superior). Algunos lienzos tienen un enfriamiento diferente para reemplazar píxeles colocados por jugadores que para reemplazar píxeles nuevos, por ejemplo 4s/7s significa 4s para píxeles frescos y 7s en píxeles ya colocados.",ii||(ii=$i("br",{})),"Los niveles de zoom mas altos tardan un tiempo en actualizarse, el globo 3D es actualizado al menos una vez por día.",ri||(ri=$i("br",{})),"¡Diviértete!"),$i("p",{className:"modalinfo"},void 0,"Guilded (","recomendado","): ",$i("a",{href:"./guilded",target:"_blank",rel:"noopener noreferrer"},void 0,"Invited to Chat")),$i("p",{className:"modalinfo"},void 0,"Source for pixelplanet on ",si||(si=$i("a",{href:"https://git.pixelplanet.fun",target:"_blank",rel:"noopener noreferrer"},void 0,"git.pixelplanet.fun"))),$i("p",{className:"modalinfo"},void 0,"We are Libre Software, ",$i("a",{href:"/legal",target:"_blank",rel:"noopener noreferrer"},void 0,"check compliance here")),$i("h3",{},void 0,"Información del Mapa"),$i("p",{},void 0,"Los datos del mapa original que usamos, junto a segmentos de OpenStreetMap para orientación se pueden descargar desde mega.nz aquí: ",ai||(ai=$i("a",{href:"https://mega.nz/#!JpkBwAbJ!EnSLlZmKv3kEBE0HDhakTgAZZycD3ELjduajJxPGaXo"},void 0,"pixelplanetmap.zip"))," (422MB)"),$i("h3",{},void 0,"¿Baneado?¿Detectado como Proxy?"),$i("div",{},void 0,$i("p",{},void 0,["Si lo detectaron como proxy, pero no lo es, o cree que lo banearon por error, vaya a nuestro ",E," o envíenos un correo electrónico a ",C," e incluya el siguiente IID:"]),li||(li=$i(Bo,{}))),$i("h3",{},void 0,"2D ",": controles"),$i("div",{style:{lineHeight:1.5}},void 0,"Haz clic en un color de la paleta para seleccionarlo",ci||(ci=$i("br",{})),["Presiona ",e," para activar/desactivar la cuadrícula"],di||(di=$i("br",{})),["Presiona ",t," para activar/desactivar la visibilidad de la actividad de píxeles"],ui||(ui=$i("br",{})),["Presiona ",n," para activar/desactivar la vista histórica"],hi||(hi=$i("br",{})),["Presiona ",o," para copiar las coordenadas"],pi||(pi=$i("br",{})),["Presiona ",i," o ",s," para cambiar el zoom"],fi||(fi=$i("br",{})),["Presiona ",a,", ",l,", ",c,", ",u," para desplazarte"],vi||(vi=$i("br",{})),["Presiona ",h,", ",p,", ",f,", ",v," para desplazarte"],mi||(mi=$i("br",{})),["Utiliza ",m," el ratón o ",g," arrastrar para desplazar"],gi||(gi=$i("br",{})),["Gira ",m," la rueda del ratón o ",g," el panel táctil para hacer zoom"],wi||(wi=$i("br",{})),["Hold left ",w," for placing while moving mouse"],yi||(yi=$i("br",{})),["Hold right ",w," for placing while moving mouse according to historical view"],bi||(bi=$i("br",{})),["Haz ",m," click izquierdo o ",g," un toque para colocar un píxel"],Si||(Si=$i("br",{})),["Haz clic ",m," con el botón medio del ratón o ",g," toque largo para seleccionar el color sobre el que flota el cursor"],Ei||(Ei=$i("br",{}))),$i("h3",{},void 0,"3D ",": controles"),$i("div",{style:{lineHeight:1.5}},void 0,["Presiona ",a,", ",l,", ",c,", ",u," para desplazarte"],Ci||(Ci=$i("br",{})),["Presiona ",h,", ",p,", ",f,", ",v," para desplazarte"],Ti||(Ti=$i("br",{})),["Presiona ",i," y ",s," para volar hacia arriba y hacia abajo"],ki||(ki=$i("br",{})),[m," Mantén presionado el botón izquierdo del ratón y arrástralo para rotar"],Ii||(Ii=$i("br",{})),[m," Gira la rueda del ratón o mantén presionado el ",m," botón medio del ratón y arrástralo para hacer zoom"],xi||(xi=$i("br",{})),["Haz ",m," clic derecho y arrastra el ratón para desplazarte"],Ni||(Ni=$i("br",{})),["Haz ",m," click izquierdo o ",g," un toque para colocar un píxel"],_i||(_i=$i("br",{})),["Haz ",m," clic derecho o ",g," doble toque para remover un píxel"],Ai||(Ai=$i("br",{})),["Haz clic ",m," con el botón medio del ratón o ",g," toque largo para seleccionar el color sobre el que flota el cursor"],Li||(Li=$i("br",{}))),Oi||(Oi=$i("h3",{},void 0,"Palette Credits")),$i("div",{},void 0,["Agradecemos a los siguientes artistas, que pusieron a disposición del público sus paletas en"]," ",Pi||(Pi=$i("a",{href:"https://lospec.com/"},void 0,"lospec.com")),$i("p",{},void 0,["El crédito por la Paleta de la Luna es para ",y,"."]),$i("p",{},void 0,["El crédito por la Paleta del Top10 es para ",b,"."]),$i("p",{},void 0,["El crédito por la Paleta de 2bit es para ",S,"."])))},"Ayuda"],SETTINGS:[dr,"Configuración"],USERAREA:[Ws,"Área del Usuario"],REGISTER:[Gs,"Registrarse"],FORGOT_PASSWORD:[Oe.memo(Bl),"Olvidé mi Contraseña"],CHAT:[()=>{const e=(0,Oe.useRef)(),t=(0,Oe.useRef)(),n=(0,Oe.useRef)(),[o,i]=(0,Oe.useState)([]),[s,a]=(0,Oe.useState)(20),[l,c]=(0,Oe.useState)({}),u=(0,Pe.I0)(),h=(0,Pe.v9)((e=>e.user.name)),p=(0,Pe.v9)((e=>e.fetching.fetchingChat)),{channels:f,messages:v,blocked:m}=(0,Pe.v9)((e=>e.chat)),{args:g,setArgs:w,setTitle:y}=(0,Oe.useContext)(Qe),{chatChannel:b=1}=g,S=Je(),E=(0,Oe.useCallback)((e=>{u((0,r.Eo)(e)),w({chatChannel:Number(e)})}),[u]),C=(0,Oe.useCallback)((e=>{const t=n.current;if(!t)return;let o=t.value;" "!==o.slice(-1)&&(o+=" "),o+=`${e} `,t.value=o,n.current.focus()}),[]),T=(0,Oe.useCallback)((()=>{c({})}),[]),k=(0,Oe.useCallback)(((e,t,n,o)=>{c({type:"USER",x:e,y:t,args:{name:n,uid:o,setChannel:E,addToInput:C}})}),[E,C]),{stayScrolled:I}=(0,pa.Z)(e,{initialScroll:1/0,inaccuracy:10}),x=v[b]||[];return(0,Oe.useEffect)((()=>{!f[b]||v[b]||p||u((0,d.TL)(b))}),[f,v,b]),(0,Oe.useEffect)((()=>{if(f[b]){const e=f[b][0];y(`Chan: ${e}`)}}),[b]),(0,Oe.useLayoutEffect)((()=>{I()}),[x.length]),(0,Oe.useEffect)((()=>{setTimeout((()=>{const e=Math.round(t.current.offsetHeight/10);a(Math.min(28,e))}),330)}),[t]),(0,Oe.useEffect)((()=>{const e=[];for(let t=0;t<m.length;t+=1)e.push(m[t][0]);i(e)}),[m.length]),(0,Oe.useEffect)((()=>{if(!b||!f[b]){const e=Object.keys(f);e.length&&E(e[0])}}),[f]),Oe.createElement("div",{ref:t,className:"chat-container"},Ul(Ta,{type:l.type,x:l.x,y:l.y,args:l.args,close:T,align:l.align}),Oe.createElement("ul",{className:"chatarea",ref:e,style:{flexGrow:1},role:"presentation"},!x.length&&Ul(Al,{uid:0,name:"info",country:"xx",msg:"Comienza a chatear aquí"}),x.map((e=>o.includes(e[3])?null:Ul(Al,{name:e[0],msg:e[1],country:e[2],uid:e[3],ts:e[4],openCm:k},e[5])))),Ul("form",{className:"chatinput",onSubmit:e=>function(e){e.preventDefault();const t=n.current.value.trim();t&&(u((0,r.bE)(t,b)),n.current.value="")}(e),style:{display:"flex"}},void 0,h?Ul(Oe.Fragment,{},"chtipt",Oe.createElement("input",{style:{flexGrow:1,minWidth:40},ref:n,autoComplete:"off",maxLength:"200",type:"text",placeholder:"Chatea aquí"}),Ul("button",{id:"sendbtn",style:{flexGrow:0},type:"submit"},void 0,"‣")):Ul("div",{className:"modallink",onClick:e=>{e.stopPropagation(),S("USERAREA",{target:"fullscreen"})},style:{textAlign:"center",fontSize:13,flexGrow:1},role:"button",tabIndex:0},"nlipt","Debes iniciar sesión para chatear"),Ul(Hl,{setChatChannel:E,chatChannel:b},"cdd")),Ul("div",{className:"chatlink",style:{fontSize:s}},void 0,Ul("span",{onClick:e=>{const{clientX:t,clientY:n}=e;c({type:"CHANNEL",x:t,y:n,args:{cid:b},align:"tr"})},role:"button",title:"Configuración del Canal",tabIndex:-1},void 0,"⚙")))},"Chat"],CANVAS_SELECTION:[sa,"Selección de Lienzo"],ARCHIVE:[()=>ua("div",{className:"content"},void 0,ua("p",{},void 0,"Si bien no tendemos a eliminar lienzos, algunos lienzos son introducidos solo por diversión, o por petición de usuarios que disfrutan de algún meme. Dichos lienzos pueden volverse aburridos después de un cierto tiempo y luego de varias semanas sin cambios mayores y si no vale la pena mantenerlos activos, puede que decidamos removerlos.",aa||(aa=ua("br",{})),"Aquí recolectamos aquellos lienzos para archivarlos de manera apropiada (actualmente es solo uno)."),ua("h3",{},void 0,"Lienzo de Brújula Política"),ua("img",{style:{padding:2,maxWidth:"20%",verticalAlign:"middle",display:"inline-block"},alt:"political-compass",src:"https://storage.pixelplanet.fun/compass-preview.png"}),ua("p",{},void 0,"Este lienzo fue solicitado durante un periodo de conflictos políticos en el lienzo principal de la Tierra. Era una representación de la brújula política de 1024x1024px con 5s de enfriamiento y 60 de apilamiento. Fue lanzado el 11 de Mayo de 2020 y permaneció activo por meses hasta que fue cerrado el 30 de Noviembre del mismo año.",la||(la=ua("br",{})),"Hemos decidido archivarlo como un lapso de tiempo en la forma de un webm codificado sin pérdida. Tomar una captura del lapso temporal resulta en una representación 1:1 perfecta de como el lienzo se veía en un determinado momento."),ca||(ca=ua("p",{className:"modalinfo"},void 0,"Timelapse:",ua("a",{href:"https://storage.pixelplanet.fun/compass-timelapse.webm"},void 0,"Download"))),ua("img",{style:{padding:2,maxWidth:"80%",verticalAlign:"middle"},alt:"political-compass",src:"https://storage.pixelplanet.fun/compass-final.png"})),"Archivo de Lienzos"]};var Zl,Kl,Yl;function Ql(e,t,n,o){Yl||(Yl="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var i=e&&e.defaultProps,r=arguments.length-3;if(t||0===r||(t={children:void 0}),1===r)t.children=o;else if(r>1){for(var s=new Array(r),a=0;a<r;a++)s[a]=arguments[a+3];t.children=s}if(t&&i)for(var l in i)void 0===t[l]&&(t[l]=i[l]);else t||(t=i||{});return{$$typeof:Yl,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}const Xl=e=>{let{id:t}=e;const[n,o]=(0,Oe.useState)(!1),i=(0,Oe.useRef)(),r=(0,Oe.useRef)(),s=(0,Oe.useMemo)((()=>{return e=t,(0,Do.P1)(Mo,(t=>t.find((t=>t.windowId===e))));var e}),[]),a=(0,Oe.useMemo)((()=>{return e=t,t=>t.windows.positions[e];var e}),[]),l=(0,Oe.useMemo)((()=>{return e=t,t=>t.windows.args[e]||{};var e}),[]),c=(0,Pe.v9)(s),d=(0,Pe.v9)(a),u=(0,Pe.v9)(Ho),h=(0,Pe.v9)(l),p=(0,Pe.I0)(),f=(0,Oe.useMemo)((()=>({args:h,setArgs:e=>p(function(e,t){return{type:"SET_WIN_ARGS",windowId:e,args:t}}(t,e)),setTitle:e=>p(function(e,t){return{type:"SET_WIN_TITLE",windowId:e,title:t}}(t,e)),changeType:(e,n,o)=>p(function(e,t){return{type:"CHANGE_WIN_TYPE",windowId:e,windowType:t,title:arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",args:arguments.length>3&&void 0!==arguments[3]?arguments[3]:null}}(t,e,n,o))})),[t,h]),{open:v,hidden:m,fullscreen:g}=c,w=(0,Oe.useCallback)((()=>{p({type:"FOCUS_WIN",windowId:t})}),[p]),y=(0,Oe.useCallback)((e=>{e.stopPropagation(),p({type:"CLONE_WIN",windowId:t})}),[p]),b=(0,Oe.useCallback)((()=>{o(!1)}),[p]),S=(0,Oe.useCallback)((e=>{e.stopPropagation(),p({type:"CLOSE_WIN",windowId:t})}),[p]),{xPos:E,yPos:C,width:T,height:k}=d;Vo(i,w,(0,Oe.useCallback)(((e,n)=>p(function(e,t,n){return{type:"MOVE_WIN",windowId:e,xDiff:t,yDiff:n}}(t,e,n))),[g,!n&&m])),Vo(r,w,(0,Oe.useCallback)(((e,n)=>p(function(e,t,n){return{type:"RESIZE_WIN",windowId:e,xDiff:t,yDiff:n}}(t,e,n))),[g,!n&&m]));const I=(0,Oe.useCallback)((()=>{m&&o(!1),v?n||m||(p({type:"TGL_MAXIMIZE_WIN",windowId:t}),setTimeout((()=>o(!0)),10)):p({type:"REMOVE_WIN",windowId:t})}),[p,m,v,n]);if((0,Oe.useEffect)((()=>{v&&!m&&window.setTimeout((()=>{o(!0)}),10)}),[v,m]),!n&&(m||!v))return null;const{title:x,windowType:N}=c,{z:_}=d,[A,L]=jl[N],O=x?`${L} - ${x}`:L,P=`${N}${v&&!m&&n?" show":""}`;return g?Ql("div",{className:`modal ${P}`,onTransitionEnd:I,onClick:w,style:{zIndex:_}},void 0,Ql("h2",{},void 0,O),Ql("div",{onClick:S,className:"modal-topbtn close",role:"button",label:"close",title:"Cerrar",tabIndex:-1},"closebtn","✕"),Ze.includes(N)&&Ql("div",{onClick:e=>{Xe(N,h,E,C,T,k),S(e)},className:"modal-topbtn pop",role:"button",label:"close",title:"Ventana emergente",tabIndex:-1},"popbtn",Zl||(Zl=Ql($o.srV,{}))),u&&Ql("div",{onClick:b,className:"modal-topbtn restore",role:"button",label:"restore",title:"Restaurar",tabIndex:-1},"resbtn","↓"),Ql("div",{className:"modal-content"},"content",Ql(Qe.Provider,{value:f},void 0,Ql(A,{})))):Ql("div",{className:`window ${P}`,onTransitionEnd:I,onClick:w,style:{left:E,top:C,width:T,height:k,zIndex:_}},void 0,Ql("div",{className:"win-topbar"},"topbar",Ql("span",{className:"win-topbtn",onClick:y,title:"Clon"},"clonebtn","+"),Oe.createElement("span",{className:"win-title",key:"title",ref:i,title:"Mover"},O),Ze.includes(N)&&Ql("span",{className:"win-topbtn",onClick:e=>{Xe(N,h,E,C,T,k),S(e)}},"pobtnm",Kl||(Kl=Ql($o.srV,{}))),Ql("span",{className:"win-topbtn",onClick:b,title:"Maximizar"},"maxbtn","↑"),Ql("span",{className:"win-topbtn close",onClick:S,title:"Cerrar"},"closebtn","X")),Oe.createElement("div",{className:"win-resize",key:"winres",title:"Cambiar tamaño",ref:r},"▨"),Ql("div",{className:"win-content"},"content",Ql(Qe.Provider,{value:f},void 0,Ql(A,{}))))},Jl=Oe.memo(Xl);var ec;function tc(e,t,n,o){ec||(ec="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var i=e&&e.defaultProps,r=arguments.length-3;if(t||0===r||(t={children:void 0}),1===r)t.children=o;else if(r>1){for(var s=new Array(r),a=0;a<r;a++)s[a]=arguments[a+3];t.children=s}if(t&&i)for(var l in i)void 0===t[l]&&(t[l]=i[l]);else t||(t=i||{});return{$$typeof:ec,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}const nc=()=>{const e=(0,Pe.v9)(Uo,Pe.wU),[t,n]=(0,Pe.v9)(Wo,Pe.wU),o=(0,Pe.I0)();return t&&e.length?tc("div",{id:"wm"},void 0,tc(ro,{show:n,onClick:()=>o({type:"CLOSE_FULLSCREEN_WINS"})}),e.map((e=>tc(Jl,{id:e},e)))):null};var oc,ic,rc,sc;function ac(e,t,n,o){sc||(sc="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var i=e&&e.defaultProps,r=arguments.length-3;if(t||0===r||(t={children:void 0}),1===r)t.children=o;else if(r>1){for(var s=new Array(r),a=0;a<r;a++)s[a]=arguments[a+3];t.children=s}if(t&&i)for(var l in i)void 0===t[l]&&(t[l]=i[l]);else t||(t=i||{});return{$$typeof:sc,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}const lc={style:{verticalAlign:"middle"}},cc=()=>Oe.createElement(Oe.Fragment,null,oc||(oc=ac(He,{})),ic||(ic=ac($e.Pd.Provider,{value:lc},void 0,ac(it,{}),ac(Kt,{}),ac(yt,{}),ac(ht,{}),ac(ze,{}),ac(Ro,{}),ac(No,{}),ac(nc,{}))));(0,o.p5)(Ae,{},(()=>{function e(){Ae.dispatch((0,r.Qr)())}window.addEventListener("message",Ae.dispatch),Ae.dispatch({type:"HYDRATED"}),h.Z.initialize(Ae,q,ye),X.initialize(Ae),window.addEventListener("hashchange",(()=>{Ae.dispatch((0,r.fL)())})),window.imMobile=function(){delete window.imMobile,Ae.dispatch((0,r.bv)(!0))},document.addEventListener("touchstart",window.imMobile,{once:!0}),window.addEventListener("resize",e),e(),Ae.dispatch((0,r.vb)()),Ae.dispatch((0,d.aM)()),q.initialize(Ae,h.Z,ye)})),function(){const e=()=>{window.name="main",function(e,t){(0,Re.s)(e).render(ac(Pe.zt,{store:t},void 0,rc||(rc=ac(cc,{}))))}(document.getElementById("app"),Ae);const t=function(e){return t=>{if("INPUT"===t.target.nodeName||"TEXTAREA"===t.target.nodeName)return;let{key:n}=t;const o=Number(n);if(!Number.isNaN(o)&&o>0){const{canvases:t,canvasId:n}=e.getState().canvas,i=Object.keys(t).filter((e=>!t[e].hid));if(o<=i.length){const s=i[o-1];if(s!==n){e.dispatch((0,r.SC)(s));const n=t[s].title;e.dispatch((0,d.h4)(`Cambiado a ${n}`))}}}else{switch(t.code){case"ArrowUp":case"KeyW":return void e.dispatch((0,r.mx)(-1));case"ArrowLeft":case"KeyA":return void e.dispatch((0,r.mW)(-1));case"ArrowDown":case"KeyS":return void e.dispatch((0,r.mx)(1));case"ArrowRight":case"KeyD":return void e.dispatch((0,r.mW)(1));case"KeyE":return void e.dispatch((0,r.WW)(1));case"KeyQ":return void e.dispatch((0,r.WW)(-1))}switch(t.key){case"+":return void e.dispatch((0,r.WW)(1));case"-":return void e.dispatch((0,r.WW)(-1));case"Control":return void e.dispatch((0,r.Or)(-1));case"Shift":return t.location===KeyboardEvent.DOM_KEY_LOCATION_LEFT?void e.dispatch((0,r.UW)(c.EQ.PENCIL,!0)):t.location===KeyboardEvent.DOM_KEY_LOCATION_RIGHT?void e.dispatch((0,r.UW)(e.getState().templates.oRightShift?c.EQ.OVERLAY:c.EQ.HISTORY,!0)):void 0}if(!u.includes(n)){if(n=t.code,!n.startsWith("Key"))return;n=n.slice(-1).toLowerCase()}switch(n){case"g":return e.dispatch((0,r.xK)()),void e.dispatch((0,d.h4)(e.getState().gui.showGrid?"Cuadrícula activa":"Cuadrícula apagada"));case"h":return void(window?.ssv.backupurl&&e.dispatch((0,r.FI)()));case"x":return e.dispatch((0,r.Xb)()),void e.dispatch((0,d.h4)(e.getState().gui.showPixelNotify?"Notificación de píxeles activada":"Notificación de píxeles desactivada"));case"m":return e.dispatch((0,r.$t)()),void e.dispatch((0,d.h4)(e.getState().gui.mute?"Sonido silenciado":"Sonido no silenciado"));case"n":return void e.dispatch((0,r.qP)());case"r":{const{hover:t}=e.getState().canvas,n=t.join("_");return(0,i.Z)(n),void e.dispatch((0,d.h4)("Copiado"))}case"t":return e.dispatch({type:"s/TGL_OVENABLED"}),void e.dispatch((0,d.h4)(e.getState().templates.ovEnabled?"Superposición activada":"Superposición desactivada"));case"l":e.dispatch((0,r.u0)()),e.dispatch((0,d.h4)(e.getState().gui.easterEgg?"Huevo de Pascua encendido":"Huevo de Pascua APAGADO"))}}}}(Ae),n=function(e){return t=>{switch(t.code){case"ArrowUp":case"KeyW":case"ArrowDown":case"KeyS":return void e.dispatch((0,r.mx)(0));case"ArrowLeft":case"KeyA":case"ArrowRight":case"KeyD":return void e.dispatch((0,r.mW)(0));case"KeyE":case"KeyQ":return void e.dispatch((0,r.WW)(0))}switch(t.key){case"+":case"-":return void e.dispatch((0,r.WW)(0));case"Shift":case"CapsLock":e.dispatch((0,r.UW)(c.EQ.OFF))}}}(Ae);document.addEventListener("keydown",t,!1),document.addEventListener("keyup",n,!1),setInterval((()=>{ye().gc()}),c.PR),document.removeEventListener("DOMContentLoaded",e)};document.addEventListener("DOMContentLoaded",e,!1)}()},389:(e,t,n)=>{n.d(t,{Z:()=>i});var o=n(7294);const i=function(e,t){const n=(0,o.useRef)();(0,o.useEffect)((()=>{n.current=e}),[e]),(0,o.useEffect)((()=>{function e(){n.current()}if(null!==t){e();const n=setInterval(e,t);return()=>clearInterval(n)}}),[t])}},940:(e,t,n)=>{n.d(t,{A$:()=>i,EQ:()=>m,Fv:()=>o,I_:()=>l,Kb:()=>u,PR:()=>v,Tj:()=>s,U4:()=>p,V4:()=>r,WF:()=>f,fS:()=>a,p7:()=>c,vB:()=>g,vc:()=>d,wL:()=>h});const o=40,i=3,r="0",s=128,a=32,l=256,c=2,d=2592e6,u=100,h=1e3,p=2e3,f=3e5,v=3e5,m={OFF:0,PENCIL:1,HISTORY:2,OVERLAY:3},g=8},259:(e,t,n)=>{n.d(t,{Cr:()=>g,D$:()=>S,D0:()=>v,HD:()=>c,IU:()=>I,NK:()=>h,Ss:()=>u,TP:()=>C,UW:()=>s,VL:()=>w,W4:()=>d,Z:()=>E,_I:()=>A,_N:()=>N,_O:()=>f,_V:()=>$,ad:()=>O,b3:()=>k,bG:()=>L,bt:()=>P,gx:()=>y,h$:()=>R,lg:()=>T,nK:()=>m,r6:()=>x,s3:()=>p,sG:()=>l,tF:()=>_,uZ:()=>r,x2:()=>a});var o=n(940);function i(e,t){return(e%t+t)%t}function r(e,t,n){return Math.max(t,Math.min(e,n))}function s(e){return e.substring(0,4)+e.substring(5,7)+e.substring(8)}function a(){const e=new Date;let t=e.getUTCDate(),n=e.getUTCMonth()+1;return n<10&&(n=`0${n}`),t<10&&(t=`0${t}`),`${e.getUTCFullYear()}-${n}-${t}`}function l(e,t,n){let i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;const r=null===i?o.I_:o.fS,s=null==i?n:i;return[Math.floor((t+e/2)/r),Math.floor((s+e/2)/r)]}function c(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;return t.map((t=>Math.floor((t+n/2)/o.I_*e)))}function d(e){return e?Math.log2(e/o.I_)/o.p7*2:0}function u(e,t,n){if(e&&n){let t=n.length;for(;t>0;){t-=1;const[o,i]=n[t];if(e<=o)return i}}return t}function h(e,t,n){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;const s=null===r?o.I_:o.fS,a=null==r?n:r;let l=null===r?0:n*s*s;const c=i(e/2,s),d=i(t+c,s);return l+=i(a+c,s)*s+d,l}function p(e,t){const n=Object.keys(e);for(let o=0;o<n.length;o+=1){const i=n[o];if(e[i].ident===t)return i}return null}function f(e,t,n,i){let r=arguments.length>4&&void 0!==arguments[4]&&arguments[4];const s=r?o.fS:o.I_,a=n%s,l=n-a;let c=l%(s*s);const d=r?(l-c)/s/s:null;c/=s;const u=i/2/s;return[(e-u)*s+a,(t-u)*s+c,d]}function v(e,t){return t.map((t=>i(t+e/2,o.I_)))}function m(e,t,n,o){let[i,r]=o;const[s,a]=e,{width:l,height:c}=n;return[Math.floor((i-l/2)/t+s),Math.floor((r-c/2)/t+a)]}function g(e,t,n,o){let[i,r]=o;const[s,a]=e,{width:l,height:c}=n;return[(i-s)*t+l/2,(r-a)*t+c/2]}function w(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const n=Math.ceil(e/1e3);let o;return o=n<60&&t?n:`${Math.floor(n/60)}:${("0"+n%60).slice(-2)}`,o}function y(e){const t=e%60;let n=(e-t)/60;const o=n%60;n=(n-o)/60;const i=n%24;n=(n-i)/24;let r="";return n&&(r+=` ${n}d`),i&&(r+=` ${i}h`),o&&(r+=` ${o}min`),t&&(r+=` ${t}s`),r}const b=["k","M","B"];function S(e){if(!e)return"N/A";if(e<1e3)return e;let t=0;for(;t<b.length;){if(e<1e4)return`${Math.floor(e/1e3)}.${`0${Math.floor(e%1e3/10)}`.slice(-2)}${b[t]}`;if(e<1e5)return`${Math.floor(e/1e3)}.${Math.floor(e%1e3/100)}${b[t]}`;if(e<1e6)return Math.floor(e/1e3)+b[t];t+=1,e=Math.round(e/1e3)}return""}function E(e){if(!e)return"#000000";let t=0;for(let n=0;n<e.length;n++)t=e.charCodeAt(n)+((t<<5)-t);return`#${`00000${(16777215&t).toString(16).toUpperCase()}`.slice(-6)}`}function C(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];3===(e=e.replace(/^\s*#|\s*$/g,"")).length&&(e=e.replace(/(.)/g,"$1$1"));let n=Math.floor(parseInt(e.substring(0,2),16)/2),o=Math.floor(parseInt(e.substring(2,4),16)/2),i=Math.floor(parseInt(e.substring(4,6),16)/2);return t&&(n+=128,o+=128,i+=128),n=`0${n.toString(16)}`.slice(-2),o=`0${o.toString(16)}`.slice(-2),i=`0${i.toString(16)}`.slice(-2),`#${n}${o}${i}`}function T(e){const t=["\\","[","]","(",")","*","~","+","_","\n"];let n="",o=0;for(let i=0;i<e.length;i+=1){const r=e[i];t.includes(r)&&(n+=`${e.slice(o,i)}\\`,o=i)}return 0===o?e:(n+=e.slice(o),n)}function k(){try{const e=document.createElement("canvas");return!(!window.WebGL2RenderingContext||!e.getContext("webgl2"))}catch{return!1}}function I(e){let t=e.indexOf("://")+3;t<3&&(t=0),e.startsWith("www.",t)&&(t+=4);let n=e.indexOf("/",t);return-1===n&&(n=e.length),e.endsWith(".com",n)&&(n-=4),n<=t?e:e.slice(t,n)}function x(e){let t=e.indexOf("&");-1===t&&(t=e.length);let n=t-1;for(;n>=0&&"."!==e[n];n-=1)if("/"===e[n])return null;return n+=1,t-n>4?null:e.slice(n,t)}function N(e){let t=e.indexOf("?");return-1===t&&(t=e.indexOf("#")),-1===t?e:e.substring(0,t)}function _(e){const t=new Date,n=new Date(1e3*e);return n.getDate()!==t.getDate()?n.toLocaleString():n.toLocaleTimeString()}function A(e){let t=e.lastIndexOf("#"),n=[];if(-1!==t){let o=e.slice(t+1);t=o.indexOf("?"),-1!==t&&(o=o.slice(0,t)),n=o.split(",").map((e=>parseInt(e,10))).slice(1,3)}return(2!==n.length||n.some(Number.isNaN))&&(n=e.split("_").map((e=>parseInt(e,10)))),(2!==n.length||n.some(Number.isNaN))&&(n=e.split(",").map((e=>parseInt(e,10)))),(2!==n.length||n.some(Number.isNaN))&&(n=null),n}function L(e){if(!e)return 0;const t=e.slice(-1).toLowerCase(),n=parseInt(e.slice(0,-1),10);if(Number.isNaN(n)||n<=0||n>600||!["s","m","h","d"].includes(t))return 0;let o=1e3;return"m"===t?o*=60:"h"===t?o*=3600:"d"===t&&(o*=86400),n*o}function O(e,t){let n=0;for(let o=0;o<e.length;o+=1){const i=Math.abs(e[o]-t[o]);i>n&&(n=i)}return n}function P(e){if(e instanceof TouchEvent){const t=e.touches.length?e.touches:e.changedTouches;let n=0,o=0;for(const{pageX:e,pageY:i}of t)n+=e,o+=i;const{length:i}=t;return[n/i,o/i]}return[e.clientX,e.clientY]}function R(e){return new Promise((t=>{const n=new Blob([e]),o=new FileReader;o.onload=e=>{const n=e.target.result,[,o]=n.split(",");t(o)},o.readAsDataURL(n)}))}async function $(e){const t=`data:application/octet-binary;base64,${e}`;return(await fetch(t)).arrayBuffer()}},631:(e,t,n)=>{n.d(t,{A:()=>N,AP:()=>f,E1:()=>p,Es:()=>x,Fx:()=>r,I6:()=>h,JL:()=>_,K$:()=>I,No:()=>v,Oh:()=>g,PS:()=>d,Pw:()=>E,Wt:()=>b,e9:()=>y,fF:()=>S,ft:()=>w,hH:()=>T,jK:()=>A,ko:()=>u,s$:()=>k,uY:()=>i,uw:()=>m,yx:()=>C});var o=n(259);const i=function(){if(!window.ssv||!window.ssv.shard||"fuckyouarkeros.fun"===window.location.host)return"";const e=window.location.host.split(".");return e.length>2&&e.shift(),`${window.ssv.shard}.${e.join(".")}`}(),r=i&&`${window.location.protocol}//${i}`;async function s(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const{timeout:n=3e4}=t,o=new AbortController,i=setTimeout((()=>o.abort()),n),r=await fetch(e,{...t,signal:o.signal});return clearTimeout(i),r}async function a(e){const{status:t}=e;if(429===t){let t="Has hecho demasiadas solicitudes";const n=e.headers.get("Retry-After");return Number.isNaN(Number(n))||(t+=`, inténtalo de nuevo luego de ${Math.floor(n/60)}min`),{errors:[t]}}try{return await e.json()}catch(e){return{errors:[`Error de conección ${t} :(`]}}}async function l(e,t){let n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];(!(arguments.length>3&&void 0!==arguments[3])||arguments[3])&&(e=`${r}${e}`);try{return a(await s(e,{method:"POST",credentials:n?"include":"omit",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)}))}catch(e){return{errors:["No se pudo conectar al servidor, por favor inténtalo de nuevo más tarde :("]}}}async function c(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];(!(arguments.length>2&&void 0!==arguments[2])||arguments[2])&&(e=`${r}${e}`);try{return a(await s(e,{credentials:t?"include":"omit"}))}catch(e){return{errors:["No se pudo conectar al servidor, por favor inténtalo de nuevo más tarde :("]}}}async function d(e,t){const n=await l("/api/block",{userId:e,block:t});return n.errors?n.errors[0]:"ok"===n.status?null:"Error Desconocido"}async function u(e){const t=await l("/api/privatize",{priv:e});return t.errors?t.errors[0]:"ok"===t.status?null:"Error Desconocido"}async function h(e){const t=await l("/api/startdm",e);return t.errors?t.errors[0]:t.channel?t.channel:"Error Desconocido"}async function p(e){const t=await l("/api/blockdm",{block:e});return t.errors?t.errors[0]:"ok"===t.status?null:"Error Desconocido"}async function f(e){const t=await l("/api/leavechan",{channelId:e});return t.errors?t.errors[0]:"ok"===t.status?null:"Error Desconocido"}async function v(e,t){try{const n=`/history?day=${(0,o.UW)(e)}&id=${t}`,i=await s(n,{credentials:"omit",timeout:45e3});if(200!==i.status)return[];return["00:00",...(await i.json()).map((e=>`${e.substring(0,2)}:${e.substring(2)}`))]}catch{return[]}}async function m(e){const t=await fetch(`${r}/api/chathistory?cid=${e}&limit=50`,{credentials:"include"});if(t.ok){const{history:e}=await t.json();return e}return null}function g(e,t){return l("/api/auth/change_passwd",{password:t,newPassword:e})}async function w(){return c("/api/auth/resend_verify")}async function y(){return!c("/api/auth/logout").errors}function b(e){return l("/api/auth/change_name",{name:e})}function S(e,t){return l("/api/auth/change_mail",{email:e,password:t})}function E(e,t){return l("/api/auth/local",{nameoremail:e,password:t})}function C(e,t,n,o,i){return l("/api/auth/register",{name:e,email:t,password:n,captcha:o,captchaid:i})}function T(e){return l("/api/auth/restore_password",{email:e})}function k(e){return l("/api/auth/delete_account",{password:e})}function I(){return c("/ranking",!1)}function x(){return c("/api/baninfo")}async function N(){if(window.me){const e=await window.me;return delete window.me,a(e)}return c("/api/me")}function _(){return c("/api/getiid")}function A(e){return l("/api/banme",{code:e})}},403:(e,t,n)=>{function o(e,t,n){return{type:"ALERT",title:e,message:t,alertType:n,btn:arguments.length>3&&void 0!==arguments[3]?arguments[3]:"OK"}}function i(){return{type:"CLOSE_ALERT"}}function r(){return{type:"s/TGL_HISTORICAL_VIEW"}}function s(){return{type:"s/TGL_EASTER_EGG"}}function a(){return{type:"s/TGL_GRID"}}function l(){return{type:"s/TGL_PXL_NOTIFY"}}function c(){return{type:"s/TGL_MVM_CTRLS"}}function d(){return{type:"s/TGL_AUTO_ZOOM_IN"}}function u(){return{type:"s/TGL_ONLINE_CANVAS"}}function h(){return{type:"s/TGL_MUTE"}}function p(){return{type:"s/TGL_COMPACT_PALETTE"}}function f(){return{type:"s/TGL_CHAT_NOTIFY"}}function v(){return{type:"s/TGL_POTATO_MODE"}}function m(){return{type:"s/TGL_LIGHT_GRID"}}function g(){return{type:"s/TGL_OPEN_PALETTE"}}function w(e,t){return{type:"s/SELECT_HOLD_PAINT",value:e,immediate:t}}function y(){return{type:"SELECT_HOVER_COLOR"}}function b(e){return{type:"s/SELECT_STYLE",style:e}}function S(){return{type:"s/TGL_OPEN_MENU"}}function E(e){return{type:"SET_HOVER",hover:e}}function C(){return{type:"UNSET_HOVER"}}function T(e){return{type:"SET_MOBILE",mobile:e}}function k(){return{type:"WIN_RESIZE"}}function I(e){return{type:"SELECT_COLOR",color:e}}function x(e){return{type:"s/SELECT_CANVAS",canvasId:String(e)}}function N(e){return{type:"UPDATE_VIEW",view:e}}function _(e){return{type:"SET_VIEW_COORDINATES",view:e}}function A(e){return{type:"s/SET_MOVE_U",value:e}}function L(e){return{type:"s/SET_MOVE_V",value:e}}function O(e){return{type:"s/SET_MOVE_W",value:e}}function P(e){return{type:"s/CANCEL_MOVE",value:e}}function R(e){return{type:"REQ_BIG_CHUNK",center:e}}function $(e){return{type:"REMOVE_CHUNKS",chunks:e}}function D(e){return{type:"REC_BIG_CHUNK",chunk:e}}function M(e,t){return{type:"REC_BIG_CHUNK_FAILURE",chunk:e,error:t}}function H(e){return{type:"s/REC_ME",...e}}function W(e){const{ranking:t,dailyRanking:n,dailyCRanking:o,prevTop:i,onlineStats:r,cHistStats:s,histStats:a,pDailyStats:l,pHourlyStats:c}=e;return{type:"REC_STATS",totalRanking:t,totalDailyRanking:n,dailyCRanking:o,prevTop:i,onlineStats:r,cHistStats:s,histStats:a,pDailyStats:l,pHourlyStats:c}}function U(e,t){return{type:"s/REQ_CHAT_MESSAGE",text:e,channel:t}}function V(){return{type:"s/LOGOUT"}}function z(e){return{type:"s/LOGIN",...e}}function G(e){return{type:"s/SET_NAME",name:e}}function F(e){return{type:"s/SET_MAILREG",mailreg:e}}function q(e){return{type:"MARK_CHANNEL_AS_READ",cid:e}}function B(){return(e,t)=>{setInterval((function(){const n=function(e){const t=[],n=Date.now(),{wait:o}=e.user,i=o-n;return null!=o&&(i>0?t.push(function(e){return{type:"COOLDOWN_SET",coolDown:e}}(i)):t.push({type:"COOLDOWN_END"})),t}(t());e(n)}),333)}}function j(e,t){return{type:"s/BLOCK_USER",userId:e,userName:t}}function Z(e,t){return{type:"s/UNBLOCK_USER",userId:e,userName:t}}function K(e){return{type:"s/SET_BLOCKING_DM",blockDm:e}}function Y(e){return{type:"s/SET_PRIVATE",priv:e}}function Q(e){return{type:"s/MUTE_CHAT_CHANNEL",cid:e}}function X(e){return{type:"s/UNMUTE_CHAT_CHANNEL",cid:e}}function J(e,t){return{type:"SET_HISTORICAL_TIME",date:e,time:t}}function ee(){return{type:"RELOAD_URL"}}function te(){return{type:"t/UNLOAD"}}function ne(e){const{id:t,name:n,mailreg:o,blockDm:i,userlvl:r}=e.user,{canvases:s}=e.canvas,{blocked:a,channels:l}=e.chat,{ranking:c,dailyRanking:d,totalPixels:u,dailyTotalPixels:h}=e.ranks;return{type:"s/REC_ME",blockDm:i,blocked:a,canvases:s,channels:l,dailyRanking:d,dailyTotalPixels:h,id:t,mailreg:o,name:n,ranking:c,totalPixels:u,userlvl:r}}n.d(t,{$t:()=>h,Ai:()=>K,BH:()=>C,Cd:()=>p,Eo:()=>q,FI:()=>r,GY:()=>ne,GZ:()=>E,Hw:()=>H,IN:()=>Y,KB:()=>g,M6:()=>i,MM:()=>b,NK:()=>N,OJ:()=>P,Oh:()=>I,Or:()=>y,Qr:()=>k,RL:()=>v,Rz:()=>te,SC:()=>x,TG:()=>R,TX:()=>V,Tl:()=>W,UI:()=>o,UW:()=>w,WW:()=>O,Xb:()=>l,Y2:()=>F,_:()=>u,_P:()=>D,bE:()=>U,bv:()=>T,c7:()=>f,fL:()=>ee,ge:()=>$,mW:()=>A,mx:()=>L,nb:()=>Q,o7:()=>d,on:()=>J,pH:()=>z,qC:()=>G,qP:()=>c,rf:()=>j,sW:()=>M,ts:()=>m,u0:()=>s,vN:()=>S,vb:()=>B,w5:()=>_,wC:()=>X,xK:()=>a,zv:()=>Z})},395:(e,t,n)=>{function o(){return{type:"w/CLOSE"}}function i(){return{type:"w/OPEN"}}function r(e,t,n,o,i){return(r,s)=>{o=Number(o);const a=s();let l;l=a.windows?a.windows.windows.some((e=>"CHAT"===e.windowType&&!e.hidden))&&Object.values(a.windows.args).some((e=>e.chatChannel===o)):"CHAT"===a.popup.windowType||a.popup.args.chatChannel===o,r({type:"s/REC_CHAT_MESSAGE",name:e,text:t,country:n,channel:o,user:i,isPing:!1,isRead:l})}}function s(e){return{type:"REC_COOLDOWN",wait:e}}function a(e){return{type:"REC_ONLINE",online:e}}function l(e){return{type:"s/ADD_CHAT_CHANNEL",channel:e}}function c(e){return{type:"s/REMOVE_CHAT_CHANNEL",cid:e}}function d(e){return{type:"SET_PXLS_FETCHING",fetching:e}}function u(e){return e.type="REC_SET_PXLS",e}n.d(t,{$s:()=>i,At:()=>s,W1:()=>u,WV:()=>o,Wm:()=>a,cC:()=>d,dm:()=>l,jg:()=>c,pl:()=>r})},669:(e,t,n)=>{n.d(t,{K6:()=>v,Ox:()=>h,R0:()=>p,TL:()=>u,YB:()=>l,aM:()=>d,eg:()=>f,h4:()=>g,mP:()=>c});var o=n(631),i=n(403),r=n(395);function s(e){return{type:"SET_API_FETCHING",fetching:e}}function a(e){return{type:"s/SET_CHAT_FETCHING",fetching:e}}function l(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return async n=>{n(s(!0));const a=await(0,o.I6)(e);if("string"==typeof a)n((0,i.UI)("Direct Message Error",a,"error","OK"));else{const e=Number(Object.keys(a)[0]);n((0,r.dm)(a)),t&&t(e)}n(s(!1))}}function c(){return async e=>{const t=await(0,o.K$)();t.errors||e((0,i.Tl)(t))}}function d(){return async e=>{const t=await(0,o.A)();t.errors||e((0,i.Hw)(t))}}function u(e){return async t=>{t(a(!0));const n=await(0,o.uw)(e);n?(setTimeout((()=>{t(a(!1))}),500),t(function(e,t){return{type:"s/REC_CHAT_HISTORY",cid:e,history:t}}(e,n))):setTimeout((()=>{t(a(!1))}),5e3)}}function h(e,t,n){return async r=>{r(s(!0));const a=await(0,o.PS)(e,n);r(a?(0,i.UI)("User Block Error",a,"error","OK"):n?(0,i.rf)(e,t):(0,i.zv)(e,t)),r(s(!1))}}function p(e){return async t=>{t(s(!0));const n=await(0,o.E1)(e);t(n?(0,i.UI)("Blocking DMs Error",n,"error","OK"):(0,i.Ai)(e)),t(s(!1))}}function f(e){return async t=>{t(s(!0));const n=await(0,o.ko)(e);t(n?(0,i.UI)("Setting User Private Error",n,"error","OK"):(0,i.IN)(e)),t(s(!1))}}function v(e){return async t=>{t(s(!0));const n=await(0,o.AP)(e);t(n?(0,i.UI)("Leaving Channel Error",n,"error","OK"):(0,r.jg)(e)),t(s(!1))}}let m=null;function g(e){return t=>{t(function(e){return{type:"SET_NOTIFICATION",notification:e}}(e)),m&&(clearTimeout(m),m=null),m=setTimeout((()=>{t({type:"UNSET_NOTIFICATION"})}),1500)}}},130:(e,t,n)=>{n.d(t,{s:()=>o,x:()=>i});const o=e=>-1!==e.gui.style.indexOf("dark"),i=e=>[e.canvas.is3D,e.gui.showMvmCtrls||e.user.isOnMobile&&(e.canvas.is3D||e.gui.holdPaint>0&&!e.canvas.isHistoricalView)]},802:(e,t,n)=>{n.d(t,{Z:()=>o});const o=class{recUpdates=!1;timestamp;z;i;j;constructor(e,t,n){this.timestamp=Date.now(),this.z=e,this.i=t,this.j=n}get id(){return this.i<<8|this.j}touch(){this.timestamp=Date.now()}destructor(){}}},686:(e,t,n)=>{n.d(t,{Z:()=>r});var o=n(403),i=n(940);const r=class{#t;#i=new Map;#r;constructor(e,t){this.#t=e,this.#r=t}get canvasId(){return this.#r}get recChunkIds(){const e=[];return this.#i.forEach((t=>{t.recUpdates&&e.push(t.id)})),e}destructor(){this.#i.forEach((e=>{e.destructor()})),this.#i=new Map}cget(e){return this.#i.get(e)}cset(e,t){this.#i.set(e,t)}bcReqChunk(e){const{z:t,i:n,j:i}=e;this.#t.dispatch((0,o.TG)([t,n,i]))}bcRecChunk(e){this.#t.dispatch((0,o._P)(e));const{size:t}=this.#i;if(t>i.U4){const e=t-Math.floor(.9*i.U4),n=Array.from(this.#i.entries()).sort(((e,t)=>e[1].timestamp-t[1].timestamp)).slice(0,e);n.forEach((e=>{let[t]=e;this.#i.delete(t)}));const o=n.map((e=>e[1]));this.bcRemoveChunks(o),console.log(`Cleared ${o.length} to cut amount of chunks to ${this.#i.size}`)}}bcReqChunkFail(e,t){this.#t.dispatch((0,o.sW)(e,t.message))}bcRemoveChunks(e){this.#t.dispatch((0,o.ge)(e))}gc(e){const t=Date.now()-i.WF,n=this.#i,o=[];n.forEach(((i,r)=>{if(t>i.timestamp){const{z:t,i:s,j:a}=i;e.isChunkInView(t,s,a)||(o.push(i),n.delete(r),i.destructor())}})),o.length&&this.bcRemoveChunks(o),console.log(`GC cleaned ${o.length} / ${n.size+o.length} chunks`)}}},906:(e,t,n)=>{n.d(t,{Z:()=>s});var o=n(403),i=n(395),r=n(669);const s=new class{constructor(){this.requestFromQueue=this.requestFromQueue.bind(this),this.pixelQueue=[],this.clientPredictions=[],this.extension=null,window.registerPixelUpdates=e=>{this.extension=e}}initialize(e,t,n){this.store=e,this.socketClient=t,this.getRenderer=n}async requestFromQueue(){const{store:e}=this;if(!this.pixelQueue.length)return void e.dispatch((0,i.cC)(!1));e.dispatch((0,i.cC)(!0));const{i:t,j:n,pixels:s}=this.pixelQueue.shift();let a;try{a=await this.socketClient.sendPixelUpdate(t,n,s)}catch{a={retCode:16,coolDownSeconds:0,pxlCnt:0},e.dispatch((0,o.UI)("Se acabó el tiempo","No se recibió una respuesta de pixelplanet. Intenta actualizar si el problema persiste.","error"))}const{retCode:l,coolDownSeconds:c,pxlCnt:d}=a;if(c&&e.dispatch((0,r.h4)(c)),d<s.length){const[e]=s[d];this.revertPredictionsAt(t,n,e),this.pixelQueue=[]}let u=null,h=null,p="error";switch(l){case 0:case 9:break;case 1:u="Lienzo Inválido",h="Este lienzo no existe";break;case 2:u="Coordenadas Inválidas",h="Coordenada 'x' está fuera de los límites";break;case 3:u="Coordenadas Inválidas",h="Coordenada 'y' está fuera de los límites";break;case 4:u="Coordenadas Inválidas",h="Coordenada 'z' está fuera de los límites";break;case 5:u="Color Incorrecto",h="Color inválido seleccionado";break;case 6:u="Solo para usuarios registrados",h="Tienes que iniciar sesión para utilizar este lienzo";break;case 7:u="No permitido",h="Aún no puedes acceder a este lienzo, porque no tienes suficientes píxeles";break;case 8:e.dispatch((0,r.h4)("Píxel Protegido"));break;case 10:u="Captcha",h="Por favor demuestra que eres humano",p="captcha";break;case 11:u="No permitido",h="Estas usando Proxy.";break;case 12:u="No permitido",h="Sólo el Top10 de ayer puede colocar píxeles aquí";break;case 13:u="Eres raro",h="El servidor se confundió con tus píxeles. ¿Estás jugando en varios dispositivos?";break;case 14:u="Prohibido",p="ban";break;case 15:u="Rango prohibido",h="Su proveedor de Internet está baneado de este juego";break;case 16:u="Se acabó el tiempo",h="No se recibió una respuesta de pixelplanet. Intenta actualizar si el problema persiste.";break;default:u="Raro",h="No se pudo colocar el Píxel"}(h||u)&&e.dispatch((0,o.UI)(u||`Error ${l}`,h,p)),e.dispatch((0,i.W1)(a)),setTimeout(this.requestFromQueue,100)}revertPredictionsAt(e,t,n){const o=this.getRenderer(),{clientPredictions:i}=this;let r=0;for(;r<i.length;){const o=i[r];if(o[0]===e&&o[1]===t&&o[2]===n)break;r+=1}const s=r;for(;r<i.length;){const[e,t,n,s]=i[r];o.renderPixel(e,t,n,s,!1),r+=1}this.clientPredictions.splice(s)}receivePixelUpdate(e){let{i:t,j:n,pixels:o}=e;this.extension&&this.extension(t,n,o),o.forEach((e=>{const[o,i]=e,{clientPredictions:r}=this;for(let e=0;e<r.length;e+=1){const s=r[e];if(s[0]===t&&s[1]===n&&s[2]===o)return void(s[4]===i?r.splice(e,1):s[3]=i)}this.getRenderer().renderPixel(t,n,o,i,!0)}))}tryPlacePixel(e,t,n,o,i){this.getRenderer().renderPixel(e,t,n,o,!1),this.clientPredictions.push([e,t,n,i,o]);const{pixelQueue:r}=this;if(r.length){const i=r[r.length-1],{i:s,j:a}=i;if(e===s&&t===a)return void i.pixels.push([n,o])}r.push({i:e,j:t,pixels:[[n,o]]}),this.store.getState().fetching.fetchingPixel||this.requestFromQueue()}}},785:(e,t,n)=>{n.d(t,{Z:()=>r});var o=n(940),i=n(403);const r=class{store;controls={update(){}};chunkLoader=null;is3D=null;forceNextRender=!0;forceNextSubrender=!0;_view=[0,0,0];#s=null;constructor(e){this.store=e}get view(){return[...this._view]}get chunks(){return this.chunkLoader.chunks}get recChunkIds(){return this.chunkLoader?this.chunkLoader.recChunkIds:[]}destructor(){this.chunkLoader?.destructor(),this.cancelStoreViewInState()}updateView(e){for(let t=0;t<e.length;t+=1)this._view[t]=e[t]}loadViewFromState(){this.store&&this.updateView(this.store.getState().canvas.view)}cancelStoreViewInState(){this.#s&&(clearTimeout(this.#s),this.#s=null)}storeViewInState(){this.store&&(this.cancelStoreViewInState(),this.#s=setTimeout((()=>{this.#s=null,this.store.dispatch((0,i.NK)(this.view))}),o.wL))}render(){return this.controls.update(this.forceNextRender)}renderPixel(){}updateCanvasData(){}getPointedColor(){return null}isChunkInView(){return!0}gc(){this.chunkLoader?.gc(this)}}},917:(e,t,n)=>{async function o(e){e.toBlob((e=>{try{if(!navigator.clipboard)throw new Error("Clipboard API not implemented");navigator.clipboard.write([new ClipboardItem({"image/png":e})])}catch(e){console.log("Couldn't copy canvas to clipboard",e)}}),"image/png")}n.d(t,{Z:()=>i,w:()=>o});const i=async function(e){if(!navigator.clipboard)return function(e){const t=document.createElement("textarea");t.value=e,t.style.top="0",t.style.left="0",t.style.position="fixed",document.body.appendChild(t),t.focus(),t.select();try{const e=document.execCommand("copy");return document.body.removeChild(t),e}catch{return document.body.removeChild(t),!1}}(e);try{return await navigator.clipboard.writeText(e),!0}catch{return!1}}},875:(e,t,n)=>{function o(e){const t=document.createElement("canvas");return t.width=e.naturalWidth,t.height=e.naturalHeight,t.getContext("2d").drawImage(e,0,0),t}function i(e){return new Promise(((t,n)=>{const i=new FileReader;i.onload=()=>{const e=new Image;e.onload=()=>{t(o(e))},e.onerror=e=>n(e),e.src=i.result},i.onerror=e=>n(e),i.readAsDataURL(e)}))}function r(e,t){return i(new Blob([e],{type:t}))}function s(e,t){return new Promise(((n,o)=>{e.toBlob((e=>{e.arrayBuffer().then(n).catch(o)}),t)}))}n.d(t,{NE:()=>i,NF:()=>r,nE:()=>s,zE:()=>o})}},i={};function r(e){var t=i[e];if(void 0!==t)return t.exports;var n=i[e]={exports:{}};return o[e](n,n.exports,r),n.exports}r.m=o,e=[],r.O=(t,n,o,i)=>{if(!n){var s=1/0;for(d=0;d<e.length;d++){for(var[n,o,i]=e[d],a=!0,l=0;l<n.length;l++)(!1&i||s>=i)&&Object.keys(r.O).every((e=>r.O[e](n[l])))?n.splice(l--,1):(a=!1,i<s&&(s=i));if(a){e.splice(d--,1);var c=o();void 0!==c&&(t=c)}}return t}i=i||0;for(var d=e.length;d>0&&e[d-1][2]>i;d--)e[d]=e[d-1];e[d]=[n,o,i]},r.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return r.d(t,{a:t}),t},r.d=(e,t)=>{for(var n in t)r.o(t,n)&&!r.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},r.f={},r.e=e=>Promise.all(Object.keys(r.f).reduce(((t,n)=>(r.f[n](e,t),t)),[])),r.u=e=>841===e?"three.1848d82f.js":{189:"modtools",545:"converter",784:"stats",882:"voxel"}[e]+".es."+{189:"99d7bac0",545:"f198717d",784:"69928133",882:"5de4fbcc"}[e]+".js",r.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),t={},n="pixelplanet:",r.l=(e,o,i,s)=>{if(t[e])t[e].push(o);else{var a,l;if(void 0!==i)for(var c=document.getElementsByTagName("script"),d=0;d<c.length;d++){var u=c[d];if(u.getAttribute("src")==e||u.getAttribute("data-webpack")==n+i){a=u;break}}a||(l=!0,(a=document.createElement("script")).charset="utf-8",a.timeout=120,r.nc&&a.setAttribute("nonce",r.nc),a.setAttribute("data-webpack",n+i),a.src=e),t[e]=[o];var h=(n,o)=>{a.onerror=a.onload=null,clearTimeout(p);var i=t[e];if(delete t[e],a.parentNode&&a.parentNode.removeChild(a),i&&i.forEach((e=>e(o))),n)return n(o)},p=setTimeout(h.bind(null,void 0,{type:"timeout",target:a}),12e4);a.onerror=h.bind(null,a.onerror),a.onload=h.bind(null,a.onload),l&&document.head.appendChild(a)}},r.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.j=47,r.p="/assets/",(()=>{var e={47:0};r.f.j=(t,n)=>{var o=r.o(e,t)?e[t]:void 0;if(0!==o)if(o)n.push(o[2]);else{var i=new Promise(((n,i)=>o=e[t]=[n,i]));n.push(o[2]=i);var s=r.p+r.u(t),a=new Error;r.l(s,(n=>{if(r.o(e,t)&&(0!==(o=e[t])&&(e[t]=void 0),o)){var i=n&&("load"===n.type?"missing":n.type),s=n&&n.target&&n.target.src;a.message="Loading chunk "+t+" failed.\n("+i+": "+s+")",a.name="ChunkLoadError",a.type=i,a.request=s,o[1](a)}}),"chunk-"+t,t)}},r.O.j=t=>0===e[t];var t=(t,n)=>{var o,i,[s,a,l]=n,c=0;if(s.some((t=>0!==e[t]))){for(o in a)r.o(a,o)&&(r.m[o]=a[o]);if(l)var d=l(r)}for(t&&t(n);c<s.length;c++)i=s[c],r.o(e,i)&&e[i]&&e[i][0](),e[i]=0;return r.O(d)},n=self.webpackChunkpixelplanet=self.webpackChunkpixelplanet||[];n.forEach(t.bind(null,0)),n.push=t.bind(null,n.push.bind(n))})();var s=r.O(void 0,[736],(()=>r(633)));s=r.O(s)})();
(()=>{"use strict";var e,t,n,i={633:(e,t,n)=>{var i=n(7774),o=n(917),s=n(403);function r(e,t,n,i,o,s,r){return{type:"s/LIST_TEMPLATE",imageId:e,title:t,canvasId:n,x:i,y:o,width:s,height:r}}function a(e){return{type:"s/REM_TEMPLATE",title:e}}function l(e,t){return{type:"s/CHG_TEMPLATE",title:e,props:t}}var c=n(940),d=n(669);const u=["g","h","x","m","t","r","l","+","-"];var h=n(906),f=n(4890),p=n(3894),v=n(6734);const m={showGrid:!1,showPixelNotify:!1,showMvmCtrls:!1,autoZoomIn:!1,isPotato:!1,isLightGrid:!1,compactPalette:!1,paletteOpen:!0,mute:!1,chatNotify:!0,menuOpen:!1,onlineCanvas:!1,style:"default",holdPaint:c.EQ.OFF,easterEgg:!1,moveU:0,moveV:0,moveW:0},g={lastFetch:0,totalPixels:0,dailyTotalPixels:0,ranking:1488,dailyRanking:1488,online:{total:0},totalRanking:[],totalDailyRanking:[],dailyCRanking:[],prevTop:[],onlineStats:[],cHistStats:[],histStats:{users:[],stats:[]},pDailyStats:[],pHourlyStats:[]},w=15e3,y={mute:[],readTs:{},unread:{}},b={id:null,name:null,wait:null,coolDown:null,lastCoolDownEnd:null,messages:[],mailreg:!1,blockDm:!1,priv:!1,isOnMobile:!1,notification:null,userlvl:0},S=class{length;rgb;colors;abgr;fl;constructor(e){this.length=e.length,this.rgb=new Uint8Array(3*this.length),this.colors=new Array(this.length),this.abgr=new Uint32Array(this.length),this.fl=new Array(this.length);let t=0;for(let n=0;n<e.length;n++){const i=e[n][0],o=e[n][1],s=e[n][2];this.rgb[t++]=i,this.rgb[t++]=o,this.rgb[t++]=s,this.colors[n]=`rgb(${i}, ${o}, ${s})`,this.abgr[n]=4278190080|s<<16|o<<8|i,this.fl[n]=[i/256,o/256,s/256]}}isDark(e){return e*=3,.2126*this.rgb[e++]+.7152*this.rgb[e++]+.0722*this.rgb[e]<128}getIndexOfColor(e,t,n){const{rgb:i}=this;let o=i.length/3;for(;o>0;){o-=1;const s=3*o;if(i[s]===e&&i[s+1]===t&&i[s+2]===n)return o}return null}getClosestIndexOfColor(e,t,n){const{rgb:i}=this;let o=i.length/3,s=0,r=null;for(;o>0;){o-=1;const a=3*o;let l=(i[a]-e)**2;l+=(i[a+1]-t)**2,l+=(i[a+2]-n)**2,(null===r||r>l)&&(s=o,r=l)}return s}};var E=n(259);function C(e){const{canvasEndDate:t,isHistoricalView:n,is3D:i}=e;if(i&&n?e.isHistoricalView=!1:t&&!n&&(e.isHistoricalView=!0,e.historicalDate||(e.historicalDate=(0,E.UW)(t),e.historicalTime="0000")),e.isHistoricalView){const{historicalDate:t,canvasId:n,canvasSize:i,canvases:o}=e;e.historicalCanvasSize=(0,E.Ss)(t,i,o[n]?.historicalSizes)}return e}function T(e,t){const n=e.cli||0,{size:i,sd:o=null,ed:s=null,ident:r,colors:a}=e,l=!!e.v;let d=[0,0,c.A$],u=n;return t&&(d=t.view,u=t.selectedColor),{clrIgnore:n,canvasSize:i,canvasStartDate:o,canvasEndDate:s,canvasIdent:r,is3D:l,view:d,selectedColor:u,palette:new S(a,0)}}function k(e){const{hash:t}=window.location,n=decodeURIComponent(t).substring(1).split(",");let i=n[0],o=(0,E.s3)(e,i);if(!o&&window.ssv.dc&&(o=window.ssv.dc),!o||!window.ssv?.backupurl&&e[o].ed){o=c.V4;const t=e[c.V4];if(!t)return null;i=t.ident}const s=!!e[o].v,r=parseInt(n[1],10)||0,a=parseInt(n[2],10)||0;let l=parseInt(n[3],10);return Number.isNaN(l)?l=s?0:c.A$:s||(l=2**(l/10)),{canvasId:o,canvasIdent:i,view:[r,a,l]}}const I={canvasId:null,canvasIdent:"xx",canvases:{},canvasSize:65536,historicalCanvasSize:65536,is3D:null,canvasStartDate:null,canvasEndDate:null,canvasMaxTiledZoom:(0,E.W4)(65536),palette:new S([[0,0,0]]),clrIgnore:0,selectedColor:0,view:[0,0,c.A$],isHistoricalView:!1,historicalDate:null,historicalTime:null,hover:null,prevCanvasState:{}},x={ovEnabled:!1,mEnabled:!1,oOpacity:40,oSmallPxls:!0,oRightShift:!1,list:[]},_={channels:{},blocked:[],messages:{}};let N=0;const A={fetchingChunks:0,fetchingChat:!1,fetchingPixel:!1,fetchingApi:!1},O=(e,t)=>e&&e._persist&&e._persist.version===t?(console.log(`Store version: ${t}`),Promise.resolve(e)):(console.log("Newer version run, resetting store."),Promise.resolve({})),L={gui:(0,i.OJ)({key:"gui",storage:v.Z,version:17,migrate:O},(function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:m,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"s/TGL_GRID":return{...e,showGrid:!e.showGrid};case"s/TGL_PXL_NOTIFY":return{...e,showPixelNotify:!e.showPixelNotify};case"s/TGL_MVM_CTRLS":return{...e,showMvmCtrls:!e.showMvmCtrls};case"s/TGL_AUTO_ZOOM_IN":return{...e,autoZoomIn:!e.autoZoomIn};case"s/TGL_ONLINE_CANVAS":return{...e,onlineCanvas:!e.onlineCanvas};case"s/TGL_POTATO_MODE":return{...e,isPotato:!e.isPotato};case"s/TGL_LIGHT_GRID":return{...e,isLightGrid:!e.isLightGrid};case"s/TGL_COMPACT_PALETTE":return{...e,compactPalette:!e.compactPalette};case"s/TGL_OPEN_PALETTE":return{...e,paletteOpen:!e.paletteOpen};case"s/TGL_OPEN_MENU":return{...e,menuOpen:!e.menuOpen};case"s/TGL_MUTE":return{...e,mute:!e.mute};case"s/TGL_CHAT_NOTIFY":return{...e,chatNotify:!e.chatNotify};case"s/TGL_EASTER_EGG":return{...e,easterEgg:!e.easterEgg};case"s/SELECT_HOLD_PAINT":return{...e,holdPaint:t.value};case"s/SELECT_STYLE":{const{style:n}=t;return{...e,style:n}}case"SELECT_COLOR":{const{compactPalette:t}=e;let{paletteOpen:n}=e;return(t||window.innerWidth<300)&&(n=!1),{...e,paletteOpen:n}}case"s/SET_MOVE_U":{const{value:n}=t,i=n;return{...e,moveU:i}}case"s/SET_MOVE_V":{const{value:n}=t,i=n;return{...e,moveV:i}}case"s/SET_MOVE_W":{const{value:n}=t,i=n;return{...e,moveW:i}}case"s/CANCEL_MOVE":return{...e,moveU:0,moveV:0,moveW:0};case"persist/REHYDRATE":return{...e,easterEgg:!1,holdPaint:c.EQ.OFF,moveU:0,moveV:0,moveW:0};default:return e}})),ranks:(0,i.OJ)({key:"ranks",storage:v.Z,version:17,migrate:O},(function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:g,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"REC_SET_PXLS":{const{rankedPxlCnt:n}=t;if(!n)return e;let{totalPixels:i,dailyTotalPixels:o}=e;return i+=n,o+=n,{...e,totalPixels:i,dailyTotalPixels:o}}case"REC_ONLINE":{const{online:n}=t;return{...e,online:n}}case"s/REC_ME":case"s/LOGIN":{if(!t.totalPixels)return e;const{totalPixels:n,dailyTotalPixels:i,ranking:o,dailyRanking:s}=t;return{...e,totalPixels:n,dailyTotalPixels:i,ranking:o,dailyRanking:s}}case"REC_STATS":{const{totalRanking:n,totalDailyRanking:i,dailyCRanking:o,prevTop:s,onlineStats:r,cHistStats:a,histStats:l,pDailyStats:c,pHourlyStats:d}=t,u={totalRanking:n,totalDailyRanking:i,dailyCRanking:o,prevTop:s,onlineStats:r,cHistStats:a,histStats:l,pDailyStats:c,pHourlyStats:d},h=Date.now();return{...e,lastFetch:h,...u}}default:return e}})),chatRead:(0,i.OJ)({key:"cr",storage:v.Z,version:17,migrate:O},(function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:y,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"s/REC_ME":case"s/LOGIN":{const{channels:n}=t,i=Object.keys(n),o={},s={};for(let t=0;t<i.length;t+=1){const r=i[t];e.readTs[r]?o[r]=e.readTs[r]:o[r]=0,s[r]=n[r][2]>o[r]}return{...e,readTs:o,unread:s}}case"s/ADD_CHAT_CHANNEL":{const[n]=Object.keys(t.channel);return{...e,readTs:{...e.readTs,[n]:e.readTs[n]||0},unread:{...e.unread,[n]:!0}}}case"s/REMOVE_CHAT_CHANNEL":{const{cid:n}=t;if(!e.readTs[n])return e;const i={...e.readTs};delete i[n];const o={...e.unread};return delete o[n],{...e,readTs:i,unread:o}}case"s/REC_CHAT_MESSAGE":{const{channel:n,isRead:i}=t,o=i?{...e.readTs,[n]:Date.now()+w}:e.readTs,s=i?e.unread:{...e.unread,[n]:!0};return{...e,readTs:o,unread:s}}case"OPEN_WIN":{const{windowType:n}=t;if("CHAT"!==n)return e;const i=t.args&&t.args.chatChannel||1;return{...e,readTs:{...e.readTs,[i]:Date.now()+w},unread:{...e.unread,[i]:!1}}}case"MARK_CHANNEL_AS_READ":{const{cid:n}=t;return{...e,readTs:{...e.readTs,[n]:Date.now()+w},unread:{...e.unread,[n]:!1}}}case"s/MUTE_CHAT_CHANNEL":{const{cid:n}=t;return{...e,mute:[...e.mute,n]}}case"s/UNMUTE_CHAT_CHANNEL":{const{cid:n}=t,i=e.mute.filter((e=>e!==n));return{...e,mute:i}}default:return e}})),templates:(0,i.OJ)({key:"tem",storage:v.Z,version:17,migrate:O},(function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:x,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"s/LIST_TEMPLATE":{const{imageId:n,title:i,canvasId:o,x:s,y:r,width:a,height:l}=t;return{...e,list:[...e.list,{enabled:!0,title:i,canvasId:o,x:s,y:r,imageId:n,width:a,height:l}]}}case"s/CHG_TEMPLATE":{const{title:n,props:i}=t,{list:o}=e,s=o.findIndex((e=>e.title===n));return-1===s?e:{...e,list:[...o.slice(0,s),{...o[s],...i},...o.slice(s+1)]}}case"s/REM_TEMPLATE":return{...e,list:e.list.filter((e=>e.title!==t.title))};case"s/UPD_TEMPLATE_IMG":{const{imageId:n,width:i,height:o}=t,{list:s}=e,r=s.findIndex((e=>e.imageId===n));return-1===r?e:{...e,list:[...s.slice(0,r),{...s[r],imageId:n,width:i,height:o},...s.slice(r+1)]}}case"s/TGL_OVENABLED":return{...e,ovEnabled:!e.ovEnabled};case"s/TGL_SMALLPXLS":return{...e,oSmallPxls:!e.oSmallPxls};case"s/TGL_RIGHTSHIFT":return{...e,oRightShift:!e.oRightShift};case"s/SET_O_OPACITY":return{...e,oOpacity:t.opacity};case"TEMPLATES_READY":return{...e,available:!0};case"persist/REHYDRATE":return{...e,available:!1};default:return e}})),user:function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:b,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"COOLDOWN_SET":{const{coolDown:n}=t;return{...e,coolDown:n||null}}case"COOLDOWN_END":return{...e,coolDown:null,lastCoolDownEnd:Date.now(),wait:null};case"REC_SET_PXLS":{const{wait:n}=t;return{...e,wait:n?Date.now()+n:e.wait}}case"REC_COOLDOWN":{const{wait:n}=t,i=n?Date.now()+n:null;return{...e,wait:i,coolDown:null}}case"SET_MOBILE":{const{mobile:n}=t;return{...e,isOnMobile:n}}case"s/REC_ME":case"s/LOGIN":{const{id:n,name:i,mailreg:o,blockDm:s,priv:r,userlvl:a}=t,l=t.messages?t.messages:[];return{...e,id:n,name:i,messages:l,mailreg:o,blockDm:s,priv:r,userlvl:a}}case"s/LOGOUT":return{...e,id:null,name:null,messages:[],mailreg:!1,blockDm:!1,priv:!1,userlvl:0};case"s/SET_NAME":{const{name:n}=t;return{...e,name:n}}case"s/SET_BLOCKING_DM":{const{blockDm:n}=t;return{...e,blockDm:n}}case"s/SET_PRIVATE":{const{priv:n}=t;return{...e,priv:n}}case"SET_NOTIFICATION":return{...e,notification:t.notification};case"UNSET_NOTIFICATION":return{...e,notification:null};case"s/REM_FROM_MESSAGES":{const{message:n}=t,i=[...e.messages],o=i.indexOf(n);return o>-1&&i.splice(o),{...e,messages:i}}case"s/SET_MAILREG":{const{mailreg:n}=t;return{...e,mailreg:n}}default:return e}},canvas:function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:I,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"SET_HISTORICAL_TIME":{const{date:n,time:i}=t;return C({...e,historicalDate:n,historicalTime:i})}case"s/TGL_HISTORICAL_VIEW":return e.is3D||e.canvasEndDate?e:C({...e,isHistoricalView:!e.isHistoricalView});case"UPDATE_VIEW":{const{view:n}=t;return{...e,view:[...n]}}case"RELOAD_URL":{const{canvases:t}=e,n=k(t);if(!n)return e;if(n.canvasId!==e.canvasId){const{canvasId:i}=n,o=T(t[i],e.prevCanvasState[i]);return{...e,...o,...n}}return{...e,...n}}case"SELECT_COLOR":return{...e,selectedColor:t.color};case"SET_HOVER":{const{hover:n}=t;return{...e,hover:n}}case"UNSET_HOVER":return{...e,hover:null};case"s/SELECT_CANVAS":{let{canvasId:n}=t;const{canvases:i,prevCanvasState:o,canvasId:s}=e;let r=i[n];r||(n=c.V4,r=i[c.V4]);const a=T(r,o[n]);return C({...e,...a,canvasId:n,isHistoricalView:!e.canvasEndDate&&e.isHistoricalView,prevCanvasState:{...e.prevCanvasState,[s]:{view:e.view,selectedColor:e.selectedColor}}})}case"s/REC_ME":{const{canvases:n}=t;let{canvasId:i,view:o}=e;null===i&&({canvasId:i,view:o}=k(n));const s=T(n[i],e.prevCanvasState[i]);return C({...e,...s,canvasId:i,canvases:n,view:o})}default:return e}},chat:function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:_,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"s/REC_ME":case"s/LOGIN":{const n={},i=t.channels,o=Object.keys(i);for(let e=0;e<o.length;e+=1){const t=o[e];n[Number(t)]=i[t]}return{...e,channels:n,blocked:t.blocked}}case"s/LOGOUT":{const t={...e.channels},n={...e.messages},i=Object.keys(t);for(let e=0;e<i.length;e+=1){const o=i[e];0!==t[o][1]&&(delete n[o],delete t[o])}return{...e,channels:t,blocked:[],messages:n}}case"s/BLOCK_USER":{const{userId:n,userName:i}=t,o=[...e.blocked,[n,i]],s={...e.channels},r=Object.keys(s);for(let t=0;t<r.length;t+=1){const i=r[t];if(1===s[i][1]&&s[i][3]===n)return delete s[i],{...e,channels:s,blocked:o}}return{...e,blocked:o}}case"s/UNBLOCK_USER":{const{userId:n}=t,i=e.blocked.filter((e=>e[0]!==n));return{...e,blocked:i}}case"s/ADD_CHAT_CHANNEL":{const{channel:n}=t,i=Number(Object.keys(n)[0]);return e.channels[i]?e:{...e,channels:{...e.channels,...n}}}case"s/REMOVE_CHAT_CHANNEL":{const{cid:n}=t;if(!e.channels[n])return e;const i={...e.channels},o={...e.messages};return delete o[n],delete i[n],{...e,channels:i,messages:o}}case"s/REC_CHAT_MESSAGE":{const{name:n,text:i,country:o,channel:s,user:r}=t;if(!e.messages[s]||!e.channels[s])return e;const a=Math.round(Date.now()/1e3);N+=1;const l={...e.messages,[s]:[...e.messages[s],[n,i,o,r,a,N]]};l[s].length>c.Kb&&l[s].splice(0,2);const d=[...e.channels[s]];return d[2]=Date.now(),{...e,channels:{...e.channels,[s]:d},messages:l}}case"s/REC_CHAT_HISTORY":{const{cid:n,history:i}=t;for(let e=0;e<i.length;e+=1)N+=1,i[e].push(N);return{...e,messages:{...e.messages,[n]:i}}}default:return e}},fetching:function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:A,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"s/SET_CHAT_FETCHING":{const{fetching:n}=t;return{...e,fetchingChat:n}}case"SET_API_FETCHING":{const{fetching:n}=t;return{...e,fetchingApi:n}}case"REQ_BIG_CHUNK":{const{fetchingChunks:t}=e;return{...e,fetchingChunks:t+1}}case"REC_BIG_CHUNK":case"REC_BIG_CHUNK_FAILURE":{const{fetchingChunks:t}=e;return{...e,fetchingChunks:t-1}}case"SET_PXLS_FETCHING":{const{fetching:n}=t;return{...e,fetchingPixel:n}}default:return e}}};function P(e){let t=Math.floor(99999*Math.random())+1;for(;e.args[t];)t+=1;return t}function R(e,t){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],i=window.innerWidth,o=window.innerHeight;n&&(i=Math.floor(.7*i),o=Math.floor(Math.min(.8*o,900)));const s=e||i,r=t||o;return[(0,E.uZ)(s,70,i),(0,E.uZ)(r,50,o)]}function $(e,t,n,i){const o=e||0===e?e:Math.floor((window.innerWidth-n)/2),s=t||0===t?t:Math.floor((window.innerHeight-i)/2);return[(0,E.uZ)(o,70-n,window.innerWidth-70),(0,E.uZ)(s,0,window.innerHeight-30)]}function D(e){const{innerWidth:t,innerHeight:n}=window,{windows:i,positions:o}=e,s=t-70,r=n-30;let a=!1;const l={};for(let e=0;e<i.length;e+=1){const c=i[e].windowId,{xPos:d,yPos:u,width:h,height:f}=o[c],p=70-h;d>s||u>r||d<p||u<0||t>h||n>f?(a=!0,l[c]={xPos:(0,E.uZ)(d,p,s),yPos:(0,E.uZ)(u,0,r),width:Math.min(h,t-30),height:Math.min(f,n-30),z:o[c].z}):l[c]=o[c]}return a?{...e,positions:l}:e}function M(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(e.zMax>=50||t){const t={...e.positions},n=Object.keys(t),i=n.map((e=>t[e].z)).sort(((e,t)=>!t||e&&e>=t));for(let e=0;e<n.length;e+=1){const o=n[e];t[o]={...t[o],z:i.indexOf(t[o].z)}}e.zMax=i.length-1,e.positions=t}return e}const W={showWindows:window.innerWidth>604,zMax:0,windows:[],positions:{},args:{}},H={open:!1,alertType:null,title:null,message:null,btn:null},U=window.AudioContext||window.webkitAudioContext,V=U&&new U;function G(e){const t=new ArrayBuffer(2),n=new DataView(t);return n.setInt8(0,160),n.setInt8(1,Number(e)),t}var F=n(395),z=n(631);const B=new class{store=null;pixelTransferController=null;ws=null;getRenderer;constructor(){console.log("Creating WebSocketClient"),this.channelId=0,this.readyState=WebSocket.CLOSED,this.msgQueue=[],this.reqQueue=[],this.checkHealth=this.checkHealth.bind(this),setInterval(this.checkHealth,2e3)}initialize(e,t,n){return this.store=e,t&&(this.pixelTransferController=t),n&&(this.getRenderer=n),this.connect()}connect(){this.readyState=WebSocket.CONNECTING,this.ws&&console.log("WebSocket already open, not starting"),this.timeLastConnecting=Date.now();const e=`${"https:"===window.location.protocol?"wss:":"ws:"}//${z.uY||window.location.host}/ws`;this.ws=new WebSocket(e),this.ws.binaryType="arraybuffer",this.ws.onopen=this.onOpen.bind(this),this.ws.onmessage=this.onMessage.bind(this),this.ws.onclose=this.onClose.bind(this),this.ws.onerror=e=>{console.error("Socket encountered error, closing socket",e)}}checkHealth(){if(this.readyState===WebSocket.OPEN){const e=Date.now();e-3e4>this.timeLastPing&&(console.log("Server is silent, killing websocket"),this.readyState=WebSocket.CLOSING,this.ws.close()),e-23e3>this.timeLastSent&&(this.send(new Uint8Array([176]).buffer),this.timeLastSent=e)}}sendWhenReady(e){this.timeLastSent=Date.now(),this.readyState===WebSocket.OPEN?this.ws.send(e):(console.log("Tried sending message when websocket was closed!"),this.msgQueue.push(e))}send(e){this.readyState===WebSocket.OPEN&&this.ws.send(e)}processMsgQueue(){for(;this.msgQueue.length>0;)this.sendWhenReady(this.msgQueue.shift())}onOpen(){const e=Date.now();this.timeLastPing=e,this.timeLastSent=e,this.store.dispatch((0,F.$s)()),this.readyState=WebSocket.OPEN,this.send(G(this.store.getState().canvas.canvasId));const t=this.getRenderer?.().recChunkIds;t?.length&&(console.log(`Register ${t.length} chunks`),this.send(function(e){const t=new ArrayBuffer(2+2*e.length),n=new Uint16Array(t);n[0]=163;for(let t=0;t<e.length;t+=1)n[t+1]=e[t];return t}(t))),this.processMsgQueue()}setCanvas(e){null!==e&&(console.log(`Notify websocket server that we changed canvas to ${e}`),this.send(G(e)))}registerChunk(e){const t=function(e){const t=new ArrayBuffer(3),n=new DataView(t);return n.setInt8(0,161),n.setInt16(1,e),t}(e);this.readyState===WebSocket.OPEN&&this.send(t)}deRegisterChunks(e){const t=function(e){const t=new ArrayBuffer(2+2*e.length),n=new Uint16Array(t);n[0]=164;for(let t=0;t<e.length;t+=1)n[t+1]=e[t];return t}(e);this.readyState===WebSocket.OPEN&&this.send(t)}sendCaptchaSolution(e,t){return new Promise(((n,i)=>{let o;const s=["cs",e=>{n(e),clearTimeout(o)}];this.reqQueue.push(s),o=setTimeout((()=>{const e=this.reqQueue.indexOf(s);~e&&this.reqQueue.splice(e,1),i(new Error("Timeout"))}),2e4),this.sendWhenReady(`cs,${JSON.stringify([e,t])}`)}))}sendPixelUpdate(e,t,n){return new Promise(((i,o)=>{let s;const r=["pu",e=>{i(e),clearTimeout(s)}];this.reqQueue.push(r),s=setTimeout((()=>{const e=this.reqQueue.indexOf(r);~e&&this.reqQueue.splice(e,1),o(new Error("Timeout"))}),2e4),this.sendWhenReady(function(e,t,n){const i=new ArrayBuffer(3+4*n.length),o=new DataView(i);o.setUint8(0,193),o.setUint8(1,e),o.setUint8(2,t);let s=2,r=n.length;for(;r;){r-=1;const[e,t]=n[r];o.setUint8(s+=1,e>>>16),o.setUint16(s+=1,65535&e),o.setUint8(s+=2,t)}return i}(e,t,n))}))}sendChatMessage(e,t){this.sendWhenReady(`cm,${JSON.stringify([e,t])}`)}onMessage(e){let{data:t}=e;try{"string"==typeof t?this.onTextMessage(t):this.onBinaryMessage(t)}catch(e){console.log(`An error occurred while parsing websocket message ${t}`,e)}}onTextMessage(e){const t=e.indexOf(",");if(-1===t)return;const n=e.slice(0,t),i=JSON.parse(e.slice(t+1));switch(n){case"cm":this.store.dispatch((0,F.pl)(...i));break;case"ac":this.store.dispatch((0,F.dm)(i));break;case"rc":this.store.dispatch((0,F.jg)(i))}}onBinaryMessage(e){if(0===e.byteLength)return;const t=new DataView(e),n=t.getUint8(0);switch(this.timeLastPing=Date.now(),n){case 193:this.pixelTransferController&&this.pixelTransferController.receivePixelUpdate(function(e){const t=e.getUint8(1),n=e.getUint8(2),i=[];let o=e.byteLength;for(;o>3;){const t=e.getUint8(o-=1),n=e.getUint16(o-=2),s=e.getUint8(o-=1)<<16;i.push([s|n,t])}return{i:t,j:n,pixels:i}}(t));break;case 195:{const e=this.reqQueue.findIndex((e=>"pu"===e[0]));~e&&this.reqQueue.splice(e,1)[0][1](function(e){return{retCode:e.getUint8(1),wait:e.getUint32(2),coolDownSeconds:e.getInt16(6),pxlCnt:e.getUint8(8),rankedPxlCnt:e.getUint8(9)}}(t));break}case 167:this.store.dispatch((0,F.Wm)(function(e){const t={};t.total=e.getUint16(1);let n=e.byteLength;for(;n>3;){const i=e.getUint16(n-=2);t[e.getUint8(n-=1)]=i}return t}(t)));break;case 194:this.store.dispatch((0,F.At)(function(e){return e.getUint32(1)}(t)));break;case 166:console.log("Websocket requested api/me reload"),this.store.dispatch((0,d.aM)()),this.reconnect();break;case 198:{const e=this.reqQueue.findIndex((e=>"cs"===e[0]));~e&&this.reqQueue.splice(e,1)[0][1](function(e){return e.getUint8(1)}(t));break}default:console.error(`Unknown op_code ${n} received`)}}onClose(e){this.store.dispatch((0,F.WV)()),this.ws=null,this.readyState=WebSocket.CONNECTING;const t=this.timeLastConnecting<Date.now()-7e3?1e3:5e3;console.warn(`Socket is closed. Reconnect will be attempted in ${t} ms.`,e.reason),setTimeout((()=>this.connect()),t)}reconnect(){this.readyState===WebSocket.OPEN&&(this.readyState=WebSocket.CLOSING,console.log("Restarting WebSocket"),this.ws.onclose=null,this.ws.onmessage=null,this.ws.close(),this.ws=null,this.connect())}};var Z=n(785);class j{type;static db;constructor(e){this.type=e}async initialize(){return await j.openDB(),this}static openDB(){return j.db?j.db:new Promise(((e,t)=>{const n=window.indexedDB.open("ppfun_files",1);n.onsuccess=t=>{const n=t.target.result;n.onerror=e=>{console.error("indexedDB error:",e.target.error)},j.db=n,e(n)},n.onupgradeneeded=e=>{const t=e.target.result.createObjectStore("files",{autoIncrement:!0});t.createIndex("type","type",{unique:!1}),t.createIndex("mimetype","mimetype",{unique:!1})},n.onerror=()=>{console.error("Error on opening indexedDB:",n.error),t(n.error)}}))}async saveFile(e){const{db:t}=j;if(!t)return null;const n=Array.isArray(e)?e:[e],i=await Promise.all(n.map((e=>e.arrayBuffer())));return new Promise(((o,s)=>{const r=[],a=t.transaction("files","readwrite");a.oncomplete=()=>{o(Array.isArray(e)?r:r[0])},a.onabort=e=>{e.stopPropagation(),s(e.target.error)};const l=a.objectStore("files");n.forEach(((e,t)=>{r.push(null),l.add({type:this.type,mimetype:e.type,buffer:i[t]}).onsuccess=e=>{r[t]=e.target.result}}))}))}async updateFile(e,t){const{db:n}=j;if(!n)return null;const i=await t.arrayBuffer();return new Promise(((o,s)=>{const r=n.transaction("files","readwrite");r.onabort=e=>{e.stopPropagation(),s(e.target.error)},r.objectStore("files").put({type:this.type,mimetpe:t.type,buffer:i},e).onsuccess=e=>o(e.target.result)}))}loadFile(e){const{db:t}=j;if(!t)return null;const n=Array.isArray(e)?e:[e];return new Promise(((i,o)=>{const s=[],r=t.transaction("files","readonly");r.oncomplete=()=>{i(Array.isArray(e)?s:s[0])},r.onabort=e=>{e.stopPropagation(),o(e.target.error)};const a=r.objectStore("files");n.forEach(((e,t)=>{s.push(null),a.get(e).onsuccess=e=>{s[t]=e.target.result}}))}))}deleteFile(e){const{db:t}=j;if(!t)return null;const n=Array.isArray(e)?e:[e];return new Promise(((e,i)=>{const o=t.transaction("files","readwrite");o.oncomplete=()=>{e()},o.onabort=e=>{e.stopPropagation(),i(e.target.error)};const s=o.objectStore("files");n.forEach((e=>{s.delete(e)}))}))}getAllKeys(){const{db:e}=j;return e?new Promise(((t,n)=>{const i=e.transaction("files","readonly");i.objectStore("files").index("type").getAllKeys(this.type).onsuccess=e=>{t(e.target.result)},i.onabort=e=>{e.stopPropagation(),n(e.target.error)}})):null}async sync(e){const t=await this.getAllKeys(),n=t.filter((t=>!e.includes(t)));n.length&&(console.log("Templaes: Keys in db but not in store",n),await this.deleteFile(n));const i=e.filter((e=>!t.includes(e)));return i.length&&console.log("Templates: Keys in store but not in db",i),i}}const K=j;var Y=n(875);const q=class{image;id;width;height;ready=!1;#e;constructor(e){this.id=e}get imageSmall(){if(!this.#e){const e=this.image.getContext("2d").getImageData(0,0,this.width,this.height),t=document.createElement("canvas");t.width=3*this.width,t.height=3*this.height;const n=t.getContext("2d"),i=n.getImageData(0,0,t.width,t.height);let o=0,s=4*i.width+4;for(;o<e.data.length;){for(let t=0;t<e.width;t+=1)i.data[s]=e.data[o],i.data[++s]=e.data[++o],i.data[++s]=e.data[++o],i.data[++s]=e.data[++o],s+=9,o+=1;s+=4*i.width*2}n.putImageData(i,0,0),this.#e=t}return this.#e}async arrayBuffer(){return(0,Y.nE)(this.image)}setDimensionFromCanvas(){const{width:e,height:t}=this.image;return this.width=e,this.height=t,this.read=!0,[e,t]}fromImage(e){return this.image=(0,Y.zE)(e),this.setDimensionFromCanvas()}async fromFile(e){return this.image=await(0,Y.NE)(e),this.setDimensionFromCanvas()}async fromBuffer(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"image/png";return this.image=await(0,Y.NF)(e,t),this.setDimensionFromCanvas()}},Q=new class{#t;#n=new K("templates");#i=new Map;ready=!1;async initialize(e){try{this.#t=e,await this.#n.initialize(),this.ready=!0,this.#t.dispatch({type:"TEMPLATES_READY"}),await this.syncDB()}catch(e){console.warn(`Couldn't initialize Templates: ${e.message}`)}}async getTemplate(e){if(!this.ready)return null;let t=this.#i.get(e);return t?t.image:(t=await this.loadExistingTemplate(e),t?t.image:null)}getTemplateSync(e){if(!this.ready)return null;const t=this.#i.get(e);return t?t.image:(this.loadExistingTemplate(e),null)}getSmallTemplateSync(e){if(!this.ready)return null;const t=this.#i.get(e);return t?t.imageSmall:(this.loadExistingTemplate(e),null)}getColorOfPixel(e,t,n){const i=this.#t.getState().templates.list.filter((i=>i.enabled&&i.canvasId===e&&i.x<=t&&i.y<=n&&i.x+i.width>t&&i.y+i.height>n));for(const e of i){const i=this.getTemplateSync(e.imageId);if(!i)continue;const o=i.getContext("2d").getImageData(t-e.x,n-e.y,1,1).data;if(o[3]>200)return[o[0],o[1],o[2]]}return null}getTemplatesInView(e,t,n,i,o){const s=t-i,r=n-o,a=t+i,l=n+o;return this.#t.getState().templates.list.filter((t=>t.enabled&&t.canvasId===e&&t.x<=a&&t.y<=l&&t.x+t.width>s&&t.y+t.height>r))}async syncDB(){try{const{list:e}=this.#t.getState().templates,t=e.map((e=>e.imageId)),n=await this.#n.sync(t);e.filter((e=>n.includes(e.imageId))).forEach((e=>{this.#t.dispatch(a(e.title))}))}catch(e){console.error(`Error on syncing templates store and indexedDB: ${e.message}`)}}async loadAllMissing(){const{templates:e}=this.#t.getState(),t=e.list.map((e=>e.imageId)).filter((e=>!this.#i.has(e)));for(const e of t)await this.loadExistingTemplate(e)}async loadExistingTemplate(e){try{const t=await this.#n.loadFile(e);if(!t)throw new Error("File does not exist in indexedDB");const{mimetype:n,buffer:i}=t,o=new q(e);return await o.fromBuffer(i,n),this.#i.set(e,o),this.#t.dispatch({type:"REC_TEMPLATE"}),o}catch(t){return console.error(`Error loading template ${e}: ${t.message}`),null}}async addFile(e,t,n,i,o){try{const s=await this.#n.saveFile(e),a=new q(s),l=await a.fromFile(e);this.#i.set(s,a),this.#t.dispatch(r(s,t,n,i,o,...l))}catch(e){console.error(`Error saving template ${t}: ${e.message}`)}}async updateFile(e,t){try{await this.#n.updateFile(e,t);const n=new q(e),i=await n.fromFile(t);this.#i.set(e,n),this.#t.dispatch(function(e,t,n){return{type:"s/UPD_TEMPLATE_IMG",imageId:e,width:t,height:n}}(e,...i))}catch(t){console.error(`Error updating file ${e}: ${t.message}`)}}changeTemplate(e,t){this.#t.dispatch(l(e,t))}deleteTemplate(e){const{list:t}=this.#t.getState().templates,n=t.find((t=>t.title===e));if(!n)return;const{imageId:i}=n;this.#t.dispatch(a(e)),this.#n.deleteFile(i),this.#i.delete(i)}async exportEnabledTemplates(){const{list:e}=this.#t.getState().templates,t=e.filter((e=>e.enabled));if(!t.length||t.length>20)return this.#t.dispatch((0,s.UI)("ارور داد سید","نمی توان بیش از 20 یا بدون قالب صادر کرد!","error")),null;const n=await this.#n.loadFile(t.map((e=>e.imageId))),i=[];for(let e=0;e<t.length;e+=1){const{buffer:o,mimetype:s}=n[e];i.push({...t[e],buffer:await(0,E.h$)(o),mimetype:s})}return i}async importTemplates(e){const t=JSON.parse(await e.text());if(!t.length||t.length>20)return void this.#t.dispatch((0,s.UI)("ارور داد سید","Can not import more than 20 or no template!","error"));const n=await Promise.all(t.map((e=>(0,E._V)(e.buffer)))),i=[];for(let e=0;e<t.length;e+=1){const{mimetype:o}=t[e];i.push(new Blob([n[e]],{type:o}))}const{list:o}=this.#t.getState().templates,a=await this.#n.saveFile(i),l=[];for(let e=0;e<t.length;e+=1){const{x:n,y:i,width:s,height:c,canvasId:d,title:u}=t[e],h=a[e],f=o.find((e=>e.title===u));f?(l.push(f.imageId),this.changeTemplate(u,{imageId:h,title:u,canvasId:d,x:n,y:i,width:s,height:c})):this.#t.dispatch(r(h,u,d,n,i,s,c))}l.length&&this.#n.deleteFile(l)}};window.templateLoader=Q;const X=Q,J=1.2;function ee(e,t,n,i,o){const{width:s,height:r}=t,a=t.getContext("2d");if(!a)return;a.globalAlpha=.5,a.fillStyle=o?"#DDDDDD":"#222222";let[l,c]=(0,E.nK)(n,i,t,[0,0]),[d,u]=(0,E.Cr)(n,i,t,[l,c]);for(;d<s;d+=i){const e=l++%10==0?2:1;a.fillRect(d,0,e,r)}for(;u<r;u+=i){const e=c++%10==0?2:1;a.fillRect(0,u,s,e)}a.globalAlpha=1}class te{store;renderer;viewport;clickTapStartView=[0,0];clickTapStartTime=0;tapStartDist=50;clickTapStartCoords=[0,0];speedScalar=0;isClicking=!1;isMultiTap=!1;wasEverMultiTap=!1;isTapPainting=!1;tapTimeout=null;prevTime=Date.now();coolDownDelta=!1;constructor(e,t,n){this.store=n,this.renderer=e,this.viewport=t,this.onMouseDown=this.onMouseDown.bind(this),this.onAuxClick=this.onAuxClick.bind(this),this.onMouseOut=this.onMouseOut.bind(this),this.onMouseMove=this.onMouseMove.bind(this),this.onWheel=this.onWheel.bind(this),this.onMouseUp=this.onMouseUp.bind(this),this.onTouchStart=this.onTouchStart.bind(this),this.onTouchEnd=this.onTouchEnd.bind(this),this.onTouchMove=this.onTouchMove.bind(this),t.addEventListener("auxclick",this.onAuxClick,!1),t.addEventListener("mousedown",this.onMouseDown,!1),t.addEventListener("mousemove",this.onMouseMove,!1),t.addEventListener("mouseup",this.onMouseUp,!1),t.addEventListener("wheel",this.onWheel,!1),t.addEventListener("touchstart",this.onTouchStart,!1),t.addEventListener("touchend",this.onTouchEnd,!1),t.addEventListener("touchmove",this.onTouchMove,!1),t.addEventListener("mouseout",this.onMouseOut,!1),t.addEventListener("touchcancel",this.onMouseOut,!1)}dispose(){}gotCoolDownDelta(e){this.coolDownDelta=!0,setTimeout((()=>{this.coolDownDelta=!1}),1e3*e)}onMouseDown(e){if(e.preventDefault(),document.activeElement.blur(),0===e.button){this.renderer.cancelStoreViewInState(),this.isClicking=!0;const{clientX:t,clientY:n}=e;this.clickTapStartTime=Date.now(),this.clickTapStartCoords=[t,n],this.clickTapStartView=this.renderer.view;const{viewport:i}=this;setTimeout((()=>{this.isClicking&&(i.style.cursor="move")}),300)}}onMouseUp(e){e.preventDefault();const{store:t,renderer:n}=this;if(0===e.button){this.isClicking=!1;const{clientX:i,clientY:o}=e,{clickTapStartCoords:s,clickTapStartTime:r}=this,a=[s[0]-i,s[1]-o].map(Math.abs);r>Date.now()-250&&a[0]<6&&a[1]<6&&te.placePixel(t,n,this.screenToWorld([i,o])),this.viewport.style.cursor="auto"}n.storeViewInState()}static getTouchCenter(e){let t=0,n=0;for(const{pageX:i,pageY:o}of e.touches)t+=i,n+=o;const{length:i}=e.touches;return[t/i,n/i]}static placePixel(e,t,n){let i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;const o=e.getState();if(o.canvas.isHistoricalView)return;const s=i??te.getWantedColor(o,t,n);if(null===s)return;const{viewscale:r}=t;if(o.gui.autoZoomIn&&r<8)return void t.updateView([n[0],n[1],12]);if(r<3)return;const a=t.getColorIndexOfPixel(...n);if(s===a)return;if(s<o.canvas.clrIgnore){const{palette:e}=o.canvas,{rgb:t}=e;let n=3*s;const i=t[n++],r=t[n++],l=t[n];if(e.getIndexOfColor(i,r,l)===a)return}const{canvasSize:l}=o.canvas,[c,d]=n;if(c>5275&&d>-8713&&c<5398&&d<-8614&&"0"===o.canvas.canvasId)return void(window.location.href="https://files.catbox.moe/gh2wtr.mp4");const u=l/2;if(c<-u||c>=u||d<-u||d>=u)return;const[f,p]=(0,E.sG)(l,c,d),v=(0,E.NK)(l,c,d);h.Z.tryPlacePixel(f,p,v,s,a)}static getMultiTouchDistance(e){if(e.touches.length<2)return 1;const t=e.touches[0],n=e.touches[1];return Math.sqrt((n.pageX-t.pageX)**2+(n.pageY-t.pageY)**2)}onTouchStart(e){e.preventDefault(),document.activeElement.blur(),this.renderer.cancelStoreViewInState(),this.clearTabTimeout(),this.isTapPainting=!1,this.clickTapStartTime=Date.now(),this.clickTapStartCoords=(0,E.bt)(e),this.clickTapStartView=this.renderer.view,e.touches.length>1?(this.tapStartDist=te.getMultiTouchDistance(e),this.isMultiTap=!0,this.wasEverMultiTap=!0):(this.isMultiTap=!1,this.wasEverMultiTap=!1,this.store.getState().gui.holdPaint?this.tapTimeout=setTimeout((()=>{this.isTapPainting=!0,te.placePixel(this.store,this.renderer,this.screenToWorld(this.clickTapStartCoords))}),200):this.tapTimeout=setTimeout((()=>{this.selectColorFromScreen(this.clickTapStartCoords)}),600))}onTouchEnd(e){if(e.preventDefault(),e.touches.length)return;const{store:t,renderer:n}=this;if(!this.wasEverMultiTap){const[n,i]=(0,E.bt)(e),{clickTapStartCoords:o,clickTapStartTime:r}=this,a=[o[0]-n,o[1]-i].map(Math.abs);r>Date.now()-580&&a[0]<6&&a[1]<6&&(te.placePixel(t,this.renderer,this.screenToWorld([n,i])),setTimeout((()=>{t.dispatch((0,s.BH)())}),500))}n.storeViewInState(),this.clearTabTimeout()}onTouchMove(e){e.preventDefault(),e.stopPropagation();const t=e.touches.length>1,n=this.store.getState(),[i,o]=(0,E.bt)(e);if(this.isMultiTap!==t)return this.wasEverMultiTap=!0,this.isMultiTap=t,this.clickTapStartCoords=[i,o],this.clickTapStartView=this.renderer.view,void(this.tapStartDist=te.getMultiTouchDistance(e));const{clickTapStartView:s,clickTapStartCoords:r}=this;if(t){this.clearTabTimeout();const t=e.touches[0],n=e.touches[1],i=Math.sqrt((n.pageX-t.pageX)**2+(n.pageY-t.pageY)**2)/this.tapStartDist,[o,r]=this.renderer.view;this.renderer.updateView([o,r,s[2]*i])}if(!n.gui.holdPaint||t){const[e,t]=s,n=i-r[0],a=o-r[1];(n>5||a>5)&&this.clearTabTimeout();const{viewscale:l}=this.renderer;this.renderer.updateView([e-n/l,t-a/l])}else this.wasEverMultiTap||this.coolDownDelta||(this.isTapPainting?te.placePixel(this.store,this.renderer,this.screenToWorld([i,o])):(this.clickTapStartCoords=[i,o],this.clickTapStartView=this.renderer.view,this.tapStartDist=te.getMultiTouchDistance(e)))}clearTabTimeout(){this.tapTimeout&&(clearTimeout(this.tapTimeout),this.tapTimeout=null)}zoom(e,t){const[n,i,o]=this.renderer.view,s=o>=1?1.1:1.04,r=e>0?o*s:o/s;this.renderer.updateView([n,i,r],t),this.renderer.storeViewInState()}step(e){const[t,n,i]=this.renderer.view,[o,s]=e.map((e=>100*e/i));this.renderer.updateView([t+o,n+s]),this.renderer.storeViewInState()}holdPaintStarted(e){if(!e)return;const{hover:t}=this.store.getState().canvas;t&&te.placePixel(this.store,this.renderer,t)}onWheel(e){e.preventDefault(),e.stopPropagation(),document.activeElement.blur();const{deltaY:t}=e,{store:n}=this,{hover:i}=n.getState().canvas,o=i||null;t<0&&this.zoom(1,o),t>0&&this.zoom(-1,o)}static getWantedColor(e,t,n){if(e.gui.holdPaint===c.EQ.HISTORY)return t.getColorIndexOfPixel(...n,!0);if(e.gui.holdPaint===c.EQ.OVERLAY){const{canvasId:t}=e.canvas,i=X.getColorOfPixel(t,...n);return i?e.canvas.palette.getClosestIndexOfColor(...i):null}return e.canvas.selectedColor}screenToWorld(e){return(0,E.nK)(this.renderer.view,this.renderer.viewscale,this.viewport,e)}setHoverFromScrrenCoor(e){const{store:t}=this,n=t.getState(),{hover:i}=n.canvas,o=this.screenToWorld(e),[r,a]=o,{canvasSize:l}=n.canvas,c=l/2;return r<-c||r>=c||a<-c||a>=c?(i&&t.dispatch((0,s.BH)()),null):i&&i[0]===r&&i[1]===a?null:(t.dispatch((0,s.GZ)(o)),o)}onMouseMove(e){e.preventDefault();const{clientX:t,clientY:n}=e,{renderer:i,isClicking:o}=this,{viewscale:s}=i;if(o){if(Date.now()<this.clickTapStartTime+100)return;const{clickTapStartView:e,clickTapStartCoords:i}=this,[o,r]=e,a=t-i[0],l=n-i[1];this.renderer.updateView([o-a/s,r-l/s])}else{const e=this.setHoverFromScrrenCoor([t,n]);if(!e)return;const i=this.store.getState();!this.coolDownDelta&&i.gui.holdPaint&&te.placePixel(this.store,this.renderer,e)}}onMouseOut(){const{store:e,viewport:t}=this;t.style.cursor="auto",e.dispatch((0,s.BH)()),this.isClicking=!1,this.clearTabTimeout()}selectColorFromScreen(e){const{renderer:t,store:n}=this;if(this.renderer.viewscale<3)return;const i=this.screenToWorld(e),o=t.getColorIndexOfPixel(...i);null!==o&&n.dispatch((0,s.Oh)(o))}onAuxClick(e){const{which:t,clientX:n,clientY:i}=e;2===t&&(e.preventDefault(),this.selectColorFromScreen([n,i]))}update(){let e=Date.now();const{moveU:t,moveV:n,moveW:i}=this.store.getState().gui;if(!(t||n||i))return this.prevTime=e,this.speedScalar=0,!1;e-=this.prevTime,this.prevTime+=e,this.speedScalar=Math.min(1,this.speedScalar+.025);const[o,s,r]=this.renderer.view,a=.4*e/r*this.speedScalar;let l=r>=1?1.0005:1.0003;return l**=i*this.speedScalar,this.renderer.updateView([o+a*t,s+a*n,r*l**e]),!0}}const ne=te;var ie=n(686),oe=n(802);class se extends oe.Z{image;ready;isEmpty;palette;constructor(e){super(arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,arguments.length>3&&void 0!==arguments[3]?arguments[3]:0),this.palette=e,this.image=document.createElement("canvas"),this.image.getContext("2d"),this.image.width=c.I_,this.image.height=c.I_,this.ready=!1,this.isEmpty=!1}fromBuffer(e){this.recUpdates=!0;const t=new ImageData(c.I_,c.I_),n=new Uint32Array(t.data.buffer),{abgr:i}=this.palette;let o=e.byteLength;for(let t=0;t<o;t+=1)n[t]=i[63&e[t]];const s=c.I_**2,r=this.palette.abgr[0];for(;o<s;)n[o]=r,o+=1;this.image.getContext("2d").putImageData(t,0,0),this.ready=!0}preLoad(e,t,n,i){if(this.ready)return;this.ready=!0;const o=this.image.getContext("2d");o.save(),o.msImageSmoothingEnabled=!1,o.webkitImageSmoothingEnabled=!1,o.imageSmoothingEnabled=!1,o.scale(t,t);const s=c.I_/t;o.drawImage(e,n,i,s,s,0,0,s,s),o.restore()}fromImage(e){this.ready=!0,this.image.getContext("2d").drawImage(e,0,0)}empty(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this.ready=!0,this.isEmpty=!0,!e){const{image:e,palette:t}=this,n=e.getContext("2d");n.fillStyle=t.colors[0],n.fillRect(0,0,c.I_,c.I_)}}static getIndexFromCell(e){let[t,n]=e;return t+c.I_*n}getColorIndex(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];const[n,i]=e,o=this.image.getContext("2d").getImageData(n,i,1,1).data;return t||0!==o[3]?t?this.palette.getClosestIndexOfColor(o[0],o[1],o[2]):this.palette.getIndexOfColor(o[0],o[1],o[2]):null}hasColorIn(e,t){const n=se.getIndexFromCell(e),i=this.image.getContext("2d").getImageData(0,0,c.I_,c.I_);return new Uint32Array(i.data.buffer)[n]===this.palette.abgr[t]}setColor(e,t){const[n,i]=e,o=this.image.getContext("2d");return o.fillStyle=this.palette.colors[t],o.fillRect(n,i,1,1),!0}}const re=se,ae=/^([\w]+:)?\/\//;function le(e){return new Promise(((t,n)=>{const i=new Image;i.addEventListener("load",(()=>t(i))),i.addEventListener("error",(()=>{n(new Error(`Failed to load image's URL: ${e}`))})),function(e){return ae&&e.replace(ae,"").indexOf(window.location.host)}(e)&&(i.crossOrigin="anonymous"),i.src=e}))}const ce=new class{tiles;constructor(){this.tiles={},this.loadLoadingTile(0)}getTile(e){return void 0===this.tiles[e]&&this.loadLoadingTile(e),this.tiles[e]||this.tiles[0]||null}async loadLoadingTile(e){null!==this.tiles[e]&&(this.tiles[e]=null,this.tiles[e]=await le(`./loading${e}.png`))}};class de extends ie.Z{canvasMaxTiledZoom;historicalMaxTiledZooms;palette;canvasSize;constructor(e,t,n,i,o){super(e,t),this.palette=n,this.canvasSize=i,this.canvasMaxTiledZoom=(0,E.W4)(i),this.historicalMaxTiledZooms=o?o.map((e=>{const[t,n]=e;return[t,(0,E.W4)(n)]})):[]}getPixelUpdate(e,t,n,i){const o=this.cget(`${this.canvasMaxTiledZoom}:${e}:${t}`);if(o){const e=n%c.I_,t=Math.floor(n/c.I_);o.setColor([e,t],i)}}getColorIndexOfPixel(e,t){const{canvasSize:n}=this,[i,o]=(0,E.sG)(n,e,t),s=`${this.canvasMaxTiledZoom}:${i}:${o}`,r=this.cget(s);return r?r.getColorIndex((0,E.D0)(n,[e,t])):null}getHistoricalIndexOfPixel(e,t,n,i,o){if(!n)return null;const[s,r]=(0,E.sG)(o,e,t),a=(0,E.D0)(o,[e,t]),l=Date.now();if(i&&i&&"0000"!==i){const e=`${n}${i}:${s}:${r}`,t=this.cget(e);if(t){const e=t.getColorIndex(a,!1);if(t.timestamp=l,null!==e)return e}}const c=`${n}:${s}:${r}`,d=this.cget(c);return d?(d.timestamp=l,d.getColorIndex(a)):null}preLoadChunk(e,t,n,i){if(e<=0)return null;try{let o=e-1,s=c.p7,[r,a]=[t,n].map((e=>Math.floor(e/s))),l=this.getChunk(o,r,a,!1,!1,!0);if(l||(o>0&&(o-=1),s=c.p7**(e-o),[r,a]=[t,n].map((e=>Math.floor(e/s))),l=this.getChunk(o,r,a,!0,!1,!0)),l){const e=t%s*c.I_/s,o=n%s*c.I_/s;return i.preLoad(l,s,e,o),i.image}}catch(i){return console.warn(`Error occurred while preloading for ${e}:${t}:${n}`,i),null}return null}getChunk(e,t,n){let i=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],o=!(arguments.length>4&&void 0!==arguments[4])||arguments[4],s=!(arguments.length>5&&void 0!==arguments[5])||arguments[5];const r=`${e}:${t}:${n}`;let a=this.cget(r);if(a){if(a.ready)return a.image}else i&&(a=new re(this.palette,e,t,n),this.cset(r,a),this.canvasMaxTiledZoom===e?this.fetchBaseChunk(t,n,a):this.fetchTile(e,t,n,a));if(s&&a){const i=this.preLoadChunk(e,t,n,a);if(i)return i}return o?ce.getTile(this.canvasId):null}getHistoricalChunk(e,t,n,i){let o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,s=o?`${i}${o}`:i;s+=`:${e}:${t}`;const r=this.cget(s),{canvasId:a}=this;if(r)return r.ready?r.image:o?null:ce.getTile(a);if(n){const n=(0,E.Ss)(i,this.canvasMaxTiledZoom,this.historicalMaxTiledZooms),r=new re(this.palette,n,e,t);this.cset(s,r),this.fetchHistoricalChunk(e,t,i,o,r)}return o?null:ce.getTile(a)}async fetchHistoricalChunk(e,t,n,i,o){const{canvasId:s}=this;let r=`${window.ssv.backupurl}/${n.slice(0,4)}/${n.slice(4,6)}/${n.slice(6)}/`;r+=i?`${s}/${i}/${e}/${t}.png`:`${s}/tiles/${e}/${t}.png`,this.bcReqChunk(o);try{const e=await le(r);o.fromImage(e),this.bcRecChunk(o)}catch(e){this.bcReqChunkFail(o,e),i?o.empty(!0):o.empty()}}async fetchBaseChunk(e,t,n){this.bcReqChunk(n);try{const i=`${z.Fx}/chunks/${this.canvasId}/${e}/${t}.bmp`,o=await fetch(i);if(!o.ok)throw new Error("Network response was not ok.");{const e=await o.arrayBuffer();if(!e.byteLength)throw new Error("Chunk response was invalid");{const t=new Uint8Array(e);n.fromBuffer(t)}this.bcRecChunk(n)}}catch(e){n.empty(),n.recUpdates=!0,this.bcReqChunkFail(n,e)}}async fetchTile(e,t,n,i){this.bcReqChunk(i);try{const o=`/tiles/${this.canvasId}/${e}/${t}/${n}.webp`,s=await le(o);i.fromImage(s),this.bcRecChunk(i)}catch(e){i.empty(),this.bcReqChunkFail(i,e)}}}const ue=de;class he{static NOTIFICATION_TIME=1100;scale;notifcircle;notificationRadius;pixelList;constructor(){this.pixelList=[],this.notificationRadius=150,this.notifcircle=document.createElement("canvas"),this.notifcircle.width=200,this.notifcircle.height=200;const e=this.notifcircle.getContext("2d");e&&(e.fillStyle="#FF000055",e.beginPath(),e.arc(100,100,100,0,2*Math.PI),e.closePath(),e.fill())}addPixel(e,t){this.pixelList.length<300&&this.pixelList.unshift([Date.now(),e,t])}doRender(){return 0!==this.pixelList.length}updateScale(e){this.scale=e,this.notificationRadius=(0,E.uZ)(10*this.scale,20,400)}render(e,t,n,i){const o=t.getContext("2d");if(!o)return;const s=Date.now();let r=this.pixelList.length;for(;r>0;){r--;const[e,a,l]=this.pixelList[r],c=s-e;if(c>he.NOTIFICATION_TIME){this.pixelList.pop();continue}const[d,u]=(0,E.Cr)(n,i,t,[a,l]).map((e=>e+this.scale/2)),h=c/he.NOTIFICATION_TIME*this.notificationRadius/100;o.save(),o.scale(h,h),o.drawImage(this.notifcircle,d/h-100,u/h-100),o.restore()}}}const fe=new he;class pe extends Z.Z{canvasId=null;viewscale=0;centerChunk=[null,null];tiledScale=0;tiledZoom=4;hover=!1;viewport=null;lastFetch=0;canvas;oldHistoricalTime=null;constructor(e){super(e),this.is3D=!1,this.canvasMaxTiledZoom=0,this.historicalCanvasMaxTiledZoom=0,this.scaleThreshold=1;const t=document.createElement("canvas");t.className="viewport";const n=t.getContext("2d",{alpha:!1});this.viewport=t;const i=document.createElement("canvas"),o=i.getContext("2d",{alpha:!1});this.canvas=i,this.onWindowResize(),o.fillStyle="#C4C4C4",o.fillRect(0,0,this.canvas.width,this.canvas.height),n.fillStyle="#C4C4C4",n.fillRect(0,0,this.viewport.width,this.viewport.height),document.body.appendChild(this.viewport),this.onWindowResize=this.onWindowResize.bind(this),window.addEventListener("resize",this.onWindowResize),this.updateCanvasData(e.getState()),this.controls=new ne(this,this.viewport,e)}destructor(){this.controls.dispose(),window.removeEventListener("resize",this.onWindowResize),this.viewport.remove(),super.destructor()}getViewport(){return this.viewport}onWindowResize(){this.viewport.width=window.innerWidth,this.viewport.height=window.innerHeight;const e=2*Math.ceil(window.screen.width/2)+c.p7*c.I_,t=2*Math.ceil(window.screen.height/2)+c.p7*c.I_;this.canvas.width===e&&this.canvas.height===t||(console.log(`Noticed screen: ${e} / ${t}`),this.canvas.width=e,this.canvas.height=t,this.scaleThreshold=Math.min(e/c.I_/3,t/c.I_/3)),this.forceNextRender=!0}updateCanvasData(e){const{canvasId:t}=e.canvas;if(t!==this.canvasId){if(this.canvasId=t,null!==t){const{palette:n,canvasSize:i,canvases:o}=e.canvas;this.canvasMaxTiledZoom=(0,E.W4)(i),this.historicalCanvasMaxTiledZoom=this.canvasMaxTiledZoom,this.chunkLoader=new ue(this.store,t,n,i,o[t].historicalSizes)}this._view[2]=0,this.updateView(e.canvas.view),this.forceNextRender=!0}}updateOldHistoricalTime(e,t){this.oldHistoricalTime="0000"===t?null:t}updateHistoricalTime(e,t,n){this.historicalCanvasMaxTiledZoom=(0,E.W4)(n),this.forceNextRender=!0,this.updateView(this.store.getState().canvas.view)}getColorIndexOfPixel(e,t){if(arguments.length>2&&void 0!==arguments[2]&&arguments[2]){const n=this.store.getState(),{historicalDate:i,historicalTime:o,historicalCanvasSize:s}=n.canvas;return this.chunkLoader.getHistoricalIndexOfPixel(e,t,i,o,s)}return this.chunkLoader.getColorIndexOfPixel(e,t)}getPointedColor(){const{hover:e}=this.store.getState().canvas;return e?this.getColorIndexOfPixel(...e):null}updateView(e,t){let[n,i,o]=e;const s=this.store.getState(),{isHistoricalView:r}=s.canvas,a=r?s.canvas.historicalCanvasSize:s.canvas.canvasSize;if(o){const s=r?.7:c.I_/a;if(o=(0,E.uZ)(e[2],s,c.Fv),t){let e=this.viewscale;this.viewscale=o>.85&&o<1.2?1:o,e/=this.viewscale;const[s,r]=t;n=s+(n-s)*e,i=r+(i-r)*e}else this.viewscale=o}else[,,o]=this._view;const l=-a/2,d=a/2-1;n=(0,E.uZ)(n,l,d),i=(0,E.uZ)(i,l,d);const u=this.view[2];if(super.updateView([n,i,o]),u!==o){const{viewscale:e}=this;fe.updateScale(e);let t=e>.5?0:Math.round(2*Math.log2(e)/c.p7);t=c.p7**t;const n=(r?this.historicalCanvasMaxTiledZoom:this.canvasMaxTiledZoom)+2*Math.log2(t)/c.p7,i=e/t;this.tiledScale=t,this.tiledZoom=n,this.relScale=i,e<this.scaleThreshold||u<this.scaleThreshold||s.templates.ovEnabled&&(u<=c.vB&&o>c.vB||u>c.vB&&o<=c.vB)?this.forceNextRender=!0:this.forceNextSubrender=!0}const h=this.centerChunk,f=(0,E.HD)(this.tiledScale,[n,i],a);h&&h[0]===f[0]&&h[1]===f[1]?this.forceNextSubrender=!0:(this.centerChunk=f,this.forceNextRender=!0)}renderPixel(e,t,n,i,o){const s=this.store.getState(),{canvasSize:r,palette:a,isHistoricalView:l}=s.canvas,d=this.viewscale;if(this.chunkLoader.getPixelUpdate(e,t,n,i),d<.8||l)return;const u=d>this.scaleThreshold?1:d,h=this.canvas.getContext("2d");if(!h)return;const[f,p]=(0,E._O)(e,t,n,r),[v,m]=this.centerChunk.map((e=>(e+.5)*c.I_-r/2)),{width:g,height:w}=this.canvas,y=(f-v)*u+g/2,b=(p-m)*u+w/2;y<0||y>=g||b<0||b>=w||(h.fillStyle=a.colors[i],h.fillRect(y,b,u,u),o&&fe.addPixel(f,p),this.forceNextSubrender=!0)}isChunkInView(e,t,n){const{tiledZoom:i}=this;if(e>i+1)return!1;let[o,s]=this.centerChunk,{relScale:r}=this;if(e!==i){const t=c.p7**(e-i);o=Math.floor(o*t),s=Math.floor(s*t),r*=t}const{width:a,height:l}=this.viewport,d=Math.ceil(a/c.I_/2/r),u=Math.ceil(l/c.I_/2/r);return Math.abs(t-o)<=d&&Math.abs(n-s)<=u}renderChunks(e){const t=this.canvas.getContext("2d");if(!t)return;const{centerChunk:n,tiledScale:i,tiledZoom:o,viewport:s,viewscale:r}=this,{canvasSize:a}=e.canvas;let{relScale:l}=this;r>=1?(t.msImageSmoothingEnabled=!1,t.webkitImageSmoothingEnabled=!1,t.imageSmoothingEnabled=!1):(t.msImageSmoothingEnabled=!0,t.webkitImageSmoothingEnabled=!0,t.imageSmoothingEnabled=!0);const{width:d,height:u}=s,h=Math.ceil(d/c.I_/2/l),f=Math.ceil(u/c.I_/2/l);r>this.scaleThreshold&&(l=1),t.save(),t.fillStyle="#C4C4C4",t.scale(l,l);const p=Date.now();let v=!1;p>this.lastFetch+150&&(this.lastFetch=p,v=!0);const m=this.canvas.width/2/l-c.I_/2,g=this.canvas.height/2/l-c.I_/2,[w,y]=n;let b;for(let e=-h;e<=h;e+=1)for(let n=-f;n<=f;n+=1){const s=w+e,r=y+n,l=m+e*c.I_,d=g+n*c.I_,u=a/c.I_;s<0||s>=u*i||r<0||r>=u*i?t.fillRect(l,d,c.I_,c.I_):(b=this.chunkLoader.getChunk(o,s,r),b?(t.drawImage(b,l,d),v&&(b.timestamp=p)):t.fillRect(l,d,c.I_,c.I_))}t.restore(),e.templates.ovEnabled&&(r<c.vB||!e.templates.oSmallPxls)&&function(e,t,n,i,o,s){if(!X.ready||i<.035)return;const{canvasSize:r,canvasId:a}=e.canvas,[l,d]=n.map((e=>e*c.I_/o+c.I_/2/o-r/2)),u=i>s?1:i,{width:h,height:f}=t,p=h/2/u,v=f/2/u,m=X.getTemplatesInView(a,l,d,p,v);if(!m.length)return;const g=t.getContext("2d");if(g){g.imageSmoothingEnabled=!1,g.save(),g.scale(u,u),g.globalAlpha=e.templates.oOpacity/100;for(const e of m){if(e.width*u<1||e.height*u<1)continue;const t=X.getTemplateSync(e.imageId);t&&g.drawImage(t,e.x-l+h/2/u,e.y-d+f/2/u)}g.restore()}}(e,this.canvas,n,r,this.tiledScale,this.scaleThreshold)}render(){if(!this.chunkLoader)return;super.render();const e=this.store.getState();e.canvas.isHistoricalView?this.renderHistorical(e):this.renderMain(e)}renderMain(e){const{_view:t,viewport:n,viewscale:i}=this,{showGrid:o,showPixelNotify:s,isPotato:r,isLightGrid:a}=e.gui,{fetchingPixel:l}=e.fetching,{canvasSize:d,hover:u}=e.canvas,[h,f]=t,[p,v]=this.centerChunk,m=i>=.5&&s&&fe.doRender(),g=i>=3&&!l&&(u||this.hover)&&!r,w=i>=3&&!l&&(u!==this.hover||this.forceNextRender||this.forceNextSubrender||m)&&r;if(!(this.forceNextRender||g||w||m||this.forceNextSubrender))return;this.hover=u,this.forceNextRender&&this.renderChunks(e),this.forceNextRender=!1,this.forceNextSubrender=!1;const{width:y,height:b}=n,S=n.getContext("2d");if(!S)return;S.msImageSmoothingEnabled=!1,S.webkitImageSmoothingEnabled=!1,S.imageSmoothingEnabled=!1;const C=d/2;i>this.scaleThreshold?(S.save(),S.scale(i,i),S.drawImage(this.canvas,y/2/i-this.canvas.width/2+((p+.5)*c.I_-C-h),b/2/i-this.canvas.height/2+((v+.5)*c.I_-C-f)),S.restore()):S.drawImage(this.canvas,Math.floor(y/2-this.canvas.width/2+((p+.5)*c.I_/this.tiledScale-C-h)*i),Math.floor(b/2-this.canvas.height/2+((v+.5)*c.I_/this.tiledScale-C-f)*i)),e.templates.ovEnabled&&e.templates.oSmallPxls&&i>=c.vB&&function(e,t,n,i){if(!X.ready)return;const{canvasId:o}=e.canvas,[s,r]=n,{width:a,height:l}=t,c=a/2/i,d=l/2/i,u=X.getTemplatesInView(o,s,r,c,d);if(!u.length)return;const h=t.getContext("2d");if(!h)return;const f=i/3;h.imageSmoothingEnabled=!1,h.save(),h.scale(f,f);for(const e of u){const t=X.getSmallTemplateSync(e.imageId);t&&h.drawImage(t,3*(e.x-s)+a/2/f,3*(e.y-r)+l/2/f)}h.restore()}(e,n,t,i),o&&i>=8&&ee(0,n,t,i,a),m&&fe.render(e,n,t,i),u&&g&&function(e,t,n,i){const o=t.getContext("2d"),{hover:s,palette:r,selectedColor:a}=e.canvas,[l,c]=(0,E.Cr)(n,i,t,s);o.save(),o.translate(l+i/2,c+i/2);const d=Math.sin(Date.now()/250)/4;o.rotate(d),o.fillStyle="#000",o.fillRect(-.6*i-1,-.6*i-1,i*J+2,i*J+2),o.fillStyle=r.colors[a],o.fillRect(.6*-i,.6*-i,i*J,i*J),o.restore()}(e,n,t,i),u&&w&&function(e,t,n,i){const o=t.getContext("2d"),{palette:s,selectedColor:r,hover:a}=e.canvas,[l,c]=(0,E.Cr)(n,i,t,a);o.save(),o.fillStyle="#000",o.fillRect(l-1,c-1,4,i+2),o.fillRect(l-1,c-1,i+2,4),o.fillRect(l+i-2,c-1,4,i+2),o.fillRect(l-1,c+i-2,i+1,4),o.fillStyle=s.colors[r],o.fillRect(l,c,2,i),o.fillRect(l,c,i,2),o.fillRect(l+i-1,c,2,i),o.fillRect(l,c+i-1,i,2),o.restore()}(e,n,t,i)}renderHistoricalChunks(e){const t=this.canvas.getContext("2d");if(!t)return;const{centerChunk:n,viewport:i,viewscale:o,oldHistoricalTime:s}=this,{historicalDate:r,historicalTime:a,historicalCanvasSize:l}=e.canvas;o>=1?(t.msImageSmoothingEnabled=!1,t.webkitImageSmoothingEnabled=!1,t.imageSmoothingEnabled=!1):(t.msImageSmoothingEnabled=!0,t.webkitImageSmoothingEnabled=!0,t.imageSmoothingEnabled=!0);const d=o>this.scaleThreshold?1:o,{width:u,height:h}=i,f=Math.ceil(u/c.I_/2/d),p=Math.ceil(h/c.I_/2/d);if(t.save(),t.fillStyle="#C4C4C4",!r||!a)return t.fillRect(0,0,this.canvas.width,this.canvas.height),void t.restore();t.scale(d,d);const v=Date.now();let m=!1;v>this.lastFetch+150&&(this.lastFetch=v,m=!0);const g=this.canvas.width/2/d-c.I_/2,w=this.canvas.height/2/d-c.I_/2,[y,b]=n;let S;for(let e=-f;e<=f;e+=1)for(let n=-p;n<=p;n+=1){const i=y+e,o=b+n,d=g+e*c.I_,u=w+n*c.I_,h=l/c.I_;if(i<0||i>=h||o<0||o>=h)t.fillRect(d,u,c.I_,c.I_);else{if(S=this.chunkLoader.getHistoricalChunk(i,o,!0,r),S?(t.drawImage(S,d,u),m&&(S.timestamp=v)):t.fillRect(d,u,c.I_,c.I_),"0000"===a)continue;S=this.chunkLoader.getHistoricalChunk(i,o,!0,r,a),S?S.isEmpty||(t.drawImage(S,d,u),m&&(S.timestamp=v)):s&&(S=this.chunkLoader.getHistoricalChunk(i,o,!1,r,s),S&&!S.isEmpty&&(t.drawImage(S,d,u),m&&(S.timestamp=v)))}}t.restore()}renderHistorical(e){const{viewport:t,viewscale:n}=this,{showGrid:i,isLightGrid:o}=e.gui,{historicalCanvasSize:s}=e.canvas,[r,a]=this._view,[l,d]=this.centerChunk;if(!this.forceNextRender&&!this.forceNextSubrender)return;this.forceNextRender&&this.renderHistoricalChunks(e),this.forceNextRender=!1,this.forceNextSubrender=!1;const{width:u,height:h}=t,f=t.getContext("2d");if(!f)return;f.msImageSmoothingEnabled=!1,f.webkitImageSmoothingEnabled=!1,f.imageSmoothingEnabled=!1;const p=s/2;n>this.scaleThreshold?(f.save(),f.scale(n,n),f.drawImage(this.canvas,u/2/n-this.canvas.width/2+((l+.5)*c.I_-p-r),h/2/n-this.canvas.height/2+((d+.5)*c.I_-p-a)),f.restore()):f.drawImage(this.canvas,Math.floor(u/2-this.canvas.width/2+((l+.5)*c.I_-p-r)*n),Math.floor(h/2-this.canvas.height/2+((d+.5)*c.I_-p-a)*n)),i&&n>=8&&ee(0,t,this._view,n,o)}}const ve=pe,me=new Z.Z;let ge=me;async function we(e,t){switch(ge.destructor(),t){case!0:if((0,E.b3)()){const t=(await Promise.all([n.e(841),n.e(882)]).then(n.bind(n,156))).default;ge=new t(e)}else e.dispatch((0,s.UI)("ارور بوم","داداش بوم سه بعدی رندر نشد. WebGL2 رو غیر فعال کردی ناقلا؟","error","OK")),ge=me;break;case!1:ge=new ve(e);break;default:ge=me}return ge}function ye(){return ge}!function e(){ge.render(),window.requestAnimationFrame(e)}();const be="PixelPlanet.fun";let Se=null;const Ee=new class{constructor(){this.wins=[],this.origin=window.location.origin,window.addEventListener("beforeunload",(()=>{this.dispatch((0,s.Rz)())}))}add(e){-1===this.wins.indexOf(e)&&this.wins.push(e)}remove(e){const t=this.wins.indexOf(e);~t&&this.wins.splice(t,1)}dispatch(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const{wins:n}=this;try{for(let i=0;i<n.length;i+=1){const o=n[i];o.closed?(n.splice(i,1),i-=1):o!==t&&o.postMessage(e,this.origin)}}catch{return!1}return!0}closeAll(){for(;this.wins.length;)this.wins.pop().close()}};var Ce=n(7187);let Te=!1;const ke=new(n.n(Ce)());function Ie(e){!Te||e.is3D||e.origUpdateView||(console.log("Extension hooked into Renderer"),e.origUpdateView=e.updateView,e.updateView=function(){const[e,t,n]=this._view;this.origUpdateView(...arguments);const[i,o,s]=this._view;if(i===e&&o===t||ke.emit("setviewcoordinates",[i,o]),s!==n){const e=(arguments.length<=1?void 0:arguments[1])&&s>.85&&s<1.2?1:s;ke.emit("setscale",e)}})}!function(){function e(){console.log("Extension active"),ke.once=ke.origOnce,ke.addListener=ke.origAdd,ke.on=ke.addListener,delete ke.origOnce,delete ke.origAdd,Te=!0,Ie(ye())}ke.origOnce=ke.once,ke.origAdd=ke.addListener,ke.once=function(){ke.origOnce(...arguments),e()},ke.addListener=function(){ke.origAdd(...arguments),e()},ke.on=ke.addListener}(),window.pixelPlanetEvents=ke;const xe=(0,i.OJ)({key:"wind",storage:v.Z,version:17,migrate:O},(function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:W,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"OPEN_WIN":{const{windowType:n,title:i,cloneable:o,args:s,xPos:r,yPos:a,width:l,height:c}=t,[d,u]=R(l,c,!0),[h,f]=$(r,a,d,u),p=!e.showWindows||t.fullscreen;if(e.windows.length>=100)return e;const v=P(e),m=e.zMax+1;return M({...e,zMax:m,windows:[...e.windows,{windowId:v,windowType:n,open:!0,hidden:!1,fullscreen:p,title:i,cloneable:o}],args:{...e.args,[v]:{...s}},positions:{...e.positions,[v]:{width:d,height:u,xPos:h,yPos:f,z:m}}})}case"REMOVE_WIN":{const{windowId:n}=t,i={...e.args},o={...e.positions};return delete i[n],delete o[n],{...e,windows:e.windows.filter((e=>e.windowId!==n)),args:i,positions:o}}case"CLOSE_WIN":{const{windowId:n}=t,i=e.windows.map((e=>e.windowId!==n?e:{...e,open:!1}));return{...e,windows:i}}case"CLOSE_ALL_WIN_TYPE":{const{windowType:n}=t,i=e.windows.map((e=>e.windowType!==n?e:{...e,open:!1}));return{...e,windows:i}}case"HIDE_ALL_WIN_TYPE":{const{windowType:n,hide:i}=t,o=e.windows.map((e=>e.windowType!==n?e:{...e,hidden:i}));return{...e,windows:o}}case"CLONE_WIN":{const{windowId:n}=t,i=e.windows.find((e=>e.windowId===n)),o=e.positions[n],s=P(e),r=e.zMax+1,{innerWidth:a,innerHeight:l}=window;return M({...e,zMax:r,windows:[...e.windows,{...i,windowId:s}],args:{...e.args,[s]:{...e.args[n]}},positions:{...e.positions,[s]:{...o,xPos:Math.min(o.xPos+15,a-70),yPos:Math.min(o.yPos+15,l-30),z:r}}})}case"CHANGE_WIN_TYPE":{const{windowId:n,windowType:i,title:o}=t,s={...e.args,[n]:{...t.args}},r=e.windows.map((e=>e.windowId!==n?e:{...e,windowType:i,title:o}));return{...e,args:s,windows:r}}case"FOCUS_WIN":{const{windowId:n}=t,{zMax:i}=e,{z:o}=e.positions[n];return o===i?e:M({...e,zMax:i+1,positions:{...e.positions,[n]:{...e.positions[n],z:i+1}}})}case"TGL_MAXIMIZE_WIN":{const{windowId:n}=t,i=e.windows.map((e=>e.windowId!==n?e:{...e,fullscreen:!e.fullscreen,open:!0,hidden:!1}));return{...e,windows:i}}case"CLOSE_FULLSCREEN_WINS":{const t=e.windows.map((e=>e.fullscreen?{...e,open:!1}:e));return{...e,windows:t}}case"MOVE_WIN":{const{windowId:n,xDiff:i,yDiff:o}=t;let{xPos:s,yPos:r}=e.positions[n];const{width:a,height:l}=e.positions[n];return[s,r]=$(s+i,r+o,a,l),{...e,positions:{...e.positions,[n]:{...e.positions[n],xPos:s,yPos:r}}}}case"RESIZE_WIN":{const{windowId:n,xDiff:i,yDiff:o}=t;let{width:s,height:r}=e.positions[n];return[s,r]=R(s+i,r+o,!1),{...e,positions:{...e.positions,[n]:{...e.positions[n],width:s,height:r}}}}case"persist/REHYDRATE":{const{showWindows:n}=e;if(!n||"wind"!==t.key)return e;const i={...e,...t.payload},o={...i.args},s={...i.positions},r=i.windows.filter((e=>!(!e.open||!e.fullscreen&&!n)||(console.log(`Cleaning up window from previous session: ${e.windowId}`),delete o[e.windowId],delete s[e.windowId],!1)));return M(D({...i,windows:r,args:o,positions:s}))}case"WIN_RESIZE":{const t=window.innerWidth>604;return t?D(t===e.showWindows?e:{...e,showWindows:t}):{...e,showWindows:t}}case"SET_WIN_TITLE":{const{windowId:n,title:i}=t,o=e.windows.map((e=>e.windowId!==n?e:{...e,title:i}));return{...e,windows:o}}case"SET_WIN_ARGS":{const{windowId:n,args:i}=t;return{...e,args:{...e.args,[n]:{...e.args[n],...i}}}}default:return e}})),_e=(0,f.UY)({...L,windows:xe,alert:function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:H,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"ALERT":{const{title:n,message:i,alertType:o,btn:s}=t;return{...e,open:!0,title:n,message:i,alertType:o,btn:s}}case"CLOSE_ALERT":return{...e,open:!1};default:return e}}}),Ne=(0,f.MT)(_e,(0,f.md)(p.Z,(()=>e=>t=>Array.isArray(t)?t.map(e):e(t)),(e=>t=>n=>{if(n instanceof MessageEvent){if(n.origin!==window.location.origin||!n.data.type)return null;if("t/UNLOAD"===n.data.type)console.log("popup closed"),Ee.remove(n.source);else if("t/LOAD"===n.data.type){const t=e.getState();n.source.postMessage((0,s.GY)(t),window.location.origin),Ee.add(n.source),console.log("popup added")}else n.data.type.startsWith("s/")&&Ee.dispatch(n.data,n.source);return t(n.data)}return Ee.wins.length&&n.type&&n.type.startsWith("s/")&&Ee.dispatch(n),t(n)}),(e=>t=>n=>{const i=e.getState(),{mute:o,chatNotify:s}=i.gui;if(!o&&V)switch(n.type){case"SELECT_COLOR":{const e=V.createOscillator(),t=V.createGain(),{currentTime:n}=V;e.type="sine",e.detune.value=-600,e.frequency.setValueAtTime(600,n),e.frequency.setValueAtTime(700,n+.1),t.gain.setValueAtTime(.3,n),t.gain.exponentialRampToValueAtTime(.2,n+.1),e.connect(t),t.connect(V.destination),e.start(),e.stop(n+.2);break}case"SET_NOTIFICATION":{const{notification:e}=n;if("string"!=typeof e)break;const t=V.createOscillator(),i=V.createGain(),{currentTime:o}=V;t.type="sine",t.detune.value=-1200,t.frequency.setValueAtTime(500,o),t.frequency.setValueAtTime(600,o+.1),i.gain.setValueAtTime(.3,o),i.gain.exponentialRampToValueAtTime(.2,o+.1),t.connect(i),i.connect(V.destination),t.start(),t.stop(o+.2);break}case"ALERT":{const e=V.createOscillator(),t=V.createGain(),{currentTime:i}=V;if("captcha"===n.alertType)e.type="sine",e.detune.value=-600,e.start(i),e.frequency.setValueAtTime(1479.98,i),e.frequency.exponentialRampToValueAtTime(493.88,i+.01),e.stop(i+.1),t.gain.setValueAtTime(.5,i),t.gain.setTargetAtTime(0,i,.1),e.connect(t),t.connect(V.destination);else{e.type="sine",e.detune.value=-900,e.start(i),e.frequency.setValueAtTime(600,i),e.frequency.setValueAtTime(1400,i+.025),e.frequency.setValueAtTime(1200,i+.05),e.frequency.setValueAtTime(900,i+.075),e.stop(i+.3);const n=V.createOscillator();n.type="sine",n.start(i),n.frequency.setValueAtTime(2,i),n.stop(i+.3),n.connect(t),t.gain.setValueAtTime(1,i),t.gain.setTargetAtTime(0,i,3),e.connect(t),t.connect(V.destination)}break}case"REC_SET_PXLS":switch(n.retCode){case 0:{const{palette:e,selectedColor:t}=i.canvas,n=e.colors.length,o=100+300*Math.log(t/n+1),s=V.createOscillator(),r=V.createGain(),{currentTime:a}=V;s.type="sine",s.start(a),s.frequency.setValueAtTime(o,a),s.frequency.exponentialRampToValueAtTime(1400,a+.2),s.stop(a+.1),r.gain.setValueAtTime(.5,a),r.gain.setTargetAtTime(0,a,.1),s.connect(r),r.connect(V.destination);break}case 9:{const e=V.createOscillator(),t=V.createGain(),{currentTime:n}=V;e.type="sine",e.start(n),e.frequency.setValueAtTime(1479.98,n),e.frequency.exponentialRampToValueAtTime(493.88,n+.01),e.stop(n+.1),t.gain.setValueAtTime(.5,n),t.gain.setTargetAtTime(0,n,.1),e.connect(t),t.connect(V.destination);break}}break;case"COOLDOWN_END":{const{lastCoolDownEnd:e}=i.user;if(e&&e+5e3>Date.now())break;const t=V.createOscillator(),n=V.createGain(),{currentTime:o}=V;t.type="sine",t.frequency.setValueAtTime(349.23,o),t.frequency.setValueAtTime(523.25,o+.1),t.frequency.setValueAtTime(698.46,o+.2),n.gain.setValueAtTime(.5,o),n.gain.exponentialRampToValueAtTime(.2,o+.15),t.connect(n),n.connect(V.destination),t.start(),t.stop(o+.3);break}case"s/REC_CHAT_MESSAGE":{if(s)break;const{isPing:e,channel:t}=n,{mute:o,chatChannel:r}=i.chatRead;if(o.includes(t)||o.includes(`${t}`))break;const{channels:a}=i.chat,l=V.createOscillator(),c=V.createGain(),{currentTime:d}=V;l.type="sine",l.frequency.setValueAtTime(310,d);const u=e||a[t]&&1===a[t][1]&&t!=r?540:355;l.frequency.exponentialRampToValueAtTime(u,d+.025),c.gain.setValueAtTime(.1,d),c.gain.exponentialRampToValueAtTime(.1,d+.1),l.connect(c),c.connect(V.destination),l.start(),l.stop(d+.075);break}}return t(n)}),(e=>t=>n=>{try{if(!document.hasFocus())switch(n.type){case"s/REC_ME":window.Notification&&"granted"!==Notification.permission&&"denied"!==Notification.permission&&Notification.requestPermission();break;case"COOLDOWN_END":{const t=e.getState(),{lastCoolDownEnd:n}=t.user;if(n&&n+15e3>Date.now())break;window.Notification&&"granted"===Notification.permission&&new Notification("پیکسل های بعدی تو آماده هستن سید",{icon:"/tile.png",silent:!1,vibrate:[200,100],body:"حالا میتونی پیکسل های بیشتری بزاری :)"});break}case"s/REC_CHAT_MESSAGE":{const t=e.getState(),{chatNotify:i}=t.gui;if(!i)break;const{isPing:o}=n;if(!o)break;const{name:s}=n;window.Notification&&"granted"===Notification.permission&&new Notification(`${s} منشنت کرد`,{icon:"/tile.png",silent:!1,vibrate:[200,100],body:"توی چت پیام های حدید داری"});break}}}catch(e){console.error(e)}return t(n)}),(e=>t=>n=>{const i=t(n);switch(n.type){case"COOLDOWN_SET":{const{coolDown:t}=e.getState().user,n=`${(0,E.VL)(t,!0)} | ${be}`;if(Se===n)break;Se=n,document.title=n;break}case"COOLDOWN_END":document.title=be;break;case"s/SELECT_CANVAS":case"s/REC_ME":case"RELOAD_URL":case"UPDATE_VIEW":{const t=e.getState(),{view:i,canvasIdent:o,is3D:s}=t.canvas;if("UPDATE_VIEW"!==n.type){const[e,n,i]=t.canvas.palette.rgb;!function(e,t,n){const i=document.querySelector("meta[name=theme-color]");i&&i.setAttribute("content",`rgb(${e}, ${t}, ${n})`)}(e,n,i)}const r=`#${o},${i.map(((e,t)=>(2!==t||s||(e=10*Math.log2(e)),Math.round(e)))).join(",")}`;window.history.replaceState(void 0,void 0,r);break}}return i}),(e=>t=>n=>{switch(n.type){case"REC_BIG_CHUNK":case"REC_BIG_CHUNK_FAILURE":{const{chunk:e}=n;e.recUpdates&&B.registerChunk(n.chunk.id);break}case"REMOVE_CHUNKS":{const{chunks:e}=n,t=e.filter((e=>e.recUpdates)).map((e=>e.id));t.length&&B.deRegisterChunks(t);break}case"s/SET_NAME":case"s/LOGIN":case"s/LOGOUT":B.reconnect();break;case"s/REQ_CHAT_MESSAGE":{const{text:e,channel:t}=n;B.sendChatMessage(e,t);break}case"RELOAD_URL":case"s/SELECT_CANVAS":case"s/REC_ME":{const i=e.getState(),o=t(n),s=e.getState(),{canvasId:r}=s.canvas;return i.canvas.canvasId!==r&&B.setCanvas(r),o}}return t(n)}),(()=>e=>t=>{const{type:n}=t;switch(n){case"s/SELECT_CANVAS":ke.emit("selectcanvas",t.canvasId);break;case"SET_HOVER":ke.emit("sethover",t.hover);break;case"REC_BIG_CHUNK":ke.emit("receivechunk",t.chunk)}const i=e(t);switch(n){case"RELOAD_URL":case"s/SELECT_CANVAS":case"s/TGL_EASTER_EGG":case"s/REC_ME":Te&&Ie(ye())}return i}),(e=>t=>n=>{const{type:i}=n;switch(i){case"SET_HISTORICAL_TIME":{const t=e.getState(),n=ye(),{historicalDate:i,historicalTime:o}=t.canvas;n.updateOldHistoricalTime(i,o);break}case"SELECT_HOVER_COLOR":{const t=ye().getPointedColor();null!==t&&e.dispatch((0,s.Oh)(t));break}}const o=t(n),r=e.getState();switch(i){case"RELOAD_URL":case"s/SELECT_CANVAS":case"s/REC_ME":{const t=ye(),{is3D:n}=r.canvas;if(n===t.is3D?(t.updateCanvasData(r),"RELOAD_URL"===i&&t.updateView(r.canvas.view)):we(e,n),r.canvas.isHistoricalView){const{historicalDate:e,historicalTime:n,historicalCanvasSize:i}=r.canvas;t.updateHistoricalTime(e,n,i)}break}case"s/TGL_EASTER_EGG":{const t=ye(),{is3D:n}=r.canvas;n&&we(e,!t.is3D);break}case"SET_HISTORICAL_TIME":{const{historicalDate:e,historicalTime:t,historicalCanvasSize:n}=r.canvas;ye().updateHistoricalTime(e,t,n);break}case"s/CHG_TEMPLATE":case"s/TGL_OVENABLED":case"s/TGL_SMALLPXLS":case"s/REM_TEMPLATE":case"s/UPD_TEMPLATE_IMG":case"s/SET_O_OPACITY":case"REQ_BIG_CHUNK":case"PRE_LOADED_BIG_CHUNK":case"REC_BIG_CHUNK":case"REC_BIG_CHUNK_FAILURE":ye().forceNextRender=!0;break;case"s/TGL_GRID":case"ALLOW_SETTING_PXL":ye().forceNextSubrender=!0;break;case"s/TGL_HISTORICAL_VIEW":{const e=ye();e.updateView(e.view,e.view),e.forceNextRender=!0;break}case"s/SELECT_HOLD_PAINT":if(n.value){const e=ye();e.controls.holdPaintStarted?.(n.immediate)}break;case"s/SET_MOVE_U":case"s/SET_MOVE_V":case"s/SET_MOVE_W":case"s/CANCEL_MOVE":n.value||ye().storeViewInState();break;case"SET_VIEW_COORDINATES":{const e=ye();e.updateView(n.view),e.storeViewInState();break}case"SET_SCALE":{const e=ye(),[t,i]=e.view;e.updateView([t,i,n.scale],n.zoompoint),e.storeViewInState();break}case"REC_SET_PXLS":{const e=ye();e.forceNextSubrender=!0;const{coolDownSeconds:t}=n;t<0&&e&&e.controls&&e.controls.gotCoolDownDelta&&e.controls.gotCoolDownDelta(-1*t);break}}return o}))),Ae=Ne;var Oe,Le=n(7294),Pe=n(743),Re=n(745),$e=n(7479);function De(e,t,n,i){Oe||(Oe="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var o=e&&e.defaultProps,s=arguments.length-3;if(t||0===s||(t={children:void 0}),1===s)t.children=i;else if(s>1){for(var r=new Array(s),a=0;a<s;a++)r[a]=arguments[a+3];t.children=r}if(t&&o)for(var l in o)void 0===t[l]&&(t[l]=o[l]);else t||(t=o||{});return{$$typeof:Oe,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}function Me(){let e=(0,Pe.v9)((e=>e.gui.style));if(!window.ssv.availableStyles)return null;const t=new Date,n=t.getMonth()+1,i=t.getDate();(31===i&&10===n||1===i&&11===n)&&(e="dark-spooky");const o=window.ssv.availableStyles[e];return"default"!==e&&o?De("link",{rel:"stylesheet",type:"text/css",href:o}):null}const We=Le.memo(Me);var He;function Ue(e,t,n,i){He||(He="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var o=e&&e.defaultProps,s=arguments.length-3;if(t||0===s||(t={children:void 0}),1===s)t.children=i;else if(s>1){for(var r=new Array(s),a=0;a<s;a++)r[a]=arguments[a+3];t.children=r}if(t&&o)for(var l in o)void 0===t[l]&&(t[l]=o[l]);else t||(t=o||{});return{$$typeof:He,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}const Ve=()=>{const[e,t,n]=(0,Pe.v9)((e=>[e.canvas.view,e.canvas.hover,e.canvas.is3D]),Pe.wU),i=(0,Pe.I0)();let s;if(t)s=t;else{const[t,i,o]=e;s=(n?[t,i,o]:[t,i]).map(Math.round)}return Ue("div",{className:"coorbox",onClick:()=>{(0,o.Z)(window.location.hash),i((0,d.h4)("Copied"))},role:"button",title:"کپی شد سید",tabIndex:"0"},void 0,`(${s.join(", ")})`)},Ge=Le.memo(Ve);var Fe=n(9583);const ze={USERAREA:["activeTab"],CHAT:["chatChannel"]},Be=["HELP","SETTINGS","USERAREA","CHAT","CANVAS_SELECTION","ARCHIVE","REGISTER","FORGOT_PASSWORD"];function Ze(){const e=window.location.pathname.split("/")[1];return e&&Be.includes(e.toUpperCase())}function je(e,t){const n={...t};let i=`/${e.toLowerCase()}`;const o=ze[e];if(o)for(let e=0;e<o.length;e+=1){const t=o[e];n[t]&&(i+=`/${encodeURIComponent(n[t])}`,delete n[t])}let s=new URLSearchParams;const r=Object.keys(n);for(let e=0;e<r.length;e+=1){const t=r[e];s.append(t,n[t])}return s=s.toString(),s&&(i+=`?${s}`),i}const Ke=Be;function Ye(e){return{type:"OPEN_WIN",windowType:e,title:arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",args:arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,fullscreen:arguments.length>3&&void 0!==arguments[3]&&arguments[3],cloneable:!(arguments.length>4&&void 0!==arguments[4])||arguments[4],xPos:arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,yPos:arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,width:arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,height:arguments.length>8&&void 0!==arguments[8]?arguments[8]:null}}function qe(e,t){return{type:"HIDE_ALL_WIN_TYPE",windowType:e,hide:t}}const Qe=(0,Le.createContext)();function Xe(e,t,n,i,o,s){!function(e,t,n,i,o){let s,r;try{if(window.innerWidth<=604?(i=window.innerWidth,o=window.innerHeight,s=window.top.screenX,r=window.top.screenY):(s=Math.round(window.top.screenX+t),r=Math.round(window.top.screenY+n)),Number.isNaN(s)||Number.isNaN(r))throw new Error("NaN")}catch{s=0,r=0}try{return window.open(e,e,`popup=yes,width=${i},height=${o},left=${s},top=${r},toolbar=no,status=no,directories=no,menubar=no`)}catch{return null}}(je(e,t),n,i,o,s)}const Je=function(){const e=(0,Pe.I0)(),t=(0,Le.useContext)(Qe);return(0,Le.useCallback)((function(n){let i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const{xPos:o=null,yPos:s=null,width:r=null,height:a=null,args:l=null}=i;if("popup"===i.target)return void Xe(n,l,o,s,r,a);const{title:c=""}=i,d=!Ze();if("blank"===i.target&&d){const{cloneable:t=!0}=i;e(Ye(n.toUpperCase(),c,l,!1,t,o,s,r,a))}else if("fullscreen"===i.target&&d){const{cloneable:t=!0}=i;e(Ye(n.toUpperCase(),c,l,!0,t,o,s,r,a))}else t?t.changeType(n,c,l):window.location.href=je(n,l)}),[t,e])};var et,tt;function nt(e,t,n,i){tt||(tt="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var o=e&&e.defaultProps,s=arguments.length-3;if(t||0===s||(t={children:void 0}),1===s)t.children=i;else if(s>1){for(var r=new Array(s),a=0;a<s;a++)r[a]=arguments[a+3];t.children=r}if(t&&o)for(var l in o)void 0===t[l]&&(t[l]=o[l]);else t||(t=o||{});return{$$typeof:tt,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}const it=()=>{const e=Je();return nt("div",{id:"canvasbutton",className:"actionbuttons",onClick:()=>e("CANVAS_SELECTION",{target:"fullscreen"}),role:"button",title:"انتخاب بوم",tabIndex:-1},void 0,et||(et=nt(Fe.n6C,{})))},ot=Le.memo(it);var st,rt,at,lt,ct;function dt(e,t,n,i){ct||(ct="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var o=e&&e.defaultProps,s=arguments.length-3;if(t||0===s||(t={children:void 0}),1===s)t.children=i;else if(s>1){for(var r=new Array(s),a=0;a<s;a++)r[a]=arguments[a+3];t.children=r}if(t&&o)for(var l in o)void 0===t[l]&&(t[l]=o[l]);else t||(t=o||{});return{$$typeof:ct,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}const ut=()=>{const[e,t,n,i,o]=(0,Pe.v9)((e=>[e.ranks.online,e.ranks.totalPixels,e.user.name,e.gui.onlineCanvas,e.canvas.canvasId]),Pe.wU),r=(0,Pe.I0)();return dt("div",{className:"onlinebox",role:"button",tabIndex:"0",onClick:()=>r((0,s._)())},void 0,i?dt("span",{title:"یوزر های انلاین در بوم"},void 0,e[o]||0,st||(st=dt(Fe.Xws,{})),rt||(rt=dt(Fe.n6C,{}))):dt("span",{title:"تمام یوزر های آنلاین"},void 0,e.total,at||(at=dt(Fe.Xws,{})))," ",null!=n&&dt("span",{title:"Pixels placed"},void 0,(0,E.D$)(t)," ",lt||(lt=dt(Fe._TT,{}))))},ht=Le.memo(ut);var ft,pt,vt=n(5434);function mt(e,t,n,i){pt||(pt="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var o=e&&e.defaultProps,s=arguments.length-3;if(t||0===s||(t={children:void 0}),1===s)t.children=i;else if(s>1){for(var r=new Array(s),a=0;a<s;a++)r[a]=arguments[a+3];t.children=r}if(t&&o)for(var l in o)void 0===t[l]&&(t[l]=o[l]);else t||(t=o||{});return{$$typeof:pt,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}const gt=e=>[e.windows.windows.some((t=>"CHAT"===t.windowType&&!1===t.hidden&&(e.windows.showWindows||t.fullscreen))),e.windows.windows.some((e=>"CHAT"===e.windowType&&!0===e.hidden))&&e.windows.showWindows],wt=()=>{const[e,t]=(0,Le.useState)(!1),n=(0,Pe.I0)(),[i,o]=(0,Pe.v9)(gt,Pe.wU),s=(0,Pe.v9)((e=>e.gui.chatNotify)),r=(0,Pe.v9)((e=>e.chat.channels)),[a,l]=(0,Pe.v9)((e=>[e.chatRead.unread,e.chatRead.mute]),Pe.wU);return(0,Le.useEffect)((()=>{if(!s||i)return void t(!1);const e=Object.keys(r);let n=0;for(;n<e.length;){const i=e[n];if(0!==r[i][1]&&a[i]&&!l.includes(i)){t(!0);break}n+=1}n===e.length&&t(!1)}),[s,i,r,a,l]),mt("div",{id:"chatbutton",className:"actionbuttons",onClick:()=>{n(i?qe("CHAT",!0):o?qe("CHAT",!1):Ye("CHAT","",null,!1,!0,window.innerWidth-350-62,window.innerHeight-350-64,350,350))},role:"button",title:i?"چت رو ببند":"چت رو باز کن",tabIndex:0},void 0,e&&mt("div",{style:{position:"fixed",bottom:27,right:62,top:"unset"},className:"chnunread"},void 0,"⦿"),ft||(ft=mt(vt.Rlc,{})))},yt=Le.memo(wt);var bt,St;function Et(e,t,n,i){St||(St="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var o=e&&e.defaultProps,s=arguments.length-3;if(t||0===s||(t={children:void 0}),1===s)t.children=i;else if(s>1){for(var r=new Array(s),a=0;a<s;a++)r[a]=arguments[a+3];t.children=r}if(t&&o)for(var l in o)void 0===t[l]&&(t[l]=o[l]);else t||(t=o||{});return{$$typeof:St,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}const Ct=()=>{const e=Je();return Et("div",{id:"helpbutton",className:"actionbuttons",onClick:()=>e("HELP",{target:"fullscreen"}),role:"button",title:"کمک",tabIndex:-1},void 0,bt||(bt=Et(Fe.g_g,{})))},Tt=Le.memo(Ct);var kt,It;function xt(e,t,n,i){It||(It="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var o=e&&e.defaultProps,s=arguments.length-3;if(t||0===s||(t={children:void 0}),1===s)t.children=i;else if(s>1){for(var r=new Array(s),a=0;a<s;a++)r[a]=arguments[a+3];t.children=r}if(t&&o)for(var l in o)void 0===t[l]&&(t[l]=o[l]);else t||(t=o||{});return{$$typeof:It,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}const _t=()=>{const e=Je();return xt("div",{id:"settingsbutton",className:"actionbuttons",onClick:()=>e("SETTINGS",{target:"fullscreen"}),role:"button",title:"تنظیمات",tabIndex:-1},void 0,kt||(kt=xt(Fe.p4t,{})))},Nt=Le.memo(_t);var At,Ot;function Lt(e,t,n,i){Ot||(Ot="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var o=e&&e.defaultProps,s=arguments.length-3;if(t||0===s||(t={children:void 0}),1===s)t.children=i;else if(s>1){for(var r=new Array(s),a=0;a<s;a++)r[a]=arguments[a+3];t.children=r}if(t&&o)for(var l in o)void 0===t[l]&&(t[l]=o[l]);else t||(t=o||{});return{$$typeof:Ot,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}const Pt=()=>{const e=Je();return Lt("div",{id:"loginbutton",className:"actionbuttons",onClick:()=>e("USERAREA",{target:"fullscreen"}),role:"button",title:"منطقه یوزر",tabIndex:-1},void 0,At||(At=Lt(vt.Vyx,{})))},Rt=Le.memo(Pt);var $t,Dt,Mt=n(5823),Wt=n.n(Mt);function Ht(e,t,n,i){Dt||(Dt="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var o=e&&e.defaultProps,s=arguments.length-3;if(t||0===s||(t={children:void 0}),1===s)t.children=i;else if(s>1){for(var r=new Array(s),a=0;a<s;a++)r[a]=arguments[a+3];t.children=r}if(t&&o)for(var l in o)void 0===t[l]&&(t[l]=o[l]);else t||(t=o||{});return{$$typeof:Dt,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}const Ut=()=>{const e=(0,Pe.v9)((e=>e.canvas.view));return Ht("div",{id:"downloadbutton",className:"actionbuttons",role:"button",title:"اسکرین شات بگیر",tabIndex:0,onClick:()=>function(e){const t=ye().getViewport();if(!t)return;const[n,i]=e.map(Math.round),o=`pixelplanet-${n}-${i}.png`;t.toBlob((e=>Wt()(e,o)))}(e)},void 0,$t||($t=Ht(vt.tEr,{})))},Vt=Le.memo(Ut);var Gt,Ft,zt,Bt,Zt;function jt(e,t,n,i){Zt||(Zt="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var o=e&&e.defaultProps,s=arguments.length-3;if(t||0===s||(t={children:void 0}),1===s)t.children=i;else if(s>1){for(var r=new Array(s),a=0;a<s;a++)r[a]=arguments[a+3];t.children=r}if(t&&o)for(var l in o)void 0===t[l]&&(t[l]=o[l]);else t||(t=o||{});return{$$typeof:Zt,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}const Kt=()=>{const[e,t]=(0,Le.useState)(!1),n=(0,Pe.v9)((e=>e.gui.menuOpen));return(0,Le.useEffect)((()=>{n&&setTimeout((()=>t(!0)),10)}),[n]),(e||n)&&jt("div",{className:n&&e?"menu show":"menu",onTransitionEnd:()=>{n||t(!1)}},void 0,Gt||(Gt=jt(Nt,{})),Ft||(Ft=jt(Rt,{})),zt||(zt=jt(Vt,{})),Bt||(Bt=jt(Tt,{})))},Yt=Le.memo(Kt);var qt;function Qt(e,t,n,i){qt||(qt="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var o=e&&e.defaultProps,s=arguments.length-3;if(t||0===s||(t={children:void 0}),1===s)t.children=i;else if(s>1){for(var r=new Array(s),a=0;a<s;a++)r[a]=arguments[a+3];t.children=r}if(t&&o)for(var l in o)void 0===t[l]&&(t[l]=o[l]);else t||(t=o||{});return{$$typeof:qt,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}const Xt=()=>{const e=(0,Pe.v9)((e=>e.user.coolDown));return Qt("div",{className:e&&e>=300?"cooldownbox show":"cooldownbox"},void 0,e&&(0,E.VL)(e,!0))},Jt=Le.memo(Xt);var en;function tn(e,t,n,i){en||(en="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var o=e&&e.defaultProps,s=arguments.length-3;if(t||0===s||(t={children:void 0}),1===s)t.children=i;else if(s>1){for(var r=new Array(s),a=0;a<s;a++)r[a]=arguments[a+3];t.children=r}if(t&&o)for(var l in o)void 0===t[l]&&(t[l]=o[l]);else t||(t=o||{});return{$$typeof:en,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}const nn=()=>{const[e,t]=(0,Le.useState)("notifybox"),n=(0,Pe.v9)((e=>e.user.notification));return(0,Le.useEffect)((()=>{if(n){let i="notifybox";n&&"string"!=typeof n&&(i+=n>0?" green":" red"),i!==e&&t(i)}}),[n,e]),tn("div",{className:n?`${e} show`:e},void 0,n)},on=Le.memo(nn);var sn,rn;function an(e,t,n,i){rn||(rn="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var o=e&&e.defaultProps,s=arguments.length-3;if(t||0===s||(t={children:void 0}),1===s)t.children=i;else if(s>1){for(var r=new Array(s),a=0;a<s;a++)r[a]=arguments[a+3];t.children=r}if(t&&o)for(var l in o)void 0===t[l]&&(t[l]=o[l]);else t||(t=o||{});return{$$typeof:rn,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}const ln=()=>{const[e,t,n,i]=(0,Pe.v9)((e=>[e.canvas.canvasId,e.canvas.canvasIdent,e.canvas.canvasSize,e.canvas.view]),Pe.wU);return an("div",{role:"button",tabIndex:-1,id:"globebutton",title:"بازدید از کل جهان",className:"actionbuttons",onClick:()=>function(e,t,n,i){const[o,s]=i.map(Math.round);window.location.href=`globe#${t},${e},${n},${o},${s}`}(e,t,n,i)},void 0,sn||(sn=an(vt.gb5,{})))},cn=Le.memo(ln);var dn,un;function hn(e,t,n,i){un||(un="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var o=e&&e.defaultProps,s=arguments.length-3;if(t||0===s||(t={children:void 0}),1===s)t.children=i;else if(s>1){for(var r=new Array(s),a=0;a<s;a++)r[a]=arguments[a+3];t.children=r}if(t&&o)for(var l in o)void 0===t[l]&&(t[l]=o[l]);else t||(t=o||{});return{$$typeof:un,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}const fn=()=>{const e=(0,Pe.v9)((e=>e.gui.paletteOpen)),[t,n]=(0,Pe.v9)((e=>[e.canvas.palette,e.canvas.selectedColor]),Pe.wU),i=(0,Pe.I0)();return hn("div",{id:"palselbutton",className:"actionbuttons"+(e?" pressed":""),style:{color:t.isDark(n)?"white":"black",backgroundColor:t.colors[n]},role:"button",title:e?"جعبه رنگ ها رو ببند":"جعبه رنگ ها رو باز کن",tabIndex:0,onClick:()=>i((0,s.KB)())},void 0,dn||(dn=hn(vt.Zox,{})))},pn=Le.memo(fn);var vn=n(106);const mn=function(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:600;const[i,o]=(0,Le.useState)(null),s=(0,Le.useRef)(),r=(0,Le.useCallback)((e=>{e.preventDefault(),o(setTimeout((()=>{t(e),o(null)}),n))}),[t,n]),a=(0,Le.useCallback)((t=>{t.preventDefault(),i&&(clearTimeout(i),e&&e(t),o(null))}),[i,e]),l=(0,Le.useCallback)((e=>{e.preventDefault(),clearTimeout(i),o(null)}),[i]);return(0,Le.useCallback)((e=>{if(e)s.current=e,e.addEventListener("mousedown",r,{passive:!1}),e.addEventListener("mouseup",a,{passive:!1}),e.addEventListener("touchstart",r,{passive:!1}),e.addEventListener("touchend",a,{passive:!1}),e.addEventListener("mouseleave",l,{passive:!1}),e.addEventListener("touchcancel",l,{passive:!1});else if(s.current){const e=s.current;e.removeEventListener("mousedown",r,{passive:!1}),e.removeEventListener("mouseup",a,{passive:!1}),e.removeEventListener("touchstart",r,{passive:!1}),e.removeEventListener("touchend",a,{passive:!1}),e.removeEventListener("mouseleave",l,{passive:!1}),e.removeEventListener("touchcancel",l,{passive:!1})}}),[l,r,a])};var gn,wn,yn;function bn(e,t,n,i){yn||(yn="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var o=e&&e.defaultProps,s=arguments.length-3;if(t||0===s||(t={children:void 0}),1===s)t.children=i;else if(s>1){for(var r=new Array(s),a=0;a<s;a++)r[a]=arguments[a+3];t.children=r}if(t&&o)for(var l in o)void 0===t[l]&&(t[l]=o[l]);else t||(t=o||{});return{$$typeof:yn,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}const Sn=()=>{const[e,t]=(0,Pe.v9)((e=>[e.gui.holdPaint,e.gui.showMvmCtrls]),Pe.wU),n=(0,Pe.I0)(),i=(0,Le.useCallback)((()=>{let t;switch(e){case c.EQ.OFF:case c.EQ.PENCIL:if(window.ssv?.backupurl){t=c.EQ.HISTORY,n((0,d.h4)("History Pencil ON"));break}case c.EQ.HISTORY:t=c.EQ.OVERLAY,n((0,d.h4)("Overlay Pencil ON"));break;default:t=e?c.EQ.OFF:c.EQ.PENCIL}n((0,s.UW)(t))}),[e,n]),o=(0,Le.useCallback)((()=>{let t;t=e?c.EQ.OFF:c.EQ.PENCIL,n((0,s.UW)(t))}),[e,n]),r=mn(o,i);let a="actionbuttons",l="Enable Pencil";switch(e){case c.EQ.PENCIL:a+=" ppencil pressed",l="Disable Pencil";break;case c.EQ.HISTORY:a+=" phistory pressed",l="Disable History Pencil";break;case c.EQ.OVERLAY:a+=" poverlay pressed",l="Disable Overlay Pencil"}return Le.createElement("div",{id:"pencilbutton",className:a,style:{bottom:e||t?180:98},role:"button",title:l,tabIndex:-1,ref:r},e?gn||(gn=bn(vn.nxI,{})):wn||(wn=bn(vn.Lik,{})))},En=Le.memo(Sn);var Cn,Tn,kn,In,xn,_n,Nn,An,On,Ln=n(225),Pn=n(130);function Rn(e,t,n,i){On||(On="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var o=e&&e.defaultProps,s=arguments.length-3;if(t||0===s||(t={children:void 0}),1===s)t.children=i;else if(s>1){for(var r=new Array(s),a=0;a<s;a++)r[a]=arguments[a+3];t.children=r}if(t&&o)for(var l in o)void 0===t[l]&&(t[l]=o[l]);else t||(t=o||{});return{$$typeof:On,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}const $n=()=>{const[e,t]=(0,Le.useState)(!1),[n,i]=(0,Pe.v9)(Pn.x,Pe.wU),o=(0,Pe.I0)();(0,Le.useEffect)((()=>{i&&window.setTimeout((()=>t(!0)),10)}),[i]);const r=(0,Le.useCallback)((e=>{if(!e)return;const t=e=>{switch(e.preventDefault(),e.currentTarget.id){case"forwardbtn":o((0,s.mx)(-1));break;case"backwardbtn":o((0,s.mx)(1));break;case"leftbtn":o((0,s.mW)(-1));break;case"rightbtn":o((0,s.mW)(1));break;case"upbtn":o((0,s.WW)(-1));break;case"downbtn":o((0,s.WW)(1))}},n=e=>{switch(e.preventDefault(),e.currentTarget.id){case"forwardbtn":case"backwardbtn":o((0,s.mx)(0));break;case"leftbtn":case"rightbtn":o((0,s.mW)(0));break;case"upbtn":case"downbtn":o((0,s.WW)(0))}},i=e=>{e.preventDefault(),o((0,s.OJ)())};e.addEventListener("touchstart",t,{passive:!1}),e.addEventListener("mousedown",t,{passive:!1}),e.addEventListener("touchend",n,{passive:!1}),e.addEventListener("mouseup",n,{passive:!1}),e.addEventListener("mouseleave",i,{passive:!1}),e.addEventListener("touchcancel",i,{passive:!1})}),[o]);return(e||i)&&Rn("div",{id:"mvmctrls",className:e&&i?"show":"",onTransitionEnd:()=>!i&&t(!1)},void 0,Le.createElement("div",{className:"actionbuttons",id:"forwardbtn",role:"button",key:"forward",tabIndex:0,style:{left:57,bottom:139},ref:r},Cn||(Cn=Rn(Ln.x8Z,{}))),Le.createElement("div",{className:"actionbuttons",id:"backwardbtn",role:"button",key:"backward",tabIndex:0,style:{left:57,bottom:98},ref:r},Tn||(Tn=Rn(Ln._tY,{}))),Le.createElement("div",{className:"actionbuttons",id:"leftbtn",role:"button",key:"left",tabIndex:0,style:{left:16,bottom:98},ref:r},kn||(kn=Rn(Ln.uMh,{}))),Le.createElement("div",{className:"actionbuttons",id:"rightbtn",role:"button",key:"right",tabIndex:0,style:{left:98,bottom:98},ref:r},In||(In=Rn(Ln.aiH,{}))),Le.createElement("div",{className:"actionbuttons",id:"upbtn",role:"button",key:"up",tabIndex:0,style:{left:16,bottom:139},ref:r},n?xn||(xn=Rn(Ln.V6o,{})):_n||(_n=Rn(Ln.owN,{}))),Le.createElement("div",{className:"actionbuttons",id:"downbtn",role:"button",key:"down",tabIndex:0,style:{left:98,bottom:139},ref:r},n?Nn||(Nn=Rn(Ln.Hgk,{})):An||(An=Rn(Ln.svp,{}))))};var Dn;function Mn(e,t,n,i){Dn||(Dn="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var o=e&&e.defaultProps,s=arguments.length-3;if(t||0===s||(t={children:void 0}),1===s)t.children=i;else if(s>1){for(var r=new Array(s),a=0;a<s;a++)r[a]=arguments[a+3];t.children=r}if(t&&o)for(var l in o)void 0===t[l]&&(t[l]=o[l]);else t||(t=o||{});return{$$typeof:Dn,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}const Wn=()=>{const[e,t]=(0,Le.useState)(!1),[n,i,o,r,a,l]=(0,Pe.v9)((e=>[e.gui.paletteOpen,e.gui.compactPalette,e.canvas.palette.colors,e.canvas.clrIgnore,e.canvas.selectedColor,e.user.userlvl]),Pe.wU),c=(0,Pe.I0)();(0,Le.useEffect)((()=>{window.setTimeout((()=>{n&&t(!0)}),10)}),[n]);const d=0===l?r:0,[u,h]=function(e,t,n,i,o){const{width:s,height:r}=t,a=n.length-i;let l,c,d;s<=300||r<=432?(c=24,d=5,l="row"):a>30||o?(c=28,d=5,l="row"):(c=24,d=r<801?2:1,l="column");const u=Math.ceil(a/d)*c,h=c*d;return e?[{display:"flex",flexWrap:"wrap",textAlign:"center",lineHeight:0,height:u,width:h,flexDirection:l,visibility:"visible"},{display:"block",width:c,height:c,margin:0,padding:0,cursor:"pointer",visibility:"visible"}]:[{display:"flex",flexWrap:"wrap",textAlign:"center",lineHeight:0,height:0,width:h,flexDirection:l,visibility:"hidden"},{display:"block",height:0,width:c,margin:0,padding:0,visibility:"hidden"}]}(e&&n,function(){const[e,t]=(0,Le.useState)({width:window.innerWidth,height:window.innerHeight});return(0,Le.useEffect)((()=>{function e(){t({width:window.innerWidth,height:window.innerHeight})}return window.addEventListener("resize",e),()=>window.removeEventListener("resize",e)}),[]),e}(),o,d,i);return(e||n)&&Mn("div",{id:"palettebox",style:u,onTransitionEnd:()=>{n||t(!1)}},void 0,o.slice(d).map(((e,t)=>Mn("span",{style:{backgroundColor:e,...h},role:"button",tabIndex:0,"aria-label":`color ${t+d}`,className:a===t+d?"selected":"unselected",color:e,onClick:()=>c((0,s.Oh)(t+d))},`${e}-${t+d}`))))},Hn=Le.memo(Wn);var Un,Vn,Gn=n(155);function Fn(e,t,n,i){Vn||(Vn="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var o=e&&e.defaultProps,s=arguments.length-3;if(t||0===s||(t={children:void 0}),1===s)t.children=i;else if(s>1){for(var r=new Array(s),a=0;a<s;a++)r[a]=arguments[a+3];t.children=r}if(t&&o)for(var l in o)void 0===t[l]&&(t[l]=o[l]);else t||(t=o||{});return{$$typeof:Vn,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}const zn={width:"100%",position:"absolute",top:"50%",left:"50%",transform:"translate(-50%,-50%)"},Bn=e=>{let{autoload:t,width:n,setLegit:i}=e;const[o,s]=(0,Le.useState)({}),[r,a]=(0,Le.useState)([]),[l,c]=(0,Le.useState)(!1),d=async()=>{l&&c(!1);const e=await async function(){const e=`${z.Fx}/captcha.svg`,t=await fetch(e,{cache:"no-cache"});if(t.ok){const e=t.headers.get("captcha-id"),n=await t.blob();return[URL.createObjectURL(n),e]}return null}();if(!e)return void a(["کَپچا لود نشد"]);const[t,n]=e;s({url:t,id:n})};(0,Le.useEffect)((()=>{t&&d()}),[]);const u=n||100;return Le.createElement(Le.Fragment,null,Fn("p",{},void 0,"چیز میزایی که توی این عکس هست رو توی باکس بنویس:"," ",Fn("span",{style:{fontSize:11}},void 0,"(","راهنمایی: نیاز نیست کلمات همشون بزرگ باشن، I و I یکی هستن",")")),r.map((e=>Fn("p",{className:"errormessage"},e,Fn("span",{},void 0,"ارور"),": ",e))),Fn("div",{style:{width:`${u}%`,paddingTop:`${Math.floor(.6*u)}%`,position:"relative",display:"inline-block",backgroundColor:"#e0e0e0"}},void 0,o.url?Fn("img",{style:{...zn,opacity:l?1:0,transition:"100ms"},src:o.url,alt:"CAPTCHA",onLoad:()=>{a([]),c(!0)},onError:()=>{a(["کَپچا لود نشد"])}}):Fn("span",{style:zn,role:"button",tabIndex:0,title:"کَپچا رو لود کن",className:"modallink",onClick:d,onKeyPress:d},void 0,"کلیک کن تا کَپچا لود بشه")),Fn("p",{},void 0,"نمیتونی بخونی؟ یک کَپچای دیگه بزن:"," ",Fn("span",{role:"button",tabIndex:-1,title:"بارگذاری جدید",className:"modallink",style:{fontSize:28},onClick:d},void 0,Un||(Un=Fn(Gn.q9I,{})))),Fn("input",{name:"captcha",placeholder:"کاراکترای جدید رو وارد کن",type:"text",autoComplete:"off",autoCorrect:"off",autoCapitalize:"off",spellCheck:"false",onChange:()=>i&&i(!0),autoFocus:t,style:{width:"6em",fontSize:21,margin:5}}),Fn("input",{type:"hidden",name:"captchaid",value:o.id||"0"}))},Zn=Le.memo(Bn);var jn;function Kn(e,t,n,i){jn||(jn="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var o=e&&e.defaultProps,s=arguments.length-3;if(t||0===s||(t={children:void 0}),1===s)t.children=i;else if(s>1){for(var r=new Array(s),a=0;a<s;a++)r[a]=arguments[a+3];t.children=r}if(t&&o)for(var l in o)void 0===t[l]&&(t[l]=o[l]);else t||(t=o||{});return{$$typeof:jn,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}const Yn=e=>{let{close:t}=e;const[n,i]=(0,Le.useState)(null),[o,s]=(0,Le.useState)(!1),[r,a]=(0,Le.useState)(!1),[l,c]=(0,Le.useState)(Date.now());return Kn("form",{onSubmit:async e=>{e.preventDefault();const n=e.target.captcha.value.slice(0,6);if(o||!n)return;r||await(0,z.jK)(2);const a=e.target.captchaid.value;let l;try{switch(s(!0),await B.sendCaptchaSolution(n,a)){case 0:return void t();case 1:l="خیلی کارت طول کشید. دوباره امتحان کن.";break;case 2:l="کَپچا رو نتونستی جواب بدی";break;case 3:l="یا هیچ کلمه ای توی کپچا نیست یا اصن اونی که باید رو ننوشتی";break;case 4:l="هیچ آیدی کپچایی داده نشده";break;default:l="یه ارور نامعلومی این کپچای لامصب داده"}}catch(e){l=`${e.message}`}s(!1),c(Date.now()),i(l)}},void 0,n&&Kn("p",{className:"errormessage"},n,Kn("span",{},void 0,"ارور"),": ",n),Kn(Zn,{autoload:!0,setLegit:a},l),Kn("p",{},void 0,Kn("button",{type:"button",onClick:t},void 0,"لغو")," ",Kn("button",{type:"submit"},void 0,o?"...":"ارسال")))},qn=Le.memo(Yn);var Qn,Xn=n(389);function Jn(e,t,n,i){Qn||(Qn="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var o=e&&e.defaultProps,s=arguments.length-3;if(t||0===s||(t={children:void 0}),1===s)t.children=i;else if(s>1){for(var r=new Array(s),a=0;a<s;a++)r[a]=arguments[a+3];t.children=r}if(t&&o)for(var l in o)void 0===t[l]&&(t[l]=o[l]);else t||(t=o||{});return{$$typeof:Qn,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}const ei=e=>{let{close:t}=e;const[n,i]=(0,Le.useState)([]),[o,s]=(0,Le.useState)(null),[r,a]=(0,Le.useState)(null),[l,c]=(0,Le.useState)(0),[d,u]=(0,Le.useState)(null),[h,f]=(0,Le.useState)(!1),p=Je(),v=async()=>{if(h)return;f(!0),i([]);const e=await(0,z.Es)();if(f(!1),e.errors)return void i(e.errors);const{sleft:t,mod:n,reason:o}=e;if(t){const e=new Date(Date.now()+1e3*t);c(t),u(e.toLocaleString())}a(n),s(o)};return(0,Xn.Z)((()=>{l>0&&(c(l-1),1===l&&v())}),1e3),Jn("div",{style:{userSelect:"text"}},void 0,Jn("p",{},void 0,"You are banned. You think it is unjustified? Check out the ",Jn("span",{role:"button",tabIndex:0,className:"modallink",onClick:()=>{p("HELP",{target:"fullscreen"}),t()}},void 0,"کمک")," بده که بنت برداشته بشه."),n.map((e=>Jn("p",{className:"errormessage"},e,Jn("span",{},void 0,"ارور"),": ",e))),o&&Jn(Le.Fragment,{},"rea",Jn("h3",{},void 0,"دلیل",":"),Jn("p",{},void 0,o)),r&&Jn(Le.Fragment,{},"mod",Jn("h3",{},void 0,"توسط ادمین",":"),Jn("p",{},void 0,r)),l>0&&Jn(Le.Fragment,{},"exp",Jn("h3",{},void 0,"زمان",":"),Jn("p",{},void 0,"بن جنابعالی در این زمان برداشته میشه ",Jn("span",{style:{fontWeight:"bold"}},void 0,d)," که در ",Jn("span",{style:{fontWeight:"bold"}},void 0,(0,E.gx)(l)))),l<0&&Jn(Le.Fragment,{},"nb",Jn("h3",{},void 0,"آنبن شدی",":"),Jn("p",{},void 0,"خب الان که داری این پیامو میبینی، دیگه بن نیستی.")),Jn("p",{},void 0,!o&&Jn(Le.Fragment,{},"btnr",Jn("button",{type:"button",style:{fontWeight:"bold",animation:"glowing 1300ms infinite"},onClick:v},void 0,h?"...":"چرا؟")," "),Jn("button",{type:"submit",onClick:t},void 0,"باشه")))},ti=Le.memo(ei);var ni;function ii(e,t,n,i){ni||(ni="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var o=e&&e.defaultProps,s=arguments.length-3;if(t||0===s||(t={children:void 0}),1===s)t.children=i;else if(s>1){for(var r=new Array(s),a=0;a<s;a++)r[a]=arguments[a+3];t.children=r}if(t&&o)for(var l in o)void 0===t[l]&&(t[l]=o[l]);else t||(t=o||{});return{$$typeof:ni,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}const oi=e=>{let{show:t,onClick:n,z:i}=e;const[o,s]=(0,Le.useState)(!1);return(0,Le.useEffect)((()=>{t&&window.setTimeout((()=>{s(!0)}),10)}),[t]),o||t?ii("div",{className:t&&o?"overlay show":"overlay",style:i?{zIndex:i}:{},onTransitionEnd:()=>{t||s(!1)},tabIndex:-1,onClick:n}):null},si=Le.memo(oi);var ri;function ai(e,t,n,i){ri||(ri="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var o=e&&e.defaultProps,s=arguments.length-3;if(t||0===s||(t={children:void 0}),1===s)t.children=i;else if(s>1){for(var r=new Array(s),a=0;a<s;a++)r[a]=arguments[a+3];t.children=r}if(t&&o)for(var l in o)void 0===t[l]&&(t[l]=o[l]);else t||(t=o||{});return{$$typeof:ri,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}const li=()=>{const[e,t]=(0,Le.useState)(!1),{open:n,alertType:i,title:o,message:r,btn:a}=(0,Pe.v9)((e=>e.alert)),l=(0,Pe.I0)(),c=(0,Le.useCallback)((()=>{l((0,s.M6)())}),[l]);(0,Le.useEffect)((()=>{n&&window.setTimeout((()=>{t(!0)}),10)}),[n]);let d=null;switch(i){case"captcha":d=qn;break;case"ban":d=ti}if(!e&&!n)return null;const u=n&&e;return Le.createElement(Le.Fragment,null,ai(si,{z:6,show:u,onClick:c}),ai("div",{className:u?"Alert show":"Alert",onTransitionEnd:()=>{n||t(!1)}},void 0,ai("h2",{},void 0,o),r&&ai("p",{},void 0,r),d?ai(d,{close:c}):ai("button",{type:"button",onClick:c},void 0,a)),")")},ci=Le.memo(li);var di;function ui(e,t,n,i){di||(di="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var o=e&&e.defaultProps,s=arguments.length-3;if(t||0===s||(t={children:void 0}),1===s)t.children=i;else if(s>1){for(var r=new Array(s),a=0;a<s;a++)r[a]=arguments[a+3];t.children=r}if(t&&o)for(var l in o)void 0===t[l]&&(t[l]=o[l]);else t||(t=o||{});return{$$typeof:di,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}function hi(e){return e?`${e.substring(0,2)}:${e.substring(2)}`:""}const fi=()=>{const e=(0,Le.useRef)(null),[t,n]=(0,Le.useState)(!1),[i,o]=(0,Le.useState)([]),[r]=(0,Le.useState)((0,E.x2)()),[a,l,c,d,u]=(0,Pe.v9)((e=>[e.canvas.canvasId,e.canvas.canvasStartDate,e.canvas.canvasEndDate,e.canvas.historicalDate,e.canvas.historicalTime]),Pe.wU),h=(0,Pe.I0)(),f=(0,Le.useCallback)(((e,t)=>{const n=t.substring(0,2)+t.substring(3,5),i=(0,E.UW)(e);h((0,s.on)(i,n))}),[h]),p=(0,Le.useCallback)((async e=>{if(t)return;n(!0);const i=e.target.value,s=await(0,z.No)(i,a);s&&s.length&&(o(s),f(i,s[0])),n(!1)}),[t,a,f]),v=(0,Le.useCallback)((async t=>{if(!(i.length&&e&&e.current&&e.current.value))return;let s=i,r=i.indexOf(hi(u))+t,l=e.current.value;if(r>=i.length||r<0){if(n(!0),r<0?e.current.stepDown(1):e.current.stepUp(1),l=e.current.value,s=await(0,z.No)(l,a),n(!1),!s||!s.length)return;r=r<0?s.length-1:0}o(s),f(l,s[r])}),[u,i,a,f]),m=(g=d)?`${g.substring(0,4)}-${g.substring(4,6)}-${g.substring(6)}`:"";var g;const w=hi(u);return ui("div",{id:"historyselect"},void 0,Le.createElement("input",{type:"date",pattern:"\\d{4}-\\d{2}-\\d{2}",key:"dateinput",value:m,min:l,max:c||r,ref:e,onChange:p}),ui("div",{},"timeselcon",!!i.length&&u&&!t&&ui("div",{},"timesel",ui("button",{type:"button",className:"hsar",onClick:()=>v(-1)},void 0,"←"),ui("select",{value:w,onChange:e=>f(m,e.target.value)},void 0,i.map((e=>ui("option",{value:e},e,e)))),ui("button",{type:"button",className:"hsar",onClick:()=>v(1)},void 0,"→")),t&&ui("p",{},void 0,"در حال لود کردن..."),!i.length&&!t&&ui("p",{},void 0,"تاریخ رو انتخاب کن")))},pi=Le.memo(fi);var vi,mi,gi,wi,yi,bi,Si,Ei,Ci,Ti;function ki(e,t,n,i){Ti||(Ti="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var o=e&&e.defaultProps,s=arguments.length-3;if(t||0===s||(t={children:void 0}),1===s)t.children=i;else if(s>1){for(var r=new Array(s),a=0;a<s;a++)r[a]=arguments[a+3];t.children=r}if(t&&o)for(var l in o)void 0===t[l]&&(t[l]=o[l]);else t||(t=o||{});return{$$typeof:Ti,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}const Ii=()=>{const[e,t,n]=(0,Pe.v9)((e=>[e.canvas.isHistoricalView,e.canvas.is3D,e.user.isOnMobile]),Pe.wU);return Le.createElement(Le.Fragment,null,vi||(vi=ki(ci,{})),mi||(mi=ki($n,{})),e?gi||(gi=ki(pi,{})):Le.createElement(Le.Fragment,null,wi||(wi=ki(pn,{})),yi||(yi=ki(Hn,{})),!t&&(bi||(bi=ki(cn,{}))),!t&&n&&(Si||(Si=ki(En,{}))),Ei||(Ei=ki(Jt,{}))),Ci||(Ci=ki(on,{})))},xi=Le.memo(Ii);var _i,Ni,Ai;function Oi(e,t,n,i){Ai||(Ai="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var o=e&&e.defaultProps,s=arguments.length-3;if(t||0===s||(t={children:void 0}),1===s)t.children=i;else if(s>1){for(var r=new Array(s),a=0;a<s;a++)r[a]=arguments[a+3];t.children=r}if(t&&o)for(var l in o)void 0===t[l]&&(t[l]=o[l]);else t||(t=o||{});return{$$typeof:Ai,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}const Li=()=>{const e=(0,Pe.v9)((e=>e.gui.menuOpen)),t=(0,Pe.I0)();return Oi("div",{id:"menubutton",className:"actionbuttons"+(e?" pressed":""),role:"button",title:e?"منو رو ببند":"منو رو باز کن",tabIndex:-1,onClick:()=>t((0,s.vN)())},void 0,e?_i||(_i=Oi(vt.Faw,{})):Ni||(Ni=Oi(vt.Yc6,{})))},Pi=Le.memo(Li);var Ri=n(7516),$i=n(573);const Di=e=>e.windows.windows,Mi=e=>e.windows.showWindows,Wi=(0,$i.P1)(Di,Mi,((e,t)=>[e.some((e=>e.fullscreen&&!e.hidden))||t,e.some((e=>e.fullscreen&&e.open&&!e.hidden))])),Hi=(0,$i.P1)(Di,Mi,((e,t)=>(t||(e=e.filter((e=>e.fullscreen))),e.map((e=>e.windowId))))),Ui=function(e,t,n){const i=(0,Le.useCallback)((e=>{e.preventDefault(),e.stopPropagation(),t&&t();let{clientX:i,clientY:o}=e.touches?e.touches[0]:e;const s=e=>{e.preventDefault(),e.stopPropagation();const{clientX:t,clientY:s}=e.touches?e.touches[0]:e;n(t-i,s-o),i=t,o=s};document.addEventListener("mousemove",s),document.addEventListener("touchmove",s);const r=e=>{e.preventDefault(),e.stopPropagation(),document.removeEventListener("mousemove",s),document.removeEventListener("touchmove",s),document.removeEventListener("mouseup",r),document.removeEventListener("touchcancel",r),document.removeEventListener("touchend",r)};document.addEventListener("mouseup",r),document.addEventListener("touchcancel",r),document.addEventListener("touchend",r)}),[t,n]);(0,Le.useEffect)((()=>{const t=e.current;if(t)return t.addEventListener("mousedown",i,{passive:!1}),t.addEventListener("touchstart",i,{passive:!1}),()=>{t.removeEventListener("mousedown",i),t.removeEventListener("touchstart",i)}}),[e,i])};var Vi,Gi=n(2585);function Fi(e,t,n,i){Vi||(Vi="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var o=e&&e.defaultProps,s=arguments.length-3;if(t||0===s||(t={children:void 0}),1===s)t.children=i;else if(s>1){for(var r=new Array(s),a=0;a<s;a++)r[a]=arguments[a+3];t.children=r}if(t&&o)for(var l in o)void 0===t[l]&&(t[l]=o[l]);else t||(t=o||{});return{$$typeof:Vi,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}const zi=()=>{const[e,t]=(0,Le.useState)(""),[n,i]=(0,Le.useState)(!1),s=(0,Pe.I0)();return Fi("p",{},void 0,Fi("input",{style:{display:"inline-block",width:"100%",maxWidth:"18em"},readOnly:!0,value:e}),e?Fi("button",{type:"button",onClick:()=>{(0,o.Z)(e),s((0,d.h4)("Copied"))}},"cobtn","کپی"):Fi("button",{type:"button",onClick:async()=>{i(!0);const e=await(0,z.JL)();e.iid&&t(e.iid),i(!1)}},"subtn",n?"...":"آیدی بگیر"))},Bi=Le.memo(zi);var Zi,ji,Ki,Yi,qi,Qi,Xi,Ji,eo,to,no,io,oo,so,ro,ao,lo,co,uo,ho,fo,po,vo,mo,go,wo,yo,bo,So,Eo,Co,To,ko,Io,xo,_o,No,Ao,Oo,Lo,Po,Ro;function $o(e,t,n,i){Ro||(Ro="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var o=e&&e.defaultProps,s=arguments.length-3;if(t||0===s||(t={children:void 0}),1===s)t.children=i;else if(s>1){for(var r=new Array(s),a=0;a<s;a++)r[a]=arguments[a+3];t.children=r}if(t&&o)for(var l in o)void 0===t[l]&&(t[l]=o[l]);else t||(t=o||{});return{$$typeof:Ro,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}var Do,Mo,Wo=n(888);function Ho(e,t,n,i){Mo||(Mo="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var o=e&&e.defaultProps,s=arguments.length-3;if(t||0===s||(t={children:void 0}),1===s)t.children=i;else if(s>1){for(var r=new Array(s),a=0;a<s;a++)r[a]=arguments[a+3];t.children=r}if(t&&o)for(var l in o)void 0===t[l]&&(t[l]=o[l]);else t||(t=o||{});return{$$typeof:Mo,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}const Uo=Le.memo((e=>{let{title:t,keyBind:n,value:i,onToggle:o,children:s,deactivated:r}=e;return Ho("div",{className:"setitem"},void 0,Ho("div",{className:"setrow"},void 0,Ho("h3",{className:"settitle"},void 0,t," ",n&&Ho("kbd",{},void 0,n)),Ho(Wo.Z,{checked:i,onChange:o,disabled:r})),Ho("div",{className:"modaldesc"},void 0,s),Do||(Do=Ho("div",{className:"modaldivider"})))}),((e,t)=>e.value===t.value));var Vo;function Go(e,t,n,i){Vo||(Vo="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var o=e&&e.defaultProps,s=arguments.length-3;if(t||0===s||(t={children:void 0}),1===s)t.children=i;else if(s>1){for(var r=new Array(s),a=0;a<s;a++)r[a]=arguments[a+3];t.children=r}if(t&&o)for(var l in o)void 0===t[l]&&(t[l]=o[l]);else t||(t=o||{});return{$$typeof:Vo,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}const Fo=function(){const[e,t]=(0,Le.useState)(window.ssv.lang),[n,i]=(0,Le.useState)("xx");return(0,Le.useEffect)((()=>{const{langs:t}=window.ssv;for(let n=0;n<t.length;n+=1){const[o,s]=t[n];if(o===e)return void i(s)}}),[e]),navigator.cookieEnabled?Go("div",{style:{textAlign:"right"}},void 0,Go("span",{},void 0,Go("select",{value:e,onChange:e=>{const n=e.target;t(n.options[n.selectedIndex].value)}},void 0,window.ssv.langs.map((e=>{let[t]=e;return Go("option",{value:t},t,t.toUpperCase())})))),"  ",Go("span",{},void 0,Go("img",{style:{height:"1em",imageRendering:"crisp-edges"},alt:"",src:`/cf/${n}.gif`})),Go("button",{type:"submit",style:{display:"block",margin:5},onClick:()=>{const t=new Date;t.setTime(t.getTime()+24*c.vc);let{hostname:n}=window.location;n=n.lastIndexOf(".")!==n.indexOf(".")?n.slice(n.indexOf(".")):`.${n}`,document.cookie=`plang=${e};expires=${t.toUTCString()};path=/;domain=${n}`,window.location.reload()}},void 0,"ذخیره")):null};var zo;function Bo(e,t,n,i){zo||(zo="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var o=e&&e.defaultProps,s=arguments.length-3;if(t||0===s||(t={children:void 0}),1===s)t.children=i;else if(s>1){for(var r=new Array(s),a=0;a<s;a++)r[a]=arguments[a+3];t.children=r}if(t&&o)for(var l in o)void 0===t[l]&&(t[l]=o[l]);else t||(t=o||{});return{$$typeof:zo,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}const Zo=e=>{let{enabled:t,title:n,canvasId:i,x:o,y:r,width:a,height:c,imageId:d,startEditing:u}=e;const h=(0,Le.useRef)(),f=(0,Pe.v9)((e=>e.canvas.canvases)),p=(0,Pe.I0)();return(0,Le.useEffect)((()=>{(async()=>{if(!d||!h.current)return;const e=await X.getTemplate(d);if(!e)return;const t=await createImageBitmap(e);h.current.getContext("bitmaprenderer").transferFromImageBitmap(t),t.close()})()}),[d]),Bo("div",{className:t?"tmpitm":"tmpitm disabled",style:{cursor:"pointer"},onClick:()=>p(l(n,{enabled:!t}))},void 0,Bo("div",{className:"tmpitm-preview"},void 0,Le.createElement("canvas",{className:"tmpitm-img",ref:h,key:"showimg",width:a,height:c})),Bo("div",{className:"tmpitm-desc"},void 0,Bo("h4",{},void 0,n),Bo("p",{},void 0,"بوم",": ",Bo("span",{},void 0,f[i]?.title)),Bo("p",{},void 0,"Coordinates",": ",Bo("span",{},void 0,`${o},${r}`)),Bo("p",{},void 0,"ابعاد",": ",Bo("span",{},void 0,`${a} x ${c}`))),Bo("div",{className:"tmpitm-actions"},void 0,Bo("button",{onClick:e=>{e.stopPropagation(),u(n)},type:"button"},void 0,"Edit"),Bo("button",{onClick:e=>{e.stopPropagation(),p((0,s.SC)(i)),p((0,s.w5)([o+a/2,r+c/2]))},type:"button"},void 0,"Go to")))},jo=Le.memo(Zo);var Ko;function Yo(e,t,n,i){Ko||(Ko="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var o=e&&e.defaultProps,s=arguments.length-3;if(t||0===s||(t={children:void 0}),1===s)t.children=i;else if(s>1){for(var r=new Array(s),a=0;a<s;a++)r[a]=arguments[a+3];t.children=r}if(t&&o)for(var l in o)void 0===t[l]&&(t[l]=o[l]);else t||(t=o||{});return{$$typeof:Ko,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}const qo=e=>{let{title:t,canvasId:n,x:i,y:o,imageId:s,stopEditing:r}=e;const[a]=(0,Le.useMemo)((()=>[Number.isNaN(parseInt(i,10))||Number.isNaN(parseInt(o,10))?null:[i,o]]),[i,o]),[l,c]=(0,Le.useState)(a),[d,u]=(0,Le.useState)(null),[h,f]=(0,Le.useState)(t||""),[p,v]=(0,Le.useState)(null),[m,g]=(0,Le.useState)(!0),w=(0,Le.useRef)(),y=(0,Le.useRef)(),[b,S,C]=(0,Pe.v9)((e=>[e.canvas.canvasId,e.canvas.canvases,e.templates.list]),Pe.wU),[T,k]=(0,Le.useState)(n??b);(0,Le.useEffect)((()=>{(async()=>{if(!s||!w.current)return;const e=await X.getTemplate(s);if(!e)return;const t=await createImageBitmap(e),n=w.current,{width:i,height:o}=t;n.width=i,n.height=o,n.getContext("bitmaprenderer").transferFromImageBitmap(t),u([i,o]),t.close()})()}),[s]),(0,Le.useEffect)((()=>{p&&w.current&&(async()=>{const e=await createImageBitmap(p),t=w.current,{width:n,height:i}=e;t.width=n,t.height=i,t.getContext("bitmaprenderer").transferFromImageBitmap(e),u([n,i]),e.close()})()}),[p]);const I=w.current&&(p||s)&&m&&l&&h&&d;return Yo("div",{className:"tmpitm"},void 0,Yo("div",{className:"tmpitm-preview"},void 0,Yo("div",{style:{width:"100%",height:"100%"}},void 0,Le.createElement("canvas",{className:"tmpitm-img",ref:w,key:"editimg",style:{opacity:.4}})),Yo("div",{className:"centered-on-img modallink",onClick:()=>y.current?.click()},void 0,"Select File"),Le.createElement("input",{type:"file",key:"hinpt",accept:"image/*",ref:y,style:{display:"none"},onChange:e=>{u(null),v(e.target.files?.[0])}})),Yo("div",{className:"tmpitm-desc"},void 0,Yo("h4",{},void 0,Yo("input",{value:h,style:{width:"10em"},type:"text",onChange:e=>{const t=e.target.value;g(!C.some((e=>e.title===t))),f(e.target.value)},placeholder:"Template Name"})),Yo("p",{},void 0,"بوم",": ",Yo("span",{},void 0,Yo("select",{value:T,onChange:e=>{const t=e.target;k(t.options[t.selectedIndex].value)}},void 0,Object.keys(S).filter((e=>!S[e].v&&!S[e].ed)).map((e=>Yo("option",{value:e},e,S[e].title)))))),Yo("p",{},void 0,"Coordinates",": ",Yo("span",{},void 0,Yo("input",{type:"text",defaultValue:l&&l.join("_"),style:{display:"inline-block",maxWidth:"8em"},placeholder:"X_Y or URL",onChange:e=>{const t=(0,E._I)(e.target.value.trim());t&&(e.target.value=t.join("_")),c(t)}}))),Yo("p",{},void 0,"ابعاد",": ",Yo("span",{},void 0,d?d.join(" x "):"N/A"))),Yo("div",{className:"tmpitm-actions"},void 0,t&&Yo("button",{onClick:()=>{r(t),X.deleteTemplate(t)},type:"button"},void 0,"Delete"),Yo("button",{onClick:()=>r(h),type:"button"},void 0,"لغو"),Yo("button",{disabled:!I,onClick:async()=>{if(!I)return;const[e,a]=l;t?(p&&s&&await X.updateFile(s,p),!t||t===h&&i===e&&o===a&&n===T||X.changeTemplate(t,{title:h,canvasId:T,x:e,y:a})):await X.addFile(p,h,T,e,a),r(t)},type:"button"},void 0,"ذخیره")))},Qo=Le.memo(qo);var Xo,Jo;function es(e,t,n,i){Jo||(Jo="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var o=e&&e.defaultProps,s=arguments.length-3;if(t||0===s||(t={children:void 0}),1===s)t.children=i;else if(s>1){for(var r=new Array(s),a=0;a<s;a++)r[a]=arguments[a+3];t.children=r}if(t&&o)for(var l in o)void 0===t[l]&&(t[l]=o[l]);else t||(t=o||{});return{$$typeof:Jo,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}const ts=()=>{const[e,t]=(0,Le.useState)(!1),[n,i,o,s,r,a]=(0,Pe.v9)((e=>[e.templates.list,e.templates.ovEnabled,e.templates.oSmallPxls,e.templates.oOpacity,e.templates.oRightShift,e.user.isOnMobile]),Pe.wU),[l,c]=(0,Le.useState)([]),d=(0,Le.useCallback)((()=>t(!1)),[]),u=(0,Le.useRef)(),h=(0,Pe.I0)(),f=(0,Le.useCallback)((e=>{const t=n.findIndex((t=>t.title===e)),i=l.indexOf(t);c(-1===i?[...l,t]:l.toSpliced(i,1))}),[n,l]);return Le.createElement(Le.Fragment,null,es("h2",{},void 0,"Templates"),es("p",{},void 0,"Tired of always spaming one single color? Want to create art instead, but you have to count pixels from some other image? Templates can help you with that! Templates can show as overlay and you can draw over them. One pixel on the template, should be one pixel on the canvas."),es(Uo,{title:"Enable Overlay",keyBind:"T",value:i,onToggle:()=>h({type:"s/TGL_OVENABLED"})},void 0,"Show templates as overlays ingame."),es(Uo,{title:"Small Pixels When Zoomed",value:o,onToggle:()=>h({type:"s/TGL_SMALLPXLS"})},void 0,"Show overlay as small individual pixels on high zoomlevels."),es("div",{className:"setitem"},void 0,es("div",{className:"setrow"},void 0,es("h3",{className:"settitle"},void 0,"Overlay Opacity"),es("div",{style:{textAlign:"right"}},void 0,es("input",{type:"number",value:s,style:{maxWidth:"6em"},step:"1",min:"10",max:"100",onChange:e=>h({type:"s/SET_O_OPACITY",opacity:e.target.value})}))),es("div",{className:"modaldesc"},void 0,"Opacity of Overlay in percent."),Xo||(Xo=es("div",{className:"modaldivider"}))),!a&&es(Uo,{title:"Right-Shift Auto-Color",value:r,onToggle:()=>h({type:"s/TGL_RIGHTSHIFT"})},void 0,"Place pixels from overlay on right-shift, instead of history."),n.map(((e,t)=>{let{enabled:n,imageId:i,canvasId:o,title:s,x:r,y:a,width:c,height:d}=e;return l.includes(t)?es(Qo,{enabled:n,title:s,imageId:i,canvasId:o,x:r,y:a,stopEditing:f},t):es(jo,{enabled:n,title:s,imageId:i,canvasId:o,x:r,y:a,width:c,height:d,startEditing:f},t)})),e&&es(Qo,{stopEditing:d}),e?es("span",{role:"button",tabIndex:-1,className:"modallink",onClick:()=>d()},void 0," ","Cancel adding Template"):es("span",{role:"button",tabIndex:-1,className:"modallink",onClick:()=>t(!0)},void 0," ","Add Template"),n.some((e=>e.enabled))&&es(Le.Fragment,{},"exps"," | ",es("span",{role:"button",tabIndex:-1,className:"modallink",onClick:async()=>{const e=await X.exportEnabledTemplates();e&&Wt()(JSON.stringify(e),"PixelplanetTemplates.json")}},void 0,"Export enabled templates"))," | ",es("span",{role:"button",tabIndex:-1,className:"modallink",onClick:async()=>u.current?.click()},void 0,"Import templates"),Le.createElement("input",{type:"file",key:"impin",ref:u,style:{display:"none"},onChange:e=>{X.importTemplates(e.target.files?.[0])}}))};var ns,is,os,ss,rs;function as(e,t,n,i){rs||(rs="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var o=e&&e.defaultProps,s=arguments.length-3;if(t||0===s||(t={children:void 0}),1===s)t.children=i;else if(s>1){for(var r=new Array(s),a=0;a<s;a++)r[a]=arguments[a+3];t.children=r}if(t&&o)for(var l in o)void 0===t[l]&&(t[l]=o[l]);else t||(t=o||{});return{$$typeof:rs,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}const ls=e=>{let{title:t,values:n,selected:i,onSelect:o,icon:s,children:r}=e;return as("div",{className:"setitem"},void 0,as("div",{className:"setrow"},void 0,as("h3",{className:"settitle"},void 0,t),s&&as("img",{alt:"",src:s}),as("select",{value:i,onChange:e=>{const t=e.target;o(t.options[t.selectedIndex].value)}},void 0,n.map((e=>as("option",{value:e},e,e))))),as("div",{className:"modaldesc"},void 0,r),ns||(ns=as("div",{className:"modaldivider"})))},cs=()=>{const[e,t,n,i,o,r,a,l,c,d,u,h]=(0,Pe.v9)((e=>[e.gui.showGrid,e.gui.showPixelNotify,e.gui.showMvmCtrls,e.gui.autoZoomIn,e.gui.compactPalette,e.gui.isPotato,e.gui.isLightGrid,e.gui.style,e.gui.mute,e.gui.chatNotify,e.canvas.isHistoricalView,e.templates.available]),Pe.wU),f=(0,Pe.I0)(),p=window.AudioContext||window.webkitAudioContext;return as("div",{className:"content"},void 0,as(Uo,{title:"شبکه رو نشون بده",keyBind:"G",value:e,onToggle:()=>f((0,s.xK)())},void 0,"شبکه رو روشن کن که مرز های دور پیکسل ها نشون داده بشه."),as(Uo,{title:"فعالیت پیکسل ها رو نشون بده",keyBind:"X",value:t,onToggle:()=>f((0,s.Xb)())},void 0,"دور پیکسل هایی که گذاشته میشن دایره بزار."),as(Uo,{title:"Always show Movement Controls",keyBind:"N",value:n,onToggle:()=>f((0,s.qP)())},void 0,"Always show movement control buttons"),as(Uo,{title:"صدا های بازی رو غیرفعال کن",keyBind:"M",deactivated:!p,value:!p||c,onToggle:()=>f((0,s.$t)())},void 0,["تمامی افکت های صدا غیرفعال میشه.",!p&&as("p",{className:"warn"},void 0,"مرورگر شما به ما اجازه نمی دهد از AudioContext برای پخش صداها استفاده کنیم. آیا برخی از ویژگی های حفظ حریم خصوصی ما را مسدود می کند؟")]),as(Uo,{title:"نوتیفیکیشن های چت رو فعال کن",value:d,onToggle:()=>f((0,s.c7)())},void 0,"وقتی یه پیام جدید میاد یه صدایی بده"),as(Uo,{title:"زوم اتوماتیک بزرگتر",value:i,onToggle:()=>f((0,s.o7)())},void 0,"وقتی که بومت کوچیکه و میخوای پیکسل بزاری، بجای پیکسل گذاشتن زوم کن."),as(Uo,{title:"حعبه رنگ فشرده",value:o,onToggle:()=>f((0,s.Cd)())},void 0,"جعبه رنگ رو فشرده کن که فضای کمتری بگیره."),as(Uo,{title:"حالت سیب زمینی",value:r,onToggle:()=>f((0,s.RL)())},void 0,"برای موقعی که داری روی ذغال بازی میکنی."),as(Uo,{title:"پس زمینه روشن",value:a,onToggle:()=>f((0,s.ts)())},void 0,"پس زمینه رو بجای اینکه سفید نشون بده، سیاه نشون بده."),window.ssv&&window.ssv.backupurl&&as(Uo,{title:"حالت تاریخی",value:u,keyBind:"H",onToggle:()=>f((0,s.FI)())},void 0,"نسخه های قدیمی این بوم رو نشون بده."),window.ssv&&window.ssv.availableStyles&&as(ls,{title:"تِم ها",values:Object.keys(window.ssv.availableStyles),selected:l,onSelect:e=>f((0,s.MM)(e))},void 0,"پیکسل پلنت باید چطوری دیده بشه."),window.ssv&&navigator.cookieEnabled&&window.ssv.langs&&as("div",{className:"setitem"},void 0,as("div",{className:"setrow"},void 0,as("h3",{className:"settitle"},void 0,"زبانت رو انتخاب کن"),is||(is=as(Fo,{})))),os||(os=as("div",{className:"modaldivider"})),h&&(ss||(ss=as(ts,{}))))},ds=Le.memo(cs),us=/^[-!#$%&'*+\/0-9=?A-Z^_a-z{|}~](\.?[-!#$%&'*+\/0-9=?A-Z^_a-z`{|}~])*@[a-zA-Z0-9](-*\.?[a-zA-Z0-9])*\.[a-zA-Z](-?[a-zA-Z0-9])+$/;function hs(e){return e?e.length<5?"ایمیل باید حداقل پنج تا کلمه داشته باشه.":e.length>40?"نمیشه که ایمیل بیشتر از چهل تا کلمه داشته باشه.":-1===e.indexOf(".")?"ایمیل باید نقطه داشته باشه":1!==e.split("").filter((e=>"@"===e)).length?"ایمیل باید حتما @ داشته باشه":!us.test(e)&&"Your Email looks shady":"سید ایمیل خالی نمیشه که بزاری."}function fs(e){return e?e.length<2?"اسم باید بیشتر از دو تا کلمه داشته باشه":e.length>26?"اسم باید کمتر از 26 تا کلمه باشه":(-1!==e.indexOf("@")||-1!==e.indexOf("/")||-1!==e.indexOf("\\")||-1!==e.indexOf(">")||-1!==e.indexOf("<")||-1!==e.indexOf("#"))&&"اسم نباید @ یا # یا / از این چیزا داشته باشه":"اسم نمیشه که خالی باشه سید."}function ps(e){return e?e.length<6?"رمز باید حداقل شیش تا کلمه داشته باشه.":e.length>60&&"داداش چخبره باید کمتر از شصت تا کلمه باشه پسوردت.":"داداش رمز نزاشتی."}var vs,ms;function gs(e,t,n,i){ms||(ms="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var o=e&&e.defaultProps,s=arguments.length-3;if(t||0===s||(t={children:void 0}),1===s)t.children=i;else if(s>1){for(var r=new Array(s),a=0;a<s;a++)r[a]=arguments[a+3];t.children=r}if(t&&o)for(var l in o)void 0===t[l]&&(t[l]=o[l]);else t||(t=o||{});return{$$typeof:ms,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}const ws={display:"inline-block",width:"75%",maxWidth:"35em"},ys=()=>{const[e,t]=(0,Le.useState)(""),[n,i]=(0,Le.useState)(""),[o,r]=(0,Le.useState)(!1),[a,l]=(0,Le.useState)([]),c=(0,Pe.I0)();return gs("form",{onSubmit:async t=>{if(t.preventDefault(),o)return;const i=function(e,t){const n=[],i=-1!==e.indexOf("@")?hs(e):fs(e);i&&n.push(i);const o=ps(t);return o&&n.push(o),n}(e,n);if(i.length>0)return void l(i);r(!0);const{errors:a,me:d}=await(0,z.Pw)(e,n);r(!1),a?l(a):c((0,s.pH)(d))}},void 0,a.map((e=>gs("p",{},e,gs("span",{},void 0,"ارور"),": ",e))),gs("input",{value:e,style:ws,onChange:e=>t(e.target.value),type:"text",placeholder:"اسم یا ایمیل"}),vs||(vs=gs("br",{})),gs("input",{value:n,style:ws,onChange:e=>i(e.target.value),type:"password",placeholder:"پسورد"}),gs("p",{},void 0,gs("button",{type:"submit"},void 0,o?"...":"وارد شدن")))},bs=Le.memo(ys);var Ss,Es,Cs,Ts,ks,Is,xs,_s;function Ns(e,t,n,i){_s||(_s="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var o=e&&e.defaultProps,s=arguments.length-3;if(t||0===s||(t={children:void 0}),1===s)t.children=i;else if(s>1){for(var r=new Array(s),a=0;a<s;a++)r[a]=arguments[a+3];t.children=r}if(t&&o)for(var l in o)void 0===t[l]&&(t[l]=o[l]);else t||(t=o||{});return{$$typeof:_s,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}const As={marginRight:5},Os=()=>{const e=Je();return Ns("div",{style:{textAlign:"center"}},void 0,Ns("p",{},void 0,"برای دسترسی به ویژگی ها و آمار بیشتر وارد شوید."),Ss||(Ss=Ns("br",{})),Ns("h2",{},void 0,"با نام یا ایمیل وارد شوید:"),Es||(Es=Ns(bs,{})),Ns("p",{className:"modallink",onClick:()=>e("FORGOT_PASSWORD"),role:"presentation"},void 0,"رمز یادم رفته."),Ns("h2",{},void 0,"یا با :"),Cs||(Cs=Ns("a",{href:"/api/auth/discord"},void 0,Ns("img",{style:As,width:32,src:"/discordlogo.svg",alt:"Discord"}))),Ts||(Ts=Ns("a",{href:"/api/auth/google"},void 0,Ns("img",{style:As,width:32,src:"/googlelogo.svg",alt:"Google"}))),ks||(ks=Ns("a",{href:"/api/auth/facebook"},void 0,Ns("img",{style:As,width:32,src:"/facebooklogo.svg",alt:"Facebook"}))),Is||(Is=Ns("a",{href:"/api/auth/vk"},void 0,Ns("img",{style:As,width:32,src:"/vklogo.svg",alt:"VK"}))),xs||(xs=Ns("a",{href:"/api/auth/reddit"},void 0,Ns("img",{style:As,width:32,src:"/redditlogo.svg",alt:"Reddit"}))),Ns("h2",{},void 0,"یا اینجا ثبت نام کنید:"),Ns("button",{type:"button",onClick:()=>e("REGISTER")},void 0,"ثبت نام"))},Ls=Le.memo(Os);var Ps;function Rs(e,t,n,i){Ps||(Ps="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var o=e&&e.defaultProps,s=arguments.length-3;if(t||0===s||(t={children:void 0}),1===s)t.children=i;else if(s>1){for(var r=new Array(s),a=0;a<s;a++)r[a]=arguments[a+3];t.children=r}if(t&&o)for(var l in o)void 0===t[l]&&(t[l]=o[l]);else t||(t=o||{});return{$$typeof:Ps,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}const $s=e=>{let{onClick:t,active:n,label:i}=e,o="tab-list-item";return n&&(o+=" active"),Rs("li",{role:"presentation",className:o,onClick:()=>t(i)},void 0,i)};var Ds;function Ms(e,t,n,i){Ds||(Ds="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var o=e&&e.defaultProps,s=arguments.length-3;if(t||0===s||(t={children:void 0}),1===s)t.children=i;else if(s>1){for(var r=new Array(s),a=0;a<s;a++)r[a]=arguments[a+3];t.children=r}if(t&&o)for(var l in o)void 0===t[l]&&(t[l]=o[l]);else t||(t=o||{});return{$$typeof:Ds,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}const Ws=e=>{let{children:t,activeTab:n,setActiveTab:i}=e;return Ms("div",{className:"tabs"},void 0,Ms("ol",{className:"tab-list"},void 0,t.map((e=>{if(!e.props)return;const{label:t}=e.props;return Ms($s,{active:n===t,label:t,onClick:e=>i(e)},t)}))),Ms("div",{className:"tab-content"},void 0,t.map((e=>{if(e.props&&e.props.label===n)return e.props.children}))))};var Hs;function Us(e,t,n,i){Hs||(Hs="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var o=e&&e.defaultProps,s=arguments.length-3;if(t||0===s||(t={children:void 0}),1===s)t.children=i;else if(s>1){for(var r=new Array(s),a=0;a<s;a++)r[a]=arguments[a+3];t.children=r}if(t&&o)for(var l in o)void 0===t[l]&&(t[l]=o[l]);else t||(t=o||{});return{$$typeof:Hs,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}const Vs=()=>{const[e,t]=(0,Le.useState)(!1),[n,i]=(0,Le.useState)(null),o=(0,Pe.v9)((e=>e.user.messages));return o?Us("div",{style:{paddingLeft:"5%",paddingRight:"5%"}},void 0,o.includes("not_verified")&&Us("p",{className:"usermessages"},void 0,"لطفاً آدرس ایمیل خود را تأیید کنید، در غیر این صورت حساب شما ممکن است پس از چند روز حذف شود.",n?Us("span",{className:"modallink"},void 0,n):Us("span",{role:"button",tabIndex:-1,className:"modallink",onClick:async()=>{if(e)return;t(!0);const{errors:n}=await(0,z.ft)(),o=n?n[0]:"یک ایمیل تأیید جدید برای شما ارسال می شود.";i(o)}},void 0,"برای درخواست یک ایمیل تأیید جدید اینجا را کلیک کنید.")),o.map((e=>"not_verified"===e?null:Us("p",{className:"usermessages"},e,e)))):null},Gs=Le.memo(Vs);var Fs,zs,Bs,Zs;function js(e,t,n,i){Zs||(Zs="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var o=e&&e.defaultProps,s=arguments.length-3;if(t||0===s||(t={children:void 0}),1===s)t.children=i;else if(s>1){for(var r=new Array(s),a=0;a<s;a++)r[a]=arguments[a+3];t.children=r}if(t&&o)for(var l in o)void 0===t[l]&&(t[l]=o[l]);else t||(t=o||{});return{$$typeof:Zs,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}const Ks=e=>{let{done:t}=e;const[n,i]=(0,Le.useState)(""),[o,r]=(0,Le.useState)(""),[a,l]=(0,Le.useState)(""),[c,d]=(0,Le.useState)(!1),[u,h]=(0,Le.useState)(!1),[f,p]=(0,Le.useState)([]),v=(0,Pe.v9)((e=>e.user.mailreg)),m=(0,Pe.I0)();return c?js("div",{className:"inarea"},void 0,js("p",{className:"modalmessage"},void 0,"Password successfully changed."),js("button",{type:"button",onClick:t},void 0,"Close")):js("div",{className:"inarea"},void 0,js("form",{onSubmit:async e=>{if(e.preventDefault(),u)return;const t=function(e,t,n,i){const o=[];if(e){const e=ps(t);e&&o.push(e)}if(n!==i)return o.push("رمزهای ورود مطابقت ندارند."),o;const s=ps(n);return s&&o.push(s),o}(v,n,o,a);if(p(t),t.length)return;h(!0);const{errors:i}=await(0,z.Oh)(o,n);if(i)return p(i),void h(!1);m((0,s.Y2)(!0)),d(!0)}},void 0,f.map((e=>js("p",{className:"errormessage"},e,js("span",{},void 0,"ارور"),": ",e))),v&&js("input",{value:n,onChange:e=>i(e.target.value),type:"password",placeholder:"رمز قدیمی"}),Fs||(Fs=js("br",{})),js("input",{value:o,onChange:e=>r(e.target.value),type:"password",placeholder:"رمز جدید"}),zs||(zs=js("br",{})),js("input",{value:a,onChange:e=>l(e.target.value),type:"password",placeholder:"رمز عبور جدید را تأیید کنید"}),Bs||(Bs=js("br",{})),js("button",{type:"submit"},void 0,u?"...":"ذخیره"),js("button",{type:"button",onClick:t},void 0,"لغو")))},Ys=Le.memo(Ks);var qs,Qs;function Xs(e,t,n,i){Qs||(Qs="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var o=e&&e.defaultProps,s=arguments.length-3;if(t||0===s||(t={children:void 0}),1===s)t.children=i;else if(s>1){for(var r=new Array(s),a=0;a<s;a++)r[a]=arguments[a+3];t.children=r}if(t&&o)for(var l in o)void 0===t[l]&&(t[l]=o[l]);else t||(t=o||{});return{$$typeof:Qs,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}const Js=e=>{let{done:t}=e;const[n,i]=(0,Le.useState)(""),[o,r]=(0,Le.useState)(!1),[a,l]=(0,Le.useState)([]),c=(0,Pe.I0)();return Xs("div",{className:"inarea"},void 0,Xs("form",{onSubmit:async e=>{if(e.preventDefault(),o)return;const i=function(e){const t=[],n=fs(e);return n&&t.push(n),t}(n);if(i.length>0)return void l(i);r(!0);const{errors:a}=await(0,z.Wt)(n);r(!1),a?l(a):(c((0,s.qC)(n)),t())}},void 0,a.map((e=>Xs("p",{className:"errormessage"},e,Xs("span",{},void 0,"ارور"),": ",e))),Xs("input",{value:n,onChange:e=>i(e.target.value),type:"text",placeholder:"نام کاربری جدید"}),qs||(qs=Xs("br",{})),Xs("button",{type:"submit"},void 0,o?"...":"ذخیره"),Xs("button",{type:"button",onClick:t},void 0,"لغو")))};var er,tr,nr;function ir(e,t,n,i){nr||(nr="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var o=e&&e.defaultProps,s=arguments.length-3;if(t||0===s||(t={children:void 0}),1===s)t.children=i;else if(s>1){for(var r=new Array(s),a=0;a<s;a++)r[a]=arguments[a+3];t.children=r}if(t&&o)for(var l in o)void 0===t[l]&&(t[l]=o[l]);else t||(t=o||{});return{$$typeof:nr,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}const or=e=>{let{done:t}=e;const[n,i]=(0,Le.useState)(""),[o,s]=(0,Le.useState)(""),[r,a]=(0,Le.useState)(!1),[l,c]=(0,Le.useState)(!1),[d,u]=(0,Le.useState)([]);return l?ir("div",{className:"inarea"},void 0,ir("p",{className:"modalmessage"},void 0,"ایمیل با موفقیت تغییر کرد. ما یک ایمیل تأیید برای شما ارسال کردیم،               لطفا آدرس ایمیل جدید خود را تأیید کنید."),ir("button",{type:"button",onClick:t},void 0,"Close")):ir("div",{className:"inarea"},void 0,ir("form",{onSubmit:async e=>{if(e.preventDefault(),r)return;const t=function(e,t){const n=[],i=ps(t);i&&n.push(i);const o=hs(e);return o&&n.push(o),n}(o,n);if(t.length>0)return void u(t);a(!0);const{errors:i}=await(0,z.fF)(o,n);a(!1),i?u(i):c(!0)}},void 0,d.map((e=>ir("p",{className:"errormessage"},e,ir("span",{},void 0,"ارور"),": ",e))),ir("input",{value:n,onChange:e=>i(e.target.value),type:"password",placeholder:"پسورد"}),er||(er=ir("br",{})),ir("input",{value:o,onChange:e=>s(e.target.value),type:"text",placeholder:"ایمیل جدید"}),tr||(tr=ir("br",{})),ir("button",{type:"submit"},void 0,r?"...":"ذخیره"),ir("button",{type:"button",onClick:t},void 0,"لغو")))};var sr,rr;function ar(e,t,n,i){rr||(rr="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var o=e&&e.defaultProps,s=arguments.length-3;if(t||0===s||(t={children:void 0}),1===s)t.children=i;else if(s>1){for(var r=new Array(s),a=0;a<s;a++)r[a]=arguments[a+3];t.children=r}if(t&&o)for(var l in o)void 0===t[l]&&(t[l]=o[l]);else t||(t=o||{});return{$$typeof:rr,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}const lr=e=>{let{done:t}=e;const[n,i]=(0,Le.useState)(""),[o,r]=(0,Le.useState)(!1),[a,l]=(0,Le.useState)([]),c=(0,Pe.I0)();return ar("div",{className:"inarea",style:{backgroundColor:"#ff6666"}},void 0,ar("form",{onSubmit:async e=>{if(e.preventDefault(),o)return;const t=function(e){const t=[],n=ps(e);return n&&t.push(n),t}(n);if(t.length>0)return void l(t);r(!0);const{errors:i}=await(0,z.s$)(n);r(!1),i?l(i):c((0,s.TX)())}},void 0,a.map((e=>ar("p",{className:"errormessage"},e,ar("span",{},void 0,"ارور"),": ",e))),ar("input",{value:n,onChange:e=>i(e.target.value),type:"password",placeholder:"پسورد"}),sr||(sr=ar("br",{})),ar("button",{type:"submit"},void 0,o?"...":"آره، اکانتم رو پاک کن!"),ar("button",{type:"button",onClick:t},void 0,"لغو")))};var cr,dr;function ur(e,t,n,i){dr||(dr="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var o=e&&e.defaultProps,s=arguments.length-3;if(t||0===s||(t={children:void 0}),1===s)t.children=i;else if(s>1){for(var r=new Array(s),a=0;a<s;a++)r[a]=arguments[a+3];t.children=r}if(t&&o)for(var l in o)void 0===t[l]&&(t[l]=o[l]);else t||(t=o||{});return{$$typeof:dr,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}const hr=e=>[e.chat.blocked,e.user.blockDm,e.user.priv,e.fetching.fetchingApi],fr=e=>{let{done:t}=e;const[n,i,o,s]=(0,Pe.v9)(hr,Pe.wU),r=(0,Pe.I0)();return ur("div",{className:"inarea"},void 0,ur(Uo,{title:"پیام ها رو مسدود کنید",value:i,onToggle:()=>{s||r((0,d.R0)(!i))}},void 0,"تمام پیام های خصوصی رو مسدود کنید"),ur(Uo,{title:"خصوصی",value:o,onToggle:()=>{s||r((0,d.eg)(!o))}},void 0,"اسم من رو توی امار جهانی نشون نده"),ur("h3",{style:{textAlign:"left",marginLeft:10}},void 0,"کاربران رو غیر مسدود کن"),n.length?ur("span",{className:"unblocklist"},void 0,n.map((e=>ur("div",{role:"button",tabIndex:0,onClick:()=>{s||r((0,d.Ox)(e[0],e[1],!1))}},e[0],`⦸ ${e[1]}`)))):ur("p",{},void 0,"تو هیچ کاربر مسدود شده نداری"),cr||(cr=ur("div",{className:"modaldivider"})),ur("button",{type:"button",onClick:t,style:{margin:10}},void 0,"Done"))};var pr,vr,mr,gr,wr,yr,br;function Sr(e,t,n,i){br||(br="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var o=e&&e.defaultProps,s=arguments.length-3;if(t||0===s||(t={children:void 0}),1===s)t.children=i;else if(s>1){for(var r=new Array(s),a=0;a<s;a++)r[a]=arguments[a+3];t.children=r}if(t&&o)for(var l in o)void 0===t[l]&&(t[l]=o[l]);else t||(t=o||{});return{$$typeof:br,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}const Er={CHANGE_NAME:Le.memo(Js),CHANGE_MAIL:Le.memo(or),CHANGE_PASSWORD:Ys,DELETE_ACCOUNT:Le.memo(lr),SOCIAL_SETTINGS:Le.memo(fr)},Cr=e=>{let{text:t,value:n,rank:i}=e;return Sr("p",{},void 0,Sr("span",{className:"stattext"},void 0,i?`${t}: #`:`${t}: `)," ",Sr("span",{className:"statvalue"},void 0,(0,E.D$)(n)))},Tr=()=>{const[e,t]=(0,Le.useState)("NONE"),n=(0,Pe.I0)(),i=(0,Le.useCallback)((async()=>{await(0,z.e9)()&&n((0,s.TX)())}),[n]),o=(0,Pe.v9)((e=>e.user.mailreg)),r=(0,Pe.v9)((e=>e.user.name)),a=(0,Pe.v9)((e=>({totalPixels:e.ranks.totalPixels,dailyTotalPixels:e.ranks.dailyTotalPixels,ranking:e.ranks.ranking,dailyRanking:e.ranks.dailyRanking})),Pe.wU),l=Er[e];return Sr("div",{className:"content"},void 0,pr||(pr=Sr(Gs,{})),Sr(Cr,{text:"Today Placed Pixels",value:a.dailyTotalPixels}),Sr(Cr,{text:"رتبه روزانه",value:a.dailyRanking,rank:!0}),Sr(Cr,{text:"پیکسل های گذاشته شده",value:a.totalPixels}),Sr(Cr,{text:"رتبه کلی",value:a.ranking,rank:!0}),Sr("div",{},void 0,Sr("p",{},void 0,`اسم شما: ${r}`),"(",Sr("span",{role:"button",tabIndex:-1,className:"modallink",onClick:i},void 0," ","خروج از اکانت"),vr||(vr=Sr("span",{className:"hdivider"})),Sr("span",{role:"button",tabIndex:-1,className:"modallink",onClick:()=>t("CHANGE_NAME")},void 0," ","اسم کاربریت رو عوض کن"),mr||(mr=Sr("span",{className:"hdivider"})),o&&Sr(Le.Fragment,{},"mc",Sr("span",{role:"button",tabIndex:-1,className:"modallink",onClick:()=>t("CHANGE_MAIL")},void 0," ","ایمیلت رو عوض کن"),gr||(gr=Sr("span",{className:"hdivider"}))),Sr("span",{role:"button",tabIndex:-1,className:"modallink",onClick:()=>t("CHANGE_PASSWORD")},void 0," ","پسوردت رو عوض کن"),wr||(wr=Sr("span",{className:"hdivider"})),Sr("span",{role:"button",tabIndex:-1,className:"modallink",onClick:()=>t("DELETE_ACCOUNT")},void 0," ","اکانتت رو پاک کن")," )",yr||(yr=Sr("br",{})),"(",Sr("span",{role:"button",tabIndex:-1,className:"modallink",onClick:()=>t("SOCIAL_SETTINGS")},void 0," ","تنظیمات فضای اجتماعی")," )"),l&&Sr(l,{done:()=>t(null)}))},kr=Le.memo(Tr);var Ir,xr,_r,Nr,Ar,Or,Lr,Pr;function Rr(e,t,n,i){Pr||(Pr="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var o=e&&e.defaultProps,s=arguments.length-3;if(t||0===s||(t={children:void 0}),1===s)t.children=i;else if(s>1){for(var r=new Array(s),a=0;a<s;a++)r[a]=arguments[a+3];t.children=r}if(t&&o)for(var l in o)void 0===t[l]&&(t[l]=o[l]);else t||(t=o||{});return{$$typeof:Pr,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}const $r=Le.lazy((()=>n.e(784).then(n.bind(n,563)))),Dr=Le.lazy((()=>n.e(545).then(n.bind(n,865)))),Mr=Le.lazy((()=>n.e(189).then(n.bind(n,89)))),Wr=()=>{const e=(0,Pe.v9)((e=>e.user.name)),t=(0,Pe.v9)((e=>e.user.userlvl)),n=(0,Pe.v9)((e=>e.ranks.lastFetch)),{args:i,setArgs:o,setTitle:s}=(0,Le.useContext)(Qe),{activeTab:r="پروفایل"}=i,a=(0,Pe.I0)(),l=(0,Le.useCallback)((e=>{o({activeTab:e}),s(e)}),[o,s]);return(0,Xn.Z)((()=>{Date.now()-3e5>n&&a((0,d.mP)())}),3e5),Rr("div",{style:{textAlign:"center"}},void 0,Rr(Ws,{activeTab:r,setActiveTab:l},void 0,Rr("div",{label:"پروفایل"},void 0,e?Ir||(Ir=Rr(kr,{})):xr||(xr=Rr(Ls,{}))),Rr("div",{label:"آمار"},void 0,_r||(_r=Rr(Le.Suspense,{fallback:Rr("div",{},void 0,"Loading...")},void 0,Rr($r,{})))),Rr("div",{label:"تبدیل کننده"},void 0,Nr||(Nr=Rr(Le.Suspense,{fallback:Rr("div",{},void 0,"Loading...")},void 0,Rr(Dr,{})))),t&&Rr("div",{label:"چیزای ادمینا"},void 0,Rr(Le.Suspense,{fallback:Rr("div",{},void 0,"در حال بارگزاری...")},void 0,Ar||(Ar=Rr(Mr,{}))))),Or||(Or=Rr("br",{})),"حتی خوب میشه اگر به گیلدد ما هم عضو بشین:"," ",Rr("a",{href:"./guilded",target:"_blank"},void 0,"Invited to Chat"),Lr||(Lr=Rr("br",{})))},Hr=Le.memo(Wr);var Ur;function Vr(e,t,n,i){Ur||(Ur="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var o=e&&e.defaultProps,s=arguments.length-3;if(t||0===s||(t={children:void 0}),1===s)t.children=i;else if(s>1){for(var r=new Array(s),a=0;a<s;a++)r[a]=arguments[a+3];t.children=r}if(t&&o)for(var l in o)void 0===t[l]&&(t[l]=o[l]);else t||(t=o||{});return{$$typeof:Ur,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}const Gr=()=>{const[e,t]=(0,Le.useState)(""),[n,i]=(0,Le.useState)([]),[o,r]=(0,Le.useState)(Date.now()),a=(0,Pe.I0)(),l=Je();return Vr("div",{className:"content"},void 0,Vr("form",{style:{paddingLeft:"5%",paddingRight:"5%"},onSubmit:async n=>{if(n.preventDefault(),e)return;const o=n.target.name.value,c=n.target.email.value,d=n.target.password.value,u=n.target.confirmpassword.value,h=n.target.captcha.value,f=n.target.captchaid.value,p=function(e,t,n,i){const o=[],s=hs(t);s&&o.push(s);const r=fs(e);r&&o.push(r);const a=ps(n);return a&&o.push(a),n!==i&&o.push("Passwords do not match"),o}(o,c,d,u);if(p.length>0)return void i(p);t(!0);const{errors:v,me:m}=await(0,z.yx)(o,c,d,h,f);if(t(!1),v)return r(Date.now()),void i(v);a((0,s.pH)(m)),l("USERAREA")}},void 0,Vr("p",{},void 0,"اکانت جدید بساز"),n.map((e=>Vr("p",{className:"errormessage"},e,Vr("span",{},void 0,"ارور"),": ",e))),Vr("h3",{},void 0,"اسم",":"),Vr("input",{name:"name",className:"reginput",autoComplete:"username",type:"text",placeholder:"اسم"}),Vr("h3",{},void 0,"ایمیل",":"),Vr("input",{name:"email",className:"reginput",autoComplete:"email",type:"text",placeholder:"ایمیل"}),Vr("h3",{},void 0,"پسورد",":"),Vr("input",{name:"password",className:"reginput",autoComplete:"new-password",type:"password",placeholder:"پسورد"}),Vr("h3",{},void 0,"دوباره پسورد رو وارد کن",":"),Vr("input",{name:"confirmpassword",className:"reginput",autoComplete:"new-password",type:"password",placeholder:"دوباره پسورد رو وارد کن"}),Vr("h3",{},void 0,"کَپچا",":"),Vr(Zn,{autoload:!1,width:60},o),Vr("button",{type:"submit"},void 0,e?"...":"ارسال"),Vr("button",{type:"button",onClick:()=>l("USERAREA")},void 0,"لغو")))},Fr=Le.memo(Gr);var zr,Br,Zr,jr,Kr,Yr,qr,Qr,Xr,Jr;function ea(e,t,n,i){Jr||(Jr="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var o=e&&e.defaultProps,s=arguments.length-3;if(t||0===s||(t={children:void 0}),1===s)t.children=i;else if(s>1){for(var r=new Array(s),a=0;a<s;a++)r[a]=arguments[a+3];t.children=r}if(t&&o)for(var l in o)void 0===t[l]&&(t[l]=o[l]);else t||(t=o||{});return{$$typeof:Jr,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}const ta=e=>{let{canvasId:t,canvas:n,selCanvas:i,online:o}=e;return ea("div",{className:"cvbtn",onClick:()=>i(t),role:"button",tabIndex:0},void 0,ea("img",{className:"cvimg",alt:"preview",src:`/preview${t}.png`}),ea("div",{className:"modalcvtext"},void 0,ea("h4",{},void 0,n.title),o&&ea(Le.Fragment,{},"online","کاربران انلاین",": ",ea("span",{className:"modalinfo"},void 0,o),zr||(zr=ea("br",{}))),ea("span",{className:"modalinfo"},void 0,n.desc),Br||(Br=ea("br",{})),"کولداون",": ",ea("span",{className:"modalinfo"},void 0,n.pcd&&n.bcd!==n.pcd?ea("span",{},"cdf"," ",n.bcd/1e3,"s / ",n.pcd/1e3,"s"):ea("span",{},"cd"," ",n.bcd/1e3,"s")),Zr||(Zr=ea("br",{})),"انباشته شدن تا",": ",ea("span",{className:"modalinfo"},void 0," ",n.cds/1e3,"s"),jr||(jr=ea("br",{})),"رتبه دار",": ",ea("span",{className:"modalinfo"},void 0,n.ranked?"آره":"نه"),Kr||(Kr=ea("br",{})),void 0!==n.req&&ea(Le.Fragment,{},"req",ea("span",{},void 0,"چیزای مورد نیاز",":",Yr||(Yr=ea("br",{})),ea("span",{className:"modalinfo"},void 0,"number"==typeof n.req?ea("span",{},void 0,"اکانت کاربر"," "):null,n.req>0?ea("span",{},void 0," ",`و ${n.req} تنظیم پیکسل`," "):null,"top"===n.req&&ea("span",{},void 0,"10 رتبه برتر روزانه"))),qr||(qr=ea("br",{}))),"ابعاد",": ",ea("span",{className:"modalinfo"},void 0," ",n.size," x ",n.size,n.v?Qr||(Qr=ea("span",{},"voxsize"," x ",c.Tj," Voxels")):Xr||(Xr=ea("span",{},"pxlsize"," Pixels")))))},na=Le.memo(ta);var ia;function oa(e,t,n,i){ia||(ia="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var o=e&&e.defaultProps,s=arguments.length-3;if(t||0===s||(t={children:void 0}),1===s)t.children=i;else if(s>1){for(var r=new Array(s),a=0;a<s;a++)r[a]=arguments[a+3];t.children=r}if(t&&o)for(var l in o)void 0===t[l]&&(t[l]=o[l]);else t||(t=o||{});return{$$typeof:ia,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}const sa=()=>{const[e,t,n]=(0,Pe.v9)((e=>[e.canvas.canvases,e.gui.easterEgg,e.ranks.online]),Pe.wU),i=(0,Pe.I0)(),o=(0,Le.useCallback)((e=>i((0,s.SC)(e))),[i]),r=Je();return oa("div",{className:"content"},void 0,oa("p",{},void 0,"Select the canvas you want to use.\nEvery canvas is unique and has different palettes, cooldown and requirements.\nArchived canvases can be accessed here:"," ",oa("span",{role:"button",tabIndex:0,className:"modallink",onClick:()=>r("ARCHIVE")},void 0,"آرشیو")),Object.keys(e).sort(((t,n)=>t===window.ssv.dc?-1:n===window.ssv.dc?1:(null!=e[t].linkcd&&(t=e[t].linkcd+.1),null!=e[n].linkcd&&(n=e[n].linkcd+.1),t-n))).map((i=>(!e[i].hid||t)&&!e[i].ed&&oa(na,{online:n[i],canvasId:i,canvas:e[i],selCanvas:o},i))),window.ssv?.backupurl&&Object.keys(e).some((t=>e[t].ed))&&Le.createElement(Le.Fragment,null,oa("h3",{},void 0,"Retired Canvases (history only)"),Object.keys(e).map((t=>e[t].ed&&oa(na,{online:n[t],canvasId:t,canvas:e[t],selCanvas:o},t)))))},ra=Le.memo(sa);var aa,la,ca,da;function ua(e,t,n,i){da||(da="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var o=e&&e.defaultProps,s=arguments.length-3;if(t||0===s||(t={children:void 0}),1===s)t.children=i;else if(s>1){for(var r=new Array(s),a=0;a<s;a++)r[a]=arguments[a+3];t.children=r}if(t&&o)for(var l in o)void 0===t[l]&&(t[l]=o[l]);else t||(t=o||{});return{$$typeof:da,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}var ha,fa=n(9210),pa=n(3935);function va(e,t,n,i){ha||(ha="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var o=e&&e.defaultProps,s=arguments.length-3;if(t||0===s||(t={children:void 0}),1===s)t.children=i;else if(s>1){for(var r=new Array(s),a=0;a<s;a++)r[a]=arguments[a+3];t.children=r}if(t&&o)for(var l in o)void 0===t[l]&&(t[l]=o[l]);else t||(t=o||{});return{$$typeof:ha,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}const ma=e=>{let{args:t,close:n}=e;const i=(0,Pe.v9)((e=>e.chat.channels)),o=(0,Pe.v9)((e=>e.fetching.fetchingApi)),s=(0,Pe.I0)(),{name:r,uid:a,setChannel:l,addToInput:c}=t;return Le.createElement(Le.Fragment,null,va("div",{role:"button",tabIndex:0,onClick:()=>{const e=`@[${(0,E.lg)(r)}](${a})`;c(e),n()},style:{borderTop:"none"}},"ping","پینگ"),va("div",{role:"button",tabIndex:0,onClick:()=>{const e=Object.keys(i);for(let t=0;t<e.length;t+=1){const o=e[t];if(4===i[o].length&&i[o][3]===a)return l(o),void n()}o||s((0,d.YB)({userId:a},l)),n()}},"dm","پیام"),va("div",{role:"button",tabIndex:-1,onClick:()=>{s((0,d.Ox)(a,r,!0)),n()}},"block","بلاک"))};var ga;function wa(e,t,n,i){ga||(ga="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var o=e&&e.defaultProps,s=arguments.length-3;if(t||0===s||(t={children:void 0}),1===s)t.children=i;else if(s>1){for(var r=new Array(s),a=0;a<s;a++)r[a]=arguments[a+3];t.children=r}if(t&&o)for(var l in o)void 0===t[l]&&(t[l]=o[l]);else t||(t=o||{});return{$$typeof:ga,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}const ya=e=>{let{args:t,close:n}=e;const i=(0,Pe.v9)((e=>e.chat.channels)),o=(0,Pe.v9)((e=>e.chatRead.mute)),{cid:r}=t,a=(0,Pe.I0)(),l=o.includes(r);return Le.createElement(Le.Fragment,null,wa("div",{role:"button",onClick:()=>{a(l?(0,s.wC)(r):(0,s.nb)(r))},tabIndex:0,style:{borderTop:"none"}},"mute",(l?"✔":"✘")+" سکوت"),0!==i[r][1]&&wa("div",{role:"button",onClick:()=>{a((0,d.K6)(r)),n()},tabIndex:0},"leave","ببند"))};var ba;function Sa(e,t,n,i){ba||(ba="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var o=e&&e.defaultProps,s=arguments.length-3;if(t||0===s||(t={children:void 0}),1===s)t.children=i;else if(s>1){for(var r=new Array(s),a=0;a<s;a++)r[a]=arguments[a+3];t.children=r}if(t&&o)for(var l in o)void 0===t[l]&&(t[l]=o[l]);else t||(t=o||{});return{$$typeof:ba,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}const Ea={USER:Le.memo(ma),CHANNEL:Le.memo(ya)},Ca=e=>{let{type:t,x:n,y:i,args:o,close:s,align:r}=e;const a=(0,Le.useRef)(null);var l,c;if(l=[a],c=s,(0,Le.useEffect)((()=>{const e=l.some((e=>e.current))?l.map((e=>e.current)):null;if(null===e)return;const t=t=>{e.every((e=>!e||!e.contains(t.target)))&&c()},n=()=>{c()};return document.addEventListener("mousedown",t,{capture:!0}),window.addEventListener("resize",n),()=>{document.removeEventListener("mousedown",t,{capture:!0}),window.removeEventListener("resize",n)}}),[l,c]),!t)return null;const d={};switch(r){case"tr":d.right=window.innerWidth-n,d.top=i;break;case"br":d.right=window.innerWidth-n,d.bottom=window.innerHeight-i;break;case"bl":d.left=n,d.bottom=window.innerHeight-i;break;default:d.left=n,d.top=i}const u=Ea[t];return pa.createPortal(Le.createElement("div",{ref:a,className:`contextmenu ${t}`,style:d},Sa(u,{close:s,args:o})),document.getElementById("app"))},Ta=Le.memo(Ca);var ka,Ia,xa=n(3854);function _a(e,t,n,i){Ia||(Ia="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var o=e&&e.defaultProps,s=arguments.length-3;if(t||0===s||(t={children:void 0}),1===s)t.children=i;else if(s>1){for(var r=new Array(s),a=0;a<s;a++)r[a]=arguments[a+3];t.children=r}if(t&&o)for(var l in o)void 0===t[l]&&(t[l]=o[l]);else t||(t=o||{});return{$$typeof:Ia,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}const Na=e=>{let{url:t}=e;const[n,i]=(0,Le.useState)(null);return(0,Le.useEffect)((()=>{!async function(){const e=`${window.location.protocol}//www.tiktok.com/oembed?url=${encodeURIComponent(t)}`,n=await fetch(e),o=await n.json();o.html&&i(o.html)}()}),[t]),n?_a("iframe",{style:{width:"100%",height:756},srcDoc:n,frameBorder:"0",referrerPolicy:"no-referrer",allow:"autoplay; picture-in-picture",scrolling:"no",sandbox:"allow-scripts allow-modals allow-forms allow-popups allow-same-origin allow-presentation",allowFullScreen:!0,title:"Embedded tiktok"}):ka||(ka=_a("div",{},void 0,"LOADING"))},Aa=[Le.memo(Na),e=>e.includes("/video/"),e=>function(e){let t=e.indexOf("/@");if(-1===t)return e;t+=1;let n=e.indexOf("/",t);return-1===n&&(n=e.length),e.substring(t,n)}(e),"/embico/tiktok.png"];var Oa;function La(e,t,n,i){Oa||(Oa="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var o=e&&e.defaultProps,s=arguments.length-3;if(t||0===s||(t={children:void 0}),1===s)t.children=i;else if(s>1){for(var r=new Array(s),a=0;a<s;a++)r[a]=arguments[a+3];t.children=r}if(t&&o)for(var l in o)void 0===t[l]&&(t[l]=o[l]);else t||(t=o||{});return{$$typeof:Oa,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}function Pa(e){let t,n=-1;if(e.includes("youtube")&&(n=e.indexOf("v=")),e.includes("youtu.be")&&(n=e.indexOf("e/")),-1===n)return null;for(n+=2,t=n;t<e.length&&!["&","?","/"].includes(e[t]);t+=1);return e.substring(n,t)}const Ra=e=>{let{url:t}=e;const n=Pa(t);return n?La("div",{className:"vemb",style:{paddingBottom:"56.25%"}},void 0,La("iframe",{className:"vembc",src:`https://www.youtube.com/embed/${n}`,frameBorder:"0",referrerPolicy:"no-referrer",allow:"autoplay; picture-in-picture",sandbox:"allow-scripts allow-modals allow-forms allow-popups allow-same-origin allow-presentation",allowFullScreen:!0,title:"Embedded youtube"})):null},$a=[Le.memo(Ra),Pa,e=>Pa(e),"/embico/youtube.png"];var Da;function Ma(e,t,n,i){Da||(Da="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var o=e&&e.defaultProps,s=arguments.length-3;if(t||0===s||(t={children:void 0}),1===s)t.children=i;else if(s>1){for(var r=new Array(s),a=0;a<s;a++)r[a]=arguments[a+3];t.children=r}if(t&&o)for(var l in o)void 0===t[l]&&(t[l]=o[l]);else t||(t=o||{});return{$$typeof:Da,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}const Wa=e=>{let{url:t}=e;const n=t.substring(0,t.indexOf("?type="));return t.includes("?type=video")?Ma("div",{className:"vemb"},void 0,Ma("video",{className:"vembc",controls:!0,autoPlay:!0,src:n})):Ma("img",{alt:`Matrix ${n}`,src:n,style:{maxWidth:"100%"}})},Ha=[Le.memo(Wa),e=>e.includes("?type=video")||e.includes("?type=image"),null,"/embico/matrix.png"],Ua=function(e,t){const n=(0,Le.useRef)();(0,Le.useEffect)((()=>{n.current=t}),[t]),(0,Le.useEffect)((()=>{function t(t){t.source===e.current.contentWindow&&n.current(t.data)}return window.addEventListener("message",t,!1),()=>window.removeEventListener("message",t)}),[e])},Va="t.me/",Ga=e=>{let{url:t}=e;const[n,i]=(0,Le.useState)(200),o=(0,Le.useRef)(null);Ua(o,(e=>{try{const t=JSON.parse(e);"resize"===t.event&&t.height&&i(t.height)}catch{console.error(`Could not read postMessage from frame: ${e}`)}}));let s=(0,E._N)(t);s=s.substring(s.indexOf(Va)+5);const r=s.indexOf("/",s.indexOf("/")+1);return-1!==r&&(s=s.substring(0,r)),Le.createElement("iframe",{ref:o,style:{width:"100%",height:n},src:`https://t.me/${s}?embed=1`,frameBorder:"0",referrerPolicy:"no-referrer",allow:"autoplay; picture-in-picture",scrolling:"no",sandbox:"allow-scripts allow-modals allow-forms allow-popups allow-same-origin allow-presentation",allowFullScreen:!0,title:"Embedded telegram"})},Fa=[Le.memo(Ga),e=>{let t=e.indexOf(Va);return!(-1===t||t+5+1>=e.length||(t=e.indexOf("/",t+5+1),-1===t||t+2>=e.length))},e=>{let t=e.substring(e.indexOf(Va)+5);return t=t.substring(0,t.indexOf("/")),t},"/embico/telegram.png"],za="/status/",Ba=e=>{let{url:t}=e;const[n,i]=(0,Le.useState)(200),o=(0,Le.useRef)(null);Ua(o,(e=>{try{e["twttr.embed"]&&"twttr.private.resize"===e["twttr.embed"].method&&e["twttr.embed"].params.length&&e["twttr.embed"].params[0].height&&i(e["twttr.embed"].params[0].height)}catch{console.error(`Could not read postMessage from frame: ${e}`)}}));let s=(0,E._N)(t);return s=s.substring(s.indexOf(za)+8),-1!==s.indexOf("/")&&(s=s.substring(s.indexOf("/"))),Le.createElement("iframe",{ref:o,style:{width:"100%",height:n},src:`https://platform.twitter.com/embed/Tweet.html?dnt=true&embedId=twitter-widget-&frame=false&hideCard=false&hideThread=true&id=${s}&theme=light&width=550px`,frameBorder:"0",referrerPolicy:"no-referrer",allow:"autoplay; picture-in-picture",scrolling:"no",allowFullScreen:!0,title:"Embedded twitter"})},Za=[Le.memo(Ba),e=>{const t=e.indexOf(za);return!(-1===t||t+8+1>=e.length)},e=>{let t=e.substring(0,e.indexOf(za));return t=t.substring(t.lastIndexOf("/")+1),t},"/embico/twitter.png"];var ja;function Ka(e,t,n,i){ja||(ja="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var o=e&&e.defaultProps,s=arguments.length-3;if(t||0===s||(t={children:void 0}),1===s)t.children=i;else if(s>1){for(var r=new Array(s),a=0;a<s;a++)r[a]=arguments[a+3];t.children=r}if(t&&o)for(var l in o)void 0===t[l]&&(t[l]=o[l]);else t||(t=o||{});return{$$typeof:ja,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}function Ya(e){const t=e.lastIndexOf(":");return-1!==t?e.substring(0,t):e}const qa="/@",Qa=e=>{let t,{url:n}=e,i=n.indexOf(qa);return-1!==i||(i=n.indexOf("//"),-1===i&&(i=0)),t=n.substring(n.indexOf("/",i+2)+1),t=Ya((0,E._N)(t)),Ka("div",{className:"vemb",style:{paddingBottom:"56.25%"}},void 0,Ka("iframe",{className:"vembc",src:`https://odysee.com/$/embed/${t}`,frameBorder:"0",referrerPolicy:"no-referrer",allow:"autoplay; picture-in-picture",scrolling:"no",sandbox:"allow-scripts allow-modals allow-forms allow-popups allow-same-origin allow-presentation",allowFullScreen:!0,title:"Embedded odysee"}))},Xa=[Le.memo(Qa),e=>{const t=(0,E._N)(e);let n=t.indexOf(qa);return-1!==n?!(-1===n||n+4>=t.length||(n=t.indexOf("/",n+2),-1===n||n+2>=t.length)):(n=t.indexOf("//"),-1===n&&(n=0),n=t.indexOf("/",n+2),!(-1===n||n+2>=t.length))},e=>{let t=(0,E._N)(e),n=t.indexOf(qa);if(-1!==n){t=t.substring(n+2);let e=t.substring(0,t.indexOf("/"));return t=Ya(t.substring(e.length+1)),e=Ya(e),`${e} | ${t}`}return n=t.indexOf("//"),-1===n&&(n=0),t=t.substring(t.indexOf("/",n+2)+1),t=Ya((0,E._N)(t)),t},"/embico/odysee.png"];var Ja;function el(e,t,n,i){Ja||(Ja="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var o=e&&e.defaultProps,s=arguments.length-3;if(t||0===s||(t={children:void 0}),1===s)t.children=i;else if(s>1){for(var r=new Array(s),a=0;a<s;a++)r[a]=arguments[a+3];t.children=r}if(t&&o)for(var l in o)void 0===t[l]&&(t[l]=o[l]);else t||(t=o||{});return{$$typeof:Ja,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}const tl=["webm","mp4"],nl=["jpg","jpeg","png","webp","gif"],il=e=>{let{url:t}=e;const n=(0,E.r6)(t);return tl.includes(n)?el("div",{className:"vemb"},void 0,el("video",{className:"vembc",controls:!0,autoPlay:!0,src:t,referrerPolicy:"no-referrer"})):el("img",{alt:`Matrix ${t}`,src:t,style:{maxWidth:"100%"},referrerPolicy:"no-referrer"})},ol=[Le.memo(il),e=>{const t=(0,E.r6)(e);return tl.includes(t)||nl.includes(t)},null,"/embico/direct.png"],sl={tiktok:Aa,youtube:$a,"youtu.be":$a,"matrix.pixelplanet.fun":Ha,"i.4cdn.org":ol,"i.imgur":ol,"litter.catbox.moe":ol,"files.catbox.moe":ol,"i.redd.it":ol,"media.discordapp.net":ol,"media.consumeproduct.win":ol,"cdn.discord.com":ol,"t.me":Fa,twitter:Za,"nitter.net":Za,odysee:Xa};var rl,al,ll;function cl(e,t,n,i){ll||(ll="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var o=e&&e.defaultProps,s=arguments.length-3;if(t||0===s||(t={children:void 0}),1===s)t.children=i;else if(s>1){for(var r=new Array(s),a=0;a<s;a++)r[a]=arguments[a+3];t.children=r}if(t&&o)for(var l in o)void 0===t[l]&&(t[l]=o[l]);else t||(t=o||{});return{$$typeof:ll,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}const dl=["odysee","twitter","matrix.pixelplanet.fun","youtube","youtu.be","t.me"],ul=e=>{let{href:t,title:n,refEmbed:i}=e;const[o,s]=(0,Le.useState)(!1),r=(0,E.IU)(t);if(r===window.location.hostname&&t.includes("/#")){const e=t.substring(t.indexOf("/#")+1);return Ze()&&window.opener&&!window.opener.closed?cl("a",{href:`/${e}`,target:"main"},void 0,n||e):cl("a",{href:`/${e}`},void 0,n||e)}const a=sl[r],l=a&&a[1](t),c=a&&a[0];let d;return d=n&&dl.includes(r)?n:l&&a[2]?a[2](t):t,Le.createElement(Le.Fragment,null,cl("a",{href:t,target:"_blank",rel:"noopener noreferrer"},void 0,d),l&&Le.createElement(Le.Fragment,null," ",a[3]&&cl("img",{style:{width:"1em",height:"1em",verticalAlign:"middle"},src:a[3],alt:`${r}-icon`}),cl("span",{style:{cursor:"pointer"},onClick:()=>s(!o)},void 0,o?rl||(rl=cl(xa.TQH,{className:"ebcl"})):al||(al=cl(xa.uwt,{className:"ebex"})))),o&&l&&(i&&i.current?pa.createPortal(cl(c,{url:t}),i.current):cl(c,{url:t})))},hl=Le.memo(ul);var fl;function pl(e,t,n,i){fl||(fl="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var o=e&&e.defaultProps,s=arguments.length-3;if(t||0===s||(t={children:void 0}),1===s)t.children=i;else if(s>1){for(var r=new Array(s),a=0;a<s;a++)r[a]=arguments[a+3];t.children=r}if(t&&o)for(var l in o)void 0===t[l]&&(t[l]=o[l]);else t||(t=o||{});return{$$typeof:fl,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}const vl=e=>{let{name:t,uid:n}=e;const i=n&&n.trim(),o=(0,Pe.v9)((e=>-1!==e.gui.style.indexOf("dark")));return pl("span",{className:i==(0,Pe.v9)((e=>e.user.id))?"ping":"mention",style:{color:(0,E.TP)((0,E.Z)(t),o)}},void 0,`@${t}`)},ml=Le.memo(vl);var gl;function wl(e,t,n,i){gl||(gl="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var o=e&&e.defaultProps,s=arguments.length-3;if(t||0===s||(t={children:void 0}),1===s)t.children=i;else if(s>1){for(var r=new Array(s),a=0;a<s;a++)r[a]=arguments[a+3];t.children=r}if(t&&o)for(var l in o)void 0===t[l]&&(t[l]=o[l]);else t||(t=o||{});return{$$typeof:gl,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}const yl=Le.memo((e=>{let{pArray:t,refEmbed:n}=e;return t.map((e=>{if(!Array.isArray(e))return e;const t=e[0];switch(t){case"c":return wl("code",{},void 0,e[1]);case"*":return wl("strong",{},void 0,wl(yl,{pArray:e[1]}));case"~":return wl("s",{},void 0,wl(yl,{pArray:e[1]}));case"+":return wl("em",{},void 0,wl(yl,{pArray:e[1]}));case"_":return wl("u",{},void 0,wl(yl,{pArray:e[1]}));case"img":case"l":return wl(hl,{refEmbed:n,href:e[2],title:e[1]});case"@":return wl(ml,{uid:e[2],name:e[1]});default:return t}}))}));class bl{constructor(e,t){this.txt=e,this.iter=t||0}done(){return this.iter>=this.txt.length}moveForward(){return this.iter+=1,this.iter<this.txt.length}setIter(e){this.iter=e}getChar(){return this.txt[this.iter]}slice(e,t){return this.txt.slice(e,t||this.iter)}has(e){return this.txt.startsWith(e,this.iter)}move(e){return this.iter+=e,this.iter<this.txt.length}skipSpaces(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];for(;this.iter<this.txt.length;this.iter+=1){const t=this.txt[this.iter];if(" "!==t&&"\t"!==t&&(!e||"\n"!==t))break}}countRepeatingCharacters(){const e=this.getChar();let t=this.iter+1;for(;t<this.txt.length&&this.txt[t]===e;t+=1);return t-this.iter}moveToNextLine(){const e=this.txt.indexOf("\n",this.iter);this.iter=-1===e?this.txt.length:e+1}getLine(){const e=this.iter;return this.moveToNextLine(),this.txt.slice(e,this.iter)}getIndent(e){let t=0;for(;this.iter<this.txt.length;){const n=this.getChar();if("\t"===n)t+=e;else{if(" "!==n)break;t+=1}this.iter+=1}return t}goToCharInLine(e){let{iter:t}=this;for(;t<this.txt.length&&"\n"!==this.txt[t]&&this.txt[t]!==e;t+=1);return this.txt[t]===e&&(this.iter=t,t)}static isWhiteSpace(e){return" "===e||"\t"===e||"\n"===e}checkIfEnclosure(e){let t=this.iter+1,n=t;const i=[];for(;"]"!==this.txt[n];){const e=this.txt[n];if("\\"!==e){if(n>=this.txt.length||"\n"===e)return null;n+=1}else i.push(n),n+=2}let o=n+1;if("("!==this.txt[o])return null;o+=1;let s=o,r=null;for(;")"!==this.txt[s];){const t=this.txt[s];if(s>=this.txt.length||"\n"===t||"["===t||"("===t)return null;if(e&&":"===t){const e=this.iter;if(this.iter=s,r=this.checkIfLink(!0),s=this.iter,this.iter=e,null===r)return null}else s+=1}if(s<o+1||!r&&e)return null;e||(r=this.txt.slice(o,s));let a="";for(let e=0;e<i.length;e+=1){const n=i[e];a+=this.txt.slice(t,n),t=n+1}return t<n&&(a+=this.txt.slice(t,n)),this.iter=s,[a,r]}checkIfLink(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=this.iter;if(!this.txt.startsWith("://",t)||t<3)return null;let n=t-1;for(;n>=0&&!bl.isWhiteSpace(this.txt[n])&&"("!==this.txt[n];n-=1);for(n+=1,t+=3;t<this.txt.length&&!bl.isWhiteSpace(this.txt[t])&&(!e||")"!==this.txt[t]);t+=1);if(t<this.iter+4)return null;let i=this.txt.slice(n,t);const o=i.indexOf("http");return-1!==o&&0!==o&&(n+=o,i=this.txt.slice(n,t)),this.iter=t,i}checkIfCoords(){let e=this.iter+1;for(;e<this.txt.length;){const t=this.txt[e];if(","===t)break;if(bl.isWhiteSpace(t)||!Number.isNaN(Number(t)))return null;e+=1}if(e>=this.txt.length||e-this.iter>12||e===this.iter)return null;e+=1;const t=this.txt[e];if("-"!==t&&Number.isNaN(t))return null;e+=1;let n=1;for(;e<this.txt.length&&!bl.isWhiteSpace(this.txt[e]);){const t=this.txt[e];if(","===t)n+=1;else if("-"!==t&&Number.isNaN(Number(t)))return null;e+=1}if(n<2||n>3||","===this.txt[e-1])return null;const i=this.txt.slice(this.iter,e);return this.iter=e,i}}let Sl=()=>{};const El=["*","~","+","_"];function Cl(e,t,n){const i=[];let o=e.iter,s=null;for(;!e.done()&&(s=e.getChar(),s!==n);){if("\n"===s){e.moveForward();break}if("\\"===s)o!==e.iter&&i.push(e.slice(o)),o=e.iter+1,e.moveForward();else if("#"===s){const t=e.iter,n=e.checkIfCoords();n&&(o!==t&&i.push(e.slice(o,t)),i.push(["l",null,`${window.location.origin}/${n}`]),o=e.iter)}else if(El.includes(s)){const n=e.iter;e.moveForward();const r=Cl(e,t,s);e.getChar()===s?(o!==n&&i.push(e.slice(o,n)),i.push([s,r]),o=e.iter+1):e.setIter(n)}else if("`"===s){const t=e.iter;e.moveForward(),e.goToCharInLine("`")&&(o!==t&&i.push(e.slice(o,t)),i.push(["c",e.slice(t+1)]),o=e.iter+1)}else if(":"===s){const t=e.checkIfLink();if(null!==t){const n=e.iter-t.length;o<n&&i.push(e.slice(o,n)),i.push(["l",null,t]),o=e.iter;continue}}else if("["===s){let t=e.iter,n=null;e.iter>0&&(e.move(-1),n=e.getChar(),e.setIter(t));let s="l",r=!0;"!"===n?(s="img",t-=1):"@"===n&&(r=!1,s="@",t-=1);const a=e.checkIfEnclosure(r);null!==a&&(o<t&&i.push(e.slice(o,t)),i.push([s,a[0],a[1]]),o=e.iter+1)}e.moveForward()}return o!==e.iter&&i.push(e.slice(o)),i}function Tl(e){e.skipSpaces(!1),"\n"===e.getChar()&&e.moveForward();const t=e.iter;for(;!e.done();){if(e.skipSpaces(!0),e.has("```")){const n=["cb",e.slice(t)];return e.move(3),n}e.moveToNextLine()}const n=e.slice(t);return e.move(3),["cb",n]}function kl(e,t){const n=e.getChar();let i="";for(;e.getChar()===n&&e.moveForward();)i+=e.getLine();const o=new bl(i);return[n,Sl(o,t,0)]}function Il(e,t,n,i){const o=[];let s=[],r=0;for(;!e.done();){const a=e.iter;r+=1;const l=e.getIndent(t.tabWidth);if(l<i&&r>1){e.setIter(a);break}const c=e.getChar();if(!i&&"#"===c)break;let d=!1,u=!1;if("-"===c&&(d=!0,e.moveForward()),!Number.isNaN(parseInt(c,10))){let t=e.iter+1;for(;!Number.isNaN(parseInt(e.txt[t],10));t+=1);const n=e.txt[t];"."!==n&&")"!==n||(u=!0,e.setIter(t+1))}let h=!1,f=null;if(d||u){let i;s.length&&(o.push(["p",s]),s=[]),i=Il(e,t,n,l+1),i=["-",i];const r=d?"ul":"ol";o.length&&o[o.length-1][0]===r?o[o.length-1][1].push(i):o.push([r,[i]])}else if(">"===c||"<"===c)h=!0,f=kl(e,t);else if(e.has("```"))h=!0,e.move(3),f=Tl(e);else{if(i||"\n"!==c){const n=Cl(e,t);n&&(s=s.concat(n));continue}if(e.moveForward(),e.skipSpaces(!1),"\n"===e.getChar()){if(n&&t.newlineBreaksArticles)break;e.moveForward()}h=!0}h&&s.length&&(o.push(["p",s]),s=[]),f&&o.push(f)}return s.length&&o.push(["p",s]),o}var xl;function _l(e,t,n,i){xl||(xl="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var o=e&&e.defaultProps,s=arguments.length-3;if(t||0===s||(t={children:void 0}),1===s)t.children=i;else if(s>1){for(var r=new Array(s),a=0;a<s;a++)r[a]=arguments[a+3];t.children=r}if(t&&o)for(var l in o)void 0===t[l]&&(t[l]=o[l]);else t||(t=o||{});return{$$typeof:xl,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}function Nl(e){let{name:t,uid:n,country:i,msg:o,ts:s,openCm:r}=e;const a=(0,Pe.v9)(Pn.s),l=(0,Le.useRef)(),c="info"===t,d="event"===t;let u="msg";c?u+=" info":d?u+=" event":">"===o.charAt(0)?u+=" greentext":"<"===o.charAt(0)&&(u+=" redtext");const h=function(e,t){const n=function(e){const t={};return t.parseLinks=e&&e.parseLinks||!1,t.tabWidth=e&&e.tabWidth||4,t.newlineBreaksArticles=e&&e.newlineBreaksArticles||!0,t}(void 0);return Cl(new bl(e),n)}(o);return Le.createElement("li",{className:"chatmsg",ref:l},_l("div",{className:"msgcont"},void 0,_l("span",{className:u},void 0,!c&&!d&&_l(Le.Fragment,{},"name",_l("img",{className:"chatflag",alt:"",title:i,src:`/cf/${i}.gif`}),_l("span",{className:"chatname",style:{color:(0,E.TP)((0,E.Z)(t),a),cursor:"pointer"},role:"button",title:t,tabIndex:-1,onClick:e=>{r(e.clientX,e.clientY,t,n)}},void 0,t),": "),_l(yl,{refEmbed:l,pArray:h})),_l("span",{className:"chatts"},void 0,(0,E.tF)(s))))}Sl=(e,t,n)=>{let i=[];for(;!e.done();){const o=Il(e,t,n,0);if(i=i.concat(o),"#"!==e.getChar())break;{let o=e.countRepeatingCharacters();if(o<=n||6===n)break;{e.move(o);const n=e.getLine();o=Math.min(o,6);const s=Sl(e,t,o);i.push(["a",o,n,s])}}}return i};const Al=Le.memo(Nl);var Ol,Ll,Pl,Rl,$l;function Dl(e,t,n,i){$l||($l="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var o=e&&e.defaultProps,s=arguments.length-3;if(t||0===s||(t={children:void 0}),1===s)t.children=i;else if(s>1){for(var r=new Array(s),a=0;a<s;a++)r[a]=arguments[a+3];t.children=r}if(t&&o)for(var l in o)void 0===t[l]&&(t[l]=o[l]);else t||(t=o||{});return{$$typeof:$l,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}const Ml=e=>{let{setChatChannel:t,chatChannel:n}=e;const[i,o]=(0,Le.useState)(!1),[s,r]=(0,Le.useState)([]),[a,l]=(0,Le.useState)(0),[c,d]=(0,Le.useState)(0),[u,h]=(0,Le.useState)(!1),[f,p]=(0,Le.useState)("..."),[v,m]=(0,Le.useState)(!1),g=(0,Le.useRef)(null),w=(0,Le.useRef)(null),y=(0,Pe.v9)((e=>e.chatRead.unread)),b=(0,Pe.v9)((e=>e.chatRead.mute)),S=(0,Pe.v9)((e=>e.chat.channels)),E=(0,Pe.v9)((e=>e.gui.chatNotify));return(0,Le.useEffect)((()=>{d(w.current.clientHeight)}),[w]),function(e,t,n){const i=(0,Le.useCallback)((t=>{e.every((e=>!e.current||!e.current.contains(t.target)))&&n()}),[n,e]),o=(0,Le.useCallback)((()=>{n()}),[n]);(0,Le.useLayoutEffect)((()=>{t?(document.addEventListener("mousedown",i,{capture:!0}),window.addEventListener("resize",o)):(document.removeEventListener("mousedown",i,{capture:!0}),window.removeEventListener("resize",o))}),[t,i,o])}([g],i,(0,Le.useCallback)((()=>o(!1)),[])),(0,Le.useEffect)((()=>{if(i&&S[n]){const e=1===S[n][1]?1:0;l(e)}}),[i,S,n]),(0,Le.useEffect)((()=>{const e=Object.keys(S),t=[];let n=0;for(;n<e.length;){const i=e[n],o=y[i]&&!b.includes(i);t.push([i,o,...S[i]]),!u&&0!==S[i][1]&&o&&h(!0),n+=1}t.sort(((e,t)=>0===e[3]||0===t[3]?0:e[4]>t[4]?-1:t[4]>e[4]?1:0)),t.sort(((e,t)=>0===e[3]||0===t[3]?0:e[1]&&!t[1]?-1:t[1]&&!e[1]?1:0)),r(t),n===e.length&&h(!1)}),[S,y,b,u]),(0,Le.useEffect)((()=>{const e=Object.keys(S);for(let t=0;t<e.length;t+=1)if(1===S[e[t]][1])return void m(!0);m(!1)}),[S]),(0,Le.useEffect)((()=>{S[n]&&p(S[n][0])}),[n,S]),Dl("div",{style:{position:"relative"}},void 0,Le.createElement("div",{ref:w,key:"expbtn",role:"button",tabIndex:-1,onClick:()=>o(!0),className:"channelbtn"+(i?" selected":"")},u&&E&&!i&&Dl("div",{style:{top:-4},className:"chnunread"},void 0,"⦿"),f),i&&Le.createElement("div",{ref:g,key:"dropdown",style:{position:"absolute",bottom:c,right:9},className:"channeldd"},Dl("div",{className:"chntop"},void 0,Dl("span",{style:{borderLeft:"none"},className:"chntype"+(0===a?" selected":""),onClick:()=>l(0),role:"button",tabIndex:-1},void 0,Ol||(Ol=Dl(vt.Fmx,{}))),v&&Dl("span",{className:"chntype"+(1===a?" selected":""),onClick:()=>l(1),role:"button",tabIndex:-1},void 0,u&&E&&1!==a&&(Ll||(Ll=Dl("div",{className:"chnunread"},void 0,"⦿"))),Pl||(Pl=Dl(Fe.wN,{})))),Dl("div",{className:"channeldds"},void 0,s.filter((e=>{const t=e[3];return 1===a&&1===t||0===a&&1!==t})).map((e=>{const[i,o,s]=e;return Dl("div",{onClick:()=>t(i),className:"chn"+(i===n?" selected":""),role:"button",tabIndex:-1},i,o&&E?Rl||(Rl=Dl("div",{className:"chnunread"},void 0,"⦿")):null,s)})))))},Wl=Le.memo(Ml);var Hl;function Ul(e,t,n,i){Hl||(Hl="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var o=e&&e.defaultProps,s=arguments.length-3;if(t||0===s||(t={children:void 0}),1===s)t.children=i;else if(s>1){for(var r=new Array(s),a=0;a<s;a++)r[a]=arguments[a+3];t.children=r}if(t&&o)for(var l in o)void 0===t[l]&&(t[l]=o[l]);else t||(t=o||{});return{$$typeof:Hl,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}var Vl,Gl,Fl;function zl(e,t,n,i){Fl||(Fl="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var o=e&&e.defaultProps,s=arguments.length-3;if(t||0===s||(t={children:void 0}),1===s)t.children=i;else if(s>1){for(var r=new Array(s),a=0;a<s;a++)r[a]=arguments[a+3];t.children=r}if(t&&o)for(var l in o)void 0===t[l]&&(t[l]=o[l]);else t||(t=o||{});return{$$typeof:Fl,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}const Bl={display:"inline-block",width:"100%",maxWidth:"35em"},Zl=()=>{const[e,t]=(0,Le.useState)(""),[n,i]=(0,Le.useState)(!1),[o,s]=(0,Le.useState)(!1),[r,a]=(0,Le.useState)([]),l=Je();return o?zl("div",{},void 0,zl("p",{className:"modalmessage"},void 0,"یک ایمیل فرستادیم با آموزش که پسوردتون رو عوض کنین."),zl("button",{type:"button",onClick:()=>l("USERAREA")},void 0,"Back")):zl("div",{className:"content"},void 0,zl("p",{},void 0,"آدرس ایمیلتون رو وارد کنین تا ما یه لینک بفرستیم تا بتونین پسورد جدید بسازید:"),Vl||(Vl=zl("br",{})),zl("form",{onSubmit:async t=>{if(t.preventDefault(),n)return;const o=function(e){const t=[],n=hs(e);return n&&t.push(n),t}(e);if(o.length>0)return void a(o);i(!0);const{errors:r}=await(0,z.hH)(e);i(!1),r?a(r):s(!0)}},void 0,r.map((e=>zl("p",{},e,zl("span",{},void 0,"ارور"),": ",e))),zl("input",{style:Bl,value:e,onChange:e=>t(e.target.value),type:"text",placeholder:"ایمیل"}),Gl||(Gl=zl("br",{})),zl("button",{type:"submit"},void 0,n?"...":"ارسال"),zl("button",{type:"button",onClick:()=>l("USERAREA")},void 0,"لغو")))},jl={HELP:[()=>{const e=$o("kbd",{},void 0,"G"),t=$o("kbd",{},void 0,"X"),n=$o("kbd",{},void 0,"H"),i=$o("kbd",{},void 0,"R"),o=$o("kbd",{},void 0,"Q"),r=$o("kbd",{},void 0,"E"),a=$o("kbd",{},void 0,"W"),l=$o("kbd",{},void 0,"A"),c=$o("kbd",{},void 0,"S"),u=$o("kbd",{},void 0,"D"),h=Zi||(Zi=$o("kbd",{},void 0,"↑")),f=ji||(ji=$o("kbd",{},void 0,"←")),p=Ki||(Ki=$o("kbd",{},void 0,"↓")),v=Yi||(Yi=$o("kbd",{},void 0,"→")),m=qi||(qi=$o("kbd",{},void 0,$o(Gi.nI7,{}))),g=Qi||(Qi=$o("kbd",{},void 0,$o(vt.EGB,{}))),w=$o("kbd",{},void 0,"⇧ ","Shift"),y=Xi||(Xi=$o("a",{href:"https://twitter.com/starhousedev"},void 0,"starhouse ")),b=Ji||(Ji=$o("a",{href:"https://twitter.com/Vinikdev"},void 0,"Vinikdev")),S=eo||(eo=$o("a",{href:"https://lospec.com/palette-list/lava-gb"},void 0,"Do-Nendo")),E=to||(to=$o("a",{href:"/guilded"},void 0,"guilded")),C=$o("a",{href:`mailto:${window.ssv.contactAddress}`},void 0,window.ssv.contactAddress),T=(0,Pe.I0)(),k=(0,Pe.v9)((e=>e.gui.easterEgg)),I=(0,Le.useCallback)((()=>{T((0,s.u0)()),T((0,d.h4)(k?"ایستر اگ خاموش است":"حالت ایستر اگ روشن است"))}),[k,T]),x=mn(null,I,1e3);return $o("div",{className:"content"},void 0,Le.createElement("img",{style:{padding:2,maxWidth:"20%",verticalAlign:"middle",display:"inline-block"},alt:"ppfun",src:"./logo.svg",ref:x}),$o("p",{},void 0,"پیکسل های رنگی را روی یک بوم بزرگ با سایر بازیکنان آنلاین قرار دهید!",no||(no=$o("br",{})),"ببین، این بوم یک نقشه از جهان با سایز بشدت بزرگی هست که تو میتونی هرجایی که دلت میخواد توش پیکسل بزاری. اما یادت باشه هر پیکسل که میزاری یه کولداون داره. تو میتونی کولداون و چیزای لازم برای استفاده از بوم رو توی بخش انتخاب بوم ببینی. بعضی بوم ها کولداون های مختلفی دارن و اینکه وقتی تو یک پیکسل رو روی یک پیکسلی که یکی دیگه گذاشته میزاری، کولداونش با پیکسل روی یک جای بی صاحب فرق داره. اینطوری که در بوم جهان، پیکسل های بی صاحب هر 4 ثانیه هست و گذاشتن روی پیکسل های صاحب دار 7 ثانیه.",io||(io=$o("br",{})),"سطوح زوم بالاتر مدتی طول می کشد تا به روز شوند، کره سه بعدی حداقل یک بار در روز به روز می شود.",oo||(oo=$o("br",{})),"خوش بگذره!"),$o("p",{className:"modalinfo"},void 0,"Guilded (","پیشنهاد شده","): ",$o("a",{href:"./guilded",target:"_blank",rel:"noopener noreferrer"},void 0,"Invited to Chat")),$o("p",{className:"modalinfo"},void 0,"Source for pixelplanet on ",so||(so=$o("a",{href:"https://git.pixelplanet.fun",target:"_blank",rel:"noopener noreferrer"},void 0,"git.pixelplanet.fun"))),$o("p",{className:"modalinfo"},void 0,"We are Libre Software, ",$o("a",{href:"/legal",target:"_blank",rel:"noopener noreferrer"},void 0,"check compliance here")),$o("h3",{},void 0,"اطلاعات نقشه"),$o("p",{},void 0,"داده های نقشه خالی که استفاده می کنیم، به همراه کاشی های OpenStreetMap تبدیل شده برای جهت یابی، می توانند از mega.nz در اینجا دانلود شوند: ",ro||(ro=$o("a",{href:"https://mega.nz/#!JpkBwAbJ!EnSLlZmKv3kEBE0HDhakTgAZZycD3ELjduajJxPGaXo"},void 0,"pixelplanetmap.zip"))," (422MB)"),$o("h3",{},void 0,"بن شدی؟ به عنوان پروکسی شناخته شدی؟"),$o("div",{},void 0,$o("p",{},void 0,["اگر فکر کردن تو رباتی ولی تو فکر میکنی که نیستی، یا فکر میکنی که اشتباها بن شدی، پس برو به ",E," یا یه ایمیل به ",C," بفرست و آیدی مورد نظر رو اضافه کن:"]),ao||(ao=$o(Bi,{}))),$o("h3",{},void 0,"2D ","کنترل ها"),$o("div",{style:{lineHeight:1.5}},void 0,"یه رنگ توی حعبه رنگ کلیک کن تا انتخاب کنی",lo||(lo=$o("br",{})),["روی ",e," بزن تا شبکه فعال بشه"],co||(co=$o("br",{})),["روی ",t," بزن تا فعالیت پیکسلی نشون داده بشه"],uo||(uo=$o("br",{})),["روی ",n," بزن تا دید تاریخی فعال بشه"],ho||(ho=$o("br",{})),["بزن روی ",i," تا مختصات کپی بشه"],fo||(fo=$o("br",{})),["بزن روی ",r," ",o," تا زوم کنی"],po||(po=$o("br",{})),["بزن روی ",a," یا ",l," یا ",c," یا ",u," تا جا به جا بشی"],vo||(vo=$o("br",{})),["بزن روی ",h," یا ",f," یا ",p," یا ",v," تا حرکت کنی"],mo||(mo=$o("br",{})),["بکش روی ",m," موس یا ",g," بکش تا حرکت کنی"],go||(go=$o("br",{})),["اسکرول ",m," رول موس یا ",g," روی صفحه بکش تا زوم کنی"],wo||(wo=$o("br",{})),["Hold left ",w," for placing while moving mouse"],yo||(yo=$o("br",{})),["Hold right ",w," for placing while moving mouse according to historical view"],bo||(bo=$o("br",{})),[m," کلیک چپ یا ",g," بزن روی صفحه تا پیکسل گذاشته بشه"],So||(So=$o("br",{})),["کلیک ",m," وسط موس رو بزن یا ",g," روی یک پیکسل نگه دار تا رنگ اون پیکسل گذاشته شده رو انتخاب کنی"],Eo||(Eo=$o("br",{}))),$o("h3",{},void 0,"3D ","کنترل ها"),$o("div",{style:{lineHeight:1.5}},void 0,["بزن روی ",a," یا ",l," یا ",c," یا ",u," تا جا به جا بشی"],Co||(Co=$o("br",{})),["بزن روی ",h," یا ",f," یا ",p," یا ",v," تا حرکت کنی"],To||(To=$o("br",{})),["Press ",o," and ",r," to fly up and down"],ko||(ko=$o("br",{})),[m," دکمه چپ موس رو نگه دار و موس رو حرکت بده تا بچرخی"],Io||(Io=$o("br",{})),[m," اسکرول موس یا ",m," دکمه وسطی موس رو نگه دار و تکونش بده تا زوم کنی"],xo||(xo=$o("br",{})),[m," Right click and drag mouse to pan"],_o||(_o=$o("br",{})),[m," کلیک چپ یا ",g," بزن روی صفحه تا پیکسل گذاشته بشه"],No||(No=$o("br",{})),["راست کلیک کن ",m," یا ",g," دوبار روی پیکسل بزن تا پیکسل رو حرف کنی"],Ao||(Ao=$o("br",{})),["کلیک ",m," وسط موس رو بزن یا ",g," روی یک پیکسل نگه دار تا رنگ اون پیکسل گذاشته شده رو انتخاب کنی"],Oo||(Oo=$o("br",{}))),Lo||(Lo=$o("h3",{},void 0,"Palette Credits")),$o("div",{},void 0,["We thank the following artists, who made their palettes available to the public on"]," ",Po||(Po=$o("a",{href:"https://lospec.com/"},void 0,"lospec.com")),$o("p",{},void 0,["فرد سازنده جعبه رنگ بوم ماه ",y,"."]),$o("p",{},void 0,["فرد سازنده بوم 10 نفر اول ",b,"."]),$o("p",{},void 0,["Credit for the Palette of the 2bit canvas goes to ",S,"."])))},"کمک"],SETTINGS:[ds,"تنظیمات"],USERAREA:[Hr,"منطقه یوزر"],REGISTER:[Fr,"ثبت"],FORGOT_PASSWORD:[Le.memo(Zl),"پسورد رو یادم رفته"],CHAT:[()=>{const e=(0,Le.useRef)(),t=(0,Le.useRef)(),n=(0,Le.useRef)(),[i,o]=(0,Le.useState)([]),[r,a]=(0,Le.useState)(20),[l,c]=(0,Le.useState)({}),u=(0,Pe.I0)(),h=(0,Pe.v9)((e=>e.user.name)),f=(0,Pe.v9)((e=>e.fetching.fetchingChat)),{channels:p,messages:v,blocked:m}=(0,Pe.v9)((e=>e.chat)),{args:g,setArgs:w,setTitle:y}=(0,Le.useContext)(Qe),{chatChannel:b=1}=g,S=Je(),E=(0,Le.useCallback)((e=>{u((0,s.Eo)(e)),w({chatChannel:Number(e)})}),[u]),C=(0,Le.useCallback)((e=>{const t=n.current;if(!t)return;let i=t.value;" "!==i.slice(-1)&&(i+=" "),i+=`${e} `,t.value=i,n.current.focus()}),[]),T=(0,Le.useCallback)((()=>{c({})}),[]),k=(0,Le.useCallback)(((e,t,n,i)=>{c({type:"USER",x:e,y:t,args:{name:n,uid:i,setChannel:E,addToInput:C}})}),[E,C]),{stayScrolled:I}=(0,fa.Z)(e,{initialScroll:1/0,inaccuracy:10}),x=v[b]||[];return(0,Le.useEffect)((()=>{!p[b]||v[b]||f||u((0,d.TL)(b))}),[p,v,b]),(0,Le.useEffect)((()=>{if(p[b]){const e=p[b][0];y(`Chan: ${e}`)}}),[b]),(0,Le.useLayoutEffect)((()=>{I()}),[x.length]),(0,Le.useEffect)((()=>{setTimeout((()=>{const e=Math.round(t.current.offsetHeight/10);a(Math.min(28,e))}),330)}),[t]),(0,Le.useEffect)((()=>{const e=[];for(let t=0;t<m.length;t+=1)e.push(m[t][0]);o(e)}),[m.length]),(0,Le.useEffect)((()=>{if(!b||!p[b]){const e=Object.keys(p);e.length&&E(e[0])}}),[p]),Le.createElement("div",{ref:t,className:"chat-container"},Ul(Ta,{type:l.type,x:l.x,y:l.y,args:l.args,close:T,align:l.align}),Le.createElement("ul",{className:"chatarea",ref:e,style:{flexGrow:1},role:"presentation"},!x.length&&Ul(Al,{uid:0,name:"info",country:"xx",msg:"اینجا میتونی چت کنی"}),x.map((e=>i.includes(e[3])?null:Ul(Al,{name:e[0],msg:e[1],country:e[2],uid:e[3],ts:e[4],openCm:k},e[5])))),Ul("form",{className:"chatinput",onSubmit:e=>function(e){e.preventDefault();const t=n.current.value.trim();t&&(u((0,s.bE)(t,b)),n.current.value="")}(e),style:{display:"flex"}},void 0,h?Ul(Le.Fragment,{},"chtipt",Le.createElement("input",{style:{flexGrow:1,minWidth:40},ref:n,autoComplete:"off",maxLength:"200",type:"text",placeholder:"همینجا چت کن"}),Ul("button",{id:"sendbtn",style:{flexGrow:0},type:"submit"},void 0,"‣")):Ul("div",{className:"modallink",onClick:e=>{e.stopPropagation(),S("USERAREA",{target:"fullscreen"})},style:{textAlign:"center",fontSize:13,flexGrow:1},role:"button",tabIndex:0},"nlipt","باید در سایت وارد بشی تا بتونی چت کنی"),Ul(Wl,{setChatChannel:E,chatChannel:b},"cdd")),Ul("div",{className:"chatlink",style:{fontSize:r}},void 0,Ul("span",{onClick:e=>{const{clientX:t,clientY:n}=e;c({type:"CHANNEL",x:t,y:n,args:{cid:b},align:"tr"})},role:"button",title:"تنظمیات کانال",tabIndex:-1},void 0,"⚙")))},"چت"],CANVAS_SELECTION:[ra,"انتخاب بوم"],ARCHIVE:[()=>ua("div",{className:"content"},void 0,ua("p",{},void 0,"While we tend to not delete canvases, some canvases are started for fun or as a request by users who like a currently popular meme. Those canvases can become dull and inactive after a while, at which point there is no reason to keep them and we may decide to remove them.",aa||(aa=ua("br",{})),"Here we collect removed canvases to archive them properly. Which is currently only one."),ua("h3",{},void 0,"بوم قطب نمای سیاسی"),ua("img",{style:{padding:2,maxWidth:"20%",verticalAlign:"middle",display:"inline-block"},alt:"political-compass",src:"https://storage.pixelplanet.fun/compass-preview.png"}),ua("p",{},void 0,"این بوم در زمان درگیری های سیاسی در بوم اصلی زمین درخواست شد. این یک نمایش 1024x1024 از قطب‌نمای سیاسی با خنک‌کردن 5s و انباشته شدن 60s بود. در 21 اردیبهشت راه اندازی شد و برای ماه ها فعال بود تا اینکه در 9 آذر تعطیل شد.",la||(la=ua("br",{})),"ما تصمیم گرفتیم آن را به عنوان یک تایم لپس با وب مدیا رمزگذاری شده بدون ضرر بایگانی کنیم. گرفتن اسکرین شات از تایم لپس به نمایش کامل 1:1 از چگونگی بوم در آن زمان منجر می شود."),ca||(ca=ua("p",{className:"modalinfo"},void 0,"Timelapse:",ua("a",{href:"https://storage.pixelplanet.fun/compass-timelapse.webm"},void 0,"Download"))),ua("img",{style:{padding:2,maxWidth:"80%",verticalAlign:"middle"},alt:"political-compass",src:"https://storage.pixelplanet.fun/compass-final.png"})),"آرشیو بوم"]};var Kl,Yl,ql;function Ql(e,t,n,i){ql||(ql="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var o=e&&e.defaultProps,s=arguments.length-3;if(t||0===s||(t={children:void 0}),1===s)t.children=i;else if(s>1){for(var r=new Array(s),a=0;a<s;a++)r[a]=arguments[a+3];t.children=r}if(t&&o)for(var l in o)void 0===t[l]&&(t[l]=o[l]);else t||(t=o||{});return{$$typeof:ql,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}const Xl=e=>{let{id:t}=e;const[n,i]=(0,Le.useState)(!1),o=(0,Le.useRef)(),s=(0,Le.useRef)(),r=(0,Le.useMemo)((()=>{return e=t,(0,$i.P1)(Di,(t=>t.find((t=>t.windowId===e))));var e}),[]),a=(0,Le.useMemo)((()=>{return e=t,t=>t.windows.positions[e];var e}),[]),l=(0,Le.useMemo)((()=>{return e=t,t=>t.windows.args[e]||{};var e}),[]),c=(0,Pe.v9)(r),d=(0,Pe.v9)(a),u=(0,Pe.v9)(Mi),h=(0,Pe.v9)(l),f=(0,Pe.I0)(),p=(0,Le.useMemo)((()=>({args:h,setArgs:e=>f(function(e,t){return{type:"SET_WIN_ARGS",windowId:e,args:t}}(t,e)),setTitle:e=>f(function(e,t){return{type:"SET_WIN_TITLE",windowId:e,title:t}}(t,e)),changeType:(e,n,i)=>f(function(e,t){return{type:"CHANGE_WIN_TYPE",windowId:e,windowType:t,title:arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",args:arguments.length>3&&void 0!==arguments[3]?arguments[3]:null}}(t,e,n,i))})),[t,h]),{open:v,hidden:m,fullscreen:g}=c,w=(0,Le.useCallback)((()=>{f({type:"FOCUS_WIN",windowId:t})}),[f]),y=(0,Le.useCallback)((e=>{e.stopPropagation(),f({type:"CLONE_WIN",windowId:t})}),[f]),b=(0,Le.useCallback)((()=>{i(!1)}),[f]),S=(0,Le.useCallback)((e=>{e.stopPropagation(),f({type:"CLOSE_WIN",windowId:t})}),[f]),{xPos:E,yPos:C,width:T,height:k}=d;Ui(o,w,(0,Le.useCallback)(((e,n)=>f(function(e,t,n){return{type:"MOVE_WIN",windowId:e,xDiff:t,yDiff:n}}(t,e,n))),[g,!n&&m])),Ui(s,w,(0,Le.useCallback)(((e,n)=>f(function(e,t,n){return{type:"RESIZE_WIN",windowId:e,xDiff:t,yDiff:n}}(t,e,n))),[g,!n&&m]));const I=(0,Le.useCallback)((()=>{m&&i(!1),v?n||m||(f({type:"TGL_MAXIMIZE_WIN",windowId:t}),setTimeout((()=>i(!0)),10)):f({type:"REMOVE_WIN",windowId:t})}),[f,m,v,n]);if((0,Le.useEffect)((()=>{v&&!m&&window.setTimeout((()=>{i(!0)}),10)}),[v,m]),!n&&(m||!v))return null;const{title:x,windowType:_}=c,{z:N}=d,[A,O]=jl[_],L=x?`${O} - ${x}`:O,P=`${_}${v&&!m&&n?" show":""}`;return g?Ql("div",{className:`modal ${P}`,onTransitionEnd:I,onClick:w,style:{zIndex:N}},void 0,Ql("h2",{},void 0,L),Ql("div",{onClick:S,className:"modal-topbtn close",role:"button",label:"close",title:"ببند",tabIndex:-1},"closebtn","✕"),Ke.includes(_)&&Ql("div",{onClick:e=>{Xe(_,h,E,C,T,k),S(e)},className:"modal-topbtn pop",role:"button",label:"close",title:"پاپ آپ",tabIndex:-1},"popbtn",Kl||(Kl=Ql(Ri.srV,{}))),u&&Ql("div",{onClick:b,className:"modal-topbtn restore",role:"button",label:"restore",title:"بازگردانی کن",tabIndex:-1},"resbtn","↓"),Ql("div",{className:"modal-content"},"content",Ql(Qe.Provider,{value:p},void 0,Ql(A,{})))):Ql("div",{className:`window ${P}`,onTransitionEnd:I,onClick:w,style:{left:E,top:C,width:T,height:k,zIndex:N}},void 0,Ql("div",{className:"win-topbar"},"topbar",Ql("span",{className:"win-topbtn",onClick:y,title:"کلون کن"},"clonebtn","+"),Le.createElement("span",{className:"win-title",key:"title",ref:o,title:"جا به جا کن"},L),Ke.includes(_)&&Ql("span",{className:"win-topbtn",onClick:e=>{Xe(_,h,E,C,T,k),S(e)}},"pobtnm",Yl||(Yl=Ql(Ri.srV,{}))),Ql("span",{className:"win-topbtn",onClick:b,title:"به حداکثر برسون"},"maxbtn","↑"),Ql("span",{className:"win-topbtn close",onClick:S,title:"ببند"},"closebtn","X")),Le.createElement("div",{className:"win-resize",key:"winres",title:"تغییر اندازه",ref:s},"▨"),Ql("div",{className:"win-content"},"content",Ql(Qe.Provider,{value:p},void 0,Ql(A,{}))))},Jl=Le.memo(Xl);var ec;function tc(e,t,n,i){ec||(ec="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var o=e&&e.defaultProps,s=arguments.length-3;if(t||0===s||(t={children:void 0}),1===s)t.children=i;else if(s>1){for(var r=new Array(s),a=0;a<s;a++)r[a]=arguments[a+3];t.children=r}if(t&&o)for(var l in o)void 0===t[l]&&(t[l]=o[l]);else t||(t=o||{});return{$$typeof:ec,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}const nc=()=>{const e=(0,Pe.v9)(Hi,Pe.wU),[t,n]=(0,Pe.v9)(Wi,Pe.wU),i=(0,Pe.I0)();return t&&e.length?tc("div",{id:"wm"},void 0,tc(si,{show:n,onClick:()=>i({type:"CLOSE_FULLSCREEN_WINS"})}),e.map((e=>tc(Jl,{id:e},e)))):null};var ic,oc,sc,rc;function ac(e,t,n,i){rc||(rc="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var o=e&&e.defaultProps,s=arguments.length-3;if(t||0===s||(t={children:void 0}),1===s)t.children=i;else if(s>1){for(var r=new Array(s),a=0;a<s;a++)r[a]=arguments[a+3];t.children=r}if(t&&o)for(var l in o)void 0===t[l]&&(t[l]=o[l]);else t||(t=o||{});return{$$typeof:rc,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}const lc={style:{verticalAlign:"middle"}},cc=()=>Le.createElement(Le.Fragment,null,ic||(ic=ac(We,{})),oc||(oc=ac($e.Pd.Provider,{value:lc},void 0,ac(ot,{}),ac(Yt,{}),ac(yt,{}),ac(ht,{}),ac(Ge,{}),ac(Pi,{}),ac(xi,{}),ac(nc,{}))));(0,i.p5)(Ae,{},(()=>{function e(){Ae.dispatch((0,s.Qr)())}window.addEventListener("message",Ae.dispatch),Ae.dispatch({type:"HYDRATED"}),h.Z.initialize(Ae,B,ye),X.initialize(Ae),window.addEventListener("hashchange",(()=>{Ae.dispatch((0,s.fL)())})),window.imMobile=function(){delete window.imMobile,Ae.dispatch((0,s.bv)(!0))},document.addEventListener("touchstart",window.imMobile,{once:!0}),window.addEventListener("resize",e),e(),Ae.dispatch((0,s.vb)()),Ae.dispatch((0,d.aM)()),B.initialize(Ae,h.Z,ye)})),function(){const e=()=>{window.name="main",function(e,t){(0,Re.s)(e).render(ac(Pe.zt,{store:t},void 0,sc||(sc=ac(cc,{}))))}(document.getElementById("app"),Ae);const t=function(e){return t=>{if("INPUT"===t.target.nodeName||"TEXTAREA"===t.target.nodeName)return;let{key:n}=t;const i=Number(n);if(!Number.isNaN(i)&&i>0){const{canvases:t,canvasId:n}=e.getState().canvas,o=Object.keys(t).filter((e=>!t[e].hid));if(i<=o.length){const r=o[i-1];if(r!==n){e.dispatch((0,s.SC)(r));const n=t[r].title;e.dispatch((0,d.h4)(`Switched to ${n}`))}}}else{switch(t.code){case"ArrowUp":case"KeyW":return void e.dispatch((0,s.mx)(-1));case"ArrowLeft":case"KeyA":return void e.dispatch((0,s.mW)(-1));case"ArrowDown":case"KeyS":return void e.dispatch((0,s.mx)(1));case"ArrowRight":case"KeyD":return void e.dispatch((0,s.mW)(1));case"KeyE":return void e.dispatch((0,s.WW)(1));case"KeyQ":return void e.dispatch((0,s.WW)(-1))}switch(t.key){case"+":return void e.dispatch((0,s.WW)(1));case"-":return void e.dispatch((0,s.WW)(-1));case"Control":return void e.dispatch((0,s.Or)(-1));case"Shift":return t.location===KeyboardEvent.DOM_KEY_LOCATION_LEFT?void e.dispatch((0,s.UW)(c.EQ.PENCIL,!0)):t.location===KeyboardEvent.DOM_KEY_LOCATION_RIGHT?void e.dispatch((0,s.UW)(e.getState().templates.oRightShift?c.EQ.OVERLAY:c.EQ.HISTORY,!0)):void 0}if(!u.includes(n)){if(n=t.code,!n.startsWith("Key"))return;n=n.slice(-1).toLowerCase()}switch(n){case"g":return e.dispatch((0,s.xK)()),void e.dispatch((0,d.h4)(e.getState().gui.showGrid?"شبکه  روشن است":"شبکه  خاموش است"));case"h":return void(window?.ssv.backupurl&&e.dispatch((0,s.FI)()));case"x":return e.dispatch((0,s.Xb)()),void e.dispatch((0,d.h4)(e.getState().gui.showPixelNotify?"هشدار دهنده پیکسل روشن است":"هشدار دهنده پیکسل خاموش است"));case"m":return e.dispatch((0,s.$t)()),void e.dispatch((0,d.h4)(e.getState().gui.mute?"صدا ساکت است":"صدا ساکت نیست"));case"n":return void e.dispatch((0,s.qP)());case"r":{const{hover:t}=e.getState().canvas,n=t.join("_");return(0,o.Z)(n),void e.dispatch((0,d.h4)("Copied"))}case"t":return e.dispatch({type:"s/TGL_OVENABLED"}),void e.dispatch((0,d.h4)(e.getState().templates.ovEnabled?"اورلی روشن است":"اورلی خاموش است"));case"l":e.dispatch((0,s.u0)()),e.dispatch((0,d.h4)(e.getState().gui.easterEgg?"حالت ایستر اگ روشن است":"ایستر اگ خاموش است"))}}}}(Ae),n=function(e){return t=>{switch(t.code){case"ArrowUp":case"KeyW":case"ArrowDown":case"KeyS":return void e.dispatch((0,s.mx)(0));case"ArrowLeft":case"KeyA":case"ArrowRight":case"KeyD":return void e.dispatch((0,s.mW)(0));case"KeyE":case"KeyQ":return void e.dispatch((0,s.WW)(0))}switch(t.key){case"+":case"-":return void e.dispatch((0,s.WW)(0));case"Shift":case"CapsLock":e.dispatch((0,s.UW)(c.EQ.OFF))}}}(Ae);document.addEventListener("keydown",t,!1),document.addEventListener("keyup",n,!1),setInterval((()=>{ye().gc()}),c.PR),document.removeEventListener("DOMContentLoaded",e)};document.addEventListener("DOMContentLoaded",e,!1)}()},389:(e,t,n)=>{n.d(t,{Z:()=>o});var i=n(7294);const o=function(e,t){const n=(0,i.useRef)();(0,i.useEffect)((()=>{n.current=e}),[e]),(0,i.useEffect)((()=>{function e(){n.current()}if(null!==t){e();const n=setInterval(e,t);return()=>clearInterval(n)}}),[t])}},940:(e,t,n)=>{n.d(t,{A$:()=>o,EQ:()=>m,Fv:()=>i,I_:()=>l,Kb:()=>u,PR:()=>v,Tj:()=>r,U4:()=>f,V4:()=>s,WF:()=>p,fS:()=>a,p7:()=>c,vB:()=>g,vc:()=>d,wL:()=>h});const i=40,o=3,s="0",r=128,a=32,l=256,c=2,d=2592e6,u=100,h=1e3,f=2e3,p=3e5,v=3e5,m={OFF:0,PENCIL:1,HISTORY:2,OVERLAY:3},g=8},259:(e,t,n)=>{n.d(t,{Cr:()=>g,D$:()=>S,D0:()=>v,HD:()=>c,IU:()=>I,NK:()=>h,Ss:()=>u,TP:()=>C,UW:()=>r,VL:()=>w,W4:()=>d,Z:()=>E,_I:()=>A,_N:()=>_,_O:()=>p,_V:()=>$,ad:()=>L,b3:()=>k,bG:()=>O,bt:()=>P,gx:()=>y,h$:()=>R,lg:()=>T,nK:()=>m,r6:()=>x,s3:()=>f,sG:()=>l,tF:()=>N,uZ:()=>s,x2:()=>a});var i=n(940);function o(e,t){return(e%t+t)%t}function s(e,t,n){return Math.max(t,Math.min(e,n))}function r(e){return e.substring(0,4)+e.substring(5,7)+e.substring(8)}function a(){const e=new Date;let t=e.getUTCDate(),n=e.getUTCMonth()+1;return n<10&&(n=`0${n}`),t<10&&(t=`0${t}`),`${e.getUTCFullYear()}-${n}-${t}`}function l(e,t,n){let o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;const s=null===o?i.I_:i.fS,r=null==o?n:o;return[Math.floor((t+e/2)/s),Math.floor((r+e/2)/s)]}function c(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;return t.map((t=>Math.floor((t+n/2)/i.I_*e)))}function d(e){return e?Math.log2(e/i.I_)/i.p7*2:0}function u(e,t,n){if(e&&n){let t=n.length;for(;t>0;){t-=1;const[i,o]=n[t];if(e<=i)return o}}return t}function h(e,t,n){let s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;const r=null===s?i.I_:i.fS,a=null==s?n:s;let l=null===s?0:n*r*r;const c=o(e/2,r),d=o(t+c,r);return l+=o(a+c,r)*r+d,l}function f(e,t){const n=Object.keys(e);for(let i=0;i<n.length;i+=1){const o=n[i];if(e[o].ident===t)return o}return null}function p(e,t,n,o){let s=arguments.length>4&&void 0!==arguments[4]&&arguments[4];const r=s?i.fS:i.I_,a=n%r,l=n-a;let c=l%(r*r);const d=s?(l-c)/r/r:null;c/=r;const u=o/2/r;return[(e-u)*r+a,(t-u)*r+c,d]}function v(e,t){return t.map((t=>o(t+e/2,i.I_)))}function m(e,t,n,i){let[o,s]=i;const[r,a]=e,{width:l,height:c}=n;return[Math.floor((o-l/2)/t+r),Math.floor((s-c/2)/t+a)]}function g(e,t,n,i){let[o,s]=i;const[r,a]=e,{width:l,height:c}=n;return[(o-r)*t+l/2,(s-a)*t+c/2]}function w(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const n=Math.ceil(e/1e3);let i;return i=n<60&&t?n:`${Math.floor(n/60)}:${("0"+n%60).slice(-2)}`,i}function y(e){const t=e%60;let n=(e-t)/60;const i=n%60;n=(n-i)/60;const o=n%24;n=(n-o)/24;let s="";return n&&(s+=` ${n}d`),o&&(s+=` ${o}h`),i&&(s+=` ${i}min`),t&&(s+=` ${t}s`),s}const b=["k","M","B"];function S(e){if(!e)return"N/A";if(e<1e3)return e;let t=0;for(;t<b.length;){if(e<1e4)return`${Math.floor(e/1e3)}.${`0${Math.floor(e%1e3/10)}`.slice(-2)}${b[t]}`;if(e<1e5)return`${Math.floor(e/1e3)}.${Math.floor(e%1e3/100)}${b[t]}`;if(e<1e6)return Math.floor(e/1e3)+b[t];t+=1,e=Math.round(e/1e3)}return""}function E(e){if(!e)return"#000000";let t=0;for(let n=0;n<e.length;n++)t=e.charCodeAt(n)+((t<<5)-t);return`#${`00000${(16777215&t).toString(16).toUpperCase()}`.slice(-6)}`}function C(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];3===(e=e.replace(/^\s*#|\s*$/g,"")).length&&(e=e.replace(/(.)/g,"$1$1"));let n=Math.floor(parseInt(e.substring(0,2),16)/2),i=Math.floor(parseInt(e.substring(2,4),16)/2),o=Math.floor(parseInt(e.substring(4,6),16)/2);return t&&(n+=128,i+=128,o+=128),n=`0${n.toString(16)}`.slice(-2),i=`0${i.toString(16)}`.slice(-2),o=`0${o.toString(16)}`.slice(-2),`#${n}${i}${o}`}function T(e){const t=["\\","[","]","(",")","*","~","+","_","\n"];let n="",i=0;for(let o=0;o<e.length;o+=1){const s=e[o];t.includes(s)&&(n+=`${e.slice(i,o)}\\`,i=o)}return 0===i?e:(n+=e.slice(i),n)}function k(){try{const e=document.createElement("canvas");return!(!window.WebGL2RenderingContext||!e.getContext("webgl2"))}catch{return!1}}function I(e){let t=e.indexOf("://")+3;t<3&&(t=0),e.startsWith("www.",t)&&(t+=4);let n=e.indexOf("/",t);return-1===n&&(n=e.length),e.endsWith(".com",n)&&(n-=4),n<=t?e:e.slice(t,n)}function x(e){let t=e.indexOf("&");-1===t&&(t=e.length);let n=t-1;for(;n>=0&&"."!==e[n];n-=1)if("/"===e[n])return null;return n+=1,t-n>4?null:e.slice(n,t)}function _(e){let t=e.indexOf("?");return-1===t&&(t=e.indexOf("#")),-1===t?e:e.substring(0,t)}function N(e){const t=new Date,n=new Date(1e3*e);return n.getDate()!==t.getDate()?n.toLocaleString():n.toLocaleTimeString()}function A(e){let t=e.lastIndexOf("#"),n=[];if(-1!==t){let i=e.slice(t+1);t=i.indexOf("?"),-1!==t&&(i=i.slice(0,t)),n=i.split(",").map((e=>parseInt(e,10))).slice(1,3)}return(2!==n.length||n.some(Number.isNaN))&&(n=e.split("_").map((e=>parseInt(e,10)))),(2!==n.length||n.some(Number.isNaN))&&(n=e.split(",").map((e=>parseInt(e,10)))),(2!==n.length||n.some(Number.isNaN))&&(n=null),n}function O(e){if(!e)return 0;const t=e.slice(-1).toLowerCase(),n=parseInt(e.slice(0,-1),10);if(Number.isNaN(n)||n<=0||n>600||!["s","m","h","d"].includes(t))return 0;let i=1e3;return"m"===t?i*=60:"h"===t?i*=3600:"d"===t&&(i*=86400),n*i}function L(e,t){let n=0;for(let i=0;i<e.length;i+=1){const o=Math.abs(e[i]-t[i]);o>n&&(n=o)}return n}function P(e){if(e instanceof TouchEvent){const t=e.touches.length?e.touches:e.changedTouches;let n=0,i=0;for(const{pageX:e,pageY:o}of t)n+=e,i+=o;const{length:o}=t;return[n/o,i/o]}return[e.clientX,e.clientY]}function R(e){return new Promise((t=>{const n=new Blob([e]),i=new FileReader;i.onload=e=>{const n=e.target.result,[,i]=n.split(",");t(i)},i.readAsDataURL(n)}))}async function $(e){const t=`data:application/octet-binary;base64,${e}`;return(await fetch(t)).arrayBuffer()}},631:(e,t,n)=>{n.d(t,{A:()=>_,AP:()=>p,E1:()=>f,Es:()=>x,Fx:()=>s,I6:()=>h,JL:()=>N,K$:()=>I,No:()=>v,Oh:()=>g,PS:()=>d,Pw:()=>E,Wt:()=>b,e9:()=>y,fF:()=>S,ft:()=>w,hH:()=>T,jK:()=>A,ko:()=>u,s$:()=>k,uY:()=>o,uw:()=>m,yx:()=>C});var i=n(259);const o=function(){if(!window.ssv||!window.ssv.shard||"fuckyouarkeros.fun"===window.location.host)return"";const e=window.location.host.split(".");return e.length>2&&e.shift(),`${window.ssv.shard}.${e.join(".")}`}(),s=o&&`${window.location.protocol}//${o}`;async function r(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const{timeout:n=3e4}=t,i=new AbortController,o=setTimeout((()=>i.abort()),n),s=await fetch(e,{...t,signal:i.signal});return clearTimeout(o),s}async function a(e){const{status:t}=e;if(429===t){let t="زیادی درخواست دادی";const n=e.headers.get("Retry-After");return Number.isNaN(Number(n))||(t+=`, دوباره بعد ${Math.floor(n/60)}دقیقه امتحان کن شاید درست شد`),{errors:[t]}}try{return await e.json()}catch(e){return{errors:[`نتت مشکل داره کسکم. ${t} :(`]}}}async function l(e,t){let n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];(!(arguments.length>3&&void 0!==arguments[3])||arguments[3])&&(e=`${s}${e}`);try{return a(await r(e,{method:"POST",credentials:n?"include":"omit",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)}))}catch(e){return{errors:["به سرور نتونستم وصل شم. بعدا یه امتحان بکن :("]}}}async function c(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];(!(arguments.length>2&&void 0!==arguments[2])||arguments[2])&&(e=`${s}${e}`);try{return a(await r(e,{credentials:t?"include":"omit"}))}catch(e){return{errors:["به سرور نتونستم وصل شم. بعدا یه امتحان بکن :("]}}}async function d(e,t){const n=await l("/api/block",{userId:e,block:t});return n.errors?n.errors[0]:"ok"===n.status?null:"داداش یه ارور عجیبی اتفاق افتاد که خودمم نمیدونم چیه"}async function u(e){const t=await l("/api/privatize",{priv:e});return t.errors?t.errors[0]:"ok"===t.status?null:"داداش یه ارور عجیبی اتفاق افتاد که خودمم نمیدونم چیه"}async function h(e){const t=await l("/api/startdm",e);return t.errors?t.errors[0]:t.channel?t.channel:"داداش یه ارور عجیبی اتفاق افتاد که خودمم نمیدونم چیه"}async function f(e){const t=await l("/api/blockdm",{block:e});return t.errors?t.errors[0]:"ok"===t.status?null:"داداش یه ارور عجیبی اتفاق افتاد که خودمم نمیدونم چیه"}async function p(e){const t=await l("/api/leavechan",{channelId:e});return t.errors?t.errors[0]:"ok"===t.status?null:"داداش یه ارور عجیبی اتفاق افتاد که خودمم نمیدونم چیه"}async function v(e,t){try{const n=`/history?day=${(0,i.UW)(e)}&id=${t}`,o=await r(n,{credentials:"omit",timeout:45e3});if(200!==o.status)return[];return["00:00",...(await o.json()).map((e=>`${e.substring(0,2)}:${e.substring(2)}`))]}catch{return[]}}async function m(e){const t=await fetch(`${s}/api/chathistory?cid=${e}&limit=50`,{credentials:"include"});if(t.ok){const{history:e}=await t.json();return e}return null}function g(e,t){return l("/api/auth/change_passwd",{password:t,newPassword:e})}async function w(){return c("/api/auth/resend_verify")}async function y(){return!c("/api/auth/logout").errors}function b(e){return l("/api/auth/change_name",{name:e})}function S(e,t){return l("/api/auth/change_mail",{email:e,password:t})}function E(e,t){return l("/api/auth/local",{nameoremail:e,password:t})}function C(e,t,n,i,o){return l("/api/auth/register",{name:e,email:t,password:n,captcha:i,captchaid:o})}function T(e){return l("/api/auth/restore_password",{email:e})}function k(e){return l("/api/auth/delete_account",{password:e})}function I(){return c("/ranking",!1)}function x(){return c("/api/baninfo")}async function _(){if(window.me){const e=await window.me;return delete window.me,a(e)}return c("/api/me")}function N(){return c("/api/getiid")}function A(e){return l("/api/banme",{code:e})}},403:(e,t,n)=>{function i(e,t,n){return{type:"ALERT",title:e,message:t,alertType:n,btn:arguments.length>3&&void 0!==arguments[3]?arguments[3]:"باشه"}}function o(){return{type:"CLOSE_ALERT"}}function s(){return{type:"s/TGL_HISTORICAL_VIEW"}}function r(){return{type:"s/TGL_EASTER_EGG"}}function a(){return{type:"s/TGL_GRID"}}function l(){return{type:"s/TGL_PXL_NOTIFY"}}function c(){return{type:"s/TGL_MVM_CTRLS"}}function d(){return{type:"s/TGL_AUTO_ZOOM_IN"}}function u(){return{type:"s/TGL_ONLINE_CANVAS"}}function h(){return{type:"s/TGL_MUTE"}}function f(){return{type:"s/TGL_COMPACT_PALETTE"}}function p(){return{type:"s/TGL_CHAT_NOTIFY"}}function v(){return{type:"s/TGL_POTATO_MODE"}}function m(){return{type:"s/TGL_LIGHT_GRID"}}function g(){return{type:"s/TGL_OPEN_PALETTE"}}function w(e,t){return{type:"s/SELECT_HOLD_PAINT",value:e,immediate:t}}function y(){return{type:"SELECT_HOVER_COLOR"}}function b(e){return{type:"s/SELECT_STYLE",style:e}}function S(){return{type:"s/TGL_OPEN_MENU"}}function E(e){return{type:"SET_HOVER",hover:e}}function C(){return{type:"UNSET_HOVER"}}function T(e){return{type:"SET_MOBILE",mobile:e}}function k(){return{type:"WIN_RESIZE"}}function I(e){return{type:"SELECT_COLOR",color:e}}function x(e){return{type:"s/SELECT_CANVAS",canvasId:String(e)}}function _(e){return{type:"UPDATE_VIEW",view:e}}function N(e){return{type:"SET_VIEW_COORDINATES",view:e}}function A(e){return{type:"s/SET_MOVE_U",value:e}}function O(e){return{type:"s/SET_MOVE_V",value:e}}function L(e){return{type:"s/SET_MOVE_W",value:e}}function P(e){return{type:"s/CANCEL_MOVE",value:e}}function R(e){return{type:"REQ_BIG_CHUNK",center:e}}function $(e){return{type:"REMOVE_CHUNKS",chunks:e}}function D(e){return{type:"REC_BIG_CHUNK",chunk:e}}function M(e,t){return{type:"REC_BIG_CHUNK_FAILURE",chunk:e,error:t}}function W(e){return{type:"s/REC_ME",...e}}function H(e){const{ranking:t,dailyRanking:n,dailyCRanking:i,prevTop:o,onlineStats:s,cHistStats:r,histStats:a,pDailyStats:l,pHourlyStats:c}=e;return{type:"REC_STATS",totalRanking:t,totalDailyRanking:n,dailyCRanking:i,prevTop:o,onlineStats:s,cHistStats:r,histStats:a,pDailyStats:l,pHourlyStats:c}}function U(e,t){return{type:"s/REQ_CHAT_MESSAGE",text:e,channel:t}}function V(){return{type:"s/LOGOUT"}}function G(e){return{type:"s/LOGIN",...e}}function F(e){return{type:"s/SET_NAME",name:e}}function z(e){return{type:"s/SET_MAILREG",mailreg:e}}function B(e){return{type:"MARK_CHANNEL_AS_READ",cid:e}}function Z(){return(e,t)=>{setInterval((function(){const n=function(e){const t=[],n=Date.now(),{wait:i}=e.user,o=i-n;return null!=i&&(o>0?t.push(function(e){return{type:"COOLDOWN_SET",coolDown:e}}(o)):t.push({type:"COOLDOWN_END"})),t}(t());e(n)}),333)}}function j(e,t){return{type:"s/BLOCK_USER",userId:e,userName:t}}function K(e,t){return{type:"s/UNBLOCK_USER",userId:e,userName:t}}function Y(e){return{type:"s/SET_BLOCKING_DM",blockDm:e}}function q(e){return{type:"s/SET_PRIVATE",priv:e}}function Q(e){return{type:"s/MUTE_CHAT_CHANNEL",cid:e}}function X(e){return{type:"s/UNMUTE_CHAT_CHANNEL",cid:e}}function J(e,t){return{type:"SET_HISTORICAL_TIME",date:e,time:t}}function ee(){return{type:"RELOAD_URL"}}function te(){return{type:"t/UNLOAD"}}function ne(e){const{id:t,name:n,mailreg:i,blockDm:o,userlvl:s}=e.user,{canvases:r}=e.canvas,{blocked:a,channels:l}=e.chat,{ranking:c,dailyRanking:d,totalPixels:u,dailyTotalPixels:h}=e.ranks;return{type:"s/REC_ME",blockDm:o,blocked:a,canvases:r,channels:l,dailyRanking:d,dailyTotalPixels:h,id:t,mailreg:i,name:n,ranking:c,totalPixels:u,userlvl:s}}n.d(t,{$t:()=>h,Ai:()=>Y,BH:()=>C,Cd:()=>f,Eo:()=>B,FI:()=>s,GY:()=>ne,GZ:()=>E,Hw:()=>W,IN:()=>q,KB:()=>g,M6:()=>o,MM:()=>b,NK:()=>_,OJ:()=>P,Oh:()=>I,Or:()=>y,Qr:()=>k,RL:()=>v,Rz:()=>te,SC:()=>x,TG:()=>R,TX:()=>V,Tl:()=>H,UI:()=>i,UW:()=>w,WW:()=>L,Xb:()=>l,Y2:()=>z,_:()=>u,_P:()=>D,bE:()=>U,bv:()=>T,c7:()=>p,fL:()=>ee,ge:()=>$,mW:()=>A,mx:()=>O,nb:()=>Q,o7:()=>d,on:()=>J,pH:()=>G,qC:()=>F,qP:()=>c,rf:()=>j,sW:()=>M,ts:()=>m,u0:()=>r,vN:()=>S,vb:()=>Z,w5:()=>N,wC:()=>X,xK:()=>a,zv:()=>K})},395:(e,t,n)=>{function i(){return{type:"w/CLOSE"}}function o(){return{type:"w/OPEN"}}function s(e,t,n,i,o){return(s,r)=>{i=Number(i);const a=r();let l;l=a.windows?a.windows.windows.some((e=>"CHAT"===e.windowType&&!e.hidden))&&Object.values(a.windows.args).some((e=>e.chatChannel===i)):"CHAT"===a.popup.windowType||a.popup.args.chatChannel===i,s({type:"s/REC_CHAT_MESSAGE",name:e,text:t,country:n,channel:i,user:o,isPing:!1,isRead:l})}}function r(e){return{type:"REC_COOLDOWN",wait:e}}function a(e){return{type:"REC_ONLINE",online:e}}function l(e){return{type:"s/ADD_CHAT_CHANNEL",channel:e}}function c(e){return{type:"s/REMOVE_CHAT_CHANNEL",cid:e}}function d(e){return{type:"SET_PXLS_FETCHING",fetching:e}}function u(e){return e.type="REC_SET_PXLS",e}n.d(t,{$s:()=>o,At:()=>r,W1:()=>u,WV:()=>i,Wm:()=>a,cC:()=>d,dm:()=>l,jg:()=>c,pl:()=>s})},669:(e,t,n)=>{n.d(t,{K6:()=>v,Ox:()=>h,R0:()=>f,TL:()=>u,YB:()=>l,aM:()=>d,eg:()=>p,h4:()=>g,mP:()=>c});var i=n(631),o=n(403),s=n(395);function r(e){return{type:"SET_API_FETCHING",fetching:e}}function a(e){return{type:"s/SET_CHAT_FETCHING",fetching:e}}function l(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return async n=>{n(r(!0));const a=await(0,i.I6)(e);if("string"==typeof a)n((0,o.UI)("Direct Message Error",a,"error","OK"));else{const e=Number(Object.keys(a)[0]);n((0,s.dm)(a)),t&&t(e)}n(r(!1))}}function c(){return async e=>{const t=await(0,i.K$)();t.errors||e((0,o.Tl)(t))}}function d(){return async e=>{const t=await(0,i.A)();t.errors||e((0,o.Hw)(t))}}function u(e){return async t=>{t(a(!0));const n=await(0,i.uw)(e);n?(setTimeout((()=>{t(a(!1))}),500),t(function(e,t){return{type:"s/REC_CHAT_HISTORY",cid:e,history:t}}(e,n))):setTimeout((()=>{t(a(!1))}),5e3)}}function h(e,t,n){return async s=>{s(r(!0));const a=await(0,i.PS)(e,n);s(a?(0,o.UI)("User Block Error",a,"error","OK"):n?(0,o.rf)(e,t):(0,o.zv)(e,t)),s(r(!1))}}function f(e){return async t=>{t(r(!0));const n=await(0,i.E1)(e);t(n?(0,o.UI)("Blocking DMs Error",n,"error","OK"):(0,o.Ai)(e)),t(r(!1))}}function p(e){return async t=>{t(r(!0));const n=await(0,i.ko)(e);t(n?(0,o.UI)("Setting User Private Error",n,"error","OK"):(0,o.IN)(e)),t(r(!1))}}function v(e){return async t=>{t(r(!0));const n=await(0,i.AP)(e);t(n?(0,o.UI)("Leaving Channel Error",n,"error","OK"):(0,s.jg)(e)),t(r(!1))}}let m=null;function g(e){return t=>{t(function(e){return{type:"SET_NOTIFICATION",notification:e}}(e)),m&&(clearTimeout(m),m=null),m=setTimeout((()=>{t({type:"UNSET_NOTIFICATION"})}),1500)}}},130:(e,t,n)=>{n.d(t,{s:()=>i,x:()=>o});const i=e=>-1!==e.gui.style.indexOf("dark"),o=e=>[e.canvas.is3D,e.gui.showMvmCtrls||e.user.isOnMobile&&(e.canvas.is3D||e.gui.holdPaint>0&&!e.canvas.isHistoricalView)]},802:(e,t,n)=>{n.d(t,{Z:()=>i});const i=class{recUpdates=!1;timestamp;z;i;j;constructor(e,t,n){this.timestamp=Date.now(),this.z=e,this.i=t,this.j=n}get id(){return this.i<<8|this.j}touch(){this.timestamp=Date.now()}destructor(){}}},686:(e,t,n)=>{n.d(t,{Z:()=>s});var i=n(403),o=n(940);const s=class{#t;#o=new Map;#s;constructor(e,t){this.#t=e,this.#s=t}get canvasId(){return this.#s}get recChunkIds(){const e=[];return this.#o.forEach((t=>{t.recUpdates&&e.push(t.id)})),e}destructor(){this.#o.forEach((e=>{e.destructor()})),this.#o=new Map}cget(e){return this.#o.get(e)}cset(e,t){this.#o.set(e,t)}bcReqChunk(e){const{z:t,i:n,j:o}=e;this.#t.dispatch((0,i.TG)([t,n,o]))}bcRecChunk(e){this.#t.dispatch((0,i._P)(e));const{size:t}=this.#o;if(t>o.U4){const e=t-Math.floor(.9*o.U4),n=Array.from(this.#o.entries()).sort(((e,t)=>e[1].timestamp-t[1].timestamp)).slice(0,e);n.forEach((e=>{let[t]=e;this.#o.delete(t)}));const i=n.map((e=>e[1]));this.bcRemoveChunks(i),console.log(`Cleared ${i.length} to cut amount of chunks to ${this.#o.size}`)}}bcReqChunkFail(e,t){this.#t.dispatch((0,i.sW)(e,t.message))}bcRemoveChunks(e){this.#t.dispatch((0,i.ge)(e))}gc(e){const t=Date.now()-o.WF,n=this.#o,i=[];n.forEach(((o,s)=>{if(t>o.timestamp){const{z:t,i:r,j:a}=o;e.isChunkInView(t,r,a)||(i.push(o),n.delete(s),o.destructor())}})),i.length&&this.bcRemoveChunks(i),console.log(`GC cleaned ${i.length} / ${n.size+i.length} chunks`)}}},906:(e,t,n)=>{n.d(t,{Z:()=>r});var i=n(403),o=n(395),s=n(669);const r=new class{constructor(){this.requestFromQueue=this.requestFromQueue.bind(this),this.pixelQueue=[],this.clientPredictions=[],this.extension=null,window.registerPixelUpdates=e=>{this.extension=e}}initialize(e,t,n){this.store=e,this.socketClient=t,this.getRenderer=n}async requestFromQueue(){const{store:e}=this;if(!this.pixelQueue.length)return void e.dispatch((0,o.cC)(!1));e.dispatch((0,o.cC)(!0));const{i:t,j:n,pixels:r}=this.pixelQueue.shift();let a;try{a=await this.socketClient.sendPixelUpdate(t,n,r)}catch{a={retCode:16,coolDownSeconds:0,pxlCnt:0},e.dispatch((0,i.UI)("سید سایتو پاره کردی تابم اوت خوردی، رفرش کن","Didn't get an answer from pixelplanet. Try to refresh if this problem persists.","error"))}const{retCode:l,coolDownSeconds:c,pxlCnt:d}=a;if(c&&e.dispatch((0,s.h4)(c)),d<r.length){const[e]=r[d];this.revertPredictionsAt(t,n,e),this.pixelQueue=[]}let u=null,h=null,f="error";switch(l){case 0:case 9:break;case 1:u="بوم پیدا نشد",h="این بوم وجود ندارد";break;case 2:u="مختصات اشتباه است",h="ایکس خارج از محدوده است";break;case 3:u="مختصات اشتباه است",h="ایگرگ خارج از محدوده است";break;case 4:u="مختصات اشتباه است",h="زد خارج از محدوده است";break;case 5:u="رنگ اشتباهی انتخاب کرده اید",h="سید رنگ نادرستی انتخاب کردین";break;case 6:u="فقط برای کاربران ثبت نام شده",h="باید توی سایت ثبت نام کنی که از این بوم بتونی استفاده کنی سید";break;case 7:u="قابل قبول نیست سید",h="You can not access this canvas yet, because your pixel score is too low";break;case 8:e.dispatch((0,s.h4)("Pixel protected"));break;case 10:u="Captcha",h="اثبات کن که انسان هستی سید",f="captcha";break;case 11:u="قابل قبول نیست سید",h="داری از فیلترشکن استفاده میکنی؟ نگران نباش سایت فیلتر نیست، البته نمیدونم فردا فیلتره یا نه";break;case 12:u="قابل قبول نیست سید",h="فقط تاپ 10 ها میتونن اینجا فعالیت کنند سید";break;case 13:u="سید داری یاهود بازی در میاری؟",h="انقدر پیکسل گذاشتی سایت به خاک رفت سید، داری از چندتا گوشی استفاده میکنی؟ اگر کیا داره اینو میخونه باید بگم هنوز کونی هستی سید";break;case 14:u="بن شدی سید، بهت گفتیم یاهود بازی در نیار",f="ban";break;case 15:u="رنج بن شدی سید",h="Your Internet Provider is banned from this game";break;case 16:u="سید سایتو پاره کردی تابم اوت خوردی، رفرش کن",h="Didn't get an answer from pixelplanet. Try to refresh if this problem persists.";break;default:u="عجیب",h="پیکسل گذاشته نشد"}(h||u)&&e.dispatch((0,i.UI)(u||`Error ${l}`,h,f)),e.dispatch((0,o.W1)(a)),setTimeout(this.requestFromQueue,100)}revertPredictionsAt(e,t,n){const i=this.getRenderer(),{clientPredictions:o}=this;let s=0;for(;s<o.length;){const i=o[s];if(i[0]===e&&i[1]===t&&i[2]===n)break;s+=1}const r=s;for(;s<o.length;){const[e,t,n,r]=o[s];i.renderPixel(e,t,n,r,!1),s+=1}this.clientPredictions.splice(r)}receivePixelUpdate(e){let{i:t,j:n,pixels:i}=e;this.extension&&this.extension(t,n,i),i.forEach((e=>{const[i,o]=e,{clientPredictions:s}=this;for(let e=0;e<s.length;e+=1){const r=s[e];if(r[0]===t&&r[1]===n&&r[2]===i)return void(r[4]===o?s.splice(e,1):r[3]=o)}this.getRenderer().renderPixel(t,n,i,o,!0)}))}tryPlacePixel(e,t,n,i,o){this.getRenderer().renderPixel(e,t,n,i,!1),this.clientPredictions.push([e,t,n,o,i]);const{pixelQueue:s}=this;if(s.length){const o=s[s.length-1],{i:r,j:a}=o;if(e===r&&t===a)return void o.pixels.push([n,i])}s.push({i:e,j:t,pixels:[[n,i]]}),this.store.getState().fetching.fetchingPixel||this.requestFromQueue()}}},785:(e,t,n)=>{n.d(t,{Z:()=>s});var i=n(940),o=n(403);const s=class{store;controls={update(){}};chunkLoader=null;is3D=null;forceNextRender=!0;forceNextSubrender=!0;_view=[0,0,0];#r=null;constructor(e){this.store=e}get view(){return[...this._view]}get chunks(){return this.chunkLoader.chunks}get recChunkIds(){return this.chunkLoader?this.chunkLoader.recChunkIds:[]}destructor(){this.chunkLoader?.destructor(),this.cancelStoreViewInState()}updateView(e){for(let t=0;t<e.length;t+=1)this._view[t]=e[t]}loadViewFromState(){this.store&&this.updateView(this.store.getState().canvas.view)}cancelStoreViewInState(){this.#r&&(clearTimeout(this.#r),this.#r=null)}storeViewInState(){this.store&&(this.cancelStoreViewInState(),this.#r=setTimeout((()=>{this.#r=null,this.store.dispatch((0,o.NK)(this.view))}),i.wL))}render(){return this.controls.update(this.forceNextRender)}renderPixel(){}updateCanvasData(){}getPointedColor(){return null}isChunkInView(){return!0}gc(){this.chunkLoader?.gc(this)}}},917:(e,t,n)=>{async function i(e){e.toBlob((e=>{try{if(!navigator.clipboard)throw new Error("Clipboard API not implemented");navigator.clipboard.write([new ClipboardItem({"image/png":e})])}catch(e){console.log("Couldn't copy canvas to clipboard",e)}}),"image/png")}n.d(t,{Z:()=>o,w:()=>i});const o=async function(e){if(!navigator.clipboard)return function(e){const t=document.createElement("textarea");t.value=e,t.style.top="0",t.style.left="0",t.style.position="fixed",document.body.appendChild(t),t.focus(),t.select();try{const e=document.execCommand("copy");return document.body.removeChild(t),e}catch{return document.body.removeChild(t),!1}}(e);try{return await navigator.clipboard.writeText(e),!0}catch{return!1}}},875:(e,t,n)=>{function i(e){const t=document.createElement("canvas");return t.width=e.naturalWidth,t.height=e.naturalHeight,t.getContext("2d").drawImage(e,0,0),t}function o(e){return new Promise(((t,n)=>{const o=new FileReader;o.onload=()=>{const e=new Image;e.onload=()=>{t(i(e))},e.onerror=e=>n(e),e.src=o.result},o.onerror=e=>n(e),o.readAsDataURL(e)}))}function s(e,t){return o(new Blob([e],{type:t}))}function r(e,t){return new Promise(((n,i)=>{e.toBlob((e=>{e.arrayBuffer().then(n).catch(i)}),t)}))}n.d(t,{NE:()=>o,NF:()=>s,nE:()=>r,zE:()=>i})}},o={};function s(e){var t=o[e];if(void 0!==t)return t.exports;var n=o[e]={exports:{}};return i[e](n,n.exports,s),n.exports}s.m=i,e=[],s.O=(t,n,i,o)=>{if(!n){var r=1/0;for(d=0;d<e.length;d++){for(var[n,i,o]=e[d],a=!0,l=0;l<n.length;l++)(!1&o||r>=o)&&Object.keys(s.O).every((e=>s.O[e](n[l])))?n.splice(l--,1):(a=!1,o<r&&(r=o));if(a){e.splice(d--,1);var c=i();void 0!==c&&(t=c)}}return t}o=o||0;for(var d=e.length;d>0&&e[d-1][2]>o;d--)e[d]=e[d-1];e[d]=[n,i,o]},s.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return s.d(t,{a:t}),t},s.d=(e,t)=>{for(var n in t)s.o(t,n)&&!s.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},s.f={},s.e=e=>Promise.all(Object.keys(s.f).reduce(((t,n)=>(s.f[n](e,t),t)),[])),s.u=e=>841===e?"three.1848d82f.js":{189:"modtools",545:"converter",784:"stats",882:"voxel"}[e]+".fa."+{189:"94019e8e",545:"380b3add",784:"d081aa7d",882:"5de4fbcc"}[e]+".js",s.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),t={},n="pixelplanet:",s.l=(e,i,o,r)=>{if(t[e])t[e].push(i);else{var a,l;if(void 0!==o)for(var c=document.getElementsByTagName("script"),d=0;d<c.length;d++){var u=c[d];if(u.getAttribute("src")==e||u.getAttribute("data-webpack")==n+o){a=u;break}}a||(l=!0,(a=document.createElement("script")).charset="utf-8",a.timeout=120,s.nc&&a.setAttribute("nonce",s.nc),a.setAttribute("data-webpack",n+o),a.src=e),t[e]=[i];var h=(n,i)=>{a.onerror=a.onload=null,clearTimeout(f);var o=t[e];if(delete t[e],a.parentNode&&a.parentNode.removeChild(a),o&&o.forEach((e=>e(i))),n)return n(i)},f=setTimeout(h.bind(null,void 0,{type:"timeout",target:a}),12e4);a.onerror=h.bind(null,a.onerror),a.onload=h.bind(null,a.onload),l&&document.head.appendChild(a)}},s.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},s.j=47,s.p="/assets/",(()=>{var e={47:0};s.f.j=(t,n)=>{var i=s.o(e,t)?e[t]:void 0;if(0!==i)if(i)n.push(i[2]);else{var o=new Promise(((n,o)=>i=e[t]=[n,o]));n.push(i[2]=o);var r=s.p+s.u(t),a=new Error;s.l(r,(n=>{if(s.o(e,t)&&(0!==(i=e[t])&&(e[t]=void 0),i)){var o=n&&("load"===n.type?"missing":n.type),r=n&&n.target&&n.target.src;a.message="Loading chunk "+t+" failed.\n("+o+": "+r+")",a.name="ChunkLoadError",a.type=o,a.request=r,i[1](a)}}),"chunk-"+t,t)}},s.O.j=t=>0===e[t];var t=(t,n)=>{var i,o,[r,a,l]=n,c=0;if(r.some((t=>0!==e[t]))){for(i in a)s.o(a,i)&&(s.m[i]=a[i]);if(l)var d=l(s)}for(t&&t(n);c<r.length;c++)o=r[c],s.o(e,o)&&e[o]&&e[o][0](),e[o]=0;return s.O(d)},n=self.webpackChunkpixelplanet=self.webpackChunkpixelplanet||[];n.forEach(t.bind(null,0)),n.push=t.bind(null,n.push.bind(n))})();var r=s.O(void 0,[736],(()=>s(633)));r=s.O(r)})();